import{r as k,j as t}from"./index-4Z_ADcz-.js";import{u as y}from"./index.esm-DeTgqkeM.js";import{u as S}from"./useQuery-gRsyD88e.js";import{u as i}from"./useMutation-hs9vH3uM.js";import{a as o}from"./auth-DmMH8tdr.js";import{apiClient as V}from"./client-CSi9HbAr.js";import{u as j,C as p}from"./useToast-CdNAe9X_.js";import{B as d}from"./Button-O3SqeR70.js";import{I as m}from"./Input-DUHma6SA.js";import{u as T}from"./useTranslation-GDJgXote.js";import{S as I}from"./save-Cng4afaR.js";import"./cn-BLSKlp9E.js";const M=()=>{const{register:u,handleSubmit:b}=y(),s=j(),{t:e}=T(),[n,r]=k.useState(""),{data:a,isLoading:h,refetch:g}=S({queryKey:["telegram-link-status"],queryFn:()=>o.getTelegramLink()}),c=i({mutationFn:async l=>{await V.put("/settings/telegram",l)},onSuccess:()=>{s.success(e("common.success",{defaultValue:"Success"}),e("telegramSettings.toast.saved",{defaultValue:"Restart backend to apply changes."}))},onError:l=>{s.error(e("common.error",{defaultValue:"Error"}),(l==null?void 0:l.message)||e("telegramSettings.toast.saveFailed",{defaultValue:"Failed to save Telegram settings"}))}});k.useEffect(()=>{a!=null&&a.telegramId?r(a.telegramId):r("")},[a==null?void 0:a.telegramId]);const f=i({mutationFn:async()=>o.linkTelegram(n),onSuccess:async()=>{await g(),s.success(e("common.success",{defaultValue:"Success"}),e("telegramSettings.toast.linked",{defaultValue:"Telegram account linked to current admin."}))},onError:l=>{s.error(e("common.error",{defaultValue:"Error"}),(l==null?void 0:l.message)||e("telegramSettings.toast.linkFailed",{defaultValue:"Failed to link Telegram account"}))}}),x=i({mutationFn:async()=>o.unlinkTelegram(),onSuccess:async()=>{await g(),s.success(e("common.success",{defaultValue:"Success"}),e("telegramSettings.toast.unlinked",{defaultValue:"Telegram account unlinked from current admin."}))},onError:l=>{s.error(e("common.error",{defaultValue:"Error"}),(l==null?void 0:l.message)||e("telegramSettings.toast.unlinkFailed",{defaultValue:"Failed to unlink Telegram account"}))}});return t.jsxs("div",{className:"space-y-6",children:[t.jsxs(p,{children:[t.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900 dark:text-white",children:e("telegramSettings.link.title",{defaultValue:"Telegram admin link"})}),h?t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("telegramSettings.link.loading",{defaultValue:"Loading Telegram link status..."})}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-800/50",children:[t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e("telegramSettings.link.statusLabel",{defaultValue:"Status"}),":"," ",t.jsx("span",{className:a!=null&&a.linked?"font-semibold text-green-600 dark:text-green-400":"font-semibold text-yellow-600 dark:text-yellow-400",children:a!=null&&a.linked?e("telegramSettings.link.statusLinked",{defaultValue:"Linked"}):e("telegramSettings.link.statusNotLinked",{defaultValue:"Not linked"})})]}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[e("telegramSettings.link.currentIdLabel",{defaultValue:"Current ID"}),":"," ",(a==null?void 0:a.telegramId)||e("common.na",{defaultValue:"N/A"})]})]}),t.jsx(m,{label:e("telegramSettings.link.telegramIdLabel",{defaultValue:"Telegram ID"}),value:n,onChange:l=>r(l.target.value),placeholder:e("telegramSettings.link.telegramIdPlaceholder",{defaultValue:"123456789"})}),t.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[t.jsx(d,{onClick:()=>f.mutate(),loading:f.isPending,disabled:!n.trim(),children:e("telegramSettings.link.linkButton",{defaultValue:"Link Telegram"})}),t.jsx(d,{variant:"secondary",onClick:()=>x.mutate(),loading:x.isPending,disabled:!(a!=null&&a.linked),children:e("telegramSettings.link.unlinkButton",{defaultValue:"Unlink Telegram"})})]})]})]}),t.jsxs(p,{children:[t.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900 dark:text-white",children:e("telegramSettings.bot.title",{defaultValue:"Telegram bot configuration"})}),t.jsxs("form",{onSubmit:b(l=>c.mutate(l)),className:"space-y-4",children:[t.jsx(m,{label:e("telegramSettings.bot.botTokenLabel",{defaultValue:"Bot token"}),...u("botToken"),placeholder:"123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11"}),t.jsx(m,{label:e("telegramSettings.bot.adminIdsLabel",{defaultValue:"Admin chat IDs (comma-separated)"}),...u("adminIds"),placeholder:"123456789,987654321"}),t.jsx("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-4 dark:border-yellow-900/50 dark:bg-yellow-900/20",children:t.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[t.jsxs("strong",{children:[e("telegramSettings.bot.helpTitle",{defaultValue:"How to get your Chat ID"}),":"]}),t.jsx("br",{}),e("telegramSettings.bot.helpStep1",{defaultValue:"1. Message @userinfobot on Telegram"}),t.jsx("br",{}),e("telegramSettings.bot.helpStep2",{defaultValue:"2. It will reply with your Chat ID"}),t.jsx("br",{}),e("telegramSettings.bot.helpStep3",{defaultValue:"3. Add it to the field above"})]})}),t.jsxs(d,{type:"submit",className:"w-full",loading:c.isPending,children:[t.jsx(I,{className:"mr-2 h-4 w-4"}),e("telegramSettings.bot.saveButton",{defaultValue:"Save settings"})]})]})]})]})};export{M as default};
