import{c as De,h as jt,r as a,j as e}from"./index-4Z_ADcz-.js";import{B as Ce}from"./Badge-CrCszQn7.js";import{B as c}from"./Button-O3SqeR70.js";import{u as le,C as f}from"./useToast-CdNAe9X_.js";import{I as h}from"./Input-DUHma6SA.js";import{C as vt}from"./ConfirmDialog-CalzctL4.js";import{u as Te}from"./useDebouncedValue-DatrE2cU.js";import{a as Nt,u as Vt,b as St,c as wt,d as Ct,e as Tt,f as kt,g as Pt,h as Lt,i as It,j as Dt,k as Rt,l as Et,m as Gt,n as Mt,o as At}from"./useGroups-DQ1RQ18m.js";import{b as Ft}from"./useUsers-DLW3FWGw.js";import{u as re,R as ke}from"./useTranslation-GDJgXote.js";import{P as Pe}from"./plus-DVnLX_9u.js";import{L as He}from"./layers-3-I7nEP956.js";import{S as We}from"./sparkles-Df43QBZq.js";import{S as Le}from"./search-xHQPHtMA.js";import{W as Ut}from"./wifi-DfyFc3I4.js";import{T as Ie}from"./trash-2-zeQBfENx.js";import"./cn-BLSKlp9E.js";import"./useQuery-gRsyD88e.js";import"./inbounds-BCv4m568.js";import"./client-CSi9HbAr.js";import"./useMutation-hs9vH3uM.js";import"./users-Be35gZk0.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=De("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=De("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=De("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);function ge(t){const r=(t==null?void 0:t.meta)||(t==null?void 0:t.pagination);if(r&&!(typeof r.page!="number"||typeof r.limit!="number"||typeof r.total!="number"||typeof r.totalPages!="number"))return r}function Qe(t,r){return t.includes(r)?t.filter(u=>u!==r):[...t,r]}function X(t){if(t==null||t==="")return"";const r=Number(t);return Number.isNaN(r)?"":String(r)}function Je(t){const r=t.trim();if(!r)return null;const u=Number(r);return Number.isFinite(u)?u:null}function te(t){const r=t.trim();if(!r)return null;const u=Number.parseInt(r,10);return Number.isInteger(u)?u:null}function Ze(t){return Array.from(new Set(t.split(",").map(r=>Number.parseInt(r.trim(),10)).filter(r=>Number.isInteger(r)&&r>0)))}function Xe(t,r){const u=[];if(t.dataLimit!==null&&t.dataLimit!==void 0&&u.push(r("groups.chips.dataLimit",{defaultValue:"Limit: {{value}} GB",value:t.dataLimit})),t.expiryDays!==null&&t.expiryDays!==void 0&&u.push(r("groups.chips.expiryDays",{defaultValue:"Expiry: {{value}}d",value:t.expiryDays})),t.ipLimit!==null&&t.ipLimit!==void 0&&u.push(r("groups.chips.ipLimit",{defaultValue:"IP: {{value}}",value:t.ipLimit})),t.status){const g=`status.${String(t.status).toLowerCase()}`;u.push(r("groups.chips.status",{defaultValue:"Status: {{value}}",value:r(g,{defaultValue:String(t.status)})}))}if(t.trafficResetPeriod){const g=`groups.resetPeriod.${String(t.trafficResetPeriod).toLowerCase()}`,C=r(g,{defaultValue:String(t.trafficResetPeriod)});t.trafficResetDay?u.push(r("groups.chips.resetWithDay",{defaultValue:"Reset: {{period}}@{{day}}",period:C,day:t.trafficResetDay})):u.push(r("groups.chips.reset",{defaultValue:"Reset: {{period}}",period:C}))}return u}function Ot({group:t,users:r,inbounds:u,saving:g,onClose:C,onSubmit:d}){const p=le(),{t:l}=re(),[N,j]=a.useState(""),[P,v]=a.useState(""),[T,V]=a.useState(!1),[S,w]=a.useState(""),[x,G]=a.useState(""),[R,L]=a.useState(""),[I,E]=a.useState(""),[M,k]=a.useState(""),[$,o]=a.useState(""),[_,H]=a.useState([]),[J,ee]=a.useState([]),[W,de]=a.useState(""),[K,oe]=a.useState("");a.useEffect(()=>{var n,b;j((t==null?void 0:t.name)||""),v((t==null?void 0:t.remark)||""),V(!!(t!=null&&t.isDisabled)),w(X(t==null?void 0:t.dataLimit)),G(X(t==null?void 0:t.expiryDays)),L(X(t==null?void 0:t.ipLimit)),E((t==null?void 0:t.status)||""),k((t==null?void 0:t.trafficResetPeriod)||""),o(X(t==null?void 0:t.trafficResetDay)),H(((n=t==null?void 0:t.users)==null?void 0:n.map(A=>A.userId))||[]),ee(((b=t==null?void 0:t.inbounds)==null?void 0:b.map(A=>A.inboundId))||[]),de(""),oe("")},[t]);const Z=a.useMemo(()=>{const n=W.trim().toLowerCase();return n?r.filter(b=>b.email.toLowerCase().includes(n)):r},[r,W]),ne=a.useMemo(()=>{const n=K.trim().toLowerCase();return n?u.filter(b=>[b.tag,b.remark||"",b.protocol,String(b.port)].join(" ").toLowerCase().includes(n)):u},[u,K]),se=async()=>{const n=N.trim();if(!n){p.error(l("common.validationFailed",{defaultValue:"Validation failed"}),l("groups.editor.nameRequired",{defaultValue:"Group name is required."}));return}await d({name:n,remark:P.trim(),isDisabled:T,dataLimit:Je(S),expiryDays:te(x),ipLimit:te(R),status:I||null,trafficResetPeriod:M||null,trafficResetDay:te($),userIds:_,inboundIds:J})};return e.jsx("div",{className:"fixed inset-0 z-[80] flex items-center justify-center bg-black/55 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"glass-panel max-h-[90vh] w-full max-w-5xl overflow-hidden rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-line/70 px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:t?l("groups.editor.editTitle",{defaultValue:"Edit Group"}):l("groups.editor.createTitle",{defaultValue:"Create Group"})}),e.jsx("p",{className:"text-sm text-muted",children:l("groups.editor.subtitle",{defaultValue:"Reusable user, inbound and policy bundle."})})]}),e.jsx(c,{variant:"secondary",onClick:C,children:l("common.close",{defaultValue:"Close"})})]}),e.jsxs("div",{className:"max-h-[calc(90vh-10rem)] space-y-5 overflow-y-auto px-6 py-5",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(h,{label:l("groups.editor.nameLabel",{defaultValue:"Group Name *"}),value:N,onChange:n=>j(n.target.value),placeholder:l("groups.editor.namePlaceholder",{defaultValue:"Premium users"})}),e.jsx(h,{label:l("groups.editor.remarkLabel",{defaultValue:"Remark"}),value:P,onChange:n=>v(n.target.value),placeholder:l("groups.editor.remarkPlaceholder",{defaultValue:"Optional note"})})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:n=>V(n.target.checked),className:"h-4 w-4 rounded border-line bg-card text-brand-500"}),l("groups.editor.disableGroup",{defaultValue:"Disable this group"})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-muted",children:l("groups.editor.policyOverridesTitle",{defaultValue:"Policy Overrides"})}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:l("groups.editor.policyOverridesHint",{defaultValue:"Leave empty to inherit each user policy."})}),e.jsxs("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:[e.jsx(h,{label:l("groups.editor.dataLimitLabel",{defaultValue:"Data Limit (GB)"}),type:"number",min:0,value:S,onChange:n=>w(n.target.value)}),e.jsx(h,{label:l("users.expiryDays",{defaultValue:"Expiry Days"}),type:"number",min:1,value:x,onChange:n=>G(n.target.value)}),e.jsx(h,{label:l("groups.editor.ipLimitLabel",{defaultValue:"IP Limit (0 = unlimited)"}),type:"number",min:0,value:R,onChange:n=>L(n.target.value)}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:l("groups.editor.statusOverride",{defaultValue:"Status Override"})}),e.jsxs("select",{value:I,onChange:n=>E(n.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"",children:l("groups.editor.noOverride",{defaultValue:"No override"})}),e.jsx("option",{value:"ACTIVE",children:l("status.active",{defaultValue:"Active"})}),e.jsx("option",{value:"LIMITED",children:l("status.limited",{defaultValue:"Limited"})}),e.jsx("option",{value:"EXPIRED",children:l("status.expired",{defaultValue:"Expired"})}),e.jsx("option",{value:"DISABLED",children:l("status.disabled",{defaultValue:"Disabled"})})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:l("groups.editor.trafficResetPeriod",{defaultValue:"Traffic Reset Period"})}),e.jsxs("select",{value:M,onChange:n=>k(n.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"",children:l("groups.editor.noOverride",{defaultValue:"No override"})}),e.jsx("option",{value:"NEVER",children:l("groups.resetPeriod.never",{defaultValue:"NEVER"})}),e.jsx("option",{value:"DAILY",children:l("groups.resetPeriod.daily",{defaultValue:"DAILY"})}),e.jsx("option",{value:"WEEKLY",children:l("groups.resetPeriod.weekly",{defaultValue:"WEEKLY"})}),e.jsx("option",{value:"MONTHLY",children:l("groups.resetPeriod.monthly",{defaultValue:"MONTHLY"})})]})]}),e.jsx(h,{label:l("groups.editor.trafficResetDay",{defaultValue:"Traffic Reset Day"}),type:"number",min:1,max:31,value:$,onChange:n=>o(n.target.value)})]})]}),e.jsxs("div",{className:"grid gap-5 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:l("groups.editor.usersTitle",{defaultValue:"Users ({{count}})",count:_.length})}),e.jsx(h,{value:W,onChange:n=>de(n.target.value),placeholder:l("groups.editor.filterUsers",{defaultValue:"Filter users"}),className:"max-w-[12rem] py-2 text-xs"})]}),e.jsx("div",{className:"max-h-72 space-y-2 overflow-y-auto",children:Z.length===0?e.jsx("p",{className:"text-sm text-muted",children:l("groups.editor.noUsers",{defaultValue:"No users found."})}):Z.map(n=>e.jsxs("label",{className:"flex cursor-pointer items-center justify-between rounded-lg border border-line/60 bg-card/65 px-3 py-2 text-sm",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate font-medium text-foreground",children:n.email}),e.jsx("p",{className:"text-xs text-muted",children:n.status})]}),e.jsx("input",{type:"checkbox",checked:_.includes(n.id),onChange:()=>H(b=>Qe(b,n.id)),className:"h-4 w-4 rounded border-line bg-card text-brand-500"})]},n.id))})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:l("groups.editor.inboundsTitle",{defaultValue:"Inbounds ({{count}})",count:J.length})}),e.jsx(h,{value:K,onChange:n=>oe(n.target.value),placeholder:l("groups.editor.filterInbounds",{defaultValue:"Filter inbounds"}),className:"max-w-[12rem] py-2 text-xs"})]}),e.jsx("div",{className:"max-h-72 space-y-2 overflow-y-auto",children:ne.length===0?e.jsx("p",{className:"text-sm text-muted",children:l("groups.editor.noInbounds",{defaultValue:"No inbounds found."})}):ne.map(n=>e.jsxs("label",{className:"flex cursor-pointer items-center justify-between rounded-lg border border-line/60 bg-card/65 px-3 py-2 text-sm",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"truncate font-medium text-foreground",children:[n.protocol," â€¢ ",n.port]}),e.jsx("p",{className:"truncate text-xs text-muted",children:n.remark||n.tag})]}),e.jsx("input",{type:"checkbox",checked:J.includes(n.id),onChange:()=>ee(b=>Qe(b,n.id)),className:"h-4 w-4 rounded border-line bg-card text-brand-500"})]},n.id))})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-line/70 px-6 py-4",children:[e.jsx(c,{variant:"secondary",onClick:C,children:l("common.cancel",{defaultValue:"Cancel"})}),e.jsx(c,{onClick:()=>void se(),loading:g,children:t?l("groups.editor.saveChanges",{defaultValue:"Save Changes"}):l("groups.editor.createCta",{defaultValue:"Create Group"})})]})]})})}function Yt({template:t,saving:r,onClose:u,onSubmit:g}){const C=le(),{t:d}=re(),[p,l]=a.useState(""),[N,j]=a.useState(""),[P,v]=a.useState(!1),[T,V]=a.useState(""),[S,w]=a.useState(""),[x,G]=a.useState(""),[R,L]=a.useState(""),[I,E]=a.useState(""),[M,k]=a.useState("");a.useEffect(()=>{l((t==null?void 0:t.name)||""),j((t==null?void 0:t.description)||""),v(!!(t!=null&&t.isDefault)),V(X(t==null?void 0:t.dataLimit)),w(X(t==null?void 0:t.expiryDays)),G(X(t==null?void 0:t.ipLimit)),L((t==null?void 0:t.status)||""),E((t==null?void 0:t.trafficResetPeriod)||""),k(X(t==null?void 0:t.trafficResetDay))},[t]);const $=async()=>{const o=p.trim();if(!o){C.error(d("common.validationFailed",{defaultValue:"Validation failed"}),d("groups.templates.editor.nameRequired",{defaultValue:"Template name is required."}));return}await g({name:o,description:N.trim(),isDefault:P,dataLimit:Je(T),expiryDays:te(S),ipLimit:te(x),status:R||null,trafficResetPeriod:I||null,trafficResetDay:te(M)})};return e.jsx("div",{className:"fixed inset-0 z-[85] flex items-center justify-center bg-black/55 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"glass-panel w-full max-w-2xl rounded-2xl",children:[e.jsxs("div",{className:"border-b border-line/70 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:t?d("groups.templates.editor.editTitle",{defaultValue:"Edit Policy Template"}):d("groups.templates.editor.createTitle",{defaultValue:"Create Policy Template"})}),e.jsx("p",{className:"text-sm text-muted",children:d("groups.templates.editor.subtitle",{defaultValue:"Reusable policy overrides for multiple groups."})})]}),e.jsxs("div",{className:"space-y-4 px-6 py-5",children:[e.jsx(h,{label:d("groups.templates.editor.nameLabel",{defaultValue:"Template Name *"}),value:p,onChange:o=>l(o.target.value),placeholder:d("groups.templates.editor.namePlaceholder",{defaultValue:"Monthly 50GB Standard"})}),e.jsx(h,{label:d("groups.templates.editor.descriptionLabel",{defaultValue:"Description"}),value:N,onChange:o=>j(o.target.value),placeholder:d("groups.templates.editor.descriptionPlaceholder",{defaultValue:"Optional details"})}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:o=>v(o.target.checked),className:"h-4 w-4 rounded border-line bg-card text-brand-500"}),d("groups.templates.editor.defaultToggle",{defaultValue:"Mark as default template"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsx(h,{label:d("groups.editor.dataLimitLabel",{defaultValue:"Data Limit (GB)"}),type:"number",min:0,value:T,onChange:o=>V(o.target.value)}),e.jsx(h,{label:d("users.expiryDays",{defaultValue:"Expiry Days"}),type:"number",min:1,value:S,onChange:o=>w(o.target.value)}),e.jsx(h,{label:d("groups.editor.ipLimitLabel",{defaultValue:"IP Limit (0 = unlimited)"}),type:"number",min:0,value:x,onChange:o=>G(o.target.value)}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:d("groups.editor.statusOverride",{defaultValue:"Status Override"})}),e.jsxs("select",{value:R,onChange:o=>L(o.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"",children:d("groups.editor.noOverride",{defaultValue:"No override"})}),e.jsx("option",{value:"ACTIVE",children:d("status.active",{defaultValue:"Active"})}),e.jsx("option",{value:"LIMITED",children:d("status.limited",{defaultValue:"Limited"})}),e.jsx("option",{value:"EXPIRED",children:d("status.expired",{defaultValue:"Expired"})}),e.jsx("option",{value:"DISABLED",children:d("status.disabled",{defaultValue:"Disabled"})})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:d("groups.editor.trafficResetPeriod",{defaultValue:"Traffic Reset Period"})}),e.jsxs("select",{value:I,onChange:o=>E(o.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"",children:d("groups.editor.noOverride",{defaultValue:"No override"})}),e.jsx("option",{value:"NEVER",children:d("groups.resetPeriod.never",{defaultValue:"NEVER"})}),e.jsx("option",{value:"DAILY",children:d("groups.resetPeriod.daily",{defaultValue:"DAILY"})}),e.jsx("option",{value:"WEEKLY",children:d("groups.resetPeriod.weekly",{defaultValue:"WEEKLY"})}),e.jsx("option",{value:"MONTHLY",children:d("groups.resetPeriod.monthly",{defaultValue:"MONTHLY"})})]})]}),e.jsx(h,{label:d("groups.editor.trafficResetDay",{defaultValue:"Traffic Reset Day"}),type:"number",min:1,max:31,value:M,onChange:o=>k(o.target.value)})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-line/70 px-6 py-4",children:[e.jsx(c,{variant:"secondary",onClick:u,children:d("common.cancel",{defaultValue:"Cancel"})}),e.jsx(c,{onClick:()=>void $(),loading:r,children:t?d("groups.editor.saveChanges",{defaultValue:"Save Changes"}):d("groups.templates.editor.createCta",{defaultValue:"Create Template"})})]})]})})}function qt({schedule:t,groups:r,templates:u,saving:g,onClose:C,onSubmit:d}){const p=le(),{t:l}=re(),[N,j]=a.useState(""),[P,v]=a.useState(""),[T,V]=a.useState(""),[S,w]=a.useState("0 3 * * *"),[x,G]=a.useState("UTC"),[R,L]=a.useState(!0),[I,E]=a.useState(!1),[M,k]=a.useState("");a.useEffect(()=>{j((t==null?void 0:t.name)||""),v(t!=null&&t.groupId?String(t.groupId):""),V(t!=null&&t.templateId?String(t.templateId):""),w((t==null?void 0:t.cronExpression)||"0 3 * * *"),G((t==null?void 0:t.timezone)||"UTC"),L((t==null?void 0:t.enabled)??!0),E((t==null?void 0:t.dryRun)??!1),k(((t==null?void 0:t.targetUserIds)||[]).join(","))},[t]);const $=async()=>{const o=Number.parseInt(P,10);if(!Number.isInteger(o)||o<1){p.error(l("common.validationFailed",{defaultValue:"Validation failed"}),l("groups.schedules.editor.groupRequired",{defaultValue:"Please select a valid group."}));return}const _=N.trim();if(!_){p.error(l("common.validationFailed",{defaultValue:"Validation failed"}),l("groups.schedules.editor.nameRequired",{defaultValue:"Schedule name is required."}));return}const H=S.trim();if(!H){p.error(l("common.validationFailed",{defaultValue:"Validation failed"}),l("groups.schedules.editor.cronRequired",{defaultValue:"Cron expression is required."}));return}await d({name:_,groupId:o,templateId:T?Number.parseInt(T,10):null,cronExpression:H,timezone:x.trim()||"UTC",enabled:R,dryRun:I,targetUserIds:Ze(M)})};return e.jsx("div",{className:"fixed inset-0 z-[85] flex items-center justify-center bg-black/55 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"glass-panel w-full max-w-2xl rounded-2xl",children:[e.jsxs("div",{className:"border-b border-line/70 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:t?l("groups.schedules.editor.editTitle",{defaultValue:"Edit Policy Schedule"}):l("groups.schedules.editor.createTitle",{defaultValue:"Create Policy Schedule"})}),e.jsx("p",{className:"text-sm text-muted",children:l("groups.schedules.editor.subtitle",{defaultValue:"Automate recurring group policy rollouts."})})]}),e.jsxs("div",{className:"space-y-4 px-6 py-5",children:[e.jsx(h,{label:l("groups.schedules.editor.nameLabel",{defaultValue:"Schedule Name *"}),value:N,onChange:o=>j(o.target.value),placeholder:l("groups.schedules.editor.namePlaceholder",{defaultValue:"Nightly premium sync"})}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:l("groups.schedules.editor.groupLabel",{defaultValue:"Group *"})}),e.jsxs("select",{value:P,onChange:o=>v(o.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"",children:l("groups.schedules.editor.groupPlaceholder",{defaultValue:"Select group"})}),r.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:l("groups.schedules.editor.templateLabel",{defaultValue:"Template (optional)"})}),e.jsxs("select",{value:T,onChange:o=>V(o.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"",children:l("groups.schedules.editor.noTemplate",{defaultValue:"No template"})}),u.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]}),e.jsx(h,{label:l("groups.schedules.editor.cronLabel",{defaultValue:"Cron Expression *"}),value:S,onChange:o=>w(o.target.value),placeholder:"0 3 * * *"}),e.jsx(h,{label:l("groups.schedules.editor.timezoneLabel",{defaultValue:"Timezone"}),value:x,onChange:o=>G(o.target.value),placeholder:"UTC"})]}),e.jsx(h,{label:l("groups.schedules.editor.targetUserIdsLabel",{defaultValue:"Target User IDs (optional, comma-separated)"}),value:M,onChange:o=>k(o.target.value),placeholder:l("groups.schedules.editor.targetUserIdsPlaceholder",{defaultValue:"1,2,3"})}),e.jsx("div",{className:"rounded-xl border border-line/70 bg-panel/55 p-3 text-xs text-muted",children:l("groups.schedules.editor.cronExamples",{defaultValue:"Cron examples: `0 3 * * *` (daily 03:00), `*/30 * * * *` (every 30 minutes), `0 9 * * 1` (weekly Monday)."})}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:o=>L(o.target.checked),className:"h-4 w-4 rounded border-line bg-card text-brand-500"}),l("common.enabled",{defaultValue:"Enabled"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:o=>E(o.target.checked),className:"h-4 w-4 rounded border-line bg-card text-brand-500"}),l("groups.schedules.editor.dryRunOnly",{defaultValue:"Dry-run only"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-line/70 px-6 py-4",children:[e.jsx(c,{variant:"secondary",onClick:C,children:l("common.cancel",{defaultValue:"Cancel"})}),e.jsx(c,{onClick:()=>void $(),loading:g,children:t?l("groups.editor.saveChanges",{defaultValue:"Save Changes"}):l("groups.schedules.editor.createCta",{defaultValue:"Create Schedule"})})]})]})})}function $t({template:t,groups:r,applying:u,onClose:g,onSubmit:C}){const d=le(),{t:p}=re(),[l,N]=a.useState(""),[j,P]=a.useState(!1),[v,T]=a.useState(!1),[V,S]=a.useState(""),w=async()=>{const x=Number.parseInt(l,10);if(!Number.isInteger(x)||x<1){d.error(p("common.validationFailed",{defaultValue:"Validation failed"}),p("groups.templates.applyModal.groupRequired",{defaultValue:"Please select a group."}));return}await C({groupId:x,applyNow:j,dryRun:v,userIds:Ze(V)})};return e.jsx("div",{className:"fixed inset-0 z-[90] flex items-center justify-center bg-black/55 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"glass-panel w-full max-w-lg rounded-2xl",children:[e.jsxs("div",{className:"border-b border-line/70 px-6 py-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:p("groups.templates.applyModal.title",{defaultValue:"Apply Template: {{name}}",name:t.name})}),e.jsx("p",{className:"text-sm text-muted",children:p("groups.templates.applyModal.subtitle",{defaultValue:"Copy template policy into a target group."})})]}),e.jsxs("div",{className:"space-y-4 px-6 py-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:p("groups.templates.applyModal.groupLabel",{defaultValue:"Target Group *"})}),e.jsxs("select",{value:l,onChange:x=>N(x.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"",children:p("groups.templates.applyModal.groupPlaceholder",{defaultValue:"Select group"})}),r.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:x=>P(x.target.checked),className:"h-4 w-4 rounded border-line bg-card text-brand-500"}),p("groups.templates.applyModal.applyNow",{defaultValue:"Run policy rollout immediately after template apply"})]}),j?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:x=>T(x.target.checked),className:"h-4 w-4 rounded border-line bg-card text-brand-500"}),p("groups.templates.applyModal.dryRun",{defaultValue:"Dry-run immediate rollout"})]}),e.jsx(h,{label:p("groups.templates.applyModal.targetUserIdsLabel",{defaultValue:"Target User IDs (optional)"}),value:V,onChange:x=>S(x.target.value),placeholder:p("groups.templates.applyModal.targetUserIdsPlaceholder",{defaultValue:"1,2,3"})})]}):null]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-line/70 px-6 py-4",children:[e.jsx(c,{variant:"secondary",onClick:g,children:p("common.cancel",{defaultValue:"Cancel"})}),e.jsx(c,{onClick:()=>void w(),loading:u,children:p("groups.templates.applyModal.applyCta",{defaultValue:"Apply Template"})})]})]})})}function _t(t){var u;const r=t.summary;return(r==null?void 0:r.summary)||((u=r==null?void 0:r.result)==null?void 0:u.summary)||null}function fs(){var Oe,Ye,qe,$e,_e;const{t}=re(),r=le(),{id:u}=jt(),[g,C]=a.useState("groups"),[d,p]=a.useState(null),[l,N]=a.useState(1),[j,P]=a.useState(""),[v,T]=a.useState(!0),V=Te(j,320),[S,w]=a.useState(1),[x,G]=a.useState(""),R=Te(x,320),[L,I]=a.useState(1),[E,M]=a.useState(""),[k,$]=a.useState(""),[o,_]=a.useState("all"),H=Te(E,320),[J,ee]=a.useState(1),[W,de]=a.useState(""),[K,oe]=a.useState("ALL"),[Z,ne]=a.useState("ALL"),[se,n]=a.useState(!1),[b,A]=a.useState(null),[et,ie]=a.useState(!1),[ue,ce]=a.useState(null),[me,be]=a.useState(null),[tt,pe]=a.useState(!1),[xe,fe]=a.useState(null),F=Nt({page:l,limit:20,search:V,includeDisabled:v}),ye=Ft({page:1,limit:100}),je=Vt(),B=St({page:S,limit:20,search:R}),U=wt({page:L,limit:20,search:H,groupId:k?Number.parseInt(k,10):void 0,enabled:o==="all"?void 0:o==="enabled"}),z=Ct({page:J,limit:25,groupId:W?Number.parseInt(W,10):void 0,status:K==="ALL"?void 0:K,source:Z==="ALL"?void 0:Z}),Re=Tt(),Ee=kt(),ve=Pt(),Ge=Lt(),Me=It(),Ne=Dt(),Ae=Rt(),Fe=Et(),Ue=Gt(),Ve=Mt(),Be=At(),y=a.useMemo(()=>{var s;return((s=F.data)==null?void 0:s.data)??[]},[(Oe=F.data)==null?void 0:Oe.data]),D=ge(F.data),he=a.useMemo(()=>{var s;return((s=B.data)==null?void 0:s.data)??[]},[(Ye=B.data)==null?void 0:Ye.data]),O=ge(B.data),Se=a.useMemo(()=>{var s;return((s=U.data)==null?void 0:s.data)??[]},[(qe=U.data)==null?void 0:qe.data]),Y=ge(U.data),we=a.useMemo(()=>{var s;return((s=z.data)==null?void 0:s.data)??[]},[($e=z.data)==null?void 0:$e.data]),q=ge(z.data),st=a.useMemo(()=>{var s;return(((s=ye.data)==null?void 0:s.data)||[]).map(i=>({id:i.id,email:i.email,status:i.status}))},[(_e=ye.data)==null?void 0:_e.data]),at=a.useMemo(()=>(je.data||[]).map(s=>({id:s.id,tag:s.tag,protocol:s.protocol,port:s.port,enabled:s.enabled,remark:s.remark})).sort((s,i)=>s.port-i.port),[je.data]),lt=a.useMemo(()=>y.filter(s=>!s.isDisabled).length,[y]),rt=a.useMemo(()=>y.reduce((s,i)=>{var m;return s+Number(((m=i._count)==null?void 0:m.users)||0)},0),[y]),dt=a.useMemo(()=>y.reduce((s,i)=>{var m;return s+Number(((m=i._count)==null?void 0:m.inbounds)||0)},0),[y]);a.useEffect(()=>{N(1)},[V,v]),a.useEffect(()=>{w(1)},[R]),a.useEffect(()=>{I(1)},[H,k,o]),a.useEffect(()=>{ee(1)},[W,K,Z]),a.useEffect(()=>{if(u&&y.length>0){const s=y.find(i=>i.id===Number(u));s&&!se&&(A(s),n(!0))}},[u,y,se]);const ot=async()=>{try{await Promise.all([F.refetch(),ye.refetch(),je.refetch(),B.refetch(),U.refetch(),z.refetch()]),r.success(t("groups.toast.refreshedTitle",{defaultValue:"Data refreshed"}),t("groups.toast.refreshedBody",{defaultValue:"Groups, templates, schedules, and rollouts are up to date."}))}catch(s){r.error(t("groups.toast.refreshFailedTitle",{defaultValue:"Refresh failed"}),(s==null?void 0:s.message)||t("groups.toast.refreshFailedBody",{defaultValue:"Failed to refresh group data."}))}},nt=async s=>{try{b?(await Ee.mutateAsync({id:b.id,payload:s}),r.success(t("groups.toast.groupUpdatedTitle",{defaultValue:"Group updated"}),t("groups.toast.groupUpdatedBody",{defaultValue:'"{{name}}" was updated successfully.',name:b.name}))):(await Re.mutateAsync(s),r.success(t("groups.toast.groupCreatedTitle",{defaultValue:"Group created"}),t("groups.toast.groupCreatedBody",{defaultValue:'"{{name}}" was created successfully.',name:s.name}))),await F.refetch(),n(!1),A(null)}catch(i){r.error(t("groups.toast.saveGroupFailedTitle",{defaultValue:"Failed to save group"}),(i==null?void 0:i.message)||t("groups.toast.saveGroupFailedBody",{defaultValue:"Could not save group changes."}))}},it=async s=>{p({type:"group",id:s.id,name:s.name})},ut=async s=>{const i={...s,description:s.description||null};try{ue?(await Me.mutateAsync({templateId:ue.id,payload:i}),r.success(t("groups.toast.templateUpdatedTitle",{defaultValue:"Template updated"}),t("groups.toast.templateUpdatedBody",{defaultValue:'"{{name}}" was updated.',name:ue.name}))):(await Ge.mutateAsync(i),r.success(t("groups.toast.templateCreatedTitle",{defaultValue:"Template created"}),t("groups.toast.templateCreatedBody",{defaultValue:'"{{name}}" is ready to use.',name:s.name}))),await B.refetch(),ie(!1),ce(null)}catch(m){r.error(t("groups.toast.saveTemplateFailedTitle",{defaultValue:"Failed to save template"}),(m==null?void 0:m.message)||t("groups.toast.saveTemplateFailedBody",{defaultValue:"Could not save template."}))}},ct=async s=>{p({type:"template",id:s.id,name:s.name})},mt=async s=>{if(me)try{const i={templateId:me.id};s.applyNow&&(i.applyNow=!0,i.dryRun=s.dryRun),s.userIds.length>0&&(i.userIds=s.userIds),await Ae.mutateAsync({groupId:s.groupId,payload:i}),await Promise.all([F.refetch(),B.refetch(),U.refetch(),z.refetch()]),be(null),r.success(t("groups.toast.templateAppliedTitle",{defaultValue:"Template applied"}),s.applyNow?t("groups.toast.templateAppliedBodyNow",{defaultValue:"Group policy was updated and rollout was triggered."}):t("groups.toast.templateAppliedBodyValues",{defaultValue:"Group policy values were updated successfully."}))}catch(i){r.error(t("groups.toast.applyTemplateFailedTitle",{defaultValue:"Apply template failed"}),(i==null?void 0:i.message)||t("groups.toast.applyTemplateFailedBody",{defaultValue:"Failed to apply template to group."}))}},pt=async s=>{const i={...s,templateId:s.templateId||null};try{xe?(await Ue.mutateAsync({scheduleId:xe.id,payload:i}),r.success(t("groups.toast.scheduleUpdatedTitle",{defaultValue:"Schedule updated"}),t("groups.toast.scheduleUpdatedBody",{defaultValue:'"{{name}}" was updated.',name:xe.name}))):(await Fe.mutateAsync(i),r.success(t("groups.toast.scheduleCreatedTitle",{defaultValue:"Schedule created"}),t("groups.toast.scheduleCreatedBody",{defaultValue:'"{{name}}" has been scheduled.',name:s.name}))),await U.refetch(),pe(!1),fe(null)}catch(m){r.error(t("groups.toast.saveScheduleFailedTitle",{defaultValue:"Failed to save schedule"}),(m==null?void 0:m.message)||t("groups.toast.saveScheduleFailedBody",{defaultValue:"Could not save schedule."}))}},xt=async s=>{p({type:"schedule",id:s.id,name:s.name})},ze=(d==null?void 0:d.type)==="group"?ve.isPending:(d==null?void 0:d.type)==="template"?Ne.isPending:(d==null?void 0:d.type)==="schedule"?Ve.isPending:!1,ft=async()=>{if(d)try{d.type==="group"?(await ve.mutateAsync(d.id),await F.refetch(),r.success(t("groups.toast.groupDeletedTitle",{defaultValue:"Group deleted"}),t("groups.toast.deletedBody",{defaultValue:'"{{name}}" was deleted.',name:d.name}))):d.type==="template"?(await Ne.mutateAsync(d.id),await B.refetch(),r.success(t("groups.toast.templateDeletedTitle",{defaultValue:"Template deleted"}),t("groups.toast.deletedBody",{defaultValue:'"{{name}}" was deleted.',name:d.name}))):(await Ve.mutateAsync(d.id),await Promise.all([U.refetch(),z.refetch()]),r.success(t("groups.toast.scheduleDeletedTitle",{defaultValue:"Schedule deleted"}),t("groups.toast.deletedBody",{defaultValue:'"{{name}}" was deleted.',name:d.name}))),p(null)}catch(s){r.error(t("groups.toast.deleteFailedTitle",{defaultValue:"Delete failed"}),(s==null?void 0:s.message)||t("groups.toast.deleteFailedBody",{defaultValue:'Failed to delete "{{name}}".',name:d.name}))}},ht=async s=>{try{await Be.mutateAsync(s.id),await Promise.all([U.refetch(),z.refetch(),F.refetch()]),r.success(t("groups.toast.scheduleExecutedTitle",{defaultValue:"Schedule executed"}),t("groups.toast.scheduleExecutedBody",{defaultValue:'"{{name}}" executed successfully.',name:s.name}))}catch(i){r.error(t("groups.toast.runFailedTitle",{defaultValue:"Run failed"}),(i==null?void 0:i.message)||t("groups.toast.runFailedBody",{defaultValue:'Failed to run schedule "{{name}}".',name:s.name}))}},gt=Re.isPending||Ee.isPending,bt=Ge.isPending||Me.isPending,yt=Fe.isPending||Ue.isPending;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:t("groups.title",{defaultValue:"Groups"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("groups.subtitle",{defaultValue:"Reusable policy templates, schedules, and rollout history."})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"secondary",onClick:()=>void ot(),loading:F.isFetching||B.isFetching||U.isFetching||z.isFetching,children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),t("common.refresh",{defaultValue:"Refresh"})]}),g==="groups"?e.jsxs(c,{onClick:()=>{A(null),n(!0)},children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),t("groups.newGroup",{defaultValue:"New Group"})]}):null,g==="templates"?e.jsxs(c,{onClick:()=>{ce(null),ie(!0)},children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),t("groups.newTemplate",{defaultValue:"New Template"})]}):null,g==="schedules"?e.jsxs(c,{onClick:()=>{fe(null),pe(!0)},children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),t("groups.newSchedule",{defaultValue:"New Schedule"})]}):null]})]}),e.jsx(f,{className:"p-3 sm:p-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-flex min-w-full gap-1 rounded-xl border border-line/70 bg-panel/45 p-1",children:[{id:"groups",label:t("groups.tabs.groups",{defaultValue:"Groups"}),count:(D==null?void 0:D.total)||y.length,icon:He},{id:"templates",label:t("groups.tabs.templates",{defaultValue:"Templates"}),count:(O==null?void 0:O.total)||he.length,icon:We},{id:"schedules",label:t("groups.tabs.schedules",{defaultValue:"Schedules"}),count:(Y==null?void 0:Y.total)||Se.length,icon:Ke},{id:"rollouts",label:t("groups.tabs.rollouts",{defaultValue:"Rollouts"}),count:(q==null?void 0:q.total)||we.length,icon:ke}].map(s=>{const i=s.icon,m=g===s.id;return e.jsxs("button",{type:"button",onClick:()=>C(s.id),className:`flex min-w-[140px] flex-1 items-center justify-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-colors ${m?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-soft":"text-muted hover:bg-card/70 hover:text-foreground"}`,children:[e.jsx(i,{className:"h-4 w-4"}),e.jsx("span",{children:s.label}),e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs ${m?"bg-white/20 text-white":"bg-card/80 text-foreground/80"}`,children:s.count})]},s.id)})})})}),g==="groups"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(f,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-muted",children:t("groups.stats.groups",{defaultValue:"Groups"})}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-foreground",children:(D==null?void 0:D.total)||y.length})]}),e.jsxs(f,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-muted",children:t("groups.stats.enabled",{defaultValue:"Enabled"})}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-emerald-400",children:lt})]}),e.jsxs(f,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-muted",children:t("groups.stats.memberships",{defaultValue:"User memberships"})}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-sky-400",children:rt})]}),e.jsxs(f,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-muted",children:t("groups.stats.inboundMappings",{defaultValue:"Inbound mappings"})}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-violet-400",children:dt})]})]}),e.jsx(f,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-3 lg:grid-cols-[1fr_auto]",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted"}),e.jsx(h,{value:j,onChange:s=>P(s.target.value),placeholder:t("groups.searchPlaceholder",{defaultValue:"Search groups by name or remark"}),className:"pl-9"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 rounded-xl border border-line/70 bg-card/70 px-3 py-2.5 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:s=>T(s.target.checked),className:"h-4 w-4 rounded border-line bg-card text-brand-500"}),t("groups.showDisabled",{defaultValue:"Show disabled groups"})]})]})}),F.isLoading?e.jsxs(f,{className:"p-10 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-4 border-line/70 border-t-brand-500"}),e.jsx("p",{className:"mt-4 text-sm text-muted",children:t("groups.loading",{defaultValue:"Loading groups..."})})]}):y.length===0?e.jsxs(f,{className:"p-10 text-center",children:[e.jsx(He,{className:"mx-auto h-10 w-10 text-muted"}),e.jsx("h3",{className:"mt-3 text-lg font-semibold text-foreground",children:t("groups.emptyTitle",{defaultValue:"No groups found"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("groups.emptyBody",{defaultValue:"Create your first group to reuse user/inbound assignments."})})]}):e.jsx("div",{className:"grid gap-4 xl:grid-cols-2",children:y.map(s=>{var m,Q;const i=Xe(s,t);return e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"truncate text-lg font-semibold text-foreground",children:s.name}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:s.remark||t("groups.noRemark",{defaultValue:"No remark provided"})})]}),e.jsx(Ce,{variant:s.isDisabled?"warning":"success",children:s.isDisabled?t("common.disabled",{defaultValue:"Disabled"}):t("common.active",{defaultValue:"Active"})})]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-line/60 bg-panel/55 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.1em] text-muted",children:t("groups.labels.users",{defaultValue:"Users"})}),e.jsxs("p",{className:"mt-1 inline-flex items-center gap-2 text-lg font-semibold text-foreground",children:[e.jsx(zt,{className:"h-4 w-4 text-brand-400"}),((m=s._count)==null?void 0:m.users)||0]})]}),e.jsxs("div",{className:"rounded-xl border border-line/60 bg-panel/55 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.1em] text-muted",children:t("groups.labels.inbounds",{defaultValue:"Inbounds"})}),e.jsxs("p",{className:"mt-1 inline-flex items-center gap-2 text-lg font-semibold text-foreground",children:[e.jsx(Ut,{className:"h-4 w-4 text-brand-400"}),((Q=s._count)==null?void 0:Q.inbounds)||0]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.08em] text-muted",children:t("groups.labels.policyOverrides",{defaultValue:"Policy overrides"})}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:i.length===0?e.jsx("span",{className:"text-sm text-muted",children:t("groups.labels.noPolicyOverrides",{defaultValue:"No policy overrides"})}):i.map(ae=>e.jsx("span",{className:"rounded-full border border-line/70 bg-card/70 px-2.5 py-1 text-xs text-foreground",children:ae},`${s.id}-${ae}`))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 border-t border-line/60 pt-3",children:[e.jsx(c,{variant:"secondary",size:"sm",onClick:()=>{A(s),n(!0)},children:t("common.edit",{defaultValue:"Edit"})}),e.jsxs(c,{variant:"danger",size:"sm",onClick:()=>void it(s),loading:ve.isPending,children:[e.jsx(Ie,{className:"mr-1.5 h-4 w-4"}),t("common.delete",{defaultValue:"Delete"})]})]})]},s.id)})}),D&&D.totalPages>1?e.jsxs(f,{className:"flex flex-wrap items-center justify-between gap-3 p-4",children:[e.jsx("p",{className:"text-sm text-muted",children:t("common.page",{defaultValue:"Page {{current}} of {{total}}",current:D.page,total:D.totalPages})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"secondary",size:"sm",disabled:l<=1,onClick:()=>N(s=>Math.max(1,s-1)),children:t("common.previous",{defaultValue:"Previous"})}),e.jsx(c,{variant:"secondary",size:"sm",disabled:l>=D.totalPages,onClick:()=>N(s=>Math.min(D.totalPages,s+1)),children:t("common.next",{defaultValue:"Next"})})]})]}):null]}):null,g==="templates"?e.jsxs(e.Fragment,{children:[e.jsx(f,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted"}),e.jsx(h,{value:x,onChange:s=>G(s.target.value),placeholder:t("groups.templates.searchPlaceholder",{defaultValue:"Search templates by name or description"}),className:"pl-9"})]})}),B.isLoading?e.jsxs(f,{className:"p-10 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-4 border-line/70 border-t-brand-500"}),e.jsx("p",{className:"mt-4 text-sm text-muted",children:t("groups.templates.loading",{defaultValue:"Loading templates..."})})]}):he.length===0?e.jsxs(f,{className:"p-10 text-center",children:[e.jsx(We,{className:"mx-auto h-10 w-10 text-muted"}),e.jsx("h3",{className:"mt-3 text-lg font-semibold text-foreground",children:t("groups.templates.emptyTitle",{defaultValue:"No templates found"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("groups.templates.emptyBody",{defaultValue:"Create your first reusable policy template."})})]}):e.jsx("div",{className:"grid gap-4 xl:grid-cols-2",children:he.map(s=>{var m,Q;const i=Xe(s,t);return e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s.name}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:s.description||t("groups.templates.noDescription",{defaultValue:"No description"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.isDefault?e.jsx(Ce,{variant:"info",children:t("groups.templates.defaultBadge",{defaultValue:"Default"})}):null})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:i.length===0?e.jsx("span",{className:"text-sm text-muted",children:t("groups.templates.noPolicyFields",{defaultValue:"No policy fields configured"})}):i.map(ae=>e.jsx("span",{className:"rounded-full border border-line/70 bg-card/70 px-2.5 py-1 text-xs text-foreground",children:ae},`${s.id}-${ae}`))}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-line/60 bg-panel/55 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.1em] text-muted",children:t("groups.templates.metrics.schedules",{defaultValue:"Schedules"})}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:((m=s._count)==null?void 0:m.schedules)||0})]}),e.jsxs("div",{className:"rounded-xl border border-line/60 bg-panel/55 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.1em] text-muted",children:t("groups.templates.metrics.rollouts",{defaultValue:"Rollouts"})}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:((Q=s._count)==null?void 0:Q.rollouts)||0})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 border-t border-line/60 pt-3",children:[e.jsx(c,{variant:"secondary",size:"sm",onClick:()=>be(s),children:t("groups.templates.applyToGroup",{defaultValue:"Apply to Group"})}),e.jsx(c,{variant:"secondary",size:"sm",onClick:()=>{ce(s),ie(!0)},children:t("common.edit",{defaultValue:"Edit"})}),e.jsxs(c,{variant:"danger",size:"sm",onClick:()=>void ct(s),loading:Ne.isPending,children:[e.jsx(Ie,{className:"mr-1.5 h-4 w-4"}),t("common.delete",{defaultValue:"Delete"})]})]})]},s.id)})}),O&&O.totalPages>1?e.jsxs(f,{className:"flex flex-wrap items-center justify-between gap-3 p-4",children:[e.jsx("p",{className:"text-sm text-muted",children:t("common.page",{defaultValue:"Page {{current}} of {{total}}",current:O.page,total:O.totalPages})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"secondary",size:"sm",disabled:S<=1,onClick:()=>w(s=>Math.max(1,s-1)),children:t("common.previous",{defaultValue:"Previous"})}),e.jsx(c,{variant:"secondary",size:"sm",disabled:S>=O.totalPages,onClick:()=>w(s=>Math.min(O.totalPages,s+1)),children:t("common.next",{defaultValue:"Next"})})]})]}):null]}):null,g==="schedules"?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-3 lg:grid-cols-3",children:[e.jsxs("div",{className:"relative lg:col-span-1",children:[e.jsx(Le,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted"}),e.jsx(h,{value:E,onChange:s=>M(s.target.value),placeholder:t("groups.schedules.searchPlaceholder",{defaultValue:"Search schedules"}),className:"pl-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:t("groups.filters.group",{defaultValue:"Group"})}),e.jsxs("select",{value:k,onChange:s=>$(s.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"",children:t("groups.filters.allGroups",{defaultValue:"All groups"})}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:t("common.status",{defaultValue:"Status"})}),e.jsxs("select",{value:o,onChange:s=>_(s.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"all",children:t("common.all",{defaultValue:"All"})}),e.jsx("option",{value:"enabled",children:t("common.enabled",{defaultValue:"Enabled"})}),e.jsx("option",{value:"disabled",children:t("common.disabled",{defaultValue:"Disabled"})})]})]})]})}),U.isLoading?e.jsxs(f,{className:"p-10 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-4 border-line/70 border-t-brand-500"}),e.jsx("p",{className:"mt-4 text-sm text-muted",children:t("groups.schedules.loading",{defaultValue:"Loading schedules..."})})]}):Se.length===0?e.jsxs(f,{className:"p-10 text-center",children:[e.jsx(Ke,{className:"mx-auto h-10 w-10 text-muted"}),e.jsx("h3",{className:"mt-3 text-lg font-semibold text-foreground",children:t("groups.schedules.emptyTitle",{defaultValue:"No schedules found"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("groups.schedules.emptyBody",{defaultValue:"Create a recurring rollout schedule for any group."})})]}):e.jsx(f,{className:"overflow-hidden p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[980px] w-full text-sm",children:[e.jsx("thead",{className:"bg-panel/70",children:e.jsxs("tr",{className:"border-b border-line/70 text-left text-xs uppercase tracking-wide text-muted",children:[e.jsx("th",{className:"px-4 py-3",children:t("groups.schedules.columns.name",{defaultValue:"Name"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.schedules.columns.group",{defaultValue:"Group"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.schedules.columns.template",{defaultValue:"Template"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.schedules.columns.cron",{defaultValue:"Cron"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.schedules.columns.lastRun",{defaultValue:"Last Run"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.schedules.columns.runs",{defaultValue:"Runs"})}),e.jsx("th",{className:"px-4 py-3",children:t("common.actions",{defaultValue:"Actions"})})]})}),e.jsx("tbody",{children:Se.map(s=>{var i,m;return e.jsxs("tr",{className:"border-b border-line/70 hover:bg-panel/35",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.name}),e.jsxs("span",{className:"text-xs text-muted",children:[s.enabled?t("common.enabled",{defaultValue:"Enabled"}):t("common.disabled",{defaultValue:"Disabled"})," ","â€¢"," ",s.dryRun?t("groups.schedules.dryRun",{defaultValue:"Dry-run"}):t("groups.schedules.applyMode",{defaultValue:"Apply mode"})]})]})}),e.jsx("td",{className:"px-4 py-3 text-foreground",children:((i=s.group)==null?void 0:i.name)||`#${s.groupId}`}),e.jsx("td",{className:"px-4 py-3 text-foreground",children:((m=s.template)==null?void 0:m.name)||"â€”"}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-mono text-xs text-foreground",children:s.cronExpression}),e.jsx("div",{className:"text-xs text-muted",children:s.timezone||"UTC"})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-foreground",children:s.lastRunAt?new Date(s.lastRunAt).toLocaleString():t("common.never",{defaultValue:"Never"})}),e.jsx("div",{className:"text-xs text-muted",children:s.lastStatus||"â€”"})]}),e.jsx("td",{className:"px-4 py-3 text-foreground",children:s.runCount}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>void ht(s),loading:Be.isPending,children:[e.jsx(Bt,{className:"mr-1.5 h-4 w-4"}),t("common.run",{defaultValue:"Run"})]}),e.jsx(c,{variant:"secondary",size:"sm",onClick:()=>{fe(s),pe(!0)},children:t("common.edit",{defaultValue:"Edit"})}),e.jsxs(c,{variant:"danger",size:"sm",onClick:()=>void xt(s),loading:Ve.isPending,children:[e.jsx(Ie,{className:"mr-1.5 h-4 w-4"}),t("common.delete",{defaultValue:"Delete"})]})]})})]},s.id)})})]})})}),Y&&Y.totalPages>1?e.jsxs(f,{className:"flex flex-wrap items-center justify-between gap-3 p-4",children:[e.jsx("p",{className:"text-sm text-muted",children:t("common.page",{defaultValue:"Page {{current}} of {{total}}",current:Y.page,total:Y.totalPages})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"secondary",size:"sm",disabled:L<=1,onClick:()=>I(s=>Math.max(1,s-1)),children:t("common.previous",{defaultValue:"Previous"})}),e.jsx(c,{variant:"secondary",size:"sm",disabled:L>=Y.totalPages,onClick:()=>I(s=>Math.min(Y.totalPages,s+1)),children:t("common.next",{defaultValue:"Next"})})]})]}):null]}):null,g==="rollouts"?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:t("groups.filters.group",{defaultValue:"Group"})}),e.jsxs("select",{value:W,onChange:s=>de(s.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"",children:t("groups.filters.allGroups",{defaultValue:"All groups"})}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:t("common.status",{defaultValue:"Status"})}),e.jsxs("select",{value:K,onChange:s=>oe(s.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"ALL",children:t("common.all",{defaultValue:"All"})}),e.jsx("option",{value:"SUCCESS",children:t("groups.rollouts.status.success",{defaultValue:"SUCCESS"})}),e.jsx("option",{value:"FAILED",children:t("groups.rollouts.status.failed",{defaultValue:"FAILED"})}),e.jsx("option",{value:"DRY_RUN",children:t("groups.rollouts.status.dryRun",{defaultValue:"DRY_RUN"})})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"ml-1 block text-sm font-medium text-muted",children:t("groups.rollouts.filters.source",{defaultValue:"Source"})}),e.jsxs("select",{value:Z,onChange:s=>ne(s.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all focus-visible:border-brand-500/50 focus-visible:ring-2 focus-visible:ring-brand-500/40",children:[e.jsx("option",{value:"ALL",children:t("common.all",{defaultValue:"All"})}),e.jsx("option",{value:"MANUAL",children:t("groups.rollouts.source.manual",{defaultValue:"MANUAL"})}),e.jsx("option",{value:"SCHEDULED",children:t("groups.rollouts.source.scheduled",{defaultValue:"SCHEDULED"})})]})]})]})}),z.isLoading?e.jsxs(f,{className:"p-10 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-4 border-line/70 border-t-brand-500"}),e.jsx("p",{className:"mt-4 text-sm text-muted",children:t("groups.rollouts.loading",{defaultValue:"Loading rollout history..."})})]}):we.length===0?e.jsxs(f,{className:"p-10 text-center",children:[e.jsx(ke,{className:"mx-auto h-10 w-10 text-muted"}),e.jsx("h3",{className:"mt-3 text-lg font-semibold text-foreground",children:t("groups.rollouts.emptyTitle",{defaultValue:"No rollout history"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("groups.rollouts.emptyBody",{defaultValue:"Manual or scheduled policy applications will appear here."})})]}):e.jsx(f,{className:"overflow-hidden p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[980px] w-full text-sm",children:[e.jsx("thead",{className:"bg-panel/70",children:e.jsxs("tr",{className:"border-b border-line/70 text-left text-xs uppercase tracking-wide text-muted",children:[e.jsx("th",{className:"px-4 py-3",children:t("groups.rollouts.columns.time",{defaultValue:"Time"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.rollouts.columns.group",{defaultValue:"Group"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.rollouts.columns.template",{defaultValue:"Template"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.rollouts.columns.source",{defaultValue:"Source"})}),e.jsx("th",{className:"px-4 py-3",children:t("common.status",{defaultValue:"Status"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.rollouts.columns.summary",{defaultValue:"Summary"})}),e.jsx("th",{className:"px-4 py-3",children:t("groups.rollouts.columns.initiatedBy",{defaultValue:"Initiated By"})})]})}),e.jsx("tbody",{children:we.map(s=>{var m,Q;const i=_t(s);return e.jsxs("tr",{className:"border-b border-line/70 hover:bg-panel/35",children:[e.jsx("td",{className:"px-4 py-3 text-foreground",children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-foreground",children:((m=s.group)==null?void 0:m.name)||`#${s.groupId}`}),e.jsx("td",{className:"px-4 py-3 text-foreground",children:((Q=s.template)==null?void 0:Q.name)||"â€”"}),e.jsx("td",{className:"px-4 py-3 text-foreground",children:s.source}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(Ce,{variant:s.status==="SUCCESS"?"success":s.status==="FAILED"?"danger":"warning",children:s.status})}),e.jsxs("td",{className:"px-4 py-3",children:[i?e.jsx("div",{className:"text-xs text-muted",children:t("groups.rollouts.summaryLine",{defaultValue:"Target: {{target}} â€¢ Updated: {{updated}} â€¢ Skipped: {{skipped}}",target:i.targetUsers||0,updated:i.wouldUpdateUsers||0,skipped:i.skippedUsers||0})}):e.jsx("span",{className:"text-xs text-muted",children:"â€”"}),s.errorMessage?e.jsx("div",{className:"mt-1 text-xs text-red-400",children:s.errorMessage}):null]}),e.jsx("td",{className:"px-4 py-3 text-foreground",children:s.initiatedBy||t("common.system",{defaultValue:"system"})})]},s.id)})})]})})}),q&&q.totalPages>1?e.jsxs(f,{className:"flex flex-wrap items-center justify-between gap-3 p-4",children:[e.jsx("p",{className:"text-sm text-muted",children:t("common.page",{defaultValue:"Page {{current}} of {{total}}",current:q.page,total:q.totalPages})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"secondary",size:"sm",disabled:J<=1,onClick:()=>ee(s=>Math.max(1,s-1)),children:t("common.previous",{defaultValue:"Previous"})}),e.jsx(c,{variant:"secondary",size:"sm",disabled:J>=q.totalPages,onClick:()=>ee(s=>Math.min(q.totalPages,s+1)),children:t("common.next",{defaultValue:"Next"})})]})]}):null]}):null,se?e.jsx(Ot,{group:b,users:st,inbounds:at,saving:gt,onClose:()=>{n(!1),A(null)},onSubmit:nt}):null,et?e.jsx(Yt,{template:ue,saving:bt,onClose:()=>{ie(!1),ce(null)},onSubmit:ut}):null,tt?e.jsx(qt,{schedule:xe,groups:y,templates:he,saving:yt,onClose:()=>{pe(!1),fe(null)},onSubmit:pt}):null,me?e.jsx($t,{template:me,groups:y,applying:Ae.isPending,onClose:()=>be(null),onSubmit:mt}):null,e.jsx(vt,{open:!!d,title:(d==null?void 0:d.type)==="group"?t("groups.confirmDelete.title.group",{defaultValue:"Delete Group"}):(d==null?void 0:d.type)==="template"?t("groups.confirmDelete.title.template",{defaultValue:"Delete Template"}):(d==null?void 0:d.type)==="schedule"?t("groups.confirmDelete.title.schedule",{defaultValue:"Delete Schedule"}):"",description:d?t("groups.confirmDelete.body",{defaultValue:'Delete "{{name}}"? This action cannot be undone.',name:d.name}):"",confirmLabel:t("common.delete",{defaultValue:"Delete"}),cancelLabel:t("common.cancel",{defaultValue:"Cancel"}),tone:"danger",loading:ze,onCancel:()=>{ze||p(null)},onConfirm:()=>{ft()}})]})}export{fs as Groups};
