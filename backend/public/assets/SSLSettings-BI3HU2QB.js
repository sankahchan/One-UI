import{e as h,b as n,j as s}from"./index-CcK4tOfC.js";import{u as V}from"./index.esm-6ooOXtNp.js";import{u as j}from"./useQuery-B_n5M2_v.js";import{u as x}from"./useMutation-DZpYtY5A.js";import{u as w,C as S}from"./useToast-BnKQFuqP.js";import{B as p}from"./Button-D1Vl4E60.js";import{I as d}from"./Input-CQ9kTGid.js";import{u as N}from"./useTranslation-BAr0hstR.js";import{S as k}from"./Settings-CweLedab.js";import"./cn-BLSKlp9E.js";import"./Skeleton-BQEtEzO0.js";import"./lock-CZz_8qGs.js";import"./server-4zSP9MPe.js";import"./activity-_BgUkAb_.js";const B=()=>{var f,g,y;const o=h(),l=w(),{t:e}=N(),{data:i}=j({queryKey:["ssl-info"],queryFn:async()=>await n.get("/ssl/info")}),{register:r,handleSubmit:b,formState:{errors:u}}=V(),c=x({mutationFn:async t=>{await n.post("/ssl/issue",t)},onSuccess:()=>{l.success(e("common.success",{defaultValue:"Success"}),e("sslSettings.toast.issued",{defaultValue:"SSL certificate issued successfully."})),o.invalidateQueries({queryKey:["ssl-info"]})},onError:t=>{l.error(e("common.error",{defaultValue:"Error"}),(t==null?void 0:t.message)||e("sslSettings.toast.issueFailed",{defaultValue:"Failed to issue SSL certificate"}))}}),m=x({mutationFn:async t=>{await n.post("/ssl/renew",{domain:t})},onSuccess:()=>{l.success(e("common.success",{defaultValue:"Success"}),e("sslSettings.toast.renewed",{defaultValue:"SSL certificate renewed successfully."})),o.invalidateQueries({queryKey:["ssl-info"]})},onError:t=>{l.error(e("common.error",{defaultValue:"Error"}),(t==null?void 0:t.message)||e("sslSettings.toast.renewFailed",{defaultValue:"Failed to renew SSL certificate"}))}}),a=i==null?void 0:i.data;return s.jsxs("div",{className:"space-y-6",children:[a!=null&&a.enabled?s.jsxs(S,{children:[s.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900 dark:text-white",children:e("sslSettings.current.title",{defaultValue:"Current certificate"})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("sslSettings.current.domain",{defaultValue:"Domain"}),":"]}),s.jsx("span",{className:"font-medium dark:text-gray-200",children:a.domain||e("common.na",{defaultValue:"N/A"})})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("sslSettings.current.validUntil",{defaultValue:"Valid until"}),":"]}),s.jsx("span",{className:"font-medium dark:text-gray-200",children:a.notAfter?new Date(a.notAfter).toLocaleDateString():e("common.na",{defaultValue:"N/A"})})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e("sslSettings.current.daysRemaining",{defaultValue:"Days remaining"}),":"]}),s.jsx("span",{className:`font-medium ${(a.daysRemaining||0)<30?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}`,children:typeof a.daysRemaining=="number"?e("sslSettings.current.daysRemainingValue",{defaultValue:"{{count}} days",count:a.daysRemaining}):e("common.na",{defaultValue:"N/A"})})]})]}),s.jsx(p,{className:"mt-4 w-full",variant:"secondary",onClick:()=>m.mutate(a.domain||""),loading:m.isPending,disabled:!a.domain,children:e("sslSettings.current.renew",{defaultValue:"Renew certificate"})})]}):null,s.jsxs(S,{children:[s.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900 dark:text-white",children:a!=null&&a.enabled?e("sslSettings.issue.title.enabled",{defaultValue:"Issue new certificate"}):e("sslSettings.issue.title.disabled",{defaultValue:"Issue SSL certificate"})}),s.jsxs("form",{onSubmit:b(t=>c.mutate(t)),className:"space-y-4",children:[s.jsx(d,{label:e("sslSettings.form.domainLabel",{defaultValue:"Domain"}),...r("domain",{required:e("sslSettings.form.domainRequired",{defaultValue:"Domain is required"})}),error:(f=u.domain)==null?void 0:f.message,placeholder:e("sslSettings.form.domainPlaceholder",{defaultValue:"yourdomain.com"})}),s.jsx(d,{label:e("sslSettings.form.cloudflareEmailLabel",{defaultValue:"Cloudflare email"}),type:"email",...r("cloudflareEmail",{required:e("sslSettings.form.cloudflareEmailRequired",{defaultValue:"Cloudflare email is required"})}),error:(g=u.cloudflareEmail)==null?void 0:g.message,placeholder:e("sslSettings.form.cloudflareEmailPlaceholder",{defaultValue:"your@email.com"})}),s.jsx(d,{label:e("sslSettings.form.cloudflareApiKeyLabel",{defaultValue:"Cloudflare API key"}),type:"password",...r("cloudflareApiKey",{required:e("sslSettings.form.cloudflareApiKeyRequired",{defaultValue:"API key is required"})}),error:(y=u.cloudflareApiKey)==null?void 0:y.message,placeholder:e("sslSettings.form.cloudflareApiKeyPlaceholder",{defaultValue:"Your Cloudflare API key"})}),s.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-900/50 dark:bg-blue-900/20",children:s.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[s.jsxs("strong",{children:[e("sslSettings.issue.noteTitle",{defaultValue:"Note"}),":"]})," ",e("sslSettings.issue.noteBody",{defaultValue:"This will issue a wildcard certificate for *.yourdomain.com using Cloudflare DNS validation. Make sure your domain nameservers point to Cloudflare."})]})}),s.jsxs(p,{type:"submit",className:"w-full",loading:c.isPending,children:[s.jsx(k,{className:"mr-2 h-4 w-4"}),e("sslSettings.issue.submit",{defaultValue:"Issue certificate"})]})]})]})]})};export{B as default};
