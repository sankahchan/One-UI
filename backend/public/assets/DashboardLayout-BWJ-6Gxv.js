import{c as w,r as n,l as L,j as e,a as D,u as T,b as Q,X as z,d as I,e as H,f as V,C as X,A as G,O as W}from"./index-DrL1zW_A.js";import{a as _}from"./auth-3EDWhAgC.js";import{u as K}from"./useXray-Dh-4uVLX.js";import{p}from"./routePrefetch-DBUZjxSm.js";import{B as J}from"./Button-DfueQd-M.js";import{u as F,R as Y}from"./useTranslation-BKUwUwH0.js";import{S as Z}from"./search-BDxwwLxn.js";import{U}from"./users-CPV3TvzI.js";import{S as P}from"./server-BAAycAvu.js";import{T as $}from"./ThemeToggle-MoUX4UQp.js";import{P as ee}from"./plus-B2Aaicg5.js";import{L as te}from"./lock-DRpirkSs.js";import{L as se}from"./layout-dashboard-BJyr4LcI.js";import{L as re}from"./layers-3-CBm9Z_uk.js";import{S as ae}from"./settings-j1CjngD0.js";import{A as ne}from"./arrow-up-PnIt31Aa.js";import"./useQuery-KR27nzFv.js";import"./useMutation-DkKyHOPA.js";import"./xray-DA2VgF-5.js";import"./users-Df_pA_Bq.js";import"./inbounds-V8dB5kWj.js";import"./cn-BLSKlp9E.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=w("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=w("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=w("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=w("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=w("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function O({compact:l=!1}){const{i18n:d}=F(),[o,r]=n.useState(!1),m=n.useRef(null),i=String(d.resolvedLanguage||d.language||"en").split("-")[0],f=L.find(s=>s.code===i)||L[0];n.useEffect(()=>{const s=h=>{m.current&&!m.current.contains(h.target)&&r(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const x=s=>{D(s),r(!1)};return e.jsxs("div",{className:"relative",ref:m,children:[e.jsxs("button",{onClick:()=>r(!o),className:`flex items-center rounded-lg text-sm text-gray-600 transition-colors hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 ${l?"gap-1.5 px-2.5 py-2":"gap-2 px-3 py-2"}`,"aria-label":"Change language",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:l?f.code.toUpperCase():f.nativeName})]}),o&&e.jsx("div",{className:"absolute right-0 top-full z-50 mt-1 min-w-[140px] rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-800",children:e.jsx("ul",{className:"py-1",children:L.map(s=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>x(s.code),className:`flex w-full items-center gap-2 px-4 py-2 text-left text-sm transition-colors hover:bg-gray-100 dark:hover:bg-gray-700 ${s.code===i?"bg-blue-50 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400":"text-gray-700 dark:text-gray-300"}`,children:[e.jsx("span",{children:s.nativeName}),l?null:e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s.name,")"]})]})},s.code))})})]})}function de(){const[l,d]=n.useState(""),[o,r]=n.useState([]),[m,i]=n.useState(!1),[f,x]=n.useState(!1),s=n.useRef(0),h=n.useRef(null),j=T();n.useEffect(()=>{const a=b=>{h.current&&!h.current.contains(b.target)&&i(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),n.useEffect(()=>{const a=new AbortController,b=s.current+1;s.current=b;const C=setTimeout(async()=>{const u=l.trim();if(u.length<2){r([]),i(!1),x(!1);return}x(!0);try{const c=await Q.get("/search/quick",{params:{q:u},signal:a.signal});if(s.current!==b)return;r((c==null?void 0:c.data)||[]),i(!0)}catch(c){!((c==null?void 0:c.name)==="CanceledError"||(c==null?void 0:c.code)==="ERR_CANCELED")&&s.current===b&&r([])}finally{s.current===b&&x(!1)}},260);return()=>{a.abort(),clearTimeout(C)}},[l]);const y=a=>{a.type==="user"?j(`/users/${a.id}`):a.type==="group"?j(`/groups/${a.id}`):j("/inbounds"),d(""),i(!1)};return e.jsxs("div",{className:"relative w-full max-w-md",ref:h,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted"}),e.jsx("input",{type:"text",value:l,onChange:a=>d(a.target.value),onFocus:()=>l.trim().length>=2?i(!0):void 0,onKeyDown:a=>{a.key==="Escape"&&i(!1)},placeholder:"Search users, inbounds & groups",className:"h-10 w-full rounded-xl border border-line/80 bg-card/80 py-2 pl-10 pr-9 text-sm text-foreground placeholder:text-muted focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/30"}),l?e.jsx("button",{onClick:()=>{d(""),r([]),i(!1)},className:"absolute right-2 top-1/2 -translate-y-1/2 rounded-md p-1 text-muted transition hover:bg-card hover:text-foreground","aria-label":"Clear search",children:e.jsx(z,{className:"h-3.5 w-3.5"})}):null]}),m?e.jsx("div",{className:"absolute left-0 top-full z-50 mt-2 w-full overflow-hidden rounded-2xl border border-line/80 bg-card/95 shadow-soft backdrop-blur-xl",children:f?e.jsxs("div",{className:"flex items-center justify-center p-4 text-sm text-muted",children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-muted/35 border-t-brand-500"}),"Searching..."]}):o.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-muted",children:"No results found"}):e.jsx("ul",{className:"max-h-80 overflow-y-auto py-2",children:o.map(a=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>y(a),className:"flex w-full items-center gap-3 px-4 py-2.5 text-left transition hover:bg-card",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-xl border border-line/60 bg-panel/70",children:a.type==="user"?e.jsx(ce,{className:"h-4 w-4 text-muted"}):a.type==="group"?e.jsx(U,{className:"h-4 w-4 text-muted"}):e.jsx(P,{className:"h-4 w-4 text-muted"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:a.label}),e.jsx("p",{className:"truncate text-xs text-muted",children:a.sublabel})]}),e.jsx("span",{className:"rounded-full border border-line/70 bg-panel/80 px-2 py-0.5 text-[11px] font-medium uppercase tracking-wide text-muted",children:a.type})]})},`${a.type}-${a.id}`))})}):null]})}const ue=()=>{const l=T(),d=I(),o=H(),[r,m]=n.useState(!1);if(d.pathname.startsWith("/settings"))return null;const i=async()=>{if(!r){m(!0);try{await o.invalidateQueries()}finally{window.setTimeout(()=>m(!1),550)}}};return e.jsx("div",{className:"fixed bottom-[4.75rem] right-3 z-40 lg:hidden",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-line/80 bg-card/90 p-2 shadow-soft backdrop-blur-xl",children:[e.jsx("button",{type:"button",onClick:()=>l("/inbounds?quick=create"),className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-line/70 bg-card/80 text-foreground transition hover:bg-card","aria-label":"Quick add inbound",title:"Quick add inbound",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:i,className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-line/70 bg-card/80 text-foreground transition hover:bg-card","aria-label":"Refresh",title:"Refresh data",children:e.jsx(Y,{className:`h-4 w-4 ${r?"animate-spin":""}`})}),e.jsxs("button",{type:"button",onClick:()=>l("/users?quick=create"),className:"inline-flex h-10 items-center gap-1.5 rounded-xl bg-gradient-to-r from-brand-500 to-brand-600 px-3 text-sm font-semibold text-white transition hover:brightness-110",children:[e.jsx(ee,{className:"h-4 w-4"}),"Create"]})]})})},Oe=()=>{var A,M;const l=T(),d=I(),{t:o}=F(),{admin:r,logout:m,refreshToken:i}=V(),f=(r==null?void 0:r.role)==="SUPER_ADMIN"||(r==null?void 0:r.role)==="ADMIN",x=K(f),s=x.data,h=!!((A=s==null?void 0:s.checks)!=null&&A.find(t=>t.id==="update-lock"&&!t.ok)),j=!!((M=s==null?void 0:s.checks)!=null&&M.find(t=>t.blocking&&!t.ok)),[y,a]=n.useState(!1),[b,C]=n.useState(!1),[u,c]=n.useState(null),g=n.useCallback(t=>{l(t),a(!1)},[l]),E=f?e.jsx("button",{type:"button",onClick:()=>g("/settings?tab=system&section=xray-updates"),className:`inline-flex items-center gap-1.5 rounded-xl border px-3 py-2 text-xs font-semibold transition ${x.isLoading?"border-line/70 bg-card/70 text-muted":s!=null&&s.ready?"border-emerald-500/45 bg-emerald-500/15 text-emerald-300":h?"border-rose-500/45 bg-rose-500/15 text-rose-300":j?"border-amber-500/45 bg-amber-500/15 text-amber-300":"border-line/70 bg-card/70 text-muted"}`,title:"Xray update preflight status",children:x.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"h-2 w-2 animate-pulse rounded-full bg-muted"}),e.jsx("span",{className:"hidden md:inline",children:"Checking update health"})]}):s!=null&&s.ready?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden md:inline",children:"Update Ready"})]}):h?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden md:inline",children:"Update Locked"})]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden md:inline",children:"Update Needs Fix"})]})}):null,v=n.useMemo(()=>[{path:"/dashboard",icon:se,label:o("nav.dashboard")},{path:"/users",icon:U,label:o("nav.users")},{path:"/groups",icon:re,label:o("nav.groups")},{path:"/inbounds",icon:q,label:o("nav.inbounds")},{path:"/settings",icon:ae,label:o("nav.settings")}],[o]);n.useEffect(()=>{const t=window.setTimeout(()=>{for(const N of v)p(N.path,{includeData:!1})},250);return()=>window.clearTimeout(t)},[v]);const R=t=>d.pathname===t||d.pathname.startsWith(`${t}/`);n.useEffect(()=>{if(!u)return;const t=()=>{C(u.scrollTop>420)};return t(),u.addEventListener("scroll",t,{passive:!0}),()=>{u.removeEventListener("scroll",t)}},[u]);const B=()=>{_.logout(i),m(),l("/login")};return e.jsxs("div",{className:"min-h-screen text-foreground transition-colors",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-line/70 bg-card/80 backdrop-blur-xl lg:hidden",children:e.jsxs("div",{className:"flex w-full items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx("button",{onClick:()=>a(t=>!t),className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-line/70 bg-card/80 text-muted transition hover:text-foreground","aria-label":"Toggle navigation",children:y?e.jsx(z,{className:"h-5 w-5"}):e.jsx(ie,{className:"h-5 w-5"})}),e.jsxs("button",{onClick:()=>g("/dashboard"),className:"min-w-0 rounded-lg px-1 text-left",children:[e.jsx("p",{className:"text-sm font-semibold tracking-wide text-muted",children:"ONE-UI"}),e.jsx("p",{className:"max-w-[9.5rem] truncate text-sm font-bold text-foreground sm:max-w-none sm:text-base",children:"Control Center"})]})]}),e.jsxs("div",{className:"ml-2 flex shrink-0 items-center gap-1",children:[E,e.jsx(O,{compact:!0}),e.jsx($,{})]})]})}),e.jsxs("div",{className:"flex h-screen w-full overflow-hidden",children:[e.jsx("aside",{className:`glass-panel fixed inset-y-0 left-0 z-50 w-72 transform transition-transform duration-300 lg:static lg:z-auto lg:translate-x-0 ${y?"translate-x-0":"-translate-x-full"}`,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"border-b border-line/70 px-6 py-6",children:e.jsxs("button",{onClick:()=>g("/dashboard"),className:"text-left",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.22em] text-muted",children:"ONE-UI"}),e.jsx("h1",{className:"mt-2 text-2xl font-bold text-foreground",children:"Control Center"})]})}),e.jsx("div",{className:"border-b border-line/70 px-6 py-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-brand-500 to-brand-600 text-sm font-bold text-white shadow-soft",children:((r==null?void 0:r.username)||"A").charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:(r==null?void 0:r.username)||"Admin"}),e.jsx("p",{className:"truncate text-xs text-muted",children:(r==null?void 0:r.role)||"ADMIN"})]})]})}),e.jsx("nav",{className:"flex-1 space-y-2 overflow-y-auto px-4 py-5",children:v.map(({path:t,icon:N,label:S})=>{const k=R(t);return e.jsxs("button",{onClick:()=>g(t),onMouseEnter:()=>p(t),onFocus:()=>p(t),onTouchStart:()=>p(t),className:`group flex w-full items-center gap-3 rounded-xl px-4 py-3 text-left text-sm font-medium transition-all ${k?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-soft":"text-muted hover:bg-card hover:text-foreground"}`,children:[e.jsx(N,{className:`h-5 w-5 ${k?"text-white":"text-muted group-hover:text-foreground"}`}),e.jsx("span",{children:S})]},t)})}),e.jsx("div",{className:"border-t border-line/70 px-4 py-4",children:e.jsxs(J,{variant:"ghost",className:"w-full justify-start",onClick:B,children:[e.jsx(le,{className:"mr-3 h-5 w-5"}),o("nav.logout")]})})]})}),y?e.jsx("button",{className:"fixed inset-0 z-40 bg-black/35 backdrop-blur-sm lg:hidden",onClick:()=>a(!1),"aria-label":"Close navigation"}):null,e.jsxs("main",{className:"flex-1 min-w-0 overflow-y-auto overflow-x-hidden bg-transparent",ref:c,children:[e.jsxs("div",{className:"sticky top-0 z-30 hidden items-center justify-between border-b border-line/70 bg-card/75 px-6 py-4 backdrop-blur-xl lg:flex xl:px-8",children:[e.jsx(de,{}),e.jsxs("div",{className:"flex items-center gap-3",children:[E,e.jsx(O,{}),e.jsx($,{}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-card/65 px-3 py-2 text-sm text-muted",children:[o("auth.welcomeBack"),", ",e.jsx("strong",{className:"text-foreground",children:r==null?void 0:r.username})]})]})]}),e.jsx("div",{className:"mobile-shell px-4 py-5 sm:px-6 lg:px-8 lg:py-8",children:e.jsx(W,{})})]})]}),e.jsx("nav",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-line/70 bg-card/90 px-2 pb-[calc(env(safe-area-inset-bottom)+0.45rem)] pt-2 backdrop-blur-xl lg:hidden",children:e.jsx("ul",{className:`grid gap-1 ${v.length>4?"grid-cols-5":"grid-cols-4"}`,children:v.map(({path:t,icon:N,label:S})=>{const k=R(t);return e.jsx("li",{children:e.jsxs("button",{onClick:()=>g(t),onMouseEnter:()=>p(t),onFocus:()=>p(t),onTouchStart:()=>p(t),className:`flex w-full flex-col items-center justify-center rounded-xl px-2 py-2.5 text-[11px] font-medium transition-all ${k?"bg-brand-500 text-white shadow-soft":"text-muted hover:bg-card hover:text-foreground"}`,children:[e.jsx(N,{className:"mb-1 h-4 w-4"}),e.jsx("span",{className:"truncate",children:S})]})},`mobile-${t}`)})})}),b?e.jsx("button",{type:"button",onClick:()=>u==null?void 0:u.scrollTo({top:0,behavior:"smooth"}),className:"fixed bottom-[calc(env(safe-area-inset-bottom)+4.9rem)] left-3 z-40 inline-flex h-10 w-10 items-center justify-center rounded-xl border border-line/70 bg-card/90 text-foreground shadow-soft backdrop-blur-xl transition hover:bg-card","aria-label":o("common.scrollToTop",{defaultValue:"Scroll to top"}),title:o("common.scrollToTop",{defaultValue:"Scroll to top"}),children:e.jsx(ne,{className:"h-4 w-4"})}):null,e.jsx(ue,{})]})};export{Oe as DashboardLayout};
