import{b as ie,r as a,j as t,X as de}from"./index-ypj_4hQQ.js";import{u as ce}from"./useQuery-CrpZYdr1.js";import{u as G}from"./useMutation-aFhPvO3K.js";import{apiClient as p}from"./client-DZBKUZYs.js";import{u as ue,C as se}from"./useToast-DzXNWj1a.js";import{B as ae}from"./Button-CkiGx0aE.js";import{I as l}from"./Input-ConZjJPP.js";import{B as me}from"./subscriptionApps-DtH1h3Op.js";import{u as pe}from"./useTranslation-Z2v1dAK4.js";import{P as xe}from"./pen-square-CB0IYL2P.js";import{T as ge}from"./trash-2-zr-0-aP_.js";import"./cn-BLSKlp9E.js";function he(d){return d.split(",").map(o=>Number(o.trim())).filter(o=>Number.isFinite(o))}function fe(d){try{return JSON.stringify(d??[],null,2)}catch{return"[]"}}const Oe=()=>{const d=ie(),o=ue(),{t:r}=pe(),[x,q]=a.useState(null),[g,h]=a.useState(""),[c,f]=a.useState("GLOBAL"),[z,b]=a.useState("One-UI"),[J,j]=a.useState(""),[Q,N]=a.useState(""),[D,v]=a.useState(""),[$,y]=a.useState(""),[M,S]=a.useState(""),[K,C]=a.useState(""),[_,w]=a.useState(""),[X,A]=a.useState(""),[I,U]=a.useState(""),[P,O]=a.useState(""),[H,L]=a.useState(100),[E,F]=a.useState([]),[W,B]=a.useState(""),[Y,R]=a.useState("80,90,95"),[T,k]=a.useState("[]"),V=ce({queryKey:["subscription-branding"],queryFn:async()=>{var s;return((s=(await p.get("/settings/subscription-branding")).data)==null?void 0:s.brandings)||[]}}),m=Number.isInteger(x)&&x>0,re=a.useMemo(()=>{const e={android:[],ios:[],windows:[]};for(const s of me)for(const i of s.platforms)e[i].push(s);return e},[]),Z=()=>{q(null),h(""),f("GLOBAL"),b("One-UI"),j(""),N(""),v(""),y(""),S(""),C(""),w(""),A(""),U(""),O(""),L(100),F([]),B(""),R("80,90,95"),k("[]")},le=e=>{q(e.id),h(e.name||""),f(e.scope),b(e.appName||"One-UI"),j(e.logoUrl||""),N(e.profileTitle||""),v(e.profileDescription||""),y(e.customFooter||""),S(e.clashProfileName||""),C(e.supportUrl||""),w(e.primaryColor||""),A(e.accentColor||""),U(e.userId?String(e.userId):""),O(e.groupId?String(e.groupId):""),L(Number.isInteger(e.priority)?e.priority:100);const s=e.metadata&&typeof e.metadata=="object"?e.metadata:{};F(Array.isArray(s.enabledApps)?s.enabledApps.map(String):[]),B(s.qrLogoSizePercent!==void 0?String(s.qrLogoSizePercent):""),R(Array.isArray(s.usageAlertThresholds)?s.usageAlertThresholds.map(i=>String(i)).join(","):"80,90,95"),k(fe(s.customApps||[]))},ee=G({mutationFn:async()=>{const e={name:g,scope:c,appName:z,logoUrl:J,profileTitle:Q,profileDescription:D,customFooter:$,clashProfileName:M,supportUrl:K,primaryColor:_,accentColor:X,priority:H};c==="USER"&&I.trim()&&(e.userId=Number.parseInt(I,10)),c==="GROUP"&&P.trim()&&(e.groupId=Number.parseInt(P,10));const s={};E.length>0&&(s.enabledApps=E);const i=Number(W);Number.isFinite(i)&&(s.qrLogoSizePercent=Math.min(Math.max(i,10),40));const u=he(Y).map(n=>Math.min(Math.max(n,1),100));u.length>0&&(s.usageAlertThresholds=u);try{const n=T.trim()?T:"[]",te=JSON.parse(n);if(!Array.isArray(te))throw new Error("Custom apps JSON must be an array.");s.customApps=te}catch(n){throw o.error(r("common.error",{defaultValue:"Error"}),(n==null?void 0:n.message)||r("brandingSettings.toast.invalidJson",{defaultValue:"Custom apps JSON is invalid."})),n}(m||Object.keys(s).length>0)&&(e.metadata=s),m?await p.put(`/settings/subscription-branding/${x}`,e):await p.post("/settings/subscription-branding",e)},onSuccess:async()=>{Z(),await d.invalidateQueries({queryKey:["subscription-branding"]}),o.success(r("common.success",{defaultValue:"Success"}),m?r("brandingSettings.toast.updated",{defaultValue:"Subscription branding updated successfully."}):r("brandingSettings.toast.created",{defaultValue:"Subscription branding profile created successfully."}))},onError:e=>{o.error(r("common.error",{defaultValue:"Error"}),(e==null?void 0:e.message)||r("brandingSettings.toast.saveFailed",{defaultValue:"Failed to save branding"}))}}),oe=G({mutationFn:async e=>{await p.put(`/settings/subscription-branding/${e.id}`,{enabled:!e.enabled})},onSuccess:async()=>{await d.invalidateQueries({queryKey:["subscription-branding"]}),o.success(r("common.success",{defaultValue:"Success"}),r("brandingSettings.toast.statusUpdated",{defaultValue:"Branding status updated."}))},onError:e=>{o.error(r("common.error",{defaultValue:"Error"}),(e==null?void 0:e.message)||r("brandingSettings.toast.statusUpdateFailed",{defaultValue:"Failed to update branding status"}))}}),ne=G({mutationFn:async e=>{await p.delete(`/settings/subscription-branding/${e}`)},onSuccess:async()=>{await d.invalidateQueries({queryKey:["subscription-branding"]}),o.success(r("common.success",{defaultValue:"Success"}),r("brandingSettings.toast.deleted",{defaultValue:"Branding profile deleted."}))},onError:e=>{o.error(r("common.error",{defaultValue:"Error"}),(e==null?void 0:e.message)||r("brandingSettings.toast.deleteFailed",{defaultValue:"Failed to delete branding"}))}});return t.jsxs("div",{className:"space-y-6",children:[t.jsxs(se,{children:[t.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Subscription Branding"}),t.jsx("p",{className:"mt-1 text-sm text-muted",children:"Customize subscription profile identity by scope (GLOBAL, GROUP, USER)."})]}),m?t.jsxs(ae,{variant:"secondary",onClick:Z,children:[t.jsx(de,{className:"mr-2 h-4 w-4"}),"Cancel edit"]}):null]}),t.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-4",children:[t.jsx(l,{label:"Name",value:g,onChange:e=>h(e.target.value),placeholder:"Default branding"}),t.jsxs("div",{children:[t.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Scope"}),t.jsxs("select",{value:c,onChange:e=>f(e.target.value),className:"w-full rounded-xl border border-line/80 bg-card/75 px-4 py-2.5 text-sm text-foreground outline-none transition-all duration-200 focus-visible:ring-2 focus-visible:ring-brand-500/40 focus-visible:ring-offset-2 focus-visible:ring-offset-app",children:[t.jsx("option",{value:"GLOBAL",children:"GLOBAL"}),t.jsx("option",{value:"GROUP",children:"GROUP"}),t.jsx("option",{value:"USER",children:"USER"})]})]}),t.jsx(l,{label:"App Name",value:z,onChange:e=>b(e.target.value),placeholder:"One-UI"}),t.jsx(l,{label:"Logo URL",value:J,onChange:e=>j(e.target.value),placeholder:"https://..."}),t.jsx(l,{label:"Clash Profile Name",value:M,onChange:e=>S(e.target.value),placeholder:"One-UI"}),t.jsx(l,{label:"Profile Title",value:Q,onChange:e=>N(e.target.value),placeholder:"One-UI Subscription"}),t.jsx(l,{label:"Profile Description",value:D,onChange:e=>v(e.target.value),placeholder:"Managed by One-UI"}),t.jsx(l,{label:"Custom Footer",value:$,onChange:e=>y(e.target.value),placeholder:"Powered by One-UI"}),t.jsx(l,{label:"Support URL",value:K,onChange:e=>C(e.target.value),placeholder:"https://your.domain/support"}),t.jsx(l,{label:"Priority",type:"number",value:String(H),onChange:e=>L(Number.parseInt(e.target.value||"100",10))}),t.jsx(l,{label:"Primary Color",value:_,onChange:e=>w(e.target.value),placeholder:"#3b82f6"}),t.jsx(l,{label:"Accent Color",value:X,onChange:e=>A(e.target.value),placeholder:"#6366f1"}),c==="USER"?t.jsx(l,{label:"User ID",value:I,onChange:e=>U(e.target.value),placeholder:"1"}):null,c==="GROUP"?t.jsx(l,{label:"Group ID",value:P,onChange:e=>O(e.target.value),placeholder:"1"}):null]}),t.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 xl:grid-cols-3",children:[t.jsxs("div",{className:"rounded-2xl border border-line/70 bg-panel/55 p-4 xl:col-span-2",children:[t.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Enabled Apps"}),t.jsx("p",{className:"mt-1 text-xs text-muted",children:"Choose which one-click import tiles appear on the subscription page."}),t.jsx("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:["android","ios","windows"].map(e=>t.jsxs("div",{className:"rounded-2xl border border-line/70 bg-card/65 p-4",children:[t.jsx("p",{className:"text-sm font-semibold text-foreground capitalize",children:e}),t.jsx("div",{className:"mt-3 space-y-2",children:re[e].map(s=>{const i=E.includes(s.id);return t.jsxs("label",{className:"flex cursor-pointer items-start gap-2 text-sm text-muted",children:[t.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4 rounded border-line/70 bg-card text-brand-500 focus-visible:ring-2 focus-visible:ring-brand-500/40",checked:i,onChange:()=>{F(u=>u.includes(s.id)?u.filter(n=>n!==s.id):[...u,s.id])}}),t.jsxs("span",{className:"min-w-0",children:[t.jsxs("span",{className:"font-semibold text-foreground",children:[s.icon," ",s.name]}),t.jsx("span",{className:"mt-0.5 block text-xs text-muted",children:s.description})]})]},s.id)})})]},e))}),t.jsx("p",{className:"mt-3 text-xs text-muted",children:"Tip: If you leave this empty, all built-in apps will show by default."})]}),t.jsxs("div",{className:"rounded-2xl border border-line/70 bg-panel/55 p-4",children:[t.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"QR & Usage Alerts"}),t.jsx("p",{className:"mt-1 text-xs text-muted",children:"Tune QR logo size and when users see data usage warnings."}),t.jsxs("div",{className:"mt-4 space-y-3",children:[t.jsx(l,{label:"QR Logo Size (%)",value:W,onChange:e=>B(e.target.value),placeholder:"22"}),t.jsx(l,{label:"Usage Alert Thresholds (%)",value:Y,onChange:e=>R(e.target.value),placeholder:"80,90,95"})]})]})]}),t.jsxs("div",{className:"mt-6 rounded-2xl border border-line/70 bg-panel/55 p-4",children:[t.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Custom Apps (JSON)"}),t.jsxs("p",{className:"mt-1 text-xs text-muted",children:["Advanced: define extra client tiles. Provide an array of objects with fields: ",t.jsx("code",{className:"font-mono",children:"id,name,icon,platforms,usesFormat,urlScheme,storeUrl"}),"."]}),t.jsx("textarea",{value:T,onChange:e=>k(e.target.value),rows:8,className:"mt-3 w-full rounded-2xl border border-line/80 bg-card/75 px-4 py-3 font-mono text-xs text-foreground outline-none transition-all duration-200 focus-visible:ring-2 focus-visible:ring-brand-500/40 focus-visible:ring-offset-2 focus-visible:ring-offset-app"})]}),t.jsx("div",{className:"mt-4",children:t.jsx(ae,{onClick:()=>ee.mutate(),loading:ee.isPending,disabled:!g.trim(),children:m?"Save Changes":"Create Branding"})})]}),t.jsxs(se,{children:[t.jsx("h3",{className:"mb-4 text-lg font-semibold text-foreground",children:"Branding Profiles"}),t.jsx("div",{className:"overflow-x-auto rounded-2xl border border-line/70",children:t.jsxs("table",{className:"min-w-full divide-y divide-line/70",children:[t.jsx("thead",{className:"bg-panel/60",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider text-muted",children:"Name"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider text-muted",children:"Scope"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider text-muted",children:"App Name"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider text-muted",children:"Priority"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider text-muted",children:"Enabled"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium uppercase tracking-wider text-muted",children:"Action"})]})}),t.jsxs("tbody",{className:"divide-y divide-line/70 bg-card/60",children:[(V.data||[]).map(e=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-3 py-2 text-sm text-foreground",children:e.name}),t.jsxs("td",{className:"px-3 py-2 text-sm text-muted",children:[e.scope,e.scope==="USER"&&e.userId?` #${e.userId}`:"",e.scope==="GROUP"&&e.groupId?` #${e.groupId}`:""]}),t.jsx("td",{className:"px-3 py-2 text-sm text-muted",children:e.appName||"One-UI"}),t.jsx("td",{className:"px-3 py-2 text-sm text-muted",children:e.priority}),t.jsx("td",{className:"px-3 py-2",children:t.jsx("button",{type:"button",onClick:()=>oe.mutate(e),className:`inline-flex rounded-full px-2 py-1 text-xs font-medium transition ${e.enabled?"border border-emerald-500/35 bg-emerald-500/15 text-emerald-100":"border border-line/70 bg-card/60 text-muted"}`,children:e.enabled?"ON":"OFF"})}),t.jsx("td",{className:"px-3 py-2 text-right",children:t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>le(e),className:"rounded-lg p-2 text-muted hover:bg-card/70 hover:text-foreground","aria-label":`Edit ${e.name}`,children:t.jsx(xe,{className:"h-4 w-4"})}),t.jsx("button",{type:"button",onClick:()=>ne.mutate(e.id),className:"rounded-lg p-2 text-rose-400 hover:bg-rose-500/10 hover:text-rose-300","aria-label":`Delete ${e.name}`,children:t.jsx(ge,{className:"h-4 w-4"})})]})})]},e.id)),!V.isLoading&&(V.data||[]).length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"px-3 py-4 text-center text-sm text-muted",children:"No branding profile configured"})}):null]})]})})]})]})};export{Oe as default};
