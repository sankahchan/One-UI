import{c as pe,j as e,X as $t,b as T,C as ks,R as le,A as Ss,I as Ps,u as Ts,e as Cs,r as h,h as Vs,f as As,k as Is}from"./index-CG9kpP9Y.js";import{u as qe}from"./useQuery-ClalJbNF.js";import{u as z}from"./useMutation-Br-t0osD.js";import{B as Ut}from"./Badge-DQo9BAHa.js";import{B as p,L as Es}from"./Button-B80QVKRC.js";import{u as ft,C as ee}from"./useToast-C_OO-2JX.js";import{D as Ms,M as Rs}from"./DropdownMenu-DeZo-vZf.js";import{C as Ds}from"./ConfirmDialog-BK4iJYOB.js";import{P as Ls,a as Os,I as Fs}from"./InboundClientProfileModal-Bk4NkUOW.js";import{R as Bt,u as nt}from"./useTranslation-DQjABgHn.js";import{A as Ks}from"./arrow-right-Uv6Y7rOT.js";import{u as $s}from"./index.esm-C0GmNgaO.js";import{Q as Et}from"./index-BaaKCiO9.js";import{I as S}from"./Input-vpwyIRrG.js";import{c as Us,C as Bs}from"./clipboard-D_hUxpVN.js";import{S as Ws}from"./shield-check-Cc_ybT-Z.js";import{a as Wt}from"./system-v04BLkjp.js";import{P as at}from"./plus-CuU2M0FX.js";import{T as Ht}from"./trash-2-BX_Hm8OC.js";import{g as Hs}from"./users-DYrgyhkk.js";import{u as zs,a as Gs,b as qs}from"./useSmartAutoRefresh-CWzzeZv1.js";import{q as Ys}from"./useUsers-BPTWPe_a.js";import{S as Ge}from"./Skeleton-UQb2SfAS.js";import{D as _s}from"./download-CX5md0Yg.js";import{U as Xs}from"./upload-B5ihDRft.js";import{S as Mt}from"./sparkles-BY22KUTF.js";import{C as Rt}from"./chevron-down-DRrM9xHJ.js";import{F as Qs}from"./file-code-2-B1nNAYmF.js";import{P as Js}from"./pen-square-DzONsOB7.js";import"./cn-BLSKlp9E.js";import"./Spinner-8vpN8vrI.js";import"./qr-code-BvM-7NwP.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=pe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=pe("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=pe("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=pe("Radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=pe("ShieldOff",[["path",{d:"M19.7 14a6.9 6.9 0 0 0 .3-2V5l-8-3-3.2 1.2",key:"342pvf"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M4.7 4.7 4 5v7c0 6 8 10 8 10a20.3 20.3 0 0 0 5.62-4.38",key:"p0ycf4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=pe("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=pe("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=pe("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);function Dt(t){if(!Number.isFinite(t)||t<=0)return"0 B";const c=["B","KB","MB","GB","TB","PB"],o=Math.min(Math.floor(Math.log(t)/Math.log(1024)),c.length-1),d=t/1024**o;return`${d.toFixed(d>=100?0:d>=10?1:2)} ${c[o]}`}function na(t){const c=new Date(t);if(Number.isNaN(c.getTime()))return"N/A";const o=c.getTime()-Date.now(),d=Math.ceil(o/(1e3*60*60*24));return d>0?`${d}d left`:"Expired"}function la(t){if(!t)return"No activity";const c=new Date(t).getTime();if(Number.isNaN(c))return"No activity";const o=Math.floor((Date.now()-c)/6e4);if(o<1)return"just now";if(o<60)return`${o}m ago`;const d=Math.floor(o/60);return d<24?`${d}h ago`:`${Math.floor(d/24)}d ago`}function oa({inbound:t,clients:c,sessionsByUuid:o,onClose:d,onViewUser:N,onToggleAccess:f,onResetTraffic:D,onExtendExpiry:C,onDisableUser:V,onDecreasePriority:M,onIncreasePriority:L,actionLoadingKey:A=null}){return e.jsx("div",{className:"fixed inset-0 z-50 flex justify-end bg-black/45 backdrop-blur-sm",children:e.jsxs("div",{className:"flex h-full w-full max-w-3xl flex-col border-l border-line/70 bg-card/95 shadow-soft",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-line/70 px-5 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:"Inbound Details"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:t.remark||t.tag}),e.jsxs("p",{className:"mt-1 text-sm text-muted",children:[t.protocol," • Port ",t.port," • ",t.network,"/",t.security]})]}),e.jsx("button",{type:"button",onClick:d,className:"rounded-lg p-2 text-muted transition-colors hover:bg-card/80 hover:text-foreground","aria-label":"Close drawer",children:e.jsx($t,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:c.length===0?e.jsx("div",{className:"rounded-xl border border-line/70 bg-panel/40 px-4 py-10 text-center text-sm text-muted",children:"No clients are assigned to this inbound yet."}):e.jsx("div",{className:"space-y-3",children:c.map(x=>{const m=o.get(x.uuid),B=!!(m!=null&&m.online),u=x.dataLimit>0?Math.min(x.totalUsed/x.dataLimit*100,100):0,v=`u${x.id}-`;return e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/45 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:x.email}),e.jsxs("p",{className:"text-xs text-muted",children:[x.uuid.slice(0,10),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs ${B?"bg-emerald-500/15 text-emerald-300":"bg-zinc-500/15 text-zinc-300"}`,children:[e.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[B?e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-400 opacity-70"}):null,e.jsx("span",{className:`relative inline-flex h-2.5 w-2.5 rounded-full ${B?"bg-emerald-400":"bg-zinc-400"}`})]}),B?"Online":"Offline"]}),e.jsx("span",{className:"rounded-full bg-card/80 px-2 py-0.5 text-xs text-muted",children:x.status}),e.jsxs("span",{className:"rounded-full bg-brand-500/15 px-2 py-0.5 text-xs text-brand-300",children:["Priority ",x.priority]}),x.enabled?null:e.jsx("span",{className:"rounded-full bg-amber-500/15 px-2 py-0.5 text-xs text-amber-300",children:"Key Off"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-line/60 bg-card/60 p-2.5",children:[e.jsx("p",{className:"text-muted",children:"Traffic"}),e.jsxs("p",{className:"mt-1 text-sm text-foreground",children:[Dt(x.totalUsed)," / ",x.dataLimit>0?Dt(x.dataLimit):"∞"]}),e.jsx("div",{className:"mt-2 h-2 rounded-full bg-panel/90",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-brand-500 to-brand-600",style:{width:`${u}%`}})})]}),e.jsxs("div",{className:"rounded-lg border border-line/60 bg-card/60 p-2.5",children:[e.jsx("p",{className:"text-muted",children:"Expiry"}),e.jsx("p",{className:"mt-1 text-sm text-foreground",children:na(x.expireDate)}),e.jsx("p",{className:"mt-1 text-muted",children:new Date(x.expireDate).toLocaleDateString()})]}),e.jsxs("div",{className:"rounded-lg border border-line/60 bg-card/60 p-2.5",children:[e.jsx("p",{className:"text-muted",children:"Session"}),e.jsx("p",{className:"mt-1 text-sm text-foreground",children:B?(m==null?void 0:m.currentIp)||"Connected":`Last seen ${la((m==null?void 0:m.lastSeenAt)||null)}`}),!B&&(m!=null&&m.currentIp)?e.jsx("p",{className:"mt-1 text-muted",children:m.currentIp}):null]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-6",children:[e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>N(x.id),children:"View"}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>M(x),loading:A===`${v}priority-down`,children:"Priority -"}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>L(x),loading:A===`${v}priority-up`,children:"Priority +"}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>f(x),loading:A===`${v}toggle`,children:[x.enabled?e.jsx(ra,{className:"mr-1 h-4 w-4"}):e.jsx(aa,{className:"mr-1 h-4 w-4"}),"Key"]}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>D(x),loading:A===`${v}reset`,children:[e.jsx(Bt,{className:"mr-1 h-4 w-4"}),"Reset"]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>C(x,7),loading:A===`${v}extend7`,children:"+7d"}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>C(x,30),loading:A===`${v}extend30`,children:"+30d"}),e.jsxs(p,{size:"sm",variant:"danger",onClick:()=>V(x),loading:A===`${v}disable`,children:[e.jsx(sa,{className:"mr-1 h-4 w-4"}),"Disable"]})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>N(x.id),className:"inline-flex items-center gap-1 text-xs font-medium text-brand-500 hover:text-brand-600",children:["Open user page",e.jsx(Ks,{className:"h-3.5 w-3.5"})]})})]},`${t.id}-${x.id}`)})})})]})})}const rt=[{id:"vless-reality-xhttp",name:"VLESS + REALITY + XHTTP",description:"Modern anti-censorship profile for latest Xray clients.",category:"recommended",highlights:["Anti-censorship","Modern Xray","XHTTP"],values:{protocol:"VLESS",network:"XHTTP",security:"REALITY",port:443,tag:"vless-reality-xhttp",remark:"VLESS REALITY XHTTP",wsPath:"/xhttp",xhttpMode:"auto",serverName:"www.microsoft.com",realityFingerprint:"chrome"}},{id:"vless-reality-tcp",name:"VLESS + REALITY + TCP",description:"Lean REALITY profile with plain TCP transport.",category:"recommended",highlights:["Low overhead","REALITY","TCP"],values:{protocol:"VLESS",network:"TCP",security:"REALITY",port:443,tag:"vless-reality-tcp",remark:"VLESS REALITY TCP",serverName:"www.cloudflare.com",realityFingerprint:"chrome"}},{id:"vless-ws-tls",name:"VLESS + WS + TLS",description:"Compatible profile for websocket clients and CDN edge.",category:"cdn",highlights:["CDN friendly","WS","TLS"],values:{protocol:"VLESS",network:"WS",security:"TLS",port:443,tag:"vless-ws-tls",remark:"VLESS WS TLS",wsPath:"/vless",alpn:'["h2","http/1.1"]'}},{id:"vless-httpupgrade-tls",name:"VLESS + HTTPUpgrade + TLS",description:"HTTPUpgrade profile for edge/CDN traffic blending.",category:"cdn",highlights:["HTTPUpgrade","CDN edge","TLS"],values:{protocol:"VLESS",network:"HTTPUPGRADE",security:"TLS",port:443,tag:"vless-httpupgrade-tls",remark:"VLESS HTTPUpgrade TLS",wsPath:"/upgrade",alpn:'["h2","http/1.1"]'}},{id:"trojan-grpc",name:"Trojan + gRPC + TLS",description:"Stable TLS profile with gRPC transport.",category:"transport",highlights:["TLS only","gRPC","Stable"],values:{protocol:"TROJAN",network:"GRPC",security:"TLS",port:443,tag:"trojan-grpc",remark:"Trojan gRPC",grpcServiceName:"trojan-grpc",alpn:'["h2","http/1.1"]'}},{id:"trojan-ws-tls",name:"Trojan + WS + TLS",description:"Trojan profile tuned for websocket deployments.",category:"transport",highlights:["Trojan","WebSocket","TLS"],values:{protocol:"TROJAN",network:"WS",security:"TLS",port:443,tag:"trojan-ws-tls",remark:"Trojan WS TLS",wsPath:"/trojan",alpn:'["h2","http/1.1"]'}},{id:"vmess-ws-tls",name:"VMess + WS + TLS",description:"Classic VMess deployment profile.",category:"transport",highlights:["Legacy compatible","WS","TLS"],values:{protocol:"VMESS",network:"WS",security:"TLS",port:443,tag:"vmess-ws-tls",remark:"VMess WS TLS",wsPath:"/vmess",alpn:'["h2","http/1.1"]'}},{id:"vmess-grpc-tls",name:"VMess + gRPC + TLS",description:"VMess profile with gRPC transport for modern clients.",category:"transport",highlights:["VMess","gRPC","TLS"],values:{protocol:"VMESS",network:"GRPC",security:"TLS",port:443,tag:"vmess-grpc-tls",remark:"VMess gRPC TLS",grpcServiceName:"vmess-grpc",alpn:'["h2","http/1.1"]'}},{id:"dokodemo-dns-forward",name:"Dokodemo DNS Forward",description:"Forward DNS traffic to an upstream resolver.",category:"utility",highlights:["DNS relay","UDP","Resolver"],values:{protocol:"DOKODEMO_DOOR",network:"TCP",security:"NONE",port:5353,tag:"dokodemo-dns",remark:"Dokodemo DNS Forward",serverAddress:"1.1.1.1",dokodemoTargetPort:53,dokodemoNetwork:"udp",dokodemoFollowRedirect:!1}},{id:"dokodemo-tcp-forward",name:"Dokodemo TCP Forward",description:"Forward raw TCP traffic to a target service.",category:"utility",highlights:["TCP relay","Debugging","Forward"],values:{protocol:"DOKODEMO_DOOR",network:"TCP",security:"NONE",port:10080,tag:"dokodemo-tcp-forward",remark:"Dokodemo TCP Forward",serverAddress:"127.0.0.1",dokodemoTargetPort:80,dokodemoNetwork:"tcp",dokodemoFollowRedirect:!1}},{id:"shadowsocks-tcp",name:"Shadowsocks (TCP/UDP)",description:"Lightweight encrypted proxy profile for broad client compatibility.",category:"recommended",highlights:["Fast","Simple","Broad client support"],values:{protocol:"SHADOWSOCKS",network:"TCP",security:"NONE",port:8388,tag:"shadowsocks-main",remark:"Shadowsocks Main",cipher:"chacha20-ietf-poly1305"}},{id:"socks5-local-lan",name:"SOCKS5 LAN Gateway",description:"SOCKS gateway profile for local/LAN applications.",category:"utility",highlights:["LAN apps","SOCKS5","Simple"],values:{protocol:"SOCKS",network:"TCP",security:"NONE",port:1080,tag:"socks5-lan-gateway",remark:"SOCKS5 LAN Gateway",serverAddress:"0.0.0.0"}},{id:"socks5-auth",name:"SOCKS5 Auth Gateway",description:"Username/password SOCKS proxy using panel user credentials.",category:"utility",highlights:["Auth","SOCKS5","Gateway"],values:{protocol:"SOCKS",network:"TCP",security:"NONE",port:10808,tag:"socks-auth",remark:"SOCKS5 Auth Gateway"}},{id:"http-proxy-auth",name:"HTTP Proxy Auth",description:"Classic authenticated HTTP forward proxy for browser/system use.",category:"utility",highlights:["HTTP proxy","Auth","Legacy tools"],values:{protocol:"HTTP",network:"TCP",security:"NONE",port:10809,tag:"http-proxy-auth",remark:"HTTP Proxy Auth"}},{id:"wireguard-egress",name:"WireGuard Egress Tunnel",description:"Expose a local SOCKS listener routed over WireGuard outbound.",category:"transport",highlights:["WireGuard","Egress","Secure tunnel"],values:{protocol:"WIREGUARD",network:"TCP",security:"NONE",port:51820,tag:"wireguard-egress",remark:"WireGuard Egress",wgAddress:"10.66.2.2/32",wgAllowedIPs:"0.0.0.0/0, ::/0",wgMtu:1420}},{id:"mtproto-telegram",name:"MTProto Telegram",description:"Telegram-oriented proxy inbound using MTProto protocol.",category:"utility",highlights:["Telegram","MTProto","Stealth"],values:{protocol:"MTPROTO",network:"TCP",security:"NONE",port:443,tag:"mtproto-telegram",remark:"MTProto Telegram"}}];function Lt(t){return t&&typeof t=="object"&&"data"in t?t.data:t}const ia=({register:t,watch:c,setValue:o,errors:d})=>{var m,B;const N=ft(),{t:f}=nt(),D=(c("realityDest")||"").trim(),C=(c("serverName")||"").trim(),V=String(c("realityServerName")||"").split(",").map(u=>u.trim()).filter(Boolean),{data:M,isLoading:L}=qe({queryKey:["reality-destinations"],queryFn:async()=>{const u=await T.get("/reality/destinations"),v=Lt(u)||{};return{destinations:Array.isArray(v.destinations)?v.destinations:[],recommendedWsPaths:Array.isArray(v.recommendedWsPaths)?v.recommendedWsPaths:[]}}}),A=z({mutationFn:async u=>{const v=await T.post("/reality/test-destination",{dest:u});return Lt(v)},onSuccess:u=>{if(u!=null&&u.accessible){N.success(f("common.success",{defaultValue:"Success"}),f("inbounds.toast.destinationReachable",{defaultValue:"Destination reachable: {{dest}}",dest:String(u.destination||D||"")}));return}N.warning(f("common.warning",{defaultValue:"Warning"}),String((u==null?void 0:u.message)||(u==null?void 0:u.destination)||f("inbounds.toast.destinationUnavailable",{defaultValue:"Destination is not reachable"})))},onError:u=>{N.error(f("common.error",{defaultValue:"Error"}),(u==null?void 0:u.message)||f("inbounds.toast.destinationTestFailed",{defaultValue:"Failed to test destination"}))}}),x=u=>{o("realityDest",u.dest,{shouldDirty:!0,shouldValidate:!0});const v=Array.isArray(u.serverNames)?u.serverNames.join(","):"";v&&V.length===0&&o("realityServerName",v,{shouldDirty:!0,shouldValidate:!0}),!C&&Array.isArray(u.serverNames)&&u.serverNames[0]&&o("serverName",u.serverNames[0],{shouldDirty:!0,shouldValidate:!0})};return e.jsxs("div",{className:"space-y-4 rounded-xl border border-line/70 bg-panel/45 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"REALITY Destination Controls"}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:"Use a high-trust TLS destination to improve DPI resistance."})]}),e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-500/30 bg-emerald-500/10 px-2 py-1 text-[11px] font-semibold text-emerald-300",children:[e.jsx(Ws,{className:"h-3.5 w-3.5"}),"Myanmar Optimized"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Reality Destination (host:port)",...t("realityDest",{validate:u=>u?/^[^:\s]+:\d{1,5}$/.test(String(u).trim())||"Use host:port format, e.g. www.microsoft.com:443":!0}),error:(m=d.realityDest)==null?void 0:m.message,placeholder:"www.microsoft.com:443"}),e.jsx(S,{label:"Reality Spider X (Optional)",...t("realitySpiderX"),error:(B=d.realitySpiderX)==null?void 0:B.message,placeholder:"/"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>{if(!D){N.warning(f("common.warning",{defaultValue:"Warning"}),f("inbounds.toast.destinationRequired",{defaultValue:"Select or enter a destination first."}));return}A.mutate(D)},loading:A.isPending,children:[e.jsx(ta,{className:"mr-2 h-4 w-4"}),"Test Current Destination"]}),Array.isArray(M==null?void 0:M.recommendedWsPaths)&&M.recommendedWsPaths.length>0?e.jsxs("span",{className:"text-xs text-muted",children:["Suggested WS paths: ",M.recommendedWsPaths.slice(0,3).join(", ")]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-muted",children:"Curated Destinations"}),L?e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-line/70 bg-card/60 px-3 py-2 text-xs text-muted",children:[e.jsx(Es,{className:"h-4 w-4 animate-spin"}),"Loading destination catalog..."]}):null,!L&&(!(M!=null&&M.destinations)||M.destinations.length===0)?e.jsx("div",{className:"rounded-lg border border-line/70 bg-card/60 px-3 py-2 text-xs text-muted",children:"Destination catalog unavailable. You can still set destination manually."}):null,!L&&Array.isArray(M==null?void 0:M.destinations)?e.jsx("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:M.destinations.map(u=>{const v=D===u.dest;return e.jsxs("button",{type:"button",onClick:()=>x(u),className:`rounded-lg border px-3 py-2 text-left transition ${v?"border-brand-500/60 bg-brand-500/10":"border-line/70 bg-card/60 hover:border-brand-400/40"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:u.name}),v?e.jsx(ks,{className:"h-4 w-4 text-brand-300"}):null]}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:u.dest}),e.jsxs("p",{className:"mt-1 text-[11px] text-muted",children:[u.region||"Global"," • ",u.reliability||"High"]})]},u.dest)})}):null]})]})},zt=t=>({id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,dest:"",path:"",alpn:"",name:"",xver:"",...t}),Ot=t=>Array.isArray(t)?t.filter(c=>c&&typeof c=="object").map(c=>{const o=c;return zt({dest:o.dest?String(o.dest):"",path:o.path?String(o.path):"",name:o.name?String(o.name):"",xver:o.xver!==void 0&&o.xver!==null?String(o.xver):"",alpn:Array.isArray(o.alpn)?o.alpn.map(d=>String(d).trim()).filter(Boolean).join(","):o.alpn?String(o.alpn):""})}):[],Ft=t=>t.map(c=>{const o=c.dest.trim(),d=c.path.trim(),N=c.name.trim(),f=c.xver.trim(),D=c.alpn.split(",").map(V=>V.trim()).filter(Boolean);if(!o)return null;const C={dest:o};if(d&&(C.path=d),N&&(C.name=N),D.length>0&&(C.alpn=D),f){const V=Number.parseInt(f,10);Number.isNaN(V)||(C.xver=V)}return C}).filter(c=>!!c),da=({inbound:t,initialValues:c,onClose:o,onSuccess:d})=>{var We,fe,He,ge;const N=ft(),{t:f}=nt(),[D,C]=le.useState(!1),V=!!t,M=t==null?void 0:t.domains,L=t==null?void 0:t.fallbacks,[A,x]=le.useState(()=>Ot(L)),{register:m,handleSubmit:B,setValue:u,getValues:v,watch:j,formState:{errors:te}}=$s({defaultValues:t?{...t,realityShortId:Array.isArray(t.realityShortIds)?t.realityShortIds.join(","):void 0,realityServerName:Array.isArray(t.realityServerNames)?t.realityServerNames.join(","):void 0,domains:M?M.join(", "):void 0,fallbacks:L&&L.length>0?JSON.stringify(L,null,2):""}:{protocol:"VLESS",network:"TCP",security:"NONE",alpn:'["h2","http/1.1"]',...c}}),O=j("protocol"),I=j("network"),F=j("security"),oe=j("serverName"),De=j("wsPath"),ve=j("wsHost"),Ne=j("grpcServiceName"),je=j("xhttpMode"),we=j("realityPublicKey"),Le=j("realityPrivateKey"),ke=j("realityShortId"),Se=j("realityServerName"),_=j("realityFingerprint"),q=j("realitySpiderX"),w=j("tag"),xe=j("dokodemoTargetPort"),Ye=j("dokodemoNetwork"),X=O==="DOKODEMO_DOOR",se=["VLESS","VMESS","TROJAN","SHADOWSOCKS"].includes(O),Pe=["VLESS","VMESS","TROJAN","SHADOWSOCKS"].includes(O),R=O==="VLESS",W=["VLESS","TROJAN"].includes(O),Y=j("wgPrivateKey"),he=j("wgPeerPublicKey"),lt=j("wgPublicKey"),Te=j("wgPeerEndpoint"),Q=j("serverAddress"),Ce=j("port"),Oe=j("wgAllowedIPs"),ot=j("wgMtu"),ie=j("wgAddress");le.useEffect(()=>{if(V)return;const r=String(v("serverAddress")||"").trim();(!r||r==="your.domain.com")&&Wt().then(n=>{const b=n.ip||(typeof window<"u"?window.location.hostname:"");b&&u("serverAddress",b,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!0})}).catch(()=>{typeof window<"u"&&window.location.hostname&&u("serverAddress",window.location.hostname,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!0})})},[v,V,u]),le.useEffect(()=>{x(Ot(L))},[L]),le.useEffect(()=>{const r=document.body.style.overflow,n=document.body.style.paddingRight,b=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",b>0&&(document.body.style.paddingRight=`${b}px`),()=>{document.body.style.overflow=r,document.body.style.paddingRight=n}},[]);const Fe=le.useMemo(()=>JSON.stringify(Ft(A),null,2),[A]),K=le.useMemo(()=>{const r={recommended:0,cdn:1,transport:2,utility:3};return[...rt].sort((n,b)=>{const g=r[n.category]-r[b.category];return g!==0?g:n.name.localeCompare(b.name)}).slice(0,12)},[]),ae=le.useMemo(()=>{const r=[],n=[];if((Q||"").trim()||r.push("Server address is required."),O==="TROJAN"&&F!=="TLS"&&n.push("Trojan always uses TLS. One-UI will enforce TLS on save."),O==="VLESS"&&F==="REALITY"&&((we||"").trim()||r.push("REALITY requires a Public Key."),(Le||"").trim()||r.push("REALITY requires a Private Key."),!(oe||"").trim()&&!(Se||"").trim()&&r.push("REALITY requires SNI or Reality Server Names."),(ke||"").trim()||n.push("Set a REALITY Short ID for better client compatibility.")),O==="WIREGUARD"&&((Y||"").trim()||r.push("WireGuard requires a local Private Key."),(he||"").trim()||r.push("WireGuard requires Peer Public Key."),(Te||"").trim()||r.push("WireGuard requires Peer Endpoint (host:port)."),(Oe||"").trim()||n.push("Allowed IPs is empty; recommended: 0.0.0.0/0, ::/0")),X){const b=Number(xe);(!Number.isInteger(b)||b<1||b>65535)&&r.push("Dokodemo-door requires a valid Target Port."),(Ye||"").trim()||n.push("Set Target Network (tcp/udp) explicitly for predictable routing.")}return se&&(I==="WS"||I==="HTTPUPGRADE"||I==="XHTTP")&&!(De||"").trim()&&n.push("Path is empty; define wsPath/xhttp path for client consistency."),se&&I==="GRPC"&&!(Ne||"").trim()&&n.push("gRPC Service Name is empty; most clients require a matching service name."),F==="TLS"&&!(oe||"").trim()&&n.push("TLS SNI is empty; set Server Name to avoid certificate mismatch."),W&&F==="TLS"&&(A.some(g=>[g.dest,g.path,g.alpn,g.name,g.xver].some($=>$.trim().length>0)&&!g.dest.trim())?r.push("Each fallback row with values must include Dest."):A.length===0&&n.push("Fallbacks are optional. Add them only if your routing requires fallback destinations.")),{issues:r,tips:n}},[Ye,xe,Ne,X,I,O,Le,we,ke,F,Q,oe,Se,se,W,A,Oe,Te,he,Y,De]),re=r=>{for(const[n,b]of Object.entries(r.values))u(n,b,{shouldDirty:!0,shouldValidate:!0})},Ke=()=>{x(r=>[...r,zt()])},_e=r=>{x(n=>n.filter(b=>b.id!==r))},J=(r,n,b)=>{x(g=>g.map(H=>H.id!==r?H:{...H,[n]:b}))},Ve=r=>{r==="multiplexer"?x([{id:Math.random().toString(36).substring(7),path:"/api/v2/telemetry",dest:"10002",name:"Internal VMess",alpn:"",xver:"1"},{id:Math.random().toString(36).substring(7),path:"",dest:"10001",name:"Internal Trojan",alpn:"h2",xver:"1"},{id:Math.random().toString(36).substring(7),path:"",dest:"80",name:"Web Camouflage",alpn:"",xver:"0"}]):r==="shadowsocks"?x([{id:Math.random().toString(36).substring(7),path:"",dest:"10003",name:"Internal Shadowsocks",alpn:"",xver:"1"},{id:Math.random().toString(36).substring(7),path:"",dest:"80",name:"Web Camouflage",alpn:"",xver:"0"}]):r==="web"&&x([{id:Math.random().toString(36).substring(7),path:"",dest:"80",name:"Web Camouflage",alpn:"",xver:"0"}])},$e=z({mutationFn:async r=>{V&&t?await T.put(`/inbounds/${t.id}`,r):await T.post("/inbounds",r)},onSuccess:()=>{d()},onError:r=>{N.error(f("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||f("inbounds.toast.saveFailed",{defaultValue:"Failed to save inbound"}))}}),Xe=z({mutationFn:async()=>{var n;const r=await T.get("/inbounds/random-port");return Number(((n=r==null?void 0:r.data)==null?void 0:n.port)||0)},onSuccess:r=>{if(!Number.isInteger(r)||r<1||r>65535)return;u("port",r,{shouldDirty:!0,shouldValidate:!0}),(v("tag")||"").trim()||u("tag",`${String(O).toLowerCase()}-${r}`,{shouldDirty:!0,shouldValidate:!0})},onError:r=>{N.error(f("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||f("inbounds.toast.randomPortFailed",{defaultValue:"Failed to generate random port"}))}}),ne=z({mutationFn:async()=>await T.get("/inbounds/wireguard/keys"),onSuccess:r=>{const n=(r==null?void 0:r.data)||r;n!=null&&n.privateKey&&u("wgPrivateKey",n.privateKey,{shouldDirty:!0,shouldValidate:!0}),n!=null&&n.publicKey&&u("wgPublicKey",n.publicKey,{shouldDirty:!0,shouldValidate:!0}),v("wgAllowedIPs")||u("wgAllowedIPs","0.0.0.0/0, ::/0",{shouldDirty:!0,shouldValidate:!1})},onError:r=>{N.error(f("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||f("inbounds.toast.wireguardKeygenFailed",{defaultValue:"Failed to generate WireGuard keys"}))}}),Ue=z({mutationFn:async()=>await T.post("/reality/generate-keys",{serverName:v("serverName")||void 0}),onSuccess:r=>{const n=(r==null?void 0:r.data)||r;n!=null&&n.privateKey&&u("realityPrivateKey",n.privateKey,{shouldDirty:!0,shouldValidate:!0}),n!=null&&n.publicKey&&u("realityPublicKey",n.publicKey,{shouldDirty:!0,shouldValidate:!0});const b=Array.isArray(n==null?void 0:n.shortIds)?n.shortIds:n!=null&&n.shortId?[n.shortId]:[];if(b.length>0){const H=[(v("realityShortId")||"").trim(),b.join(",")].filter(Boolean).join(",").split(",").map($=>$.trim()).filter(Boolean);u("realityShortId",Array.from(new Set(H)).join(","),{shouldDirty:!0,shouldValidate:!0})}v("realityFingerprint")||u("realityFingerprint",(n==null?void 0:n.fingerprint)||"chrome",{shouldDirty:!0,shouldValidate:!1}),v("serverName")||u("serverName",(n==null?void 0:n.serverName)||"www.microsoft.com",{shouldDirty:!0,shouldValidate:!0}),!v("realityServerName")&&(n!=null&&n.serverName)&&u("realityServerName",n.serverName,{shouldDirty:!0,shouldValidate:!1})},onError:r=>{N.error(f("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||f("inbounds.toast.realityKeygenFailed",{defaultValue:"Failed to generate REALITY keys"}))}}),P=r=>{const n={...r,domains:typeof r.domains=="string"?r.domains.split(",").map(g=>g.trim()).filter(Boolean):Array.isArray(r.domains)?r.domains:[]},b=Ft(A);if(n.fallbacks=JSON.stringify(b),se||(n.network="TCP",n.security="NONE"),X&&!n.dokodemoTargetPort&&(n.dokodemoTargetPort=80),!Pe&&n.security==="TLS"&&(n.security="NONE"),!R&&n.security==="REALITY"&&(n.security="NONE"),n.protocol==="TROJAN"&&(n.security="TLS"),n.security==="REALITY"){const g=typeof n.realityShortId=="string"?n.realityShortId.split(",").map($=>$.trim()).filter(Boolean):[];n.realityShortId=g.join(",");const H=typeof n.realityServerName=="string"?n.realityServerName.split(",").map($=>$.trim()).filter(Boolean):[];n.realityServerName=H.join(","),!n.serverName&&H.length>0&&(n.serverName=H[0])}$e.mutate(n)},Qe=()=>{const r=(Q||"").trim();if((Te||"").trim())return;if(!r){N.warning(f("common.warning",{defaultValue:"Warning"}),f("inbounds.toast.missingServerAddress",{defaultValue:"Set Server Address first."}));return}const b=Number(Ce),g=Number.isInteger(b)&&b>0?b:51820;u("wgPeerEndpoint",`${r}:${g}`,{shouldDirty:!0,shouldValidate:!0})},Be=(()=>{if(O!=="WIREGUARD")return"";const r=(Y||"").trim(),n=(he||lt||"").trim(),b=(Te||"").trim();if(!r||!n||!b)return"";const g=(ie||"").trim()||"10.66.2.2/32",H=(Oe||"").trim()||"0.0.0.0/0, ::/0",$=Number(ot),ce=Number.isInteger($)&&$>0,Ie=["[Interface]",`PrivateKey = ${r}`,`Address = ${g}`,"","[Peer]",`PublicKey = ${n}`,`Endpoint = ${b}`,`AllowedIPs = ${H}`,"PersistentKeepalive = 25"];return ce&&Ie.splice(3,0,`MTU = ${$}`),Ie.join(`
`)})(),de=(()=>{if(O!=="VLESS"||F!=="REALITY")return"";const r=(Q||"").trim(),n=Number(Ce),b=(we||"").trim();if(!r||!Number.isInteger(n)||n<1||!b)return"";const g=new URLSearchParams,H=(I||"TCP").toLowerCase();g.set("type",H),g.set("security","reality");const $=(Se||"").split(",").map(ze=>ze.trim()).filter(Boolean)[0];g.set("sni",(oe||$||r).trim()),g.set("fp",(_||"chrome").trim()||"chrome"),g.set("pbk",b),g.set("flow","xtls-rprx-vision");const ce=(ke||"").split(",").map(ze=>ze.trim()).filter(Boolean);ce.length>0&&g.set("sid",ce[0]),q&&String(q).trim()&&g.set("spx",String(q).trim()),I==="WS"||I==="HTTPUPGRADE"||I==="XHTTP"?(g.set("path",(De||"/").trim()||"/"),ve&&String(ve).trim()&&g.set("host",String(ve).trim()),I==="XHTTP"&&je&&String(je).trim()&&g.set("mode",String(je).trim())):I==="GRPC"&&(g.set("serviceName",(Ne||"").trim()),g.set("mode","gun"));const Ie=encodeURIComponent((w||"vless-reality").trim()||"vless-reality");return`vless://{UUID}@${r}:${n}?${g.toString()}#${Ie}`})(),Je=async()=>{if(!de)return;if(!await Us(de)){N.error(f("common.error",{defaultValue:"Error"}),f("inbounds.toast.copyRealityTemplateFailed",{defaultValue:"Failed to copy template"}));return}C(!0),window.setTimeout(()=>C(!1),1600)};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto overscroll-contain bg-black/45 p-2 backdrop-blur-sm sm:p-4",style:{WebkitOverflowScrolling:"touch"},children:e.jsx("div",{className:"flex min-h-full items-end justify-center sm:items-center",children:e.jsxs("div",{className:"my-2 flex max-h-[calc(100dvh-1rem)] w-full max-w-3xl flex-col overflow-hidden rounded-3xl glass-card sm:my-4 sm:max-h-[calc(100dvh-2rem)]",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-line/50 bg-card/60 p-5 backdrop-blur-md",children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent sm:text-2xl",children:V?"Edit Inbound":"Add New Inbound"}),e.jsx("button",{onClick:o,className:"rounded-xl p-2 text-muted transition-all hover:bg-white/10 hover:text-foreground active:scale-95",children:e.jsx($t,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:B(P),className:"min-h-0 flex-1 space-y-6 overflow-y-auto overscroll-contain px-5 pb-28 pt-5 sm:px-6 sm:pb-32 sm:pt-6",style:{WebkitOverflowScrolling:"touch"},children:[V?null:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Quick Presets"}),e.jsx("span",{className:"text-xs text-muted",children:"One-click inbound wizard"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:K.map(r=>e.jsxs("button",{type:"button",onClick:()=>re(r),className:"rounded-xl border border-line/80 bg-card/70 p-3 text-left transition hover:border-brand-400/55 hover:bg-card",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:r.name}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:r.values.protocol}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:r.values.network})]}),e.jsx("p",{className:"mt-1 text-xs leading-relaxed text-muted",children:r.description}),e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:r.highlights.slice(0,3).map(n=>e.jsx("span",{className:"rounded-md border border-brand-500/20 bg-brand-500/10 px-1.5 py-0.5 text-[10px] font-medium text-brand-700 dark:text-brand-300",children:n},`${r.id}-${n}`))})]},r.id))})]}),ae.issues.length>0||ae.tips.length>0?e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[ae.issues.length>0?e.jsx(Ss,{className:"h-4 w-4 text-amber-500"}):e.jsx(Ps,{className:"h-4 w-4 text-brand-500"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Validation Guide"})]}),ae.issues.map(r=>e.jsxs("p",{className:"mb-1 text-xs text-red-500",children:["• ",r]},`issue-${r}`)),ae.tips.map(r=>e.jsxs("p",{className:"mb-1 text-xs text-muted",children:["• ",r]},`tip-${r}`))]}):null,e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Basic Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Protocol *"}),e.jsxs("select",{...m("protocol",{required:"Protocol is required"}),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"VLESS",children:"VLESS"}),e.jsx("option",{value:"VMESS",children:"VMess"}),e.jsx("option",{value:"TROJAN",children:"Trojan"}),e.jsx("option",{value:"SHADOWSOCKS",children:"Shadowsocks"}),e.jsx("option",{value:"SOCKS",children:"SOCKS5"}),e.jsx("option",{value:"HTTP",children:"HTTP Proxy"}),e.jsx("option",{value:"DOKODEMO_DOOR",children:"Dokodemo-door"}),e.jsx("option",{value:"WIREGUARD",children:"Wireguard"}),e.jsx("option",{value:"MTPROTO",children:"MTProto (Telegram)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{label:"Port *",type:"number",...m("port",{required:"Port is required",min:{value:1,message:"Port must be between 1-65535"},max:{value:65535,message:"Port must be between 1-65535"}}),error:(We=te.port)==null?void 0:We.message,placeholder:"443"}),e.jsxs(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Xe.mutate(),loading:Xe.isPending,children:[e.jsx(ht,{className:"mr-2 h-4 w-4"}),"Random Free Port"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Tag *",...m("tag",{required:"Tag is required"}),error:(fe=te.tag)==null?void 0:fe.message,placeholder:"vless-ws-tls"}),e.jsx(S,{label:"Remark",...m("remark"),placeholder:"My VLESS Inbound"})]}),e.jsx(S,{label:X?"Target Address *":"Server Address *",...m("serverAddress",{required:"Server address is required"}),error:(He=te.serverAddress)==null?void 0:He.message,placeholder:X?"127.0.0.1":"your.domain.com or IP"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Additional Domains"}),e.jsx(S,{placeholder:"cdn.domain.com, worker.domain.com (comma separated)",...m("domains")}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:"Optional: Comma-separated list of additional domains for this inbound."})]})]}),X?e.jsxs("div",{className:"space-y-4 rounded-xl border border-line/70 bg-panel/50 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Dokodemo-door Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Target Port *",type:"number",...m("dokodemoTargetPort",{valueAsNumber:!0,min:{value:1,message:"Target port must be between 1-65535"},max:{value:65535,message:"Target port must be between 1-65535"}}),error:(ge=te.dokodemoTargetPort)==null?void 0:ge.message,placeholder:"80"}),e.jsx(S,{label:"Target Network",...m("dokodemoNetwork"),placeholder:"tcp,udp"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",...m("dokodemoFollowRedirect"),className:"h-4 w-4 rounded border-line bg-card"}),"Follow redirect"]})]}):null,se?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Network Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Network *"}),e.jsxs("select",{...m("network",{required:"Network is required"}),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"TCP",children:"TCP"}),e.jsx("option",{value:"WS",children:"WebSocket"}),e.jsx("option",{value:"HTTPUPGRADE",children:"HTTP Upgrade"}),e.jsx("option",{value:"XHTTP",children:"XHTTP"}),e.jsx("option",{value:"GRPC",children:"gRPC"}),e.jsx("option",{value:"HTTP",children:"HTTP/2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Security *"}),e.jsxs("select",{...m("security",{required:"Security is required"}),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"NONE",children:"None"}),Pe?e.jsx("option",{value:"TLS",children:"TLS"}):null,R?e.jsx("option",{value:"REALITY",children:"REALITY"}):null]})]})]})]}):e.jsx("div",{className:"rounded-xl border border-line/80 bg-panel/50 p-3 text-sm text-muted",children:"This protocol uses direct listener mode. Network and TLS settings are not required."}),F==="TLS"&&Pe&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"TLS Settings"}),e.jsx(S,{label:"Server Name (SNI)",...m("serverName"),placeholder:"your.domain.com"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"ALPN (JSON Array)"}),e.jsx("input",{...m("alpn"),className:"w-full rounded-xl border border-line/80 bg-card/75 px-3 py-2 font-mono text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:'["h2","http/1.1"]'}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:'Example: ["h2","http/1.1"] or ["h2"]'})]}),W?e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Fallbacks"}),e.jsxs(p,{type:"button",size:"sm",variant:"secondary",onClick:Ke,children:[e.jsx(at,{className:"mr-2 h-4 w-4"}),"Add Fallback"]})]}),A.length===0?e.jsx("p",{className:"text-xs text-muted",children:"No fallbacks configured. Add fallback rows only when you need path/destination based routing."}):null,A.map(r=>e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-card/70 p-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Dest *"}),e.jsx("input",{value:r.dest,onChange:n=>J(r.id,"dest",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"3001 or 127.0.0.1:3001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Path"}),e.jsx("input",{value:r.path,onChange:n=>J(r.id,"path",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"/ws"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Name"}),e.jsx("input",{value:r.name,onChange:n=>J(r.id,"name",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"fallback-api"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"ALPN"}),e.jsx("input",{value:r.alpn,onChange:n=>J(r.id,"alpn",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"h2,http/1.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Xver"}),e.jsx("input",{value:r.xver,onChange:n=>J(r.id,"xver",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"1",inputMode:"numeric"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(p,{type:"button",size:"sm",variant:"ghost",onClick:()=>_e(r.id),children:[e.jsx(Ht,{className:"mr-2 h-4 w-4 text-red-500"}),"Remove"]})})]},r.id)),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"JSON Preview"}),e.jsx("pre",{className:"max-h-36 overflow-auto rounded-lg border border-line/70 bg-card/80 p-3 text-xs text-foreground",children:Fe})]}),e.jsxs("div",{className:"pt-2 border-t border-line/50",children:[e.jsx("p",{className:"mb-1 text-sm font-semibold text-foreground",children:"Quick Fallback Presets"}),e.jsx("p",{className:"mb-3 text-xs text-muted",children:"Note: Users assigned to fallback destinations automatically inherit this Master Inbound's port and REALITY security."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Ve("multiplexer"),className:"bg-brand-500/10 text-brand-700 hover:bg-brand-500/20 border-brand-500/20",children:"Setup VLESS+VMess+Trojan Multiplexer"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Ve("shadowsocks"),className:"bg-brand-500/5 text-brand-600 hover:bg-brand-500/15 border-brand-500/20",children:"Setup Shadowsocks Multiplexer"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Ve("web"),children:"Nginx Web Camouflage (Port 80)"})]})]})]}):null]}),F==="REALITY"&&R&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"REALITY Settings"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Ue.mutate(),loading:Ue.isPending,children:"Generate REALITY Keys"})]}),e.jsx(ia,{register:m,watch:j,setValue:u,errors:te}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Server Name (SNI) *",...m("serverName",{required:F==="REALITY"?"SNI is required for REALITY":!1}),placeholder:"www.microsoft.com"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Fingerprint"}),e.jsxs("select",{...m("realityFingerprint"),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"chrome",children:"Chrome"}),e.jsx("option",{value:"firefox",children:"Firefox"}),e.jsx("option",{value:"safari",children:"Safari"}),e.jsx("option",{value:"ios",children:"iOS"}),e.jsx("option",{value:"android",children:"Android"}),e.jsx("option",{value:"edge",children:"Edge"}),e.jsx("option",{value:"random",children:"Random"})]})]})]}),e.jsx(S,{label:"Public Key *",...m("realityPublicKey",{required:F==="REALITY"?"Public key is required":!1}),placeholder:"Enter REALITY public key"}),e.jsx(S,{label:"Private Key *",...m("realityPrivateKey",{required:F==="REALITY"?"Private key is required":!1}),placeholder:"Enter REALITY private key"}),e.jsx(S,{label:"Short ID",...m("realityShortId"),placeholder:"e.g., 0123456789abcdef,abcdef0123456789"}),e.jsx(S,{label:"Reality Server Names",...m("realityServerName"),placeholder:"www.microsoft.com,www.cloudflare.com"}),de?e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"REALITY Link Template"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>{Je()},children:D?"Copied":"Copy Template"})]}),e.jsx("pre",{className:"max-h-44 overflow-auto rounded-lg border border-line/70 bg-card/80 p-3 text-xs text-foreground",children:de}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"w-fit rounded-lg border border-line/70 bg-white p-2",children:e.jsx(Et,{value:de,size:132})}),e.jsxs("p",{className:"text-xs text-muted",children:["Replace ","{UUID}"," with the user UUID for manual links, or use subscription URLs for automatic client import."]})]})]}):e.jsx("p",{className:"text-xs text-muted",children:"Enter server address, port, and REALITY keys to preview a share-link template."})]}),O==="WIREGUARD"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Wireguard Settings"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:Qe,children:"Auto Endpoint"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>ne.mutate(),loading:ne.isPending,children:"Generate Key Pair"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Private Key *",...m("wgPrivateKey",{required:O==="WIREGUARD"?"Private key is required":!1}),placeholder:"Your Wireguard private key"}),e.jsx(S,{label:"Public Key",...m("wgPublicKey"),placeholder:"Your Wireguard public key"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Peer Public Key *",...m("wgPeerPublicKey",{required:O==="WIREGUARD"?"Peer public key is required":!1}),placeholder:"Server's Wireguard public key"}),e.jsx(S,{label:"Peer Endpoint",...m("wgPeerEndpoint"),placeholder:"server:51820"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Allowed IPs",...m("wgAllowedIPs"),placeholder:"0.0.0.0/0, ::/0"}),e.jsx(S,{label:"MTU",type:"number",...m("wgMtu",{valueAsNumber:!0}),placeholder:"1420"})]}),e.jsx(S,{label:"Client Address (optional)",...m("wgAddress"),placeholder:"10.66.2.2/32"}),Be?e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"WireGuard Config Preview"}),e.jsx("pre",{className:"max-h-52 overflow-auto rounded-lg border border-line/70 bg-card/80 p-3 text-xs text-foreground",children:Be}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"w-fit rounded-lg border border-line/70 bg-white p-2",children:e.jsx(Et,{value:Be,size:132})}),e.jsx("p",{className:"text-xs text-muted",children:'Scan this QR in WireGuard mobile app using "Create from QR code".'})]})]}):e.jsx("p",{className:"text-xs text-muted",children:"Enter Private Key, Peer Public Key, and Peer Endpoint to preview WireGuard config and QR."})]}),(I==="WS"||I==="XHTTP"||I==="HTTPUPGRADE")&&se&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:I==="XHTTP"?"XHTTP Settings":I==="HTTPUPGRADE"?"HTTP Upgrade Settings":"WebSocket Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Path",...m("wsPath"),placeholder:I==="XHTTP"?"/xhttp":"/vless"}),e.jsx(S,{label:I==="XHTTP"?"Host (comma-separated)":"Host",...m("wsHost"),placeholder:"your.domain.com"})]}),I==="XHTTP"?e.jsx(S,{label:"Mode",...m("xhttpMode"),placeholder:"auto or packet-up"}):null]}),I==="GRPC"&&se&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"gRPC Settings"}),e.jsx(S,{label:"Service Name",...m("grpcServiceName"),placeholder:"grpc-service"})]}),O==="SHADOWSOCKS"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Shadowsocks Settings"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Cipher Method"}),e.jsxs("select",{...m("cipher"),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"chacha20-ietf-poly1305",children:"chacha20-ietf-poly1305"}),e.jsx("option",{value:"aes-256-gcm",children:"aes-256-gcm"}),e.jsx("option",{value:"aes-128-gcm",children:"aes-128-gcm"})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 z-10 -mx-5 flex flex-col gap-2 border-t border-line/70 bg-card/95 px-5 pb-2 pt-4 sm:-mx-6 sm:flex-row sm:px-6",children:[e.jsx(p,{type:"submit",className:"flex-1",loading:$e.isPending,children:V?"Update Inbound":"Create Inbound"}),e.jsx(p,{type:"button",variant:"secondary",onClick:o,className:"flex-1",children:"Cancel"})]})]})]})})})},ca=[{protocol:"VLESS",title:"VLESS",useCase:"Best overall protocol for modern Xray deployments",networks:["TCP","WS","GRPC","HTTPUPGRADE","XHTTP"],security:["NONE","TLS","REALITY"],clients:["v2rayN","v2rayNG","Clash Meta","sing-box"],recommendation:"Use REALITY + XHTTP for anti-censorship or WS+TLS for CDN."},{protocol:"VMESS",title:"VMess",useCase:"Legacy compatibility with older V2Ray clients",networks:["TCP","WS","GRPC","HTTP"],security:["NONE","TLS"],clients:["v2rayN","v2rayNG","some Clash cores"],recommendation:"Prefer VLESS for new installs; keep VMess for migration."},{protocol:"TROJAN",title:"Trojan",useCase:"TLS-native protocol with strong censorship resistance",networks:["TCP","WS","GRPC"],security:["TLS"],clients:["Clash","sing-box","NekoBox"],recommendation:"Use gRPC+TLS for clean setup and stable performance."},{protocol:"SHADOWSOCKS",title:"Shadowsocks",useCase:"Lightweight encrypted proxy for low overhead scenarios",networks:["TCP"],security:["NONE"],clients:["Shadowrocket","Clash","Outline-compatible apps"],recommendation:"Great fallback profile; pair with strong cipher."},{protocol:"SOCKS",title:"SOCKS5",useCase:"Generic proxy for apps and browsers",networks:["TCP"],security:["NONE"],clients:["Browsers","OS proxy","Proxifier"],recommendation:"Use for local gateway use-cases with account auth."},{protocol:"HTTP",title:"HTTP Proxy",useCase:"Simple forward proxy for standard HTTP tooling",networks:["TCP"],security:["NONE"],clients:["Browsers","curl","system proxy"],recommendation:"Use where HTTP proxy support is explicitly required."},{protocol:"DOKODEMO_DOOR",title:"Dokodemo-door",useCase:"Traffic forwarding and transparent proxy integration",networks:["TCP"],security:["NONE"],clients:["Xray internal routing","DNS forwarders"],recommendation:"Ideal for DNS forward and transparent redirection flows."},{protocol:"WIREGUARD",title:"WireGuard",useCase:"Tunnel outbound transport through WireGuard peer",networks:["TCP"],security:["NONE"],clients:["WireGuard app (for preview config)","Xray upstream"],recommendation:"Set peer endpoint + keys first, then route traffic through it."},{protocol:"MTPROTO",title:"MTProto",useCase:"Telegram-specific proxy protocol",networks:["TCP"],security:["NONE"],clients:["Telegram MTProto proxy clients"],recommendation:"Use dedicated port and isolate from normal user traffic."}],ua=({onQuickCreate:t})=>{const{t:c}=nt();return e.jsxs(ee,{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(ea,{className:"h-4 w-4 text-brand-500"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:c("compatibility.title",{defaultValue:"Protocol Compatibility Matrix"})})]}),e.jsx("div",{className:"space-y-3",children:ca.map(o=>e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/65 p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:o.title}),e.jsx(Ut,{variant:"info",children:o.protocol})]}),e.jsx("p",{className:"text-sm text-muted",children:o.useCase}),e.jsx("p",{className:"text-xs text-muted",children:o.recommendation}),e.jsxs("div",{className:"pt-1",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted",children:c("compatibility.networks",{defaultValue:"Networks"})}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:o.networks.map(d=>e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-1 text-xs font-medium text-foreground",children:d},`${o.protocol}-${d}`))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted",children:c("compatibility.security",{defaultValue:"Security"})}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:o.security.map(d=>e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-1 text-xs font-medium text-foreground",children:d},`${o.protocol}-${d}`))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted",children:c("compatibility.clients",{defaultValue:"Supported Clients"})}),e.jsx("p",{className:"text-xs text-foreground/90",children:o.clients.join(" · ")})]})]}),e.jsx("div",{className:"md:pl-4",children:e.jsx(p,{type:"button",size:"sm",onClick:()=>t(o.protocol),className:"w-full md:w-auto",children:c("compatibility.quickCreate",{defaultValue:"Quick Create"})})})]})},o.protocol))})]})},ma=["recommended","cdn","transport","utility"],me={recommended:{title:"Recommended",hint:"Balanced defaults for most deployments."},cdn:{title:"CDN & Edge",hint:"Traffic profiles optimized for edge/CDN transport."},transport:{title:"Transport Profiles",hint:"Focused presets for specific transport behaviors."},utility:{title:"Utility & Gateway",hint:"DNS forwarders, gateways, and service adapters."}};function Kt(t){return t==="inbounds"||t==="templates"||t==="compatibility"}function xt(t){if(typeof t=="number")return Number.isFinite(t)?t:0;if(typeof t=="string"&&t.trim()){const c=Number.parseFloat(t);return Number.isFinite(c)?c:0}return 0}const pa=new Set(["VLESS","VMESS","TROJAN","SHADOWSOCKS","SOCKS","HTTP","DOKODEMO_DOOR","WIREGUARD","MTPROTO"]),xa=new Set(["TCP","WS","GRPC","HTTP","HTTPUPGRADE","XHTTP"]),ha=new Set(["NONE","TLS","REALITY"]);function fa(t){const c=String(t||"VLESS").toUpperCase();return pa.has(c)?c:"VLESS"}function ga(t,c){const o=String(t||"").toUpperCase();return xa.has(o)?o:c==="DOKODEMO_DOOR"||c==="SOCKS"||c==="HTTP"?"TCP":"WS"}function ba(t,c){const o=String(t||"").toUpperCase();return c==="TROJAN"?"TLS":ha.has(o)?o==="REALITY"&&c!=="VLESS"?"NONE":o:"NONE"}function Gt(t,c,o){const d=String(t||c).trim().replace(/\s+/g,"-").toLowerCase();let N=d||c,f=1;for(;o.has(N);)N=`${d||c}-${f}`,f+=1;return o.add(N),N}function qt(t,c,o){let d=Number.parseInt(String(t??o),10);for((Number.isNaN(d)||d<1||d>65535)&&(d=o);c.has(d)||d<1||d>65535;)d+=1,d>65535&&(d=1024);return c.add(d),d}function ya(t,c,o,d){const N=fa(t.protocol),f=ga(t.network,N),D=ba(t.security,N),C=2e4+c,V=qt(t.port,d,C),M=Gt(t.tag,`${N.toLowerCase()}-${V}`,o),L={protocol:N,network:f,security:D,port:V,tag:M,remark:typeof t.remark=="string"?t.remark:void 0,serverAddress:typeof t.serverAddress=="string"&&t.serverAddress.trim()?t.serverAddress.trim():"127.0.0.1"},A=["serverName","wsPath","wsHost","xhttpMode","grpcServiceName","alpn","cipher","realityPublicKey","realityPrivateKey","realityShortId","realityFingerprint","wgPrivateKey","wgPublicKey","wgAddress","wgPeerPublicKey","wgPeerEndpoint","wgAllowedIPs","wgMtu","dokodemoTargetPort","dokodemoNetwork","dokodemoFollowRedirect","domains","fallbacks"];for(const x of A){const m=t[x];m!==void 0&&(L[x]=m)}return N==="DOKODEMO_DOOR"&&L.dokodemoTargetPort===void 0&&(L.dokodemoTargetPort=80),L}function Yt(t){const c={port:t.port,protocol:t.protocol,tag:t.tag,remark:t.remark,enabled:t.enabled,network:t.network,security:t.security,serverName:t.serverName,serverAddress:t.serverAddress,alpn:t.alpn,wsPath:t.wsPath,wsHost:t.wsHost,xhttpMode:t.xhttpMode,grpcServiceName:t.grpcServiceName,cipher:t.cipher,realityPublicKey:t.realityPublicKey,realityPrivateKey:t.realityPrivateKey,realityFingerprint:t.realityFingerprint,realityShortIds:t.realityShortIds,realityServerNames:t.realityServerNames,wgPrivateKey:t.wgPrivateKey,wgPublicKey:t.wgPublicKey,wgAddress:t.wgAddress,wgPeerPublicKey:t.wgPeerPublicKey,wgPeerEndpoint:t.wgPeerEndpoint,wgAllowedIPs:t.wgAllowedIPs,wgMtu:t.wgMtu,dokodemoTargetPort:t.dokodemoTargetPort,dokodemoNetwork:t.dokodemoNetwork,dokodemoFollowRedirect:t.dokodemoFollowRedirect,domains:t.domains,fallbacks:t.fallbacks};return Object.fromEntries(Object.entries(c).filter(([,o])=>o!=null))}function st(t){const c=String(t.values.protocol||"vless").toLowerCase(),o=Number(t.values.port||443);return{...t.values,tag:t.values.tag||`${c}-${o}`,serverAddress:t.values.serverAddress||"your.domain.com"}}function _t(t,c){const o=Yt(t),d=new Set(c.map(C=>C.tag)),N=new Set(c.map(C=>C.port)),f=Gt(`${t.tag}-copy`,`${t.protocol.toLowerCase()}-copy`,d),D=qt(t.port+1,N,t.port+1);return{...o,tag:f,port:D,remark:`${t.remark||t.tag} (Clone)`}}function va(t){var o;const c={...t};if(Array.isArray(t.domains)&&(c.domains=t.domains.map(d=>String(d)).join(", ")),Array.isArray(t.fallbacks)&&(c.fallbacks=JSON.stringify(t.fallbacks,null,2)),!c.realityShortId&&Array.isArray(t.realityShortIds)){const d=(o=t.realityShortIds)==null?void 0:o[0];d!=null&&(c.realityShortId=String(d))}return c}function Na(t,c){return va(_t(t,c))}function ja(t){const c=t.toLowerCase().replace(/_/g,"-");return{protocol:t,port:443,tag:`${c}-new`,remark:`${t} inbound`,network:"TCP",security:"NONE",serverAddress:"your.domain.com"}}const wa=()=>{var At,It;const{t}=nt(),c=Ts(),o=Cs(),d=ft(),N=h.useRef(null),[f,D]=Vs(),C=As(s=>s.admin),V=(C==null?void 0:C.role)==="SUPER_ADMIN",M=h.useMemo(()=>[{id:"inbounds",label:t("inbounds.tabs.inbounds",{defaultValue:"Inbounds"})},{id:"templates",label:t("inbounds.tabs.templates",{defaultValue:"Templates"})},{id:"compatibility",label:t("inbounds.tabs.compatibility",{defaultValue:"Compatibility"})}],[t]),L=h.useMemo(()=>({recommended:{title:t("inbounds.templateCategories.recommended.title",{defaultValue:me.recommended.title}),hint:t("inbounds.templateCategories.recommended.hint",{defaultValue:me.recommended.hint})},cdn:{title:t("inbounds.templateCategories.cdn.title",{defaultValue:me.cdn.title}),hint:t("inbounds.templateCategories.cdn.hint",{defaultValue:me.cdn.hint})},transport:{title:t("inbounds.templateCategories.transport.title",{defaultValue:me.transport.title}),hint:t("inbounds.templateCategories.transport.hint",{defaultValue:me.transport.hint})},utility:{title:t("inbounds.templateCategories.utility.title",{defaultValue:me.utility.title}),hint:t("inbounds.templateCategories.utility.hint",{defaultValue:me.utility.hint})}}),[t]),[A,x]=h.useState(!1),[m,B]=h.useState(null),[u,v]=h.useState(null),[j,te]=h.useState(null),[O,I]=h.useState(null),[F,oe]=h.useState(null),[De,ve]=h.useState(null),[Ne,je]=h.useState(null),[we,Le]=h.useState(null),[ke,Se]=h.useState([]),[_,q]=h.useState([]),[w,xe]=h.useState(null),[Ye,X]=h.useState(!1),[se,Pe]=h.useState(!1),[R,W]=h.useState({serverAddress:"",serverName:"",cdnHost:"",fallbackPorts:"8443,9443",assignUserIds:[],assignGroupIds:[]}),[Y,he]=h.useState(null),[lt,Te]=h.useState(()=>Date.now()),Q=zs("one-ui/inbounds-filters",{defaultTab:"inbounds",viewMode:"auto"}),{views:Ce,saveView:Oe,deleteView:ot}=Gs("one-ui/inbounds-saved-views"),[ie,Fe]=h.useState(""),[K,ae]=h.useState(()=>{const s=f.get("tab");return Kt(s)?s:Q.value.defaultTab}),re=Q.value.viewMode,Ke=s=>{Q.setValue(a=>({...a,viewMode:s}))},_e=f.get("quick"),J=f.get("tab");h.useEffect(()=>{if(_e==="create"){B(null),v(null),x(!0),ae("inbounds");const s=new URLSearchParams(f);s.delete("quick"),s.set("tab","inbounds"),D(s,{replace:!0})}},[_e,f,D]),h.useEffect(()=>{Kt(J)&&J!==K&&ae(J)},[J,K]),h.useEffect(()=>{Q.setValue(s=>s.defaultTab===K?s:{...s,defaultTab:K})},[K,Q]);const{data:Ve,isLoading:$e,isFetching:Xe}=qe({queryKey:["inbounds"],queryFn:async()=>(await T.get("/inbounds")).data,placeholderData:Is,staleTime:3e4}),{data:ne=[]}=qe({queryKey:["inbounds-users-directory"],queryFn:async()=>{var y;let a=1,l=1;const i=[];for(;a<=l&&a<=50;){const k=await T.get("/users",{params:{page:a,limit:100}});Array.isArray(k.data)&&i.push(...k.data),l=Number(((y=k.meta)==null?void 0:y.totalPages)||1),a+=1}return i},staleTime:2e4}),{data:Ue=[]}=qe({queryKey:["inbounds-assignable-groups"],queryFn:async()=>(await Hs.list({page:1,limit:100,includeDisabled:!0})).data||[],staleTime:3e4}),P=h.useMemo(()=>Ve||[],[Ve]),Qe=qe({queryKey:["inbounds-health-summary",P.map(s=>s.id).join(",")],queryFn:async()=>{var i;const s=P.map(y=>y.id).join(",");if(!s)return{items:[]};const a=await T.get("/inbounds/health-summary",{params:{ids:s,timeoutMs:1800}}),l=((i=a==null?void 0:a.data)==null?void 0:i.items)??(a==null?void 0:a.items);return{items:Array.isArray(l)?l:[]}},enabled:K==="inbounds"&&P.length>0,staleTime:1e4,refetchInterval:15e3}),it=h.useMemo(()=>{var a;const s=new Map;for(const l of((a=Qe.data)==null?void 0:a.items)||[]){const i=Number(l==null?void 0:l.inboundId);Number.isInteger(i)&&i>0&&s.set(i,l)}return s},[Qe.data]),Be=h.useMemo(()=>ne.map(s=>Number(s.id)).filter(s=>Number.isInteger(s)&&s>0),[ne]),Ae=Ys(Be,{includeOffline:!0,live:!0,streamInterval:2e3}),de=_.length,Je=P.length>0&&_.length===P.length,We=z({mutationFn:async s=>{const a=new Set(P.map(k=>k.tag)),l=new Set(P.map(k=>k.port));let i=0;const y=[];for(const[k,G]of s.entries())try{const U=ya(G,k,a,l);await T.post("/inbounds",U),i+=1}catch(U){y.push(`Item ${k+1}: ${(U==null?void 0:U.message)||"Unknown error"}`)}return{success:i,failures:y}},onSuccess:async({success:s,failures:a})=>{await o.invalidateQueries({queryKey:["inbounds"]});const l=a.length;l>0?d.error(t("inbounds.import.completedWarningsTitle",{defaultValue:"Import completed with warnings"}),t("inbounds.import.completedWarningsBody",{defaultValue:"Imported {{success}} profile(s), {{failed}} failed. {{details}}",success:s,failed:l,details:a.slice(0,3).join(" | ")})):d.success(t("inbounds.import.completedTitle",{defaultValue:"Import completed"}),t("inbounds.import.completedBody",{defaultValue:"Successfully imported {{count}} profile(s).",count:s}))},onError:s=>{d.error(t("inbounds.import.failedTitle",{defaultValue:"Import failed"}),(s==null?void 0:s.message)||t("inbounds.import.failedBody",{defaultValue:"Failed to import inbound profiles"}))}}),fe=z({mutationFn:async s=>T.post("/inbounds/presets/myanmar",s),onSuccess:async s=>{var Me,ye;const a=(s==null?void 0:s.data)||{},l=!!a.dryRun,i=a.warnings||[];if(l){he(a);const E=((Me=a.planned)==null?void 0:Me.length)||0;i.length>0?d.error(t("inbounds.myanmarPack.previewWarningsTitle",{defaultValue:"Myanmar pack preview generated with warnings"}),t("inbounds.myanmarPack.previewWarningsBody",{defaultValue:"{{count}} planned profile(s). {{details}}",count:E,details:i.slice(0,3).join(" | ")})):d.success(t("inbounds.myanmarPack.previewTitle",{defaultValue:"Myanmar pack preview generated"}),t("inbounds.myanmarPack.previewBody",{defaultValue:"{{count}} planned profile(s).",count:E}));return}await o.invalidateQueries({queryKey:["inbounds"]});const y=((ye=a.created)==null?void 0:ye.length)||0,k=a.assignment||{},G=Number(k.assignedUsers||0),U=Number(k.assignedGroups||0);let ue="";(G>0||U>0)&&(ue=`
${t("inbounds.myanmarPack.assignedSummary",{defaultValue:"Assigned to {{users}} user(s) and {{groups}} group(s).",users:G,groups:U})}`),await Promise.all([o.invalidateQueries({queryKey:["users"]}),o.invalidateQueries({queryKey:["groups"]}),o.invalidateQueries({queryKey:["inbounds-assignable-groups"]}),o.invalidateQueries({queryKey:["inbounds-users-directory"]})]),i.length>0?d.error(t("inbounds.myanmarPack.appliedWarningsTitle",{defaultValue:"Myanmar pack applied with warnings"}),t("inbounds.myanmarPack.appliedWarningsBody",{defaultValue:"{{count}} profile(s) created.{{assignment}} {{details}}",count:y,assignment:ue,details:i.slice(0,3).join(" | ")})):d.success(t("inbounds.myanmarPack.appliedTitle",{defaultValue:"Myanmar pack applied"}),t("inbounds.myanmarPack.appliedBody",{defaultValue:"{{count}} profile(s) created.{{assignment}}",count:y,assignment:ue})),X(!1),he(null)},onError:s=>{d.error(t("inbounds.myanmarPack.failedTitle",{defaultValue:"Myanmar pack failed"}),(s==null?void 0:s.message)||t("inbounds.myanmarPack.failedBody",{defaultValue:"Failed to apply Myanmar pack"}))}}),He=z({mutationFn:async s=>{await T.delete(`/inbounds/${s}`)},onSuccess:()=>{o.invalidateQueries({queryKey:["inbounds"]})}}),ge=z({mutationFn:async s=>{await T.post("/inbounds/bulk/delete",{inboundIds:s})},onSuccess:async()=>{q([]),await o.invalidateQueries({queryKey:["inbounds"]})}}),r=z({mutationFn:async s=>{await T.post("/inbounds/bulk/enable",{inboundIds:s})},onSuccess:async()=>{q([]),await o.invalidateQueries({queryKey:["inbounds"]})}}),n=z({mutationFn:async s=>{await T.post("/inbounds/bulk/disable",{inboundIds:s})},onSuccess:async()=>{q([]),await o.invalidateQueries({queryKey:["inbounds"]})}}),b=z({mutationFn:async s=>{await T.post(`/inbounds/${s}/toggle`)},onSuccess:()=>{o.invalidateQueries({queryKey:["inbounds"]})}}),g=z({mutationFn:async s=>{await T.post(`/inbounds/${s}/random-port`)},onMutate:s=>{Le(s)},onSuccess:async()=>{await o.invalidateQueries({queryKey:["inbounds"]})},onError:s=>{d.error(t("inbounds.randomPortFailedTitle",{defaultValue:"Randomize port failed"}),(s==null?void 0:s.message)||t("inbounds.randomPortFailedBody",{defaultValue:"Failed to randomize inbound port"}))},onSettled:()=>{Le(null)}});h.useEffect(()=>{q(s=>s.filter(a=>P.some(l=>l.id===a)))},[P]),h.useEffect(()=>{Se(s=>s.filter(a=>P.some(l=>l.id===a)))},[P]),h.useEffect(()=>{const s=window.setInterval(()=>{Te(Date.now())},6e4);return()=>{window.clearInterval(s)}},[]);const H=h.useMemo(()=>{var a;const s=new Map;for(const l of((a=Ae.data)==null?void 0:a.sessions)||[])s.set(String(l.uuid||""),{online:!!l.online,currentIp:l.currentIp,lastSeenAt:l.lastSeenAt});return s},[(At=Ae.data)==null?void 0:At.sessions]),$=h.useMemo(()=>{var a;const s=(((a=Ae.data)==null?void 0:a.sessions)||[]).filter(l=>l.online).map(l=>String(l.uuid||"")).filter(Boolean);return new Set(s)},[(It=Ae.data)==null?void 0:It.sessions]),ce=h.useMemo(()=>{var a;const s=new Map;for(const l of ne){const i=Array.isArray(l.inbounds)?l.inbounds:[];for(const y of i){const k=Number(y.inboundId??((a=y.inbound)==null?void 0:a.id));if(!Number.isInteger(k)||k<1)continue;const G=xt(l.uploadUsed),U=xt(l.downloadUsed),ue=xt(l.dataLimit),Me=G+U,ye={id:Number(l.id),email:String(l.email||""),uuid:String(l.uuid||""),status:String(l.status||""),enabled:!!y.enabled,priority:Number.isInteger(Number(y.priority))?Number(y.priority):100,expireDate:String(l.expireDate||""),uploadUsed:G,downloadUsed:U,dataLimit:ue,totalUsed:Me},E=s.get(k)||[];E.push(ye),s.set(k,E)}}for(const[l,i]of s.entries())i.sort((y,k)=>y.priority!==k.priority?y.priority-k.priority:y.email.localeCompare(k.email)),s.set(l,i);return s},[ne]),Ie=s=>{q(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s])},ze=s=>{Se(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s])},Xt=()=>{if(Je){q([]);return}q(P.map(s=>s.id))},Ze=ge.isPending||r.isPending||n.isPending,gt=async(s={})=>{const a=[o.invalidateQueries({queryKey:["inbounds"]})];Ae.streamStatus!=="connected"&&a.push(o.invalidateQueries({queryKey:["user-sessions"]})),s.includeUsersDirectory&&a.push(o.invalidateQueries({queryKey:["inbounds-users-directory"]})),await Promise.all(a)},Z=qs(()=>gt(),{enabled:K==="inbounds",intervalMs:5e3}),Ee=async(s,a,l)=>{ve(s);try{await a(),await gt({includeUsersDirectory:!0})}catch(i){d.error(t("inbounds.clientActionFailedTitle",{defaultValue:"Client action failed"}),(i==null?void 0:i.message)||l)}finally{ve(null)}},Qt=async()=>{if(!V){d.error(t("inbounds.permissionDeniedTitle",{defaultValue:"Permission denied"}),t("inbounds.permissionDeniedDeleteBody",{defaultValue:"Only SUPER_ADMIN can delete inbounds."}));return}_.length!==0&&xe({type:"bulk-delete",ids:[..._]})},Jt=async()=>{if(w)try{w.type==="bulk-delete"?(await ge.mutateAsync(w.ids),d.success(t("inbounds.bulkDeleteSuccessTitle",{defaultValue:"Bulk delete completed"}),t("inbounds.bulkDeleteSuccessBody",{defaultValue:"Deleted {{count}} inbound(s).",count:w.ids.length}))):(await He.mutateAsync(w.id),d.success(t("inbounds.deleteSuccessTitle",{defaultValue:"Inbound deleted"}),t("inbounds.deleteSuccessBody",{defaultValue:'Deleted inbound "{{name}}".',name:w.label}))),xe(null)}catch(s){d.error(t("inbounds.deleteFailedTitle",{defaultValue:"Delete failed"}),(s==null?void 0:s.message)||t("inbounds.deleteFailedBody",{defaultValue:"Failed to delete inbound"}))}},Zt=async()=>{if(_.length!==0)try{await r.mutateAsync(_),d.success(t("inbounds.bulkEnableSuccessTitle",{defaultValue:"Bulk enable completed"}),t("inbounds.bulkEnableSuccessBody",{defaultValue:"Selected inbounds enabled."}))}catch(s){d.error(t("inbounds.bulkEnableFailedTitle",{defaultValue:"Bulk enable failed"}),(s==null?void 0:s.message)||t("inbounds.bulkEnableFailedBody",{defaultValue:"Failed to enable selected inbounds"}))}},es=async()=>{if(_.length!==0)try{await n.mutateAsync(_),d.success(t("inbounds.bulkDisableSuccessTitle",{defaultValue:"Bulk disable completed"}),t("inbounds.bulkDisableSuccessBody",{defaultValue:"Selected inbounds disabled."}))}catch(s){d.error(t("inbounds.bulkDisableFailedTitle",{defaultValue:"Bulk disable failed"}),(s==null?void 0:s.message)||t("inbounds.bulkDisableFailedBody",{defaultValue:"Failed to disable selected inbounds"}))}},dt=z({mutationFn:async s=>{const a=_t(s,P);await T.post("/inbounds",a)},onMutate:s=>{je(s.id)},onSuccess:async()=>{await o.invalidateQueries({queryKey:["inbounds"]}),d.success(t("inbounds.cloneSuccessTitle",{defaultValue:"Inbound cloned"}),t("inbounds.cloneSuccessBody",{defaultValue:"Inbound cloned successfully."}))},onError:s=>{d.error(t("inbounds.cloneFailedTitle",{defaultValue:"Clone failed"}),(s==null?void 0:s.message)||t("inbounds.cloneFailedBody",{defaultValue:"Failed to clone inbound"}))},onSettled:()=>{je(null)}}),bt=h.useMemo(()=>({VLESS:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",VMESS:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",TROJAN:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",SHADOWSOCKS:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",SOCKS:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300",HTTP:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-300",DOKODEMO_DOOR:"bg-teal-100 text-teal-800 dark:bg-teal-900/30 dark:text-teal-300",WIREGUARD:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-300",MTPROTO:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300"}),[]),yt=(s,a={})=>{const l=!!a.mobile,i=[];if(i.push({key:"templates",label:t("inbounds.actionMenu.templates",{defaultValue:"Client templates"}),icon:Qs,onClick:()=>I(s)}),i.push({key:"details",label:t("inbounds.actionMenu.details",{defaultValue:"Inbound details"}),icon:pt,onClick:()=>oe(s)}),a.includeRandomPort){const y=!!(g.isPending&&we===s.id);i.push({key:"random-port",label:y?t("inbounds.actionMenu.randomPortPending",{defaultValue:"Assigning random port..."}):t("inbounds.actionMenu.randomPort",{defaultValue:"Assign random free port"}),icon:ht,disabled:y,onClick:()=>g.mutate(s.id)})}return i.push({key:"clone",label:Ne===s.id&&dt.isPending?t("inbounds.actionMenu.clonePending",{defaultValue:"Cloning..."}):t("inbounds.actionMenu.clone",{defaultValue:"Clone inbound"}),icon:Bs,disabled:!!(Ne===s.id&&dt.isPending),onClick:()=>dt.mutate(s)}),i.push({key:"clone-edit",label:t("inbounds.actionMenu.cloneEdit",{defaultValue:"Clone + edit"}),icon:at,onClick:()=>ms(s)}),i.push({key:"edit",label:t("inbounds.actionMenu.edit",{defaultValue:"Edit inbound"}),icon:Js,onClick:()=>{v(null),B(s)}}),V&&i.push({key:"delete",label:t("inbounds.actionMenu.delete",{defaultValue:"Delete inbound"}),icon:Ht,tone:"danger",onClick:()=>void xs(s.id)}),i.length===0?null:e.jsx(Ms,{items:i,ariaLabel:t("common.moreActions",{defaultValue:"More actions"}),triggerClassName:`rounded-lg border border-line/60 bg-card/70 px-2 py-1 text-foreground transition hover:bg-panel/70 focus:outline-none focus:ring-2 focus:ring-brand-500/40 disabled:cursor-not-allowed disabled:opacity-50 ${l?"inline-flex h-10 w-10 items-center justify-center":"inline-flex h-8 w-8 items-center justify-center"}`,children:e.jsx(Rs,{className:"h-4 w-4"})})},ct=h.useMemo(()=>[...ne].sort((s,a)=>String(s.email||"").localeCompare(String(a.email||""))).slice(0,500),[ne]),ut=h.useMemo(()=>[...Ue].sort((s,a)=>String(s.name||"").localeCompare(String(a.name||""))),[Ue]),ts=h.useMemo(()=>new Set(R.assignUserIds),[R.assignUserIds]),ss=h.useMemo(()=>new Set(R.assignGroupIds),[R.assignGroupIds]),as=h.useMemo(()=>{const s=new Map;for(const a of rt)s.has(a.values.protocol)||s.set(a.values.protocol,a);return s},[]),rs=h.useMemo(()=>{const s={recommended:[],cdn:[],transport:[],utility:[]};for(const a of rt)s[a.category].push(a);return s},[]),be=s=>{B(null),v(s||null),x(!0)},vt=async()=>{Pe(!0);try{const s=await Wt(),a=typeof window<"u"?String(window.location.hostname||"").trim():"",l=String((s==null?void 0:s.ip)||a||"").trim();if(!l)return;W(i=>({...i,serverAddress:i.serverAddress.trim()||l,serverName:i.serverName.trim()||l}))}finally{Pe(!1)}},ns=()=>{W(s=>({...s,serverAddress:s.serverAddress||"",serverName:s.serverName||"",cdnHost:s.cdnHost||"",fallbackPorts:s.fallbackPorts||"8443,9443"})),he(null),X(!0),(R.serverAddress||"").trim()||vt()},ls=(s,a)=>{W(l=>{const i=new Set(l.assignUserIds);return a?i.add(s):i.delete(s),{...l,assignUserIds:Array.from(i)}})},os=(s,a)=>{W(l=>{const i=new Set(l.assignGroupIds);return a?i.add(s):i.delete(s),{...l,assignGroupIds:Array.from(i)}})},is=()=>{W(s=>({...s,assignUserIds:ct.map(a=>Number(a.id))}))},ds=()=>{W(s=>({...s,assignUserIds:[]}))},cs=()=>{W(s=>({...s,assignGroupIds:ut.map(a=>Number(a.id))}))},us=()=>{W(s=>({...s,assignGroupIds:[]}))},Nt=async(s=!1)=>{if(!R.serverAddress.trim()){d.error(t("common.validationFailed",{defaultValue:"Validation failed"}),t("inbounds.myanmarPack.serverAddressRequired",{defaultValue:"Server address is required."}));return}const a={serverAddress:R.serverAddress.trim(),serverName:R.serverName.trim()||R.serverAddress.trim(),cdnHost:R.cdnHost.trim()||void 0,fallbackPorts:R.fallbackPorts.trim()||void 0,userIds:R.assignUserIds,groupIds:R.assignGroupIds,dryRun:s};await fe.mutateAsync(a)},ms=s=>{be(Na(s,P))},ps=s=>{const a=as.get(s);if(a){be(st(a));return}be(ja(s))},jt=()=>{x(!1),B(null),v(null)},wt=s=>{ae(s);const a=new URLSearchParams(f);a.set("tab",s),D(a,{replace:!0})},kt=()=>{const s=window.prompt(t("inbounds.savedViews.promptName",{defaultValue:"Name this inbounds view"}));if(s)try{const a=Oe(s,{tab:K,viewMode:re});Fe(a.id),d.success(t("inbounds.savedViews.savedTitle",{defaultValue:"View saved"}),t("inbounds.savedViews.savedBody",{defaultValue:'Saved view "{{name}}".',name:a.name}))}catch(a){d.error(t("inbounds.savedViews.saveFailedTitle",{defaultValue:"Save view failed"}),(a==null?void 0:a.message)||t("inbounds.savedViews.saveFailedBody",{defaultValue:"Failed to save view"}))}},St=s=>{Fe(s);const a=Ce.find(l=>l.id===s);a&&(Ke(a.filters.viewMode||"auto"),wt(a.filters.tab||"inbounds"))},Pt=()=>{ie&&(ot(ie),Fe(""))},xs=async s=>{if(!V){d.error(t("inbounds.permissionDeniedTitle",{defaultValue:"Permission denied"}),t("inbounds.permissionDeniedDeleteBody",{defaultValue:"Only SUPER_ADMIN can delete inbounds."}));return}const a=P.find(l=>l.id===s);xe({type:"single-delete",id:s,label:(a==null?void 0:a.remark)||(a==null?void 0:a.tag)||`#${s}`})},hs=()=>{if(P.length===0){d.error(t("inbounds.export.unavailableTitle",{defaultValue:"Export unavailable"}),t("inbounds.export.unavailableBody",{defaultValue:"No inbounds to export."}));return}const s={app:"One-UI",version:"1.0.0",exportedAt:new Date().toISOString(),inbounds:P.map(Yt)},a=new Blob([JSON.stringify(s,null,2)],{type:"application/json;charset=utf-8"}),l=URL.createObjectURL(a),i=document.createElement("a");i.href=l,i.download=`one-ui-inbounds-${new Date().toISOString().replace(/[:.]/g,"-")}.json`,i.click(),URL.revokeObjectURL(l)},fs=s=>{if(Array.isArray(s))return s.filter(a=>a&&typeof a=="object");if(s&&typeof s=="object"){const a=s;return Array.isArray(a.inbounds)?a.inbounds.filter(l=>l&&typeof l=="object"):[a]}return[]},gs=async s=>{var l;const a=(l=s.target.files)==null?void 0:l[0];if(s.target.value="",!!a)try{const i=await a.text(),y=JSON.parse(i),k=fs(y);if(k.length===0){d.error(t("inbounds.import.failedTitle",{defaultValue:"Import failed"}),t("inbounds.import.noValidProfilesBody",{defaultValue:"No valid inbound profiles found in selected file."}));return}await We.mutateAsync(k)}catch(i){d.error(t("inbounds.import.failedTitle",{defaultValue:"Import failed"}),(i==null?void 0:i.message)||t("inbounds.import.invalidJsonBody",{defaultValue:"Invalid JSON file"}))}},et=s=>{if(!Number.isFinite(s)||s<=0)return"0 B";const a=["B","KB","MB","GB","TB","PB"],l=Math.min(Math.floor(Math.log(s)/Math.log(1024)),a.length-1),i=s/1024**l;return`${i.toFixed(i>=100?0:i>=10?1:2)} ${a[l]}`},bs=s=>{const a=new Date(s);if(Number.isNaN(a.getTime()))return null;const l=a.getTime()-lt;return Math.ceil(l/(1e3*60*60*24))},Tt=s=>{switch(s){case"open":return{label:t("inbounds.health.open",{defaultValue:"Open"}),className:"border-green-400/50 bg-green-500/10 text-green-300"};case"closed":return{label:t("inbounds.health.closed",{defaultValue:"Closed"}),className:"border-red-400/50 bg-red-500/10 text-red-300"};case"disabled":return{label:t("inbounds.health.disabled",{defaultValue:"Disabled"}),className:"border-amber-400/50 bg-amber-500/10 text-amber-300"};default:return{label:t("inbounds.health.unknown",{defaultValue:"Unknown"}),className:"border-zinc-400/50 bg-zinc-500/10 text-zinc-300"}}},Ct=s=>{if(!s)return t("inbounds.health.neverChecked",{defaultValue:"never checked"});const a=new Date(s).getTime();if(Number.isNaN(a))return t("inbounds.health.neverChecked",{defaultValue:"never checked"});const l=Math.max(0,Math.floor((Date.now()-a)/1e3));if(l<60)return t("inbounds.health.checkedSeconds",{defaultValue:"{{count}}s ago",count:l});const i=Math.floor(l/60);return t("inbounds.health.checkedMinutes",{defaultValue:"{{count}}m ago",count:i})},ys=(w==null?void 0:w.type)==="bulk-delete"?t("inbounds.bulkDeleteTitle",{defaultValue:"Delete Selected Inbounds"}):(w==null?void 0:w.type)==="single-delete"?t("inbounds.deleteTitle",{defaultValue:"Delete Inbound"}):"",vs=(w==null?void 0:w.type)==="bulk-delete"?t("inbounds.bulkDeleteBody",{defaultValue:"Delete {{count}} selected inbound(s)? This action cannot be undone.",count:w.ids.length}):(w==null?void 0:w.type)==="single-delete"?t("inbounds.deleteBody",{defaultValue:'Delete inbound "{{name}}"? Associated users may lose access.',name:w.label}):"",Vt=(w==null?void 0:w.type)==="bulk-delete"?ge.isPending:(w==null?void 0:w.type)==="single-delete"?He.isPending:!1,Ns=re==="auto"?"hidden overflow-hidden p-0 lg:block":re==="table"?"overflow-hidden p-0":"hidden",js=re==="auto"?"grid grid-cols-1 gap-4 lg:hidden":re==="cards"?"grid grid-cols-1 gap-4":"hidden";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("input",{ref:N,type:"file",accept:"application/json,.json",className:"hidden",onChange:gs}),e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:t("inbounds.title",{defaultValue:"Inbounds"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("inbounds.subtitle",{defaultValue:"Manage your Xray inbound configurations and reusable profiles."})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[K==="inbounds"?e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"secondary",onClick:Xt,disabled:P.length===0,children:Je?t("inbounds.clearSelection",{defaultValue:"Clear Selection"}):t("common.selectAll",{defaultValue:"Select All"})}),e.jsxs(p,{variant:"secondary",onClick:hs,children:[e.jsx(_s,{className:"mr-2 h-4 w-4"}),t("inbounds.exportJson",{defaultValue:"Export JSON"})]}),e.jsxs(p,{variant:"secondary",onClick:()=>{var s;return(s=N.current)==null?void 0:s.click()},loading:We.isPending,children:[e.jsx(Xs,{className:"mr-2 h-4 w-4"}),t("inbounds.importJson",{defaultValue:"Import JSON"})]}),e.jsxs(p,{variant:"secondary",onClick:ns,loading:fe.isPending,children:[e.jsx(Mt,{className:"mr-2 h-4 w-4"}),t("inbounds.applyMyanmarPack",{defaultValue:"Apply Myanmar Pack"})]})]}):null,e.jsxs(p,{onClick:()=>be(),children:[e.jsx(at,{className:"mr-2 h-4 w-4"}),t("inbounds.addInbound",{defaultValue:"Add Inbound"})]})]})]}),e.jsx(ee,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/40 p-3",children:[e.jsxs("details",{className:"group lg:hidden",children:[e.jsxs("summary",{className:"flex list-none items-center justify-between gap-3 rounded-xl px-2 py-2 text-left text-sm font-medium text-foreground transition hover:bg-panel/50 [&::-webkit-details-marker]:hidden",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate",children:t("common.advancedControls",{defaultValue:"Advanced controls"})}),e.jsx("p",{className:"mt-0.5 text-xs font-normal text-muted",children:t("autoRefresh.line",{defaultValue:"Auto refresh: {{status}} ({{seconds}}s)",status:t(`autoRefresh.status.${Z.status}`,{defaultValue:Z.statusLabel}),seconds:Math.ceil(Z.nextRunInMs/1e3)})})]}),e.jsx(Rt,{className:"h-5 w-5 shrink-0 text-muted transition-transform group-open:rotate-180"})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"min-w-[180px] flex-1 rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",value:ie,onChange:s=>St(s.target.value),children:[e.jsx("option",{value:"",children:t("common.savedViews",{defaultValue:"Saved views"})}),Ce.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:kt,children:t("common.saveView",{defaultValue:"Save View"})}),e.jsx(p,{size:"sm",variant:"ghost",onClick:Pt,disabled:!ie,children:t("common.removeView",{defaultValue:"Remove View"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"inline-flex rounded-xl border border-line/70 bg-card/70 p-1",children:["auto","table","cards"].map(s=>e.jsx("button",{type:"button",onClick:()=>Ke(s),className:`rounded-lg px-3 py-1.5 text-xs font-medium transition-colors ${re===s?"bg-gradient-to-r from-brand-500 to-brand-600 text-white":"text-muted hover:text-foreground"}`,children:t(`viewMode.${s}`,{defaultValue:s.toUpperCase()})},s))}),e.jsx(p,{size:"sm",variant:"ghost",onClick:Z.togglePaused,children:Z.paused?t("autoRefresh.resume",{defaultValue:"Resume Auto"}):t("autoRefresh.pause",{defaultValue:"Pause Auto"})})]})]})]}),e.jsxs("div",{className:"hidden items-center justify-between gap-3 lg:flex",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"min-w-[180px] rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",value:ie,onChange:s=>St(s.target.value),children:[e.jsx("option",{value:"",children:t("common.savedViews",{defaultValue:"Saved views"})}),Ce.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:kt,children:t("common.saveView",{defaultValue:"Save View"})}),e.jsx(p,{size:"sm",variant:"ghost",onClick:Pt,disabled:!ie,children:t("common.removeView",{defaultValue:"Remove View"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"inline-flex rounded-xl border border-line/70 bg-card/70 p-1",children:["auto","table","cards"].map(s=>e.jsx("button",{type:"button",onClick:()=>Ke(s),className:`rounded-lg px-3 py-1.5 text-xs font-medium transition-colors ${re===s?"bg-gradient-to-r from-brand-500 to-brand-600 text-white":"text-muted hover:text-foreground"}`,children:t(`viewMode.${s}`,{defaultValue:s.toUpperCase()})},s))}),e.jsx(p,{size:"sm",variant:"ghost",onClick:Z.togglePaused,children:Z.paused?t("autoRefresh.resume",{defaultValue:"Resume Auto"}):t("autoRefresh.pause",{defaultValue:"Pause Auto"})}),e.jsx("span",{className:"text-xs text-muted",children:t("autoRefresh.line",{defaultValue:"Auto refresh: {{status}} ({{seconds}}s)",status:t(`autoRefresh.status.${Z.status}`,{defaultValue:Z.statusLabel}),seconds:Math.ceil(Z.nextRunInMs/1e3)})})]})]})]})}),e.jsx(ee,{className:"p-3 sm:p-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-flex min-w-full gap-1 rounded-xl border border-line/70 bg-panel/45 p-1",children:M.map(s=>{const a=K===s.id,l=s.id==="inbounds"?P.length:s.id==="templates"?rt.length:void 0;return e.jsxs("button",{type:"button",onClick:()=>wt(s.id),className:`flex min-w-[130px] flex-1 items-center justify-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-colors sm:min-w-[150px] ${a?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-soft":"text-muted hover:bg-card/70 hover:text-foreground"}`,children:[e.jsx("span",{children:s.label}),typeof l=="number"?e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs ${a?"bg-white/20 text-white":"bg-card/80 text-foreground/80"}`,children:l}):null]},s.id)})})})}),K==="inbounds"&&de>0?e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx("p",{className:"text-sm text-foreground",children:t("inbounds.selectedCount",{defaultValue:"{{count}} inbounds selected",count:de})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>{q([])},disabled:Ze,children:t("common.clear",{defaultValue:"Clear"})}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>{Zt()},loading:r.isPending,disabled:Ze,children:t("inbounds.bulk.enableSelected",{defaultValue:"Enable Selected"})}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>{es()},loading:n.isPending,disabled:Ze,children:t("inbounds.bulk.disableSelected",{defaultValue:"Disable Selected"})}),V?e.jsx(p,{size:"sm",variant:"danger",onClick:()=>{Qt()},loading:ge.isPending,disabled:Ze,children:t("inbounds.bulk.deleteSelected",{defaultValue:"Delete Selected"})}):null]})]})}):null,K==="templates"?e.jsxs(ee,{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(Mt,{className:"h-4 w-4 text-brand-500"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("inbounds.templateLibrary.title",{defaultValue:"Template Library"})})]}),e.jsx("div",{className:"space-y-5",children:ma.map(s=>{const a=rs[s];if(a.length===0)return null;const l=L[s];return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:l.title}),e.jsx("p",{className:"text-xs text-muted",children:l.hint})]}),e.jsx("span",{className:"rounded-full border border-line/70 bg-panel/70 px-2.5 py-1 text-xs text-muted",children:t("inbounds.templateLibrary.count",{defaultValue:"{{count}} templates",count:a.length})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:a.map(i=>e.jsxs("div",{className:"rounded-xl border border-line/70 bg-card/65 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("p",{className:"mr-1 text-sm font-semibold text-foreground",children:i.name}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:i.values.protocol}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:i.values.network}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:i.values.security})]}),e.jsx("p",{className:"mt-1 text-xs leading-relaxed text-muted",children:i.description}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1.5",children:i.highlights.map(y=>e.jsx("span",{className:"rounded-md border border-brand-500/25 bg-brand-500/10 px-2 py-0.5 text-[10px] font-medium text-brand-700 dark:text-brand-300",children:y},`${i.id}-${y}`))}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>te(i),children:[e.jsx(pt,{className:"mr-1 h-4 w-4"}),t("common.preview",{defaultValue:"Preview"})]}),e.jsx(p,{size:"sm",onClick:()=>{be(st(i))},children:t("inbounds.templateLibrary.useTemplate",{defaultValue:"Use Template"})})]})]},i.id))})]},s)})})]}):null,K==="compatibility"?e.jsx(ua,{onQuickCreate:ps}):null,K==="inbounds"&&$e?e.jsx(ee,{children:e.jsx("div",{className:"space-y-4 p-2",children:Array.from({length:5}).map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 rounded-xl border border-line/40 p-4",children:[e.jsx(Ge,{className:"h-8 w-20 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Ge,{className:"h-4 w-1/3"}),e.jsx(Ge,{className:"h-3 w-1/5"})]}),e.jsx(Ge,{className:"h-6 w-16 rounded-full"}),e.jsx(Ge,{className:"h-8 w-8 rounded-lg"})]},a))})}):K==="inbounds"&&P.length===0?e.jsx(ee,{children:e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"mb-4 text-muted",children:t("inbounds.empty",{defaultValue:"No inbounds configured yet."})}),e.jsxs(p,{onClick:()=>be(),children:[e.jsx(at,{className:"mr-2 h-4 w-4"}),t("inbounds.addFirst",{defaultValue:"Add Your First Inbound"})]})]})}):K==="inbounds"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ee,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("inbounds.stats.total",{defaultValue:"Total Inbounds"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:P.length})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("inbounds.stats.onlineClients",{defaultValue:"Online Clients"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:$.size})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("inbounds.stats.expanded",{defaultValue:"Expanded Rows"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:ke.length})]})]})}),e.jsx(ee,{className:Ns,children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[1160px] w-full text-sm",children:[e.jsx("thead",{className:"bg-panel/70",children:e.jsxs("tr",{className:"border-b border-line/70 text-left text-xs uppercase tracking-wide text-muted",children:[e.jsx("th",{className:"px-3 py-3",children:t("common.select",{defaultValue:"Select"})}),e.jsx("th",{className:"px-3 py-3",children:t("common.details",{defaultValue:"Details"})}),e.jsx("th",{className:"px-3 py-3",children:t("common.enabled",{defaultValue:"Enabled"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.remark",{defaultValue:"Remark"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.port",{defaultValue:"Port"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.health.label",{defaultValue:"Health"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.protocol",{defaultValue:"Protocol"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.clients",{defaultValue:"Clients"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.traffic",{defaultValue:"Traffic"})}),e.jsx("th",{className:"px-3 py-3",children:t("common.actions",{defaultValue:"Actions"})})]})}),e.jsx("tbody",{children:P.map(s=>{var ye;const a=ce.get(s.id)||[],l=a.filter(E=>$.has(E.uuid)).length,i=a.reduce((E,Re)=>E+Re.totalUsed,0),y=a.reduce((E,Re)=>E+Re.dataLimit,0),k=y>0?Math.min(i/y*100,100):0,G=ke.includes(s.id),U=it.get(s.id),ue=Tt(U==null?void 0:U.status),Me=Ct(U==null?void 0:U.lastCheckedAt);return e.jsxs(le.Fragment,{children:[e.jsxs("tr",{className:"border-b border-line/70 hover:bg-panel/35",children:[e.jsx("td",{className:"px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:_.includes(s.id),onChange:()=>Ie(s.id),className:"h-4 w-4 rounded border-line/70 bg-card text-brand-500 focus:ring-brand-500/50"})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("button",{type:"button",onClick:()=>ze(s.id),className:"inline-flex items-center gap-1 rounded-md border border-line/70 px-2 py-1 text-xs text-muted transition-colors hover:bg-card/80 hover:text-foreground",children:[G?e.jsx(Rt,{className:"h-4 w-4"}):e.jsx(Zs,{className:"h-4 w-4"}),G?t("common.hide",{defaultValue:"Hide"}):t("common.show",{defaultValue:"Show"})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("button",{type:"button",onClick:()=>b.mutate(s.id),className:`inline-flex items-center gap-2 rounded-full border px-2.5 py-1 text-xs ${s.enabled?"border-green-400/50 bg-green-500/10 text-green-300":"border-amber-400/50 bg-amber-500/10 text-amber-300"}`,children:s.enabled?t("common.on",{defaultValue:"On"}):t("common.off",{defaultValue:"Off"})})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.remark||s.tag}),e.jsx("span",{className:"text-xs text-muted",children:s.tag})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-foreground",children:s.port}),e.jsxs("button",{type:"button",onClick:()=>g.mutate(s.id),disabled:g.isPending&&we===s.id,className:"inline-flex items-center gap-1 rounded-md border border-line/70 px-2 py-1 text-xs text-muted transition-colors hover:bg-card/80 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",title:t("inbounds.randomPortTitle",{defaultValue:"Assign random free port"}),children:[e.jsx(ht,{className:"h-3.5 w-3.5"}),t("inbounds.randomPort",{defaultValue:"Random"})]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:`inline-flex rounded-full border px-2 py-0.5 text-xs ${ue.className}`,children:ue.label}),e.jsxs("p",{className:"text-xs text-muted",children:[t("inbounds.health.checkedLabel",{defaultValue:"Checked"})," ",Me]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs font-medium ${bt[s.protocol]}`,children:s.protocol}),e.jsxs("span",{className:"text-xs text-muted",children:[s.network,"/",s.security]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-foreground",children:t("inbounds.onlineTotal",{defaultValue:"{{online}} online / {{total}} total",online:l,total:a.length})}),e.jsx("p",{className:"text-xs text-muted",children:t("inbounds.assignedCount",{defaultValue:"Assigned: {{count}}",count:((ye=s._count)==null?void 0:ye.userInbounds)||0})})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"w-40",children:[e.jsxs("p",{className:"text-xs text-muted",children:[et(i)," / ",y>0?et(y):"∞"]}),e.jsx("div",{className:"mt-1 h-2 rounded-full bg-panel/80",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-brand-500 to-brand-600",style:{width:`${k}%`}})})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"flex justify-end",children:yt(s)})})]}),G?e.jsx("tr",{className:"border-b border-line/70 bg-panel/30",children:e.jsx("td",{colSpan:10,className:"px-4 py-4",children:a.length===0?e.jsx("p",{className:"text-sm text-muted",children:t("inbounds.noClients",{defaultValue:"No clients assigned to this inbound yet."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[880px] w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs uppercase tracking-wide text-muted",children:[e.jsx("th",{className:"px-2 py-2",children:t("common.client",{defaultValue:"Client"})}),e.jsx("th",{className:"px-2 py-2",children:t("common.online",{defaultValue:"Online"})}),e.jsx("th",{className:"px-2 py-2",children:t("common.status",{defaultValue:"Status"})}),e.jsx("th",{className:"px-2 py-2",children:t("inbounds.traffic",{defaultValue:"Traffic"})}),e.jsx("th",{className:"px-2 py-2",children:t("common.expiry",{defaultValue:"Expiry"})}),e.jsx("th",{className:"px-2 py-2",children:t("common.action",{defaultValue:"Action"})})]})}),e.jsx("tbody",{children:a.map(E=>{const Re=$.has(E.uuid),tt=E.dataLimit,ws=tt>0?Math.min(E.totalUsed/tt*100,100):0,mt=bs(E.expireDate);return e.jsxs("tr",{className:"border-t border-line/70",children:[e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-foreground",children:E.email}),e.jsxs("span",{className:"text-xs text-muted",children:[E.uuid.slice(0,10),"..."]})]})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs ${Re?"bg-green-500/15 text-green-300":"bg-zinc-500/15 text-zinc-300"}`,children:Re?t("common.online",{defaultValue:"Online"}):t("common.offline",{defaultValue:"Offline"})})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs ${E.status==="ACTIVE"?"bg-emerald-500/15 text-emerald-300":"bg-amber-500/15 text-amber-300"}`,children:E.status})}),e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"w-48",children:[e.jsxs("p",{className:"text-xs text-muted",children:[et(E.totalUsed)," / ",tt>0?et(tt):"∞"]}),e.jsx("div",{className:"mt-1 h-2 rounded-full bg-panel/80",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-brand-500 to-brand-600",style:{width:`${ws}%`}})})]})}),e.jsx("td",{className:"px-2 py-2 text-xs text-muted",children:mt===null?t("common.na",{defaultValue:"N/A"}):mt>0?t("common.daysLeft",{defaultValue:"{{count}}d left",count:mt}):t("common.expired",{defaultValue:"Expired"})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>c(`/users/${E.id}`),children:t("common.view",{defaultValue:"View"})})})]},`${s.id}-${E.id}`)})})]})})})}):null]},s.id)})})]})})}),e.jsx("div",{className:js,children:P.map(s=>{const a=ce.get(s.id)||[],l=a.filter(G=>$.has(G.uuid)).length,i=it.get(s.id),y=Tt(i==null?void 0:i.status),k=Ct(i==null?void 0:i.lastCheckedAt);return e.jsx(ee,{className:"transition-shadow hover:shadow-lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:`inline-block rounded-full px-3 py-1 text-sm font-medium ${bt[s.protocol]}`,children:s.protocol}),e.jsx("h3",{className:"mt-2 text-base font-semibold text-foreground",children:s.remark||s.tag}),e.jsxs("p",{className:"text-xs text-muted",children:[t("inbounds.portLabel",{defaultValue:"Port"})," ",s.port," • ",s.network,"/",s.security]})]}),e.jsx(Ut,{variant:s.enabled?"success":"warning",children:s.enabled?t("common.active",{defaultValue:"Active"}):t("common.disabled",{defaultValue:"Disabled"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted",children:t("inbounds.clients",{defaultValue:"Clients"})}),e.jsxs("span",{className:"text-foreground",children:[l," online / ",a.length," total"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted",children:t("inbounds.health.label",{defaultValue:"Health"})}),e.jsx("span",{className:`inline-flex rounded-full border px-2 py-0.5 text-xs ${y.className}`,children:y.label})]}),e.jsxs("p",{className:"text-xs text-muted",children:[t("inbounds.health.checkedLabel",{defaultValue:"Checked"})," ",k]}),e.jsxs("div",{className:"flex flex-wrap gap-2 border-t border-line/70 pt-3",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>b.mutate(s.id),children:[s.enabled?e.jsx(Ls,{className:"mr-1 h-4 w-4"}):e.jsx(Os,{className:"mr-1 h-4 w-4"}),s.enabled?t("common.disable",{defaultValue:"Disable"}):t("common.enable",{defaultValue:"Enable"})]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>oe(s),children:[e.jsx(pt,{className:"h-4 w-4"}),t("common.details",{defaultValue:"Details"})]}),e.jsx("div",{className:"ml-auto flex items-center",children:yt(s,{mobile:!0,includeRandomPort:!0})})]})]})},`mobile-${s.id}`)})})]}):null,Ye?e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-2 backdrop-blur-sm sm:items-center sm:p-4",children:e.jsxs("div",{className:"w-full max-w-xl rounded-2xl border border-line/80 bg-card/95 shadow-soft",children:[e.jsxs("div",{className:"border-b border-line/70 px-5 py-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t("inbounds.myanmarPack.title",{defaultValue:"Apply Myanmar Resilience Pack"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("inbounds.myanmarPack.subtitle",{defaultValue:"Creates three optimized profiles: VLESS REALITY XHTTP, VLESS WS TLS, and Trojan WS TLS."})})]}),e.jsxs("div",{className:"space-y-4 px-5 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.serverAddress",{defaultValue:"Server Address"})}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx("input",{value:R.serverAddress,onChange:s=>W(a=>({...a,serverAddress:s.target.value})),placeholder:"your.domain.com",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"}),e.jsxs(p,{type:"button",variant:"secondary",size:"sm",onClick:()=>{vt()},loading:se,className:"shrink-0",children:[e.jsx(Bt,{className:"mr-2 h-4 w-4"}),t("inbounds.myanmarPack.useServerIp",{defaultValue:"Use server IP"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.serverName",{defaultValue:"Server Name (SNI)"})}),e.jsx("input",{value:R.serverName,onChange:s=>W(a=>({...a,serverName:s.target.value})),placeholder:"your.domain.com",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.cdnHost",{defaultValue:"CDN Host (optional)"})}),e.jsx("input",{value:R.cdnHost,onChange:s=>W(a=>({...a,cdnHost:s.target.value})),placeholder:"cdn.your.domain.com",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.fallbackPorts",{defaultValue:"Fallback Ports"})}),e.jsx("input",{value:R.fallbackPorts,onChange:s=>W(a=>({...a,fallbackPorts:s.target.value})),placeholder:"8443,9443",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:t("inbounds.myanmarPack.fallbackPortsHint",{defaultValue:"Comma-separated ports used for WS/TLS fallback profiles."})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-line/70 bg-panel/45 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.assignUsers",{defaultValue:"Assign to Users"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:is,children:t("common.all",{defaultValue:"All"})}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:ds,children:t("common.clear",{defaultValue:"Clear"})})]})]}),e.jsx("p",{className:"mb-2 text-xs text-muted",children:t("inbounds.myanmarPack.assignUsersHint",{defaultValue:"Optional. Adds created profiles to selected users without removing existing keys."})}),e.jsx("div",{className:"max-h-40 space-y-1 overflow-auto pr-1",children:ct.length===0?e.jsx("p",{className:"text-xs text-muted",children:t("inbounds.myanmarPack.noUsers",{defaultValue:"No users found."})}):ct.map(s=>{const a=Number(s.id);return e.jsxs("label",{className:"flex items-center gap-2 rounded-md px-1 py-1 text-xs text-foreground hover:bg-panel/55",children:[e.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-line/70 bg-card/90",checked:ts.has(a),onChange:l=>ls(a,l.target.checked)}),e.jsx("span",{className:"truncate",children:s.email})]},`mm-pack-user-${a}`)})})]}),e.jsxs("div",{className:"rounded-lg border border-line/70 bg-panel/45 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.assignGroups",{defaultValue:"Assign to Groups"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:cs,children:t("common.all",{defaultValue:"All"})}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:us,children:t("common.clear",{defaultValue:"Clear"})})]})]}),e.jsx("p",{className:"mb-2 text-xs text-muted",children:t("inbounds.myanmarPack.assignGroupsHint",{defaultValue:"Optional. Merges created profiles into selected groups while keeping existing assignments."})}),e.jsx("div",{className:"max-h-40 space-y-1 overflow-auto pr-1",children:ut.length===0?e.jsx("p",{className:"text-xs text-muted",children:t("inbounds.myanmarPack.noGroups",{defaultValue:"No groups found."})}):ut.map(s=>{const a=Number(s.id);return e.jsxs("label",{className:"flex items-center gap-2 rounded-md px-1 py-1 text-xs text-foreground hover:bg-panel/55",children:[e.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-line/70 bg-card/90",checked:ss.has(a),onChange:l=>os(a,l.target.checked)}),e.jsx("span",{className:"truncate",children:s.name})]},`mm-pack-group-${a}`)})})]})]}),Y!=null&&Y.planned&&Y.planned.length>0?e.jsxs("div",{className:"space-y-2 rounded-lg border border-line/70 bg-panel/50 p-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.previewPlan",{defaultValue:"Preview Plan"})}),e.jsx("div",{className:"space-y-1 text-xs text-muted",children:Y.planned.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-md bg-panel/60 px-2 py-1",children:[e.jsxs("span",{className:"text-foreground",children:[String(s.protocol||"INBOUND")," • ",String(s.network||"TCP")," • ",String(s.security||"NONE")]}),e.jsx("span",{children:String(s.port||"-")})]},`${s.tag||s.protocol||a}`))}),Y.warnings&&Y.warnings.length>0?e.jsx("div",{className:"space-y-1 rounded-md border border-amber-500/30 bg-amber-500/10 px-2 py-2 text-xs text-amber-300",children:Y.warnings.map(s=>e.jsx("p",{children:s},s))}):null]}):null]}),e.jsxs("div",{className:"flex items-center gap-3 border-t border-line/70 px-5 py-4",children:[e.jsx(p,{variant:"secondary",onClick:()=>{Nt(!0)},loading:fe.isPending,className:"flex-1",children:t("inbounds.myanmarPack.previewPlan",{defaultValue:"Preview Plan"})}),e.jsx(p,{onClick:()=>{Nt(!1)},loading:fe.isPending,className:"flex-1",children:t("inbounds.myanmarPack.applyPack",{defaultValue:"Apply Pack"})}),e.jsx(p,{variant:"secondary",onClick:()=>X(!1),className:"flex-1",children:t("common.cancel",{defaultValue:"Cancel"})})]})]})}):null,A||m?e.jsx(da,{inbound:m||void 0,initialValues:u||void 0,onClose:jt,onSuccess:async()=>{jt(),await o.invalidateQueries({queryKey:["inbounds"]})}}):null,O?e.jsx(Fs,{inbound:O,onClose:()=>I(null)}):null,F?e.jsx(oa,{inbound:F,clients:ce.get(F.id)||[],sessionsByUuid:H,actionLoadingKey:De,onClose:()=>oe(null),onViewUser:s=>c(`/users/${s}`),onToggleAccess:s=>{Ee(`u${s.id}-toggle`,async()=>{await T.post(`/users/${s.id}/inbounds/${F.id}/toggle`,{enabled:!s.enabled})},"Failed to toggle user key access")},onResetTraffic:s=>{Ee(`u${s.id}-reset`,async()=>{await T.post(`/users/${s.id}/reset-traffic`)},"Failed to reset user traffic")},onExtendExpiry:(s,a)=>{Ee(`u${s.id}-extend${a}`,async()=>{await T.post(`/users/${s.id}/extend-expiry`,{days:a})},"Failed to extend user expiry")},onDisableUser:s=>{Ee(`u${s.id}-disable`,async()=>{await T.put(`/users/${s.id}`,{status:"DISABLED"})},"Failed to disable user")},onDecreasePriority:s=>{Ee(`u${s.id}-priority-down`,async()=>{await T.patch(`/users/${s.id}/inbounds/${F.id}/priority`,{priority:Math.max(1,Number(s.priority||100)-1)})},"Failed to update key priority")},onIncreasePriority:s=>{Ee(`u${s.id}-priority-up`,async()=>{await T.patch(`/users/${s.id}/inbounds/${F.id}/priority`,{priority:Math.min(9999,Number(s.priority||100)+1)})},"Failed to update key priority")}}):null,j?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/55 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl border border-line/80 bg-card/95 p-5 shadow-soft",children:[e.jsx("div",{className:"mb-3 flex items-start justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:j.name}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:j.description})]})}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-semibold uppercase tracking-wider text-muted",children:t("inbounds.templateLibrary.jsonPreview",{defaultValue:"Template JSON Preview"})}),e.jsx("pre",{className:"max-h-[48vh] overflow-auto rounded-lg bg-card/80 p-3 text-xs text-foreground",children:JSON.stringify(st(j),null,2)})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-end gap-2",children:[e.jsx(p,{variant:"secondary",onClick:()=>te(null),children:t("common.close",{defaultValue:"Close"})}),e.jsx(p,{onClick:()=>{be(st(j)),te(null)},children:t("inbounds.templateLibrary.useTemplate",{defaultValue:"Use Template"})})]})]})}):null,e.jsx(Ds,{open:!!w,title:ys,description:vs,confirmLabel:t("common.delete",{defaultValue:"Delete"}),cancelLabel:t("common.cancel",{defaultValue:"Cancel"}),tone:"danger",loading:Vt,onCancel:()=>{Vt||xe(null)},onConfirm:()=>{Jt()}}),Xe&&!$e?e.jsx("div",{className:"fixed bottom-24 right-4 z-40 rounded-full border border-line/80 bg-card/90 px-3 py-1 text-xs text-muted shadow-soft lg:bottom-6",children:t("inbounds.refreshing",{defaultValue:"Refreshing inbounds..."})}):null]})},sr=wa;export{wa as Inbounds,sr as InboundsPage};
