import{b as F,r as l,j as e}from"./index-BBbY-zsF.js";import{u as T}from"./useQuery-BjvbrY8C.js";import{u as w}from"./useMutation-Dc8a1YBZ.js";import{apiClient as f}from"./client-BZB-O8vt.js";import{u as L,C as b}from"./useToast-RuPXIRlr.js";import{B as n}from"./Button-278k26BX.js";import{I as R}from"./Input-hVY1OOjI.js";import{C as B}from"./ConfirmDialog-DVU6FWJw.js";import{u as $}from"./useTranslation-6XXcKgY6.js";import{C as D}from"./copy-DD6vOtEo.js";import{P as E}from"./plus-DZcq-GjF.js";import{T as U}from"./trash-2-BQX7bqv5.js";import"./cn-BLSKlp9E.js";const q=[{id:"users:read",label:"Users: Read",description:"List users, stats, sessions, devices."},{id:"users:write",label:"Users: Write",description:"Create/update users, rotate/revoke keys, reorder access keys."},{id:"inbounds:read",label:"Inbounds: Read",description:"List inbound profiles and templates."},{id:"inbounds:write",label:"Inbounds: Write",description:"Create/update/delete inbounds and apply presets."},{id:"groups:read",label:"Groups: Read",description:"List groups and policies."},{id:"groups:write",label:"Groups: Write",description:"Create/update groups and membership."},{id:"system:read",label:"System: Read",description:"Read system stats, health, and versions."},{id:"logs:read",label:"Logs: Read",description:"Read system/connection logs."},{id:"search:read",label:"Search: Read",description:"Use global search endpoints."}],ae=()=>{const k=F(),r=L(),{t:s}=$(),[m,p]=l.useState(!1),[y,x]=l.useState(""),[g,j]=l.useState(null),[d,h]=l.useState(null),[i,v]=l.useState("custom"),[K,V]=l.useState(["users:read","inbounds:read","groups:read","system:read"]),{data:c,isLoading:A}=T({queryKey:["api-keys"],queryFn:async()=>{var o;return(o=(await f.get("/api-keys")).data)==null?void 0:o.data}}),C=w({mutationFn:async a=>{var t;return(t=(await f.post("/api-keys",a)).data)==null?void 0:t.data},onSuccess:a=>{j(a.plainKey||null),x(""),p(!1),r.success(s("apiKeys.createdTitle",{defaultValue:"API key created"}),s("apiKeys.createdBody",{defaultValue:`Key "${a.name}" is ready to use.`})),k.invalidateQueries({queryKey:["api-keys"]})},onError:a=>{r.error(s("apiKeys.createFailedTitle",{defaultValue:"Create API key failed"}),(a==null?void 0:a.message)||s("apiKeys.createFailedBody",{defaultValue:"Failed to create API key"}))}}),u=w({mutationFn:async a=>{await f.delete(`/api-keys/${a}`)},onSuccess:()=>{r.success(s("apiKeys.revokedTitle",{defaultValue:"API key revoked"}),s("apiKeys.revokedBody",{defaultValue:"The selected key was revoked successfully."})),k.invalidateQueries({queryKey:["api-keys"]})},onError:a=>{r.error(s("apiKeys.revokeFailedTitle",{defaultValue:"Revoke API key failed"}),(a==null?void 0:a.message)||s("apiKeys.revokeFailedBody",{defaultValue:"Failed to revoke API key"}))}}),S=async a=>{try{await navigator.clipboard.writeText(a),r.success(s("common.copied",{defaultValue:"Copied"}),s("apiKeys.copiedBody",{defaultValue:"API key copied to clipboard."}))}catch{r.error(s("common.error",{defaultValue:"Error"}),s("apiKeys.copyFailedBody",{defaultValue:"Unable to copy to clipboard."}))}},I=a=>{V(o=>{const t=new Set(o);return t.has(a)?t.delete(a):t.add(a),Array.from(t)})},N=i==="custom"?K:[],P=y.trim().length>0&&(i==="full"||N.length>0);return e.jsxs("div",{className:"space-y-6",children:[g&&e.jsx(b,{children:e.jsxs("div",{className:"flex items-start gap-4 rounded-lg bg-green-50 p-4 dark:bg-green-900/20 dark:border dark:border-green-900/50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-green-800 dark:text-green-300",children:s("apiKeys.keyCreatedTitle",{defaultValue:"API Key Created!"})}),e.jsx("p",{className:"mt-1 text-sm text-green-700 dark:text-green-400",children:s("apiKeys.keyCreatedBody",{defaultValue:"Copy this key now. It won't be shown again."})}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 rounded bg-white px-3 py-2 text-sm dark:bg-gray-800 dark:text-gray-200",children:g}),e.jsx(n,{variant:"secondary",onClick:()=>{S(g)},children:e.jsx(D,{className:"h-4 w-4"})})]})]}),e.jsx("button",{onClick:()=>j(null),className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:"×"})]})}),e.jsxs(b,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s("apiKeys.title",{defaultValue:"API Keys"})}),e.jsxs(n,{onClick:()=>p(!0),disabled:m,children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),s("apiKeys.create",{defaultValue:"Create Key"})]})]}),m&&e.jsxs("div",{className:"mb-4 flex gap-2 rounded-lg bg-gray-50 p-4 dark:bg-gray-800/50",children:[e.jsx(R,{placeholder:s("apiKeys.namePlaceholder",{defaultValue:"Key name (e.g., 'automation')"}),value:y,onChange:a=>x(a.target.value),className:"flex-1"}),e.jsx(n,{onClick:()=>C.mutate({name:y,permissions:N}),loading:C.isPending,disabled:!P,children:s("common.create",{defaultValue:"Create"})}),e.jsx(n,{variant:"secondary",onClick:()=>{p(!1),x("")},children:s("common.cancel",{defaultValue:"Cancel"})})]}),m?e.jsxs("div",{className:"mb-4 rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-900/20",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:s("apiKeys.scopesTitle",{defaultValue:"Scopes"})}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:s("apiKeys.scopesHint",{defaultValue:"Limit what this key can access. For full access, choose Full."})}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>v("custom"),className:`rounded-xl px-3 py-2 text-sm font-semibold transition ${i==="custom"?"bg-brand-500 text-white shadow-soft":"border border-line/70 bg-card/70 text-muted hover:text-foreground"}`,children:s("apiKeys.scopesCustom",{defaultValue:"Custom"})}),e.jsx("button",{type:"button",onClick:()=>v("full"),className:`rounded-xl px-3 py-2 text-sm font-semibold transition ${i==="full"?"bg-brand-500 text-white shadow-soft":"border border-line/70 bg-card/70 text-muted hover:text-foreground"}`,children:s("apiKeys.scopesFull",{defaultValue:"Full"})})]}),i==="custom"?e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-2 sm:grid-cols-2",children:q.map(a=>e.jsxs("label",{className:"flex cursor-pointer items-start gap-3 rounded-xl border border-gray-200 p-3 text-sm dark:border-gray-700",children:[e.jsx("input",{type:"checkbox",checked:K.includes(a.id),onChange:()=>I(a.id),className:"mt-0.5 h-4 w-4 rounded border-gray-300 text-brand-600 focus:ring-brand-500"}),e.jsxs("span",{className:"min-w-0",children:[e.jsx("span",{className:"block font-semibold text-gray-900 dark:text-white",children:a.label}),e.jsx("span",{className:"mt-0.5 block text-xs text-gray-600 dark:text-gray-400",children:a.description})]})]},a.id))}):e.jsx("p",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:s("apiKeys.scopesFullHint",{defaultValue:"Full access keys can call any permitted API routes. Avoid sharing widely."})})]}):null,A?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:s("common.loading",{defaultValue:"Loading..."})}):c!=null&&c.length?e.jsx("div",{className:"space-y-3",children:c.map(a=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-gray-200 p-4 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s("apiKeys.createdAt",{defaultValue:"Created"})," ",new Date(a.createdAt).toLocaleDateString(),a.lastUsedAt&&` • Last used ${new Date(a.lastUsedAt).toLocaleDateString()}`]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:Array.isArray(a.permissions)&&a.permissions.length>0?`${s("apiKeys.scopes",{defaultValue:"Scopes"})}: ${a.permissions.join(", ")}`:s("apiKeys.scopesFull",{defaultValue:"Full"})})]}),e.jsx(n,{variant:"danger",onClick:()=>{h(a)},loading:u.isPending,children:e.jsx(U,{className:"h-4 w-4"})})]},a.id))}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:s("apiKeys.none",{defaultValue:"No API keys created yet."})})]}),e.jsxs(b,{children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900 dark:text-white",children:s("apiKeys.usageTitle",{defaultValue:"Usage"})}),e.jsx("p",{className:"mb-2 text-sm text-gray-600 dark:text-gray-400",children:s("apiKeys.usageBody",{defaultValue:"Include your API key in the X-API-Key header:"})}),e.jsx("pre",{className:"overflow-x-auto rounded-lg bg-gray-100 p-4 text-sm dark:bg-gray-800 dark:text-gray-200",children:`curl -H "X-API-Key: oneui_your_key_here" \\
  https://your-domain.com/api/users`})]}),e.jsx(B,{open:!!d,title:s("apiKeys.revokeTitle",{defaultValue:"Revoke API key?"}),description:d?`This will permanently revoke "${d.name}". Clients using it will lose access immediately.`:void 0,confirmLabel:s("apiKeys.revokeConfirm",{defaultValue:"Revoke key"}),tone:"danger",loading:u.isPending,onCancel:()=>{u.isPending||h(null)},onConfirm:()=>{d&&u.mutate(d.id,{onSettled:()=>{h(null)}})}})]})};export{ae as default};
