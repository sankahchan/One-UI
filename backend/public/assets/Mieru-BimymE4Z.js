import{c as Qe,e as He,r as c,j as e}from"./index-CG9kpP9Y.js";import{a as xe}from"./system-v04BLkjp.js";import{B as I}from"./Badge-DQo9BAHa.js";import{B as i}from"./Button-B80QVKRC.js";import{u as Be,C as U}from"./useToast-C_OO-2JX.js";import{I as C}from"./Input-vpwyIRrG.js";import{u as Oe,a as _e,b as Ge,c as ze,d as Xe,e as Ye,f as $e,g as Ke,h as We,i as Ze,j as Je,k as ea}from"./useMieru-ChZiSjrZ.js";import{C as aa,c as fe}from"./clipboard-D_hUxpVN.js";import{u as sa,R as ge}from"./useTranslation-DQjABgHn.js";import{A as he}from"./activity-DlclupDX.js";import{R as ta}from"./rotate-ccw-COvDNp33.js";import{S as be}from"./save-OYzEnSyr.js";import{P as ra}from"./plus-CuU2M0FX.js";import{D as la}from"./download-CX5md0Yg.js";import{T as na}from"./trash-2-BX_Hm8OC.js";import"./cn-BLSKlp9E.js";import"./useQuery-ClalJbNF.js";import"./useMutation-Br-t0osD.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=Qe("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),j={server:"",portRange:"8444-8444",transport:"TCP",udp:!1,multiplexing:"MULTIPLEXING_HIGH"},P={username:"",password:"",enabled:!0,quotaDays:"",quotaMegabytes:""};function ye(a){const r=a.quotaDays.trim(),n=a.quotaMegabytes.trim();if(!r&&!n)return[];const f={};if(r){const m=Number.parseInt(r,10);if(!Number.isInteger(m)||m<0)throw new Error("Quota days must be a positive integer.");f.days=m}if(n){const m=Number.parseInt(n,10);if(!Number.isInteger(m)||m<0)throw new Error("Quota megabytes must be a positive integer.");f.megabytes=m}return[f]}function ua(a){const r=Array.isArray(a)?a.find(n=>Number.isInteger(n==null?void 0:n.days)||Number.isInteger(n==null?void 0:n.megabytes)):void 0;return{quotaDays:r&&Number.isInteger(r.days)&&(r.days??0)>=0?String(r.days):"",quotaMegabytes:r&&Number.isInteger(r.megabytes)&&(r.megabytes??0)>=0?String(r.megabytes):""}}function q(a){const r=a.trim();if(!r)return"";const n=r.toLowerCase();return n==="localhost"||n==="127.0.0.1"||n==="::1"?"":r}function ia(){return typeof window>"u"?"":q(window.location.hostname||"")}const Ia=()=>{var z,X,Y,$,K,W,Z,J,ee,ae,se,te,re,le,ne,oe,ue,ie,de,ce,me;const{t:a}=sa(),r=Be(),n=He(),f=c.useMemo(()=>ia(),[]),m=Oe(),d=_e(),o=Ge(),L=ze(!0),E=Xe(),T=Ye(),Q=$e(),H=Ke(),B=We(),ve=Ze(),N=Je(),[S,je]=c.useState(!1),A=ea(120,S),[v,p]=c.useState(j),[D,g]=c.useState(!1),[O,V]=c.useState(!1),[Ne,k]=c.useState(!1),[h,w]=c.useState(P),[F,R]=c.useState(null),[b,y]=c.useState(P);c.useEffect(()=>{!o.data||D||(p({server:o.data.server||"",portRange:o.data.portRange||j.portRange,transport:o.data.transport||j.transport,udp:!!o.data.udp,multiplexing:o.data.multiplexing||j.multiplexing}),V(!!o.data.server))},[D,o.data]),c.useEffect(()=>{if(O||D||v.server.trim()||o.isLoading)return;if(f){p(t=>({...t,server:f})),V(!0);return}let s=!1;return k(!0),xe().then(({ip:t})=>{if(s)return;const x=q(t||"");x&&p(l=>({...l,server:x}))}).catch(()=>{}).finally(()=>{s||(k(!1),V(!0))}),()=>{s=!0}},[f,O,D,v.server,o.isLoading]);const _=((z=L.data)==null?void 0:z.users)||[],G=c.useMemo(()=>{var s,t;return(s=m.data)!=null&&s.enabled?(t=d.data)!=null&&t.running?{label:a("common.online",{defaultValue:"Online"}),variant:"success"}:{label:a("common.offline",{defaultValue:"Offline"}),variant:"warning"}:{label:a("common.disabled",{defaultValue:"Disabled"}),variant:"danger"}},[(X=m.data)==null?void 0:X.enabled,(Y=d.data)==null?void 0:Y.running,a]),Ve=()=>{n.invalidateQueries({queryKey:["mieru-policy"]}),n.invalidateQueries({queryKey:["mieru-status"]}),n.invalidateQueries({queryKey:["mieru-profile"]}),n.invalidateQueries({queryKey:["mieru-users"]}),S&&n.invalidateQueries({queryKey:["mieru-logs"]})},we=async()=>{try{const s=await E.mutateAsync("manual.mieru.page.sync");r.success(a("common.success",{defaultValue:"Success"}),s.changed?a("mieru.syncChanged",{defaultValue:"Synced {{count}} users to Mieru.",count:s.userCount}):a("mieru.syncNoChange",{defaultValue:"Already in sync ({{count}} users).",count:s.userCount}))}catch(s){r.error(a("common.error",{defaultValue:"Error"}),(s==null?void 0:s.message)||a("mieru.syncFailed",{defaultValue:"Failed to sync Mieru users."}))}},Me=async()=>{try{await T.mutateAsync(),r.success(a("common.success",{defaultValue:"Success"}),a("mieru.restartSuccess",{defaultValue:"Mieru restarted successfully."}))}catch(s){r.error(a("common.error",{defaultValue:"Error"}),(s==null?void 0:s.message)||a("mieru.restartFailed",{defaultValue:"Failed to restart Mieru."}))}},Ce=async()=>{try{await Q.mutateAsync(v),g(!1),r.success(a("common.success",{defaultValue:"Success"}),a("mieru.profileSaved",{defaultValue:"Mieru profile updated."}))}catch(s){r.error(a("common.error",{defaultValue:"Error"}),(s==null?void 0:s.message)||a("mieru.profileSaveFailed",{defaultValue:"Failed to update Mieru profile."}))}},Pe=()=>{if(!f){r.warning(a("common.warning",{defaultValue:"Warning"}),a("mieru.currentHostUnavailable",{defaultValue:"Current panel host is unavailable on this device."}));return}g(!0),p(s=>({...s,server:f})),V(!0)},Ie=async()=>{k(!0);try{const{ip:s}=await xe(),t=q(s||"");if(!t){r.warning(a("common.warning",{defaultValue:"Warning"}),a("mieru.publicIpUnavailable",{defaultValue:"Unable to resolve public IP right now."}));return}g(!0),p(x=>({...x,server:t})),V(!0),r.success(a("common.success",{defaultValue:"Success"}),a("mieru.publicIpDetected",{defaultValue:"Public IP detected and applied."}))}catch{r.error(a("common.error",{defaultValue:"Error"}),a("mieru.publicIpDetectFailed",{defaultValue:"Failed to detect public IP."}))}finally{k(!1)}},Ue=async()=>{try{const s=ye(h);await H.mutateAsync({username:h.username,password:h.password,enabled:h.enabled,...s.length>0?{quotas:s}:{}}),w(P),r.success(a("common.success",{defaultValue:"Success"}),a("mieru.userCreated",{defaultValue:"Mieru user created."}))}catch(s){r.error(a("common.error",{defaultValue:"Error"}),String((s==null?void 0:s.message)||a("mieru.userCreateFailed",{defaultValue:"Failed to create Mieru user."})))}},Le=s=>{R(s.username),y({username:s.username,password:s.password,enabled:s.enabled,...ua(s.quotas)})},Ee=async()=>{if(F)try{const s=ye(b);await B.mutateAsync({username:F,payload:{username:b.username,password:b.password,enabled:b.enabled,...s.length>0?{quotas:s}:{quotas:[]}}}),R(null),y(P),r.success(a("common.success",{defaultValue:"Success"}),a("mieru.userUpdated",{defaultValue:"Mieru user updated."}))}catch(s){r.error(a("common.error",{defaultValue:"Error"}),String((s==null?void 0:s.message)||a("mieru.userUpdateFailed",{defaultValue:"Failed to update Mieru user."})))}},Se=async s=>{if(window.confirm(a("mieru.confirmDelete",{defaultValue:`Delete Mieru user "${s}"?`})))try{await ve.mutateAsync(s),F===s&&(R(null),y(P)),r.success(a("common.success",{defaultValue:"Success"}),a("mieru.userDeleted",{defaultValue:"Mieru user deleted."}))}catch(t){r.error(a("common.error",{defaultValue:"Error"}),(t==null?void 0:t.message)||a("mieru.userDeleteFailed",{defaultValue:"Failed to delete Mieru user."}))}},De=async s=>{try{const t=await N.mutateAsync(s);if(!await fe(t.clashYaml))throw new Error("clipboard failed");r.success(a("common.copied",{defaultValue:"Copied"}),a("mieru.exportCopied",{defaultValue:"Clash YAML copied to clipboard."}))}catch(t){r.error(a("common.error",{defaultValue:"Error"}),(t==null?void 0:t.message)||a("mieru.exportCopyFailed",{defaultValue:"Failed to copy Mieru export."}))}},ke=async s=>{try{const t=await E.mutateAsync(`manual.mieru.export.regenerate.${s}`),x=await N.mutateAsync(s);if(!await fe(x.clashYaml))throw new Error("clipboard failed");r.success(a("common.copied",{defaultValue:"Copied"}),a("mieru.regenerateAndCopySuccess",{defaultValue:"Regenerated config and copied Clash YAML ({{count}} users synced).",count:t.userCount}))}catch(t){r.error(a("common.error",{defaultValue:"Error"}),(t==null?void 0:t.message)||a("mieru.regenerateAndCopyFailed",{defaultValue:"Failed to regenerate and copy Mieru profile."}))}},Fe=async s=>{try{const t=await N.mutateAsync(s),x=new Blob([t.clashYaml],{type:"application/yaml;charset=utf-8"}),l=window.URL.createObjectURL(x),u=document.createElement("a");u.href=l,u.download=`mieru-${s}.yaml`,u.click(),window.URL.revokeObjectURL(l)}catch(t){r.error(a("common.error",{defaultValue:"Error"}),(t==null?void 0:t.message)||a("mieru.exportDownloadFailed",{defaultValue:"Failed to download Mieru export."}))}},Re=((K=($=L.data)==null?void 0:$.stats)==null?void 0:K.online)||0,Ae=((Z=(W=L.data)==null?void 0:W.stats)==null?void 0:Z.total)||0,qe=Math.max(1,Math.round((((ee=(J=d.data)==null?void 0:J.restartMonitor)==null?void 0:ee.windowSeconds)||600)/60));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:a("nav.mieru",{defaultValue:"Mieru"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:a("mieru.subtitle",{defaultValue:"Manage Mieru profile, custom users, exports, and live online state."})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(i,{variant:"secondary",onClick:Ve,loading:d.isFetching||L.isFetching,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),a("common.refresh",{defaultValue:"Refresh"})]}),e.jsxs(i,{variant:"secondary",onClick:()=>void we(),loading:E.isPending,children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),a("mieru.syncUsers",{defaultValue:"Sync Users"})]}),e.jsxs(i,{variant:"danger",onClick:()=>void Me(),loading:T.isPending,children:[e.jsx(ta,{className:"mr-2 h-4 w-4"}),a("mieru.restart",{defaultValue:"Restart Mieru"})]})]})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:a("mieru.runtime",{defaultValue:"Runtime"})}),e.jsx(I,{variant:G.variant,children:G.label}),e.jsx("span",{className:"text-sm text-muted",children:a("mieru.onlineSummary",{defaultValue:"{{online}} / {{total}} online",online:Re,total:Ae})})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-5",children:[e.jsxs("div",{className:"rounded-2xl border border-line/70 bg-panel/60 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:a("mieru.mode",{defaultValue:"Mode"})}),e.jsx("p",{className:"mt-1 font-semibold text-foreground",children:((ae=m.data)==null?void 0:ae.mode)||"docker"})]}),e.jsxs("div",{className:"rounded-2xl border border-line/70 bg-panel/60 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:a("mieru.version",{defaultValue:"Version"})}),e.jsx("p",{className:"mt-1 font-semibold text-foreground",children:((se=d.data)==null?void 0:se.version)||"unknown"})]}),e.jsxs("div",{className:"rounded-2xl border border-line/70 bg-panel/60 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:a("mieru.health",{defaultValue:"Health"})}),e.jsx("p",{className:"mt-1 font-semibold text-foreground",children:(re=(te=d.data)==null?void 0:te.health)!=null&&re.configured?(ne=(le=d.data)==null?void 0:le.health)!=null&&ne.ok?a("common.online",{defaultValue:"Online"}):a("common.offline",{defaultValue:"Offline"}):a("mieru.notConfigured",{defaultValue:"Not configured"})})]}),e.jsxs("div",{className:"rounded-2xl border border-line/70 bg-panel/60 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:a("common.status",{defaultValue:"Status"})}),e.jsx("p",{className:"mt-1 font-semibold text-foreground",children:((oe=d.data)==null?void 0:oe.state)||"unknown"})]}),e.jsxs("div",{className:"rounded-2xl border border-line/70 bg-panel/60 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:a("mieru.restartBurst",{defaultValue:"Restarts ({{minutes}}m)",minutes:qe})}),e.jsx("p",{className:"mt-1 font-semibold text-foreground",children:(ue=d.data)!=null&&ue.restartMonitor?`${d.data.restartMonitor.observedRestarts} / ${d.data.restartMonitor.threshold}`:"0 / 0"}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:(de=(ie=d.data)==null?void 0:ie.restartMonitor)!=null&&de.alerting?a("mieru.restartAlerting",{defaultValue:"Alerting"}):a("mieru.restartNormal",{defaultValue:"Normal"})})]})]})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:a("mieru.profile",{defaultValue:"Server Profile"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{label:a("mieru.serverHost",{defaultValue:"Server Host / IP"}),value:v.server,onChange:s=>{g(!0),p(t=>({...t,server:s.target.value}))},placeholder:"167.71.212.189"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(i,{type:"button",variant:"secondary",size:"sm",onClick:Pe,disabled:!f,children:a("mieru.useCurrentHost",{defaultValue:"Use current host"})}),e.jsx(i,{type:"button",variant:"secondary",size:"sm",onClick:()=>void Ie(),loading:Ne,children:a("mieru.detectPublicIp",{defaultValue:"Detect public IP"})})]})]}),e.jsx(C,{label:a("mieru.portRange",{defaultValue:"Port Range"}),value:v.portRange,onChange:s=>{g(!0),p(t=>({...t,portRange:s.target.value}))},placeholder:"2012-2022"}),e.jsxs("label",{className:"space-y-1.5",children:[e.jsx("span",{className:"ml-1 block text-sm font-medium text-muted",children:a("mieru.transport",{defaultValue:"Transport"})}),e.jsxs("select",{value:v.transport,onChange:s=>{g(!0),p(t=>({...t,transport:s.target.value}))},className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm text-foreground outline-none transition focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10",children:[e.jsx("option",{value:"TCP",children:"TCP"}),e.jsx("option",{value:"UDP",children:"UDP"})]})]}),e.jsxs("label",{className:"space-y-1.5",children:[e.jsx("span",{className:"ml-1 block text-sm font-medium text-muted",children:a("mieru.multiplexing",{defaultValue:"Multiplexing"})}),e.jsxs("select",{value:v.multiplexing,onChange:s=>{g(!0),p(t=>({...t,multiplexing:s.target.value}))},className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm text-foreground outline-none transition focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10",children:[e.jsx("option",{value:"MULTIPLEXING_DEFAULT",children:"MULTIPLEXING_DEFAULT"}),e.jsx("option",{value:"MULTIPLEXING_LOW",children:"MULTIPLEXING_LOW"}),e.jsx("option",{value:"MULTIPLEXING_MIDDLE",children:"MULTIPLEXING_MIDDLE"}),e.jsx("option",{value:"MULTIPLEXING_HIGH",children:"MULTIPLEXING_HIGH"})]})]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-muted",children:[e.jsx("input",{type:"checkbox",checked:v.udp,onChange:s=>{g(!0),p(t=>({...t,udp:s.target.checked}))},className:"h-4 w-4 rounded border-line/70 bg-card/70 text-brand-500 focus:ring-brand-500/40"}),a("mieru.udp",{defaultValue:"Enable UDP"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(i,{onClick:()=>void Ce(),loading:Q.isPending,children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),a("common.save",{defaultValue:"Save"})]}),e.jsx(i,{variant:"secondary",onClick:()=>{o.data&&(g(!1),V(!1),p({server:o.data.server||"",portRange:o.data.portRange||j.portRange,transport:o.data.transport||j.transport,udp:!!o.data.udp,multiplexing:o.data.multiplexing||j.multiplexing}))},children:a("common.reset",{defaultValue:"Reset"})})]})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:a("mieru.customUsers",{defaultValue:"Custom Mieru Users"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsx(C,{label:a("auth.username",{defaultValue:"Username"}),value:h.username,onChange:s=>w(t=>({...t,username:s.target.value})),placeholder:"mieru_user"}),e.jsx(C,{label:a("auth.password",{defaultValue:"Password"}),value:h.password,onChange:s=>w(t=>({...t,password:s.target.value})),placeholder:"strong-password"}),e.jsx(C,{type:"number",min:0,label:a("mieru.quotaDays",{defaultValue:"Quota Days"}),value:h.quotaDays,onChange:s=>w(t=>({...t,quotaDays:s.target.value})),placeholder:"30"}),e.jsx(C,{type:"number",min:0,label:a("mieru.quotaMegabytes",{defaultValue:"Quota MB"}),value:h.quotaMegabytes,onChange:s=>w(t=>({...t,quotaMegabytes:s.target.value})),placeholder:"10240"}),e.jsxs("label",{className:"space-y-1.5",children:[e.jsx("span",{className:"ml-1 block text-sm font-medium text-muted",children:a("common.status",{defaultValue:"Status"})}),e.jsxs("select",{value:h.enabled?"enabled":"disabled",onChange:s=>w(t=>({...t,enabled:s.target.value==="enabled"})),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm text-foreground outline-none transition focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10",children:[e.jsx("option",{value:"enabled",children:a("common.enabled",{defaultValue:"Enabled"})}),e.jsx("option",{value:"disabled",children:a("common.disabled",{defaultValue:"Disabled"})})]})]})]}),e.jsxs(i,{onClick:()=>void Ue(),loading:H.isPending,children:[e.jsx(ra,{className:"mr-2 h-4 w-4"}),a("mieru.addCustomUser",{defaultValue:"Add Custom User"})]})]}),e.jsx(U,{padding:!1,children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-line/70",children:[e.jsx("thead",{className:"bg-panel/40",children:e.jsxs("tr",{className:"text-left text-xs uppercase tracking-wide text-muted",children:[e.jsx("th",{className:"px-4 py-3",children:a("auth.username",{defaultValue:"Username"})}),e.jsx("th",{className:"px-4 py-3",children:a("auth.password",{defaultValue:"Password"})}),e.jsx("th",{className:"px-4 py-3",children:a("mieru.source",{defaultValue:"Source"})}),e.jsx("th",{className:"px-4 py-3",children:a("common.status",{defaultValue:"Status"})}),e.jsx("th",{className:"px-4 py-3",children:a("mieru.quotas",{defaultValue:"Quotas"})}),e.jsx("th",{className:"px-4 py-3",children:a("common.online",{defaultValue:"Online"})}),e.jsx("th",{className:"px-4 py-3",children:a("common.actions",{defaultValue:"Actions"})})]})}),e.jsx("tbody",{className:"divide-y divide-line/60",children:_.map(s=>{const t=F===s.username,x=s.source==="custom";return e.jsxs("tr",{className:"text-sm",children:[e.jsx("td",{className:"px-4 py-3",children:t?e.jsx("input",{value:b.username,onChange:l=>y(u=>({...u,username:l.target.value})),className:"w-full rounded-lg border border-line/60 bg-card/60 px-2.5 py-1.5 text-sm"}):e.jsx("span",{className:"font-medium text-foreground",children:s.username})}),e.jsx("td",{className:"px-4 py-3",children:t?e.jsx("input",{value:b.password,onChange:l=>y(u=>({...u,password:l.target.value})),className:"w-full rounded-lg border border-line/60 bg-card/60 px-2.5 py-1.5 text-sm"}):e.jsx("code",{className:"rounded bg-panel/60 px-2 py-1 text-xs text-muted",children:s.password})}),e.jsx("td",{className:"px-4 py-3 text-muted",children:s.source}),e.jsx("td",{className:"px-4 py-3",children:t?e.jsxs("select",{value:b.enabled?"enabled":"disabled",onChange:l=>y(u=>({...u,enabled:l.target.value==="enabled"})),className:"rounded-lg border border-line/60 bg-card/60 px-2 py-1 text-sm",children:[e.jsx("option",{value:"enabled",children:a("common.enabled",{defaultValue:"Enabled"})}),e.jsx("option",{value:"disabled",children:a("common.disabled",{defaultValue:"Disabled"})})]}):s.enabled?e.jsx(I,{variant:"success",children:a("common.enabled",{defaultValue:"Enabled"})}):e.jsx(I,{variant:"warning",children:a("common.disabled",{defaultValue:"Disabled"})})}),e.jsx("td",{className:"px-4 py-3",children:t?e.jsxs("div",{className:"flex min-w-[220px] items-center gap-2",children:[e.jsx("input",{value:b.quotaDays,onChange:l=>y(u=>({...u,quotaDays:l.target.value})),type:"number",min:0,placeholder:a("mieru.days",{defaultValue:"Days"}),className:"w-24 rounded-lg border border-line/60 bg-card/60 px-2.5 py-1.5 text-sm"}),e.jsx("input",{value:b.quotaMegabytes,onChange:l=>y(u=>({...u,quotaMegabytes:l.target.value})),type:"number",min:0,placeholder:a("mieru.megabytes",{defaultValue:"MB"}),className:"w-28 rounded-lg border border-line/60 bg-card/60 px-2.5 py-1.5 text-sm"})]}):e.jsx("div",{className:"text-xs text-muted",children:(()=>{var pe;const l=(pe=s.quotas)==null?void 0:pe.find(M=>Number.isInteger(M==null?void 0:M.days)||Number.isInteger(M==null?void 0:M.megabytes));if(!l)return a("common.notSet",{defaultValue:"Not set"});const u=Number.isInteger(l.days)&&(l.days??0)>=0?`${l.days}d`:"∞",Te=Number.isInteger(l.megabytes)&&(l.megabytes??0)>=0?`${l.megabytes}MB`:"∞";return`${u} / ${Te}`})()})}),e.jsx("td",{className:"px-4 py-3",children:s.online?e.jsx(I,{variant:"success",children:a("common.online",{defaultValue:"Online"})}):e.jsx(I,{variant:"warning",children:a("common.offline",{defaultValue:"Offline"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>void ke(s.username),loading:E.isPending||N.isPending,disabled:!s.configured,children:[e.jsx(ge,{className:"mr-1 h-3.5 w-3.5"}),a("mieru.regenerateCopy",{defaultValue:"Regen + Copy"})]}),e.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>void De(s.username),loading:N.isPending,disabled:!s.configured,children:[e.jsx(aa,{className:"mr-1 h-3.5 w-3.5"}),"YAML"]}),e.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>void Fe(s.username),loading:N.isPending,disabled:!s.configured,children:[e.jsx(la,{className:"mr-1 h-3.5 w-3.5"}),a("common.export",{defaultValue:"Export CSV"})]}),x?t?e.jsxs(e.Fragment,{children:[e.jsxs(i,{size:"sm",onClick:()=>void Ee(),loading:B.isPending,children:[e.jsx(be,{className:"mr-1 h-3.5 w-3.5"}),a("common.save",{defaultValue:"Save"})]}),e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>{R(null),y(P)},children:a("common.cancel",{defaultValue:"Cancel"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(i,{size:"sm",variant:"ghost",onClick:()=>Le(s),children:[e.jsx(oa,{className:"mr-1 h-3.5 w-3.5"}),a("common.edit",{defaultValue:"Edit"})]}),e.jsxs(i,{size:"sm",variant:"ghost",onClick:()=>void Se(s.username),children:[e.jsx(na,{className:"mr-1 h-3.5 w-3.5 text-red-400"}),a("common.delete",{defaultValue:"Delete"})]})]}):null]})})]},s.username)})})]}),_.length?null:e.jsx("div",{className:"px-4 py-10 text-center text-sm text-muted",children:a("mieru.noUsers",{defaultValue:"No Mieru users found yet."})})]})}),e.jsxs(U,{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:()=>je(s=>!s),className:"inline-flex items-center rounded-xl border border-line/70 px-3 py-2 text-sm font-medium text-foreground transition hover:bg-panel/60",children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),S?a("mieru.hideLogs",{defaultValue:"Hide Logs"}):a("mieru.showLogs",{defaultValue:"Show Logs"})]}),S?e.jsx("pre",{className:"max-h-80 overflow-auto rounded-2xl border border-line/70 bg-black/35 p-4 text-xs text-slate-200",children:A.isLoading?a("common.loading",{defaultValue:"Loading..."}):((ce=A.data)==null?void 0:ce.raw)||((me=A.data)==null?void 0:me.detail)||a("mieru.noLogs",{defaultValue:"No logs available."})}):null]})]})};export{Ia as MieruPage};
