function r(e,t){const a=e==null?void 0:e[t];return typeof a=="string"&&a.trim()?a.trim():null}function u(e){const t=r(e.metadata,"scriptPath")||"/opt/one-ui/scripts/update-xray-core.sh",a=r(e.metadata,"composeFilePath")||"/opt/one-ui/docker-compose.yml",o=r(e.metadata,"containerName")||"xray-core",s=r(e.metadata,"serviceName")||"xray",i=r(e.metadata,"command"),n=r(e.metadata,"lockName")||"one-ui-xray-update",c=r(e.metadata,"ownerId"),d=r(e.metadata,"expiresAt");switch(e.id){case"update-script":return[`export XRAY_UPDATE_SCRIPT=${t}`,"echo $XRAY_UPDATE_SCRIPT","Restart backend service after env changes."];case"update-script-executable":return[`chmod +x ${t}`,`ls -l ${t}`];case"compose-file":return[`export COMPOSE_FILE=${a}`,`ls -l ${a}`];case"docker-daemon":return["docker version","docker ps","sudo systemctl status docker","sudo systemctl restart docker"];case"xray-container":return[`docker ps --filter "name=^/${o}$"`,`docker compose up -d ${s}`];case"xray-version-read":return[`docker logs --tail=120 ${o}`,"sudo mkdir -p /var/log/xray && sudo touch /var/log/xray/access.log /var/log/xray/error.log /var/log/xray/output.log","sudo chown -R 65532:65532 /var/log/xray && sudo chmod 755 /var/log/xray && sudo chmod 664 /var/log/xray/*.log",`docker compose restart ${s}`,`docker exec ${o} xray version`];case"update-script-dry-run":return[i||`${t} --stable --canary --no-restart --dry-run --yes`];case"update-lock":return[c&&d?`Lock active (${n}) by ${c} until ${d}. Wait for release or investigate stuck job.`:`Inspect lock ${n} and wait for release before retrying.`,"Retry preflight after lock is released."];default:return[]}}function l(e,t){return r(e==null?void 0:e.metadata,t)}export{u as a,l as g};
