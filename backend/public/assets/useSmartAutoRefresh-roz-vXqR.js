import{r as e}from"./index-DrL1zW_A.js";function R(n,r){if(!n)return r;try{const t=JSON.parse(n);if(t&&typeof t=="object")return{...r,...t}}catch{}return r}function L(n,r){const[t,i]=e.useState(()=>typeof window>"u"?r:R(window.localStorage.getItem(n),r));e.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(n,JSON.stringify(t))},[n,t]);const c=e.useCallback(a=>{i(d=>typeof a=="function"?a(d):a)},[]),u=e.useCallback(()=>{i(r)},[r]);return e.useMemo(()=>({value:t,setValue:c,reset:u}),[u,c,t])}function C(n){const[r,t]=e.useState(()=>{if(typeof window>"u")return[];const u=R(window.localStorage.getItem(n),[]);return Array.isArray(u)?u:[]});e.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(n,JSON.stringify(r))},[n,r]);const i=e.useCallback((u,o)=>{const a=String(u||"").trim();if(!a)throw new Error("View name is required");const l={id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,name:a,filters:o,createdAt:new Date().toISOString()};return t(b=>[l,...b].slice(0,20)),l},[]),c=e.useCallback(u=>{t(o=>o.filter(a=>a.id!==u))},[]);return{views:r,saveView:i,deleteView:c}}function M(n,r={}){const{enabled:t=!0,intervalMs:i=2e4,pauseOnHidden:c=!0}=r,u=e.useRef(n);e.useEffect(()=>{u.current=n},[n]);const[o,a]=e.useState(!1),[d,l]=e.useState(null),[b,w]=e.useState(i),v=e.useRef(null),m=e.useRef(null),p=e.useRef(i),g=e.useCallback(()=>{v.current&&(window.clearInterval(v.current),v.current=null),m.current&&(window.clearInterval(m.current),m.current=null)},[]),f=e.useCallback(async()=>{await u.current();const s=Date.now();l(new Date(s).toISOString()),p.current=s+i,w(i)},[i]),S=e.useCallback(()=>!!(!t||o||c&&typeof document<"u"&&document.visibilityState!=="visible"||typeof navigator<"u"&&navigator.onLine===!1),[t,c,o]);e.useEffect(()=>(g(),t?(p.current=Date.now()+i,w(i),v.current=window.setInterval(()=>{S()||Date.now()>=p.current&&f()},500),m.current=window.setInterval(()=>{const s=Math.max(0,p.current-Date.now());w(s)},1e3),()=>{g()}):(w(i),()=>{})),[g,t,i,f,S]),e.useEffect(()=>{if(!t)return()=>{};const s=()=>{S()||f()};return window.addEventListener("focus",s),document.addEventListener("visibilitychange",s),window.addEventListener("online",s),()=>{window.removeEventListener("focus",s),document.removeEventListener("visibilitychange",s),window.removeEventListener("online",s)}},[t,f,S]);const E=e.useCallback(()=>{a(s=>!s)},[]),y=e.useMemo(()=>t?o?"paused":c&&typeof document<"u"&&document.visibilityState!=="visible"?"hidden":typeof navigator<"u"&&navigator.onLine===!1?"offline":"active":"off",[t,c,o]),h=e.useMemo(()=>({off:"Off",paused:"Paused",hidden:"Hidden",offline:"Offline",active:"Active"})[y],[y]);return{enabled:t,paused:o,status:y,statusLabel:h,lastRunAt:d,nextRunInMs:b,forceRefresh:f,togglePaused:E}}export{C as a,M as b,L as u};
