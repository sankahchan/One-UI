import{c as g,r as o,l as C,j as e,a as z,u as L,X as T,b as I,d as D,e as F,C as q,A as B,O as Q}from"./index-BBbY-zsF.js";import{a as U}from"./auth-CuiZ6JKx.js";import{u as H}from"./useXray-D6zDe8y8.js";import{p as f}from"./routePrefetch-BH_IakJu.js";import{B as X}from"./Button-278k26BX.js";import{u as A,R as G}from"./useTranslation-6XXcKgY6.js";import{apiClient as _}from"./client-BZB-O8vt.js";import{S as K}from"./search-CqY80_Xw.js";import{U as O}from"./users-BGc4G_hF.js";import{S as V}from"./server-D54Qf5jb.js";import{T as M}from"./ThemeToggle-Bj0LRYQ6.js";import{P as W}from"./plus-DZcq-GjF.js";import{L as J}from"./lock-mlcj4XWF.js";import{L as Y}from"./layers-3-DP3tIR7R.js";import{S as Z}from"./settings-BTZNIVhM.js";import"./useQuery-BjvbrY8C.js";import"./useMutation-Dc8a1YBZ.js";import"./xray-CKoq_v5l.js";import"./users-CenwKzg4.js";import"./inbounds-VyV6Q0kf.js";import"./cn-BLSKlp9E.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=g("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=g("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=g("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=g("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=g("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=g("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function ae(){const{i18n:i}=A(),[u,a]=o.useState(!1),t=o.useRef(null),b=C.find(l=>l.code===i.language)||C[0];o.useEffect(()=>{const l=m=>{t.current&&!t.current.contains(m.target)&&a(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const x=l=>{z(l),a(!1)};return e.jsxs("div",{className:"relative",ref:t,children:[e.jsxs("button",{onClick:()=>a(!u),className:"flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-gray-600 transition-colors hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700","aria-label":"Change language",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:b.nativeName})]}),u&&e.jsx("div",{className:"absolute right-0 top-full z-50 mt-1 min-w-[140px] rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-800",children:e.jsx("ul",{className:"py-1",children:C.map(l=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>x(l.code),className:`flex w-full items-center gap-2 px-4 py-2 text-left text-sm transition-colors hover:bg-gray-100 dark:hover:bg-gray-700 ${l.code===i.language?"bg-blue-50 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400":"text-gray-700 dark:text-gray-300"}`,children:[e.jsx("span",{children:l.nativeName}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",l.name,")"]})]})},l.code))})})]})}function ne(){const[i,u]=o.useState(""),[a,t]=o.useState([]),[b,x]=o.useState(!1),[l,m]=o.useState(!1),n=o.useRef(0),p=o.useRef(null),y=L();o.useEffect(()=>{const r=d=>{p.current&&!p.current.contains(d.target)&&x(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),o.useEffect(()=>{const r=new AbortController,d=n.current+1;n.current=d;const v=setTimeout(async()=>{const h=i.trim();if(h.length<2){t([]),x(!1),m(!1);return}m(!0);try{const c=await _.get("/search/quick",{params:{q:h},signal:r.signal});if(n.current!==d)return;t((c==null?void 0:c.data)||[]),x(!0)}catch(c){!((c==null?void 0:c.name)==="CanceledError"||(c==null?void 0:c.code)==="ERR_CANCELED")&&n.current===d&&t([])}finally{n.current===d&&m(!1)}},260);return()=>{r.abort(),clearTimeout(v)}},[i]);const j=r=>{r.type==="user"?y(`/users/${r.id}`):r.type==="group"?y(`/groups/${r.id}`):y("/inbounds"),u(""),x(!1)};return e.jsxs("div",{className:"relative w-full max-w-md",ref:p,children:[e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted"}),e.jsx("input",{type:"text",value:i,onChange:r=>u(r.target.value),onFocus:()=>i.trim().length>=2?x(!0):void 0,onKeyDown:r=>{r.key==="Escape"&&x(!1)},placeholder:"Search users, inbounds & groups",className:"h-10 w-full rounded-xl border border-line/80 bg-card/80 py-2 pl-10 pr-9 text-sm text-foreground placeholder:text-muted focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/30"}),i?e.jsx("button",{onClick:()=>{u(""),t([]),x(!1)},className:"absolute right-2 top-1/2 -translate-y-1/2 rounded-md p-1 text-muted transition hover:bg-card hover:text-foreground","aria-label":"Clear search",children:e.jsx(T,{className:"h-3.5 w-3.5"})}):null]}),b?e.jsx("div",{className:"absolute left-0 top-full z-50 mt-2 w-full overflow-hidden rounded-2xl border border-line/80 bg-card/95 shadow-soft backdrop-blur-xl",children:l?e.jsxs("div",{className:"flex items-center justify-center p-4 text-sm text-muted",children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-muted/35 border-t-brand-500"}),"Searching..."]}):a.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-muted",children:"No results found"}):e.jsx("ul",{className:"max-h-80 overflow-y-auto py-2",children:a.map(r=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>j(r),className:"flex w-full items-center gap-3 px-4 py-2.5 text-left transition hover:bg-card",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-xl border border-line/60 bg-panel/70",children:r.type==="user"?e.jsx(re,{className:"h-4 w-4 text-muted"}):r.type==="group"?e.jsx(O,{className:"h-4 w-4 text-muted"}):e.jsx(V,{className:"h-4 w-4 text-muted"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:r.label}),e.jsx("p",{className:"truncate text-xs text-muted",children:r.sublabel})]}),e.jsx("span",{className:"rounded-full border border-line/70 bg-panel/80 px-2 py-0.5 text-[11px] font-medium uppercase tracking-wide text-muted",children:r.type})]})},`${r.type}-${r.id}`))})}):null]})}const le=()=>{const i=L(),u=I(),[a,t]=o.useState(!1),b=async()=>{if(!a){t(!0);try{await u.invalidateQueries()}finally{window.setTimeout(()=>t(!1),550)}}};return e.jsx("div",{className:"fixed bottom-[4.75rem] right-3 z-40 lg:hidden",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-line/80 bg-card/90 p-2 shadow-soft backdrop-blur-xl",children:[e.jsx("button",{type:"button",onClick:()=>i("/inbounds?quick=create"),className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-line/70 bg-card/80 text-foreground transition hover:bg-card","aria-label":"Quick add inbound",title:"Quick add inbound",children:e.jsx($,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:b,className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-line/70 bg-card/80 text-foreground transition hover:bg-card","aria-label":"Refresh",title:"Refresh data",children:e.jsx(G,{className:`h-4 w-4 ${a?"animate-spin":""}`})}),e.jsxs("button",{type:"button",onClick:()=>i("/users?quick=create"),className:"inline-flex h-10 items-center gap-1.5 rounded-xl bg-gradient-to-r from-brand-500 to-brand-600 px-3 text-sm font-semibold text-white transition hover:brightness-110",children:[e.jsx(W,{className:"h-4 w-4"}),"Create"]})]})})},Ee=()=>{var E,R;const i=L(),u=D(),{t:a}=A(),{admin:t,logout:b,refreshToken:x}=F(),l=(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="ADMIN",m=H(l),n=m.data,p=!!((E=n==null?void 0:n.checks)!=null&&E.find(s=>s.id==="update-lock"&&!s.ok)),y=!!((R=n==null?void 0:n.checks)!=null&&R.find(s=>s.blocking&&!s.ok)),[j,r]=o.useState(!1),d=o.useCallback(s=>{i(s),r(!1)},[i]),v=l?e.jsx("button",{type:"button",onClick:()=>d("/settings?tab=system&section=xray-updates"),className:`inline-flex items-center gap-1.5 rounded-xl border px-3 py-2 text-xs font-semibold transition ${m.isLoading?"border-line/70 bg-card/70 text-muted":n!=null&&n.ready?"border-emerald-500/45 bg-emerald-500/15 text-emerald-300":p?"border-rose-500/45 bg-rose-500/15 text-rose-300":y?"border-amber-500/45 bg-amber-500/15 text-amber-300":"border-line/70 bg-card/70 text-muted"}`,title:"Xray update preflight status",children:m.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"h-2 w-2 animate-pulse rounded-full bg-muted"}),e.jsx("span",{className:"hidden md:inline",children:"Checking update health"})]}):n!=null&&n.ready?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden md:inline",children:"Update Ready"})]}):p?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden md:inline",children:"Update Locked"})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden md:inline",children:"Update Needs Fix"})]})}):null,h=o.useMemo(()=>[{path:"/dashboard",icon:ee,label:a("nav.dashboard")},{path:"/users",icon:O,label:a("nav.users")},{path:"/groups",icon:Y,label:a("nav.groups")},{path:"/inbounds",icon:$,label:a("nav.inbounds")},{path:"/settings",icon:Z,label:a("nav.settings")}],[a]);o.useEffect(()=>{const s=window.setTimeout(()=>{for(const N of h)f(N.path,{includeData:!1})},250);return()=>window.clearTimeout(s)},[h]);const c=s=>u.pathname===s||u.pathname.startsWith(`${s}/`),S=()=>{U.logout(x),b(),i("/login")};return e.jsxs("div",{className:"min-h-screen text-foreground transition-colors",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-line/70 bg-card/80 backdrop-blur-xl lg:hidden",children:e.jsxs("div",{className:"flex w-full items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(s=>!s),className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-line/70 bg-card/80 text-muted transition hover:text-foreground","aria-label":"Toggle navigation",children:j?e.jsx(T,{className:"h-5 w-5"}):e.jsx(se,{className:"h-5 w-5"})}),e.jsxs("button",{onClick:()=>d("/dashboard"),className:"rounded-lg px-1 text-left",children:[e.jsx("p",{className:"text-sm font-semibold tracking-wide text-muted",children:"ONE-UI"}),e.jsx("p",{className:"text-base font-bold text-foreground",children:"Control Center"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v,e.jsx(M,{})]})]})}),e.jsxs("div",{className:"flex min-h-screen w-full",children:[e.jsx("aside",{className:`glass-panel fixed inset-y-0 left-0 z-50 w-72 transform transition-transform duration-300 lg:sticky lg:top-0 lg:z-20 lg:h-screen lg:translate-x-0 ${j?"translate-x-0":"-translate-x-full"}`,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"border-b border-line/70 px-6 py-6",children:e.jsxs("button",{onClick:()=>d("/dashboard"),className:"text-left",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.22em] text-muted",children:"ONE-UI"}),e.jsx("h1",{className:"mt-2 text-2xl font-bold text-foreground",children:"Control Center"})]})}),e.jsx("div",{className:"border-b border-line/70 px-6 py-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-brand-500 to-brand-600 text-sm font-bold text-white shadow-soft",children:((t==null?void 0:t.username)||"A").charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:(t==null?void 0:t.username)||"Admin"}),e.jsx("p",{className:"truncate text-xs text-muted",children:(t==null?void 0:t.role)||"ADMIN"})]})]})}),e.jsx("nav",{className:"flex-1 space-y-2 overflow-y-auto px-4 py-5",children:h.map(({path:s,icon:N,label:k})=>{const w=c(s);return e.jsxs("button",{onClick:()=>d(s),onMouseEnter:()=>f(s),onFocus:()=>f(s),onTouchStart:()=>f(s),className:`group flex w-full items-center gap-3 rounded-xl px-4 py-3 text-left text-sm font-medium transition-all ${w?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-soft":"text-muted hover:bg-card hover:text-foreground"}`,children:[e.jsx(N,{className:`h-5 w-5 ${w?"text-white":"text-muted group-hover:text-foreground"}`}),e.jsx("span",{children:k})]},s)})}),e.jsx("div",{className:"border-t border-line/70 px-4 py-4",children:e.jsxs(X,{variant:"ghost",className:"w-full justify-start",onClick:S,children:[e.jsx(te,{className:"mr-3 h-5 w-5"}),a("nav.logout")]})})]})}),j?e.jsx("button",{className:"fixed inset-0 z-40 bg-black/35 backdrop-blur-sm lg:hidden",onClick:()=>r(!1),"aria-label":"Close navigation"}):null,e.jsxs("main",{className:"min-w-0 flex-1 overflow-x-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-30 hidden items-center justify-between border-b border-line/70 bg-card/75 px-6 py-4 backdrop-blur-xl lg:flex xl:px-8",children:[e.jsx(ne,{}),e.jsxs("div",{className:"flex items-center gap-3",children:[v,e.jsx(ae,{}),e.jsx(M,{}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-card/65 px-3 py-2 text-sm text-muted",children:[a("auth.welcomeBack"),", ",e.jsx("strong",{className:"text-foreground",children:t==null?void 0:t.username})]})]})]}),e.jsx("div",{className:"mobile-shell px-4 py-5 sm:px-6 lg:px-8 lg:py-8",children:e.jsx(Q,{})})]})]}),e.jsx("nav",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-line/70 bg-card/90 px-2 pb-[calc(env(safe-area-inset-bottom)+0.45rem)] pt-2 backdrop-blur-xl lg:hidden",children:e.jsx("ul",{className:`grid gap-1 ${h.length>4?"grid-cols-5":"grid-cols-4"}`,children:h.map(({path:s,icon:N,label:k})=>{const w=c(s);return e.jsx("li",{children:e.jsxs("button",{onClick:()=>d(s),onMouseEnter:()=>f(s),onFocus:()=>f(s),onTouchStart:()=>f(s),className:`flex w-full flex-col items-center justify-center rounded-xl px-2 py-2.5 text-[11px] font-medium transition-all ${w?"bg-brand-500 text-white shadow-soft":"text-muted hover:bg-card hover:text-foreground"}`,children:[e.jsx(N,{className:"mb-1 h-4 w-4"}),e.jsx("span",{className:"truncate",children:k})]})},`mobile-${s}`)})})}),e.jsx(le,{})]})};export{Ee as DashboardLayout};
