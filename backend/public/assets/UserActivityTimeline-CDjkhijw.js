import{c as p,r as x,j as e,A as v}from"./index-Mm4FQecB.js";import{C as w}from"./useToast-CQz3nkev.js";import{B as u}from"./Button-OXbbz5eU.js";import{I as l}from"./Input-BtZIH1S2.js";import{A as M}from"./useUsers-BlUVk6Rv.js";import{f as c,a as g}from"./formatters-CEEtD2TU.js";import{R as T}from"./useTranslation-DKz5Ms18.js";import{W as C}from"./wifi-BxovJW0J.js";import{A}from"./activity-CbGHQ_hd.js";import"./cn-BLSKlp9E.js";import"./useQuery-Dl3gJxFq.js";import"./useMutation-BqgM2-rT.js";import"./users-NDPCx2dd.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=p("Globe2",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=p("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=p("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),d={hours:24,eventLimit:300,ipChurnThreshold:4,reconnectThreshold:15,reconnectWindowMinutes:10,trafficSpikeFactor:3,trafficSpikeMinMb:500};function W(t){return{hours:t.hours,eventLimit:t.eventLimit,ipChurnThreshold:t.ipChurnThreshold,reconnectThreshold:t.reconnectThreshold,reconnectWindowMinutes:t.reconnectWindowMinutes,trafficSpikeFactor:t.trafficSpikeFactor,trafficSpikeMinBytes:String(Math.max(0,Math.floor(t.trafficSpikeMinMb*1024*1024)))}}function I(t){const i={low:"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",medium:"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300",high:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300",critical:"bg-fuchsia-100 text-fuchsia-700 dark:bg-fuchsia-900/40 dark:text-fuchsia-300"};return i[t]||i.low}function P(t){return t.type==="connect"?e.jsx(C,{className:"h-4 w-4 text-emerald-500"}):t.type==="disconnect"?e.jsx(L,{className:"h-4 w-4 text-rose-500"}):t.type==="alert"?e.jsx(R,{className:"h-4 w-4 text-amber-500"}):e.jsx(A,{className:"h-4 w-4 text-brand-500"})}function $(t){return t.type==="connect"?`Connect from ${t.ip||"unknown IP"}`:t.type==="disconnect"?`Disconnect from ${t.ip||"unknown IP"}`:t.type==="alert"?t.message||t.alertType||"Anomaly alert":`Traffic sample: ${c(t.total||0)}`}function F(t){return t.type==="traffic"?`Uplink ${c(t.upload||0)} • Downlink ${c(t.download||0)}`:t.type==="alert"?`${t.severity?t.severity.toUpperCase():"UNKNOWN"}${t.alertType?` • ${t.alertType}`:""}`:[t.inboundTag||null,t.inboundProtocol||null,t.inboundPort?`:${t.inboundPort}`:null].filter(Boolean).join(" ")||"Inbound information unavailable"}const J=({userId:t})=>{const[i,n]=x.useState(d),[h,f]=x.useState(d),j=x.useMemo(()=>W(h),[h]),o=M(t,j),s=o.data,m=(s==null?void 0:s.alerts)||[],b=(s==null?void 0:s.timeline)||[],y=()=>{f({...i})},N=()=>{n(d),f(d)},k=m.filter(r=>["high","critical"].includes(r.severity)).length;return e.jsx(w,{children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Activity Timeline & Alert Rules"}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:"Detect suspicious IP churn, reconnect bursts, and traffic spikes for this user."})]}),e.jsxs(u,{variant:"secondary",onClick:()=>{o.refetch()},loading:o.isFetching,children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-xl border border-line/70 bg-card/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:"Total Traffic"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:c((s==null?void 0:s.summary.trafficTotal)||0)})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-card/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:"Unique IPs"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:(s==null?void 0:s.summary.uniqueIpCount)||0})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-card/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:"Alerts"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:(s==null?void 0:s.summary.alertCount)||0})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-card/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:"Risk Score"}),e.jsx("p",{className:`mt-1 text-lg font-semibold ${k>0?"text-rose-500":"text-foreground"}`,children:(s==null?void 0:s.summary.anomalyScore)||0})]})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/45 p-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold uppercase tracking-wide text-muted",children:"Alerting Rules"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-4",children:[e.jsx(l,{label:"Window (Hours)",type:"number",min:1,max:720,value:i.hours,onChange:r=>n(a=>({...a,hours:Number(r.target.value)}))}),e.jsx(l,{label:"Timeline Events",type:"number",min:50,max:1e3,value:i.eventLimit,onChange:r=>n(a=>({...a,eventLimit:Number(r.target.value)}))}),e.jsx(l,{label:"IP Churn Threshold",type:"number",min:2,max:50,value:i.ipChurnThreshold,onChange:r=>n(a=>({...a,ipChurnThreshold:Number(r.target.value)}))}),e.jsx(l,{label:"Reconnect Threshold",type:"number",min:3,max:200,value:i.reconnectThreshold,onChange:r=>n(a=>({...a,reconnectThreshold:Number(r.target.value)}))}),e.jsx(l,{label:"Reconnect Window (Min)",type:"number",min:1,max:120,value:i.reconnectWindowMinutes,onChange:r=>n(a=>({...a,reconnectWindowMinutes:Number(r.target.value)}))}),e.jsx(l,{label:"Traffic Spike Factor",type:"number",min:1.1,max:20,step:.1,value:i.trafficSpikeFactor,onChange:r=>n(a=>({...a,trafficSpikeFactor:Number(r.target.value)}))}),e.jsx(l,{label:"Spike Min Traffic (MB)",type:"number",min:0,value:i.trafficSpikeMinMb,onChange:r=>n(a=>({...a,trafficSpikeMinMb:Number(r.target.value)}))})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx(u,{onClick:y,children:"Apply Rules"}),e.jsx(u,{variant:"secondary",onClick:N,children:"Reset"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Anomaly Alerts"}),o.isLoading?e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/50 p-4 text-sm text-muted",children:"Loading alerts..."}):m.length===0?e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/50 p-4 text-sm text-muted",children:"No active anomaly alerts in this window."}):e.jsx("div",{className:"space-y-2",children:m.map(r=>e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/55 p-3",children:e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"mt-0.5 h-4 w-4 text-amber-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:r.message}),e.jsx("p",{className:"text-xs text-muted",children:g(r.timestamp)})]})]}),e.jsx("span",{className:`rounded-full px-2 py-1 text-xs font-semibold ${I(r.severity)}`,children:r.severity.toUpperCase()})]})},r.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Timeline"}),o.isLoading?e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/50 p-4 text-sm text-muted",children:"Loading timeline..."}):b.length===0?e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/50 p-4 text-sm text-muted",children:"No activity in this window."}):e.jsx("div",{className:"max-h-[360px] space-y-2 overflow-auto pr-1",children:b.map(r=>e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/55 p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:P(r)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:$(r)}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:F(r)})]}),e.jsxs("div",{className:"text-right text-xs text-muted",children:[e.jsx(S,{className:"ml-auto h-3.5 w-3.5"}),e.jsx("span",{className:"mt-1 block whitespace-nowrap",children:g(r.timestamp)})]})]})},r.id))})]})]})})};export{J as UserActivityTimeline};
