import{c as k,u as U,f as F,r as o,j as e}from"./index-CcK4tOfC.js";import{u as M}from"./index.esm-6ooOXtNp.js";import{u as T}from"./useQuery-B_n5M2_v.js";import{B as R}from"./Button-D1Vl4E60.js";import{I as p}from"./Input-CQ9kTGid.js";import{T as P}from"./ThemeToggle-DxjkUcDO.js";import{a as d}from"./auth-1ekMgsbl.js";import{S as O}from"./shield-check-GimFvZt1.js";import{L as _}from"./lock-CZz_8qGs.js";import{A as z}from"./arrow-right-DUibZsvi.js";import"./cn-BLSKlp9E.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=k("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=k("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]),C=()=>{var w,N,v;const i=U(),{login:c}=F(),h=o.useRef(null),[S,g]=o.useState(!1),[A,b]=o.useState(!1),[f,l]=o.useState(""),[j,m]=o.useState(!1),{register:u,handleSubmit:L,formState:{errors:x}}=M(),{data:a}=T({queryKey:["login-info"],queryFn:()=>d.getLoginInfo(),staleTime:5*60*1e3}),{data:t}=T({queryKey:["telegram-oauth-config"],queryFn:()=>d.getTelegramConfig(),staleTime:5*60*1e3});o.useEffect(()=>{a!=null&&a.requireTwoFactorForSuperAdmin&&m(!0)},[a==null?void 0:a.requireTwoFactorForSuperAdmin]);const y=o.useCallback(async n=>{b(!0),l("");try{const s=await d.loginWithTelegram(n);c(s.token,s.admin,s.refreshToken),i("/dashboard")}catch(s){l((s==null?void 0:s.message)||"Telegram login failed")}finally{b(!1)}},[c,i]);o.useEffect(()=>{const n=h.current;if(!(t!=null&&t.enabled)||!t.botUsername||!n)return;const s=window;s.oneUiTelegramAuth=E=>{y(E)},n.innerHTML="";const r=document.createElement("script");return r.async=!0,r.src="https://telegram.org/js/telegram-widget.js?22",r.setAttribute("data-telegram-login",t.botUsername),r.setAttribute("data-size","large"),r.setAttribute("data-radius","10"),r.setAttribute("data-request-access","write"),r.setAttribute("data-userpic","false"),r.setAttribute("data-onauth","oneUiTelegramAuth(user)"),n.appendChild(r),()=>{n.innerHTML="",delete s.oneUiTelegramAuth}},[t==null?void 0:t.enabled,t==null?void 0:t.botUsername,y]);const q=async n=>{g(!0),l("");try{const s=await d.login(n);c(s.token,s.admin,s.refreshToken),s.requiresTwoFactorSetup?i("/settings?tab=security"):i("/dashboard")}catch(s){const r=(s==null?void 0:s.message)||"Login failed";l(r),String(r).toLowerCase().includes("two-factor")&&m(!0)}finally{g(!1)}};return e.jsxs("div",{className:"relative flex min-h-screen items-center justify-center px-4 py-8 sm:px-6",children:[e.jsx("div",{className:"absolute right-4 top-4 z-10 sm:right-6 sm:top-6",children:e.jsx(P,{})}),e.jsxs("div",{className:"grid w-full max-w-5xl overflow-hidden rounded-3xl border border-line/70 bg-card/82 shadow-[0_30px_75px_-45px_rgba(15,23,42,0.7)] backdrop-blur-2xl lg:grid-cols-[1.15fr_1fr]",children:[e.jsxs("div",{className:"relative hidden overflow-hidden border-r border-line/70 p-10 lg:block",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-500/18 via-transparent to-brand-600/18"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.22em] text-muted",children:"ONE-UI"}),e.jsx("h1",{className:"mt-4 text-4xl font-bold leading-tight text-foreground",children:"Sleek control for your network operations."}),e.jsx("p",{className:"mt-4 max-w-md text-sm leading-relaxed text-muted",children:"Manage users, subscriptions, inbounds, and system health from one responsive dashboard designed for desktop and mobile workflows."}),e.jsxs("div",{className:"mt-10 space-y-3",children:[e.jsxs("div",{className:"glass flex items-center gap-3 rounded-xl px-4 py-3",children:[e.jsx(O,{className:"h-5 w-5 text-brand-500"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"JWT-secured admin access"})]}),e.jsxs("div",{className:"glass flex items-center gap-3 rounded-xl px-4 py-3",children:[e.jsx(_,{className:"h-5 w-5 text-brand-500"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Encrypted credentials and role-based controls"})]})]})]})]}),e.jsxs("div",{className:"p-6 sm:p-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Welcome back"}),e.jsx("p",{className:"mt-2 text-sm text-muted",children:"Sign in to continue to the admin panel."})]}),e.jsxs("form",{onSubmit:L(q),className:"space-y-5",children:[a!=null&&a.requireTwoFactorForSuperAdmin?e.jsx("div",{className:"rounded-xl border border-brand-500/30 bg-brand-500/10 px-4 py-3 text-sm text-brand-600 dark:text-brand-300",children:"Two-factor authentication is required for SUPER_ADMIN accounts."}):null,f?e.jsx("div",{className:"rounded-xl border border-red-500/30 bg-red-500/10 px-4 py-3 text-sm text-red-600 dark:text-red-300",children:f}):null,e.jsx(p,{label:"Username",autoComplete:"username",placeholder:"Enter your username",...u("username",{required:"Username is required"}),error:(w=x.username)==null?void 0:w.message}),e.jsx(p,{label:"Password",type:"password",autoComplete:"current-password",placeholder:"Enter your password",...u("password",{required:"Password is required"}),error:(N=x.password)==null?void 0:N.message}),j?e.jsx(p,{label:"One-Time Password",placeholder:"Enter 6-digit code",inputMode:"numeric",autoComplete:"one-time-code",...u("otp",{minLength:{value:6,message:"OTP must be at least 6 digits"},maxLength:{value:8,message:"OTP must be at most 8 digits"}}),error:(v=x.otp)==null?void 0:v.message}):null,e.jsxs(R,{type:"submit",className:"mt-2 w-full",size:"lg",loading:S,children:[e.jsx(I,{className:"mr-2 h-5 w-5"}),"Sign In"]}),t!=null&&t.enabled?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted",children:[e.jsx("span",{className:"h-px flex-1 bg-line/80"}),e.jsx("span",{children:"or continue with Telegram"}),e.jsx("span",{className:"h-px flex-1 bg-line/80"})]}),e.jsx("div",{className:"flex min-h-[44px] items-center justify-center rounded-xl border border-line/70 bg-card/70 p-2",children:A?e.jsx("span",{className:"text-sm text-muted",children:"Signing in with Telegram..."}):e.jsx("div",{ref:h})})]}):null,j?null:e.jsx("button",{type:"button",className:"w-full text-center text-xs text-muted underline-offset-4 transition hover:text-foreground hover:underline",onClick:()=>m(!0),children:"I use 2FA"})]}),e.jsxs("div",{className:"mt-8 flex items-center justify-center gap-4 text-xs text-muted",children:[e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[e.jsx(W,{className:"h-3.5 w-3.5 text-brand-500/60"}),"Role-based access"]}),e.jsx("span",{className:"h-3 w-px bg-line/60"}),e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[e.jsx(z,{className:"h-3.5 w-3.5 text-brand-500/60"}),"Mobile-friendly panel"]})]})]})]})]})},$=C;export{C as Login,$ as LoginPage};
