import{c as S,j as e,b as K,R as M,u as W,e as X,C as z,A as _}from"./index-31dYUl1e.js";import{u as F}from"./useQuery-CtMNJR7o.js";import{apiClient as q}from"./client-ZrARDaOq.js";import{C as k,u as G}from"./useToast-DwaWtEZ4.js";import{a as Y,b as J,u as Z,c as ee}from"./useXray-SLmc-yau.js";import{f as R}from"./formatters-CEEtD2TU.js";import{B as I}from"./Badge-CYgjB4Cb.js";import{S as L}from"./Spinner-CsqCyjP9.js";import{u as A,R as D}from"./useTranslation-BcYYym0T.js";import{W as te}from"./wifi-CYR-GHod.js";import{B as P}from"./Button-B1Z0NjYb.js";import{S as se}from"./shield-check-Na0YxVTi.js";import{g as O,a as ae}from"./xrayUpdatePreflight-D6qaceO-.js";import{C as ce}from"./ConfirmDialog-DQoCmtMH.js";import{L as Q}from"./lock-CtYL_Tso.js";import{S as T}from"./settings-C7NRRecM.js";import{C as le}from"./copy-D6G2TpML.js";import{S as y}from"./Skeleton-Bgx-f_gz.js";import{U as ne}from"./users-BgUm0KHW.js";import{A as re}from"./activity-DX2mh55A.js";import"./cn-BLSKlp9E.js";import"./useMutation-ClUFm1k_.js";import"./xray-0RSqElo8.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=S("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=S("ShieldX",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m14.5 9-5 5",key:"1m49dw"}],["path",{d:"m9.5 9 5 5",key:"wyx7zg"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=S("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=S("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=S("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),xe=()=>{const{t}=A(),{data:b,isLoading:p,isError:o}=Y();if(p)return e.jsxs(k,{children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("dashboard.onlineUsers",{defaultValue:"Online Users"})})}),e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{})})]});if(o)return e.jsxs(k,{children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("dashboard.onlineUsers",{defaultValue:"Online Users"})})}),e.jsx("p",{className:"py-4 text-sm text-muted",children:t("dashboard.onlineUsersError",{defaultValue:"Unable to fetch online users"})})]});const h=(b==null?void 0:b.users)??[];return e.jsxs(k,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-emerald-500"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("dashboard.onlineUsers",{defaultValue:"Online Users"})})]}),e.jsx(I,{variant:"success",children:t("dashboard.onlineBadge",{defaultValue:"{{count}} online",count:h.length})})]}),h.length===0?e.jsx("p",{className:"py-4 text-sm text-muted",children:t("dashboard.noOnlineUsers",{defaultValue:"No users currently online"})}):e.jsx("div",{className:"space-y-3",children:h.map(g=>e.jsxs("div",{className:"flex flex-col gap-3 rounded-xl border border-line/70 bg-card/65 p-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-3",children:[e.jsx("span",{className:"h-2.5 w-2.5 shrink-0 rounded-full bg-emerald-500"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:g.email}),e.jsx("p",{className:"text-xs text-muted",children:g.protocol})]})]}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["↑ ",R(g.upload)," / ↓ ",R(g.download)]}),g.lastActivity?e.jsx("p",{className:"text-xs text-muted",children:new Date(g.lastActivity).toLocaleTimeString()}):null]})]},g.id))})]})};async function fe(){const t=await q.get("/system/health");if(!t.data)throw new Error(t.message||"Health check failed");return t.data}function pe(){return F({queryKey:["health"],queryFn:fe,refetchInterval:3e4})}const he=()=>{var U,r,i;const{t}=A(),b=K(),{data:p,isLoading:o,isError:h,isFetching:g}=pe(),{data:m}=F({queryKey:["system-health-quality"],queryFn:()=>q.get("/users/sessions",{params:{includeOffline:!0,limit:500}}),refetchInterval:15e3}),v=()=>{b.invalidateQueries({queryKey:["health"]}),b.invalidateQueries({queryKey:["system-health-quality"]})},N=(((U=m==null?void 0:m.data)==null?void 0:U.sessions)||[]).reduce((n,d)=>{var l,s,a;return n.connects+=Number(((l=d==null?void 0:d.quality)==null?void 0:l.connectSuccesses)||0),n.rejects+=Number(((s=d==null?void 0:d.quality)==null?void 0:s.limitRejects)||0),n.reconnects+=Number(((a=d==null?void 0:d.quality)==null?void 0:a.reconnects)||0),n},{connects:0,rejects:0,reconnects:0}),w=M.useMemo(()=>{var l,s;const n=new Map;for(const a of((l=m==null?void 0:m.data)==null?void 0:l.sessions)||[])for(const c of((s=a==null?void 0:a.quality)==null?void 0:s.byProtocol)||[]){const f=String((c==null?void 0:c.protocol)||"UNKNOWN").toUpperCase(),j=n.get(f)||{protocol:f,connects:0,rejects:0,reconnects:0};j.connects+=Number((c==null?void 0:c.connectSuccesses)||0),j.rejects+=Number((c==null?void 0:c.limitRejects)||0),j.reconnects+=Number((c==null?void 0:c.reconnects)||0),n.set(f,j)}const d=a=>{const c=a.connects+a.rejects,f=c>0?a.rejects/c:0,j=a.connects>0?a.reconnects/a.connects:a.reconnects;return Number((a.connects*10-a.rejects*16-a.reconnects*6-f*25-j*10).toFixed(2))};return Array.from(n.values()).map(a=>({...a,score:d(a)})).sort((a,c)=>a.score!==c.score?c.score-a.score:a.connects!==c.connects?c.connects-a.connects:a.protocol.localeCompare(c.protocol)).slice(0,3)},[(r=m==null?void 0:m.data)==null?void 0:r.sessions]),u=M.useMemo(()=>{var l,s;const n=new Map;for(const a of((l=m==null?void 0:m.data)==null?void 0:l.sessions)||[])for(const c of((s=a==null?void 0:a.quality)==null?void 0:s.byProfile)||[]){const f=Number.isInteger(Number(c==null?void 0:c.inboundId))?Number(c.inboundId):null,j=String((c==null?void 0:c.protocol)||"UNKNOWN").toUpperCase(),V=String((c==null?void 0:c.tag)||(f?`inbound-${f}`:"unknown")),C=f?`id:${f}`:`tag:${V}`,H=n.get(C)||{key:C,tag:V,protocol:j,port:Number((c==null?void 0:c.port)||0),connects:0,rejects:0,reconnects:0};H.connects+=Number((c==null?void 0:c.connectSuccesses)||0),H.rejects+=Number((c==null?void 0:c.limitRejects)||0),H.reconnects+=Number((c==null?void 0:c.reconnects)||0),n.set(C,H)}const d=a=>{const c=a.connects+a.rejects,f=c>0?a.rejects/c:0,j=a.connects>0?a.reconnects/a.connects:a.reconnects;return Number((a.connects*10-a.rejects*16-a.reconnects*6-f*25-j*10).toFixed(2))};return Array.from(n.values()).map(a=>({...a,score:d(a)})).sort((a,c)=>a.score!==c.score?c.score-a.score:a.connects!==c.connects?c.connects-a.connects:a.tag.localeCompare(c.tag)).slice(0,3)},[(i=m==null?void 0:m.data)==null?void 0:i.sessions]);return e.jsxs(k,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h?e.jsx(de,{className:"h-5 w-5 text-red-500"}):e.jsx(se,{className:"h-5 w-5 text-emerald-500"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("systemHealth.title",{defaultValue:"System Health"})})]}),o?null:h?e.jsx(I,{variant:"danger",children:t("systemHealth.unreachable",{defaultValue:"Unreachable"})}):e.jsx(I,{variant:"success",children:t("systemHealth.healthy",{defaultValue:"Healthy"})})]}),o?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{})}):h?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted",children:t("systemHealth.errorBody",{defaultValue:"Could not reach backend health endpoint. Confirm `backend` is running on port `3000`."})}),e.jsxs(P,{type:"button",size:"sm",variant:"secondary",onClick:v,loading:g,children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),t("systemHealth.retry",{defaultValue:"Retry Health Check"})]})]}):e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted",children:t("common.status",{defaultValue:"Status"})}),e.jsx("span",{className:"font-semibold capitalize text-foreground",children:(p==null?void 0:p.status)||"ok"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted",children:t("systemHealth.lastCheck",{defaultValue:"Last Check"})}),e.jsx("span",{className:"font-medium text-foreground",children:p!=null&&p.timestamp?new Date(p.timestamp).toLocaleString():"N/A"})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(P,{type:"button",size:"sm",variant:"secondary",onClick:v,loading:g,children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),t("common.refresh",{defaultValue:"Refresh"})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-2 rounded-xl border border-line/70 bg-panel/45 p-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted",children:t("dashboard.quality.connectSuccess60m",{defaultValue:"Connect Success (60m)"})}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:N.connects})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted",children:t("dashboard.quality.limitRejects60m",{defaultValue:"Limit Rejects (60m)"})}),e.jsx("p",{className:"text-sm font-semibold text-rose-400",children:N.rejects})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted",children:t("dashboard.quality.reconnects60m",{defaultValue:"Reconnects (60m)"})}),e.jsx("p",{className:"text-sm font-semibold text-amber-300",children:N.reconnects})]})]}),e.jsxs("div",{className:"mt-3 space-y-2 text-xs",children:[e.jsx("p",{className:"uppercase tracking-wide text-muted",children:t("dashboard.topProtocolQuality.title",{defaultValue:"Top Protocol Quality (60m)"})}),w.length===0?e.jsx("p",{className:"text-muted",children:t("dashboard.topProtocolQuality.empty",{defaultValue:"No protocol quality data yet."})}):w.map(n=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-line/70 bg-panel/35 px-2.5 py-1.5",children:[e.jsx("p",{className:"font-medium text-foreground",children:n.protocol}),e.jsxs("p",{className:"text-muted",children:["C ",n.connects," / R ",n.rejects," / Re ",n.reconnects,e.jsx("span",{className:`ml-2 font-semibold ${n.score>=0?"text-emerald-300":"text-rose-300"}`,children:n.score})]})]},n.protocol))]}),e.jsxs("div",{className:"mt-3 space-y-2 text-xs",children:[e.jsx("p",{className:"uppercase tracking-wide text-muted",children:t("dashboard.topInboundProfiles.title",{defaultValue:"Top Inbound Profiles (60m)"})}),u.length===0?e.jsx("p",{className:"text-muted",children:t("dashboard.topInboundProfiles.empty",{defaultValue:"No inbound profile telemetry yet."})}):u.map(n=>e.jsxs("div",{className:"rounded-lg border border-line/70 bg-panel/35 px-2.5 py-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"font-medium text-foreground",children:[n.protocol," ",n.port?`:${n.port}`:""]}),e.jsx("span",{className:`font-semibold ${n.score>=0?"text-emerald-300":"text-rose-300"}`,children:n.score})]}),e.jsx("p",{className:"truncate text-muted",title:n.tag,children:n.tag}),e.jsxs("p",{className:"text-muted",children:["C ",n.connects," / R ",n.rejects," / Re ",n.reconnects]})]},n.key))]})]})]})},je=()=>{const{t}=A(),b=W(),p=G(),o=X(x=>x.admin),h=(o==null?void 0:o.role)==="SUPER_ADMIN"||(o==null?void 0:o.role)==="ADMIN",g=(o==null?void 0:o.role)==="SUPER_ADMIN",m=J(),v=Z(h),N=m.data,w=ee(),u=v.data,U=(N==null?void 0:N.mode)||(u==null?void 0:u.mode)||"docker",r=(N==null?void 0:N.updatesEnabled)??(u==null?void 0:u.updatesEnabled)??!0,i=((u==null?void 0:u.checks)||[]).filter(x=>!x.ok),n=i.some(x=>x.blocking),d=i.find(x=>x.id==="update-lock"),l=g&&!!d,s=O(d,"expiresAt"),a=O(d,"ownerId"),[c,f]=M.useState(!1),j=u!=null&&u.generatedAt?new Date(u.generatedAt).getTime():Number.NaN,V=s&&Number.isFinite(j)?new Date(s).getTime()<=j:!1,C=Array.from(new Set(i.flatMap(x=>ae(x)).filter(x=>x.trim().length>0))),H=async()=>{if(!C.length)return;const x=["# One-UI Xray Update Preflight Fixes",...C.map(E=>`- ${E}`)].join(`
`);try{await navigator.clipboard.writeText(x),p.success(t("updateHealth.toast.copiedTitle",{defaultValue:"Copied to clipboard"}),t("updateHealth.toast.copiedBody",{defaultValue:"Preflight fix commands copied."}))}catch{p.error(t("updateHealth.toast.copyFailedTitle",{defaultValue:"Copy failed"}),t("updateHealth.toast.copyFailedBody",{defaultValue:"Failed to copy preflight fix commands."}))}},B=async()=>{if(l)try{const x=await w.mutateAsync({reason:"manual-force-unlock-from-dashboard",force:!V});p.success(t("updateHealth.toast.unlockCompleteTitle",{defaultValue:"Unlock complete"}),x.message||(x.unlocked?t("updateHealth.toast.unlockReleasedBody",{defaultValue:"Update lock released."}):t("updateHealth.toast.unlockNotReleasedBody",{defaultValue:"Update lock not released."}))),f(!1),await v.refetch()}catch(x){p.error(t("updateHealth.toast.unlockFailedTitle",{defaultValue:"Unlock failed"}),(x==null?void 0:x.message)||t("updateHealth.toast.unlockFailedBody",{defaultValue:"Failed to unlock update lock."}))}},$=a&&s?t("updateHealth.unlockConfirm.withOwner",{defaultValue:"Force unlock active update lock owned by {{owner}} (expires {{expiresAt}})?",owner:a,expiresAt:new Date(s).toLocaleString()}):t("updateHealth.unlockConfirm.default",{defaultValue:"Force unlock the active Xray update lock?"});return e.jsxs(k,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("updateHealth.title",{defaultValue:"Update Health"})}),v.isLoading||h&&m.isLoading?e.jsx("span",{className:"inline-flex items-center rounded-full bg-card px-2.5 py-1 text-xs font-semibold text-muted",children:t("updateHealth.checking",{defaultValue:"Checking..."})}):h?r?u!=null&&u.ready?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-500/15 px-2.5 py-1 text-xs font-semibold text-emerald-300",children:[e.jsx(z,{className:"h-3.5 w-3.5"}),t("updateHealth.ready",{defaultValue:"Ready"})]}):d?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-rose-500/15 px-2.5 py-1 text-xs font-semibold text-rose-300",children:[e.jsx(Q,{className:"h-3.5 w-3.5"}),t("updateHealth.locked",{defaultValue:"Locked"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-amber-500/15 px-2.5 py-1 text-xs font-semibold text-amber-300",children:[e.jsx(_,{className:"h-3.5 w-3.5"}),t("updateHealth.needsFix",{defaultValue:"Needs Fix"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-sky-500/15 px-2.5 py-1 text-xs font-semibold text-sky-300",children:[e.jsx(T,{className:"h-3.5 w-3.5"}),t("updateHealth.manualMode",{defaultValue:"Manual Mode"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-card px-2.5 py-1 text-xs font-semibold text-muted",children:[e.jsx(Q,{className:"h-3.5 w-3.5"}),t("updateHealth.restricted",{defaultValue:"Restricted"})]})]}),v.isLoading||h&&m.isLoading?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{})}):h?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted",children:r?u!=null&&u.ready?t("updateHealth.body.ready",{defaultValue:"All required checks passed. You can run canary/full rollout safely."}):d?t("updateHealth.body.locked",{defaultValue:"Xray update lock is active. Resolve lock state before running updates."}):n?t("updateHealth.body.blockingFailure",{defaultValue:"One or more required checks are failing. Apply fixes before rollout."}):t("updateHealth.body.reviewWarnings",{defaultValue:"Review warnings before rollout."}):t("updateHealth.body.scriptedDisabled",{defaultValue:"Runtime mode is {{mode}}. Scripted container update actions are disabled.",mode:U})}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-2 sm:grid-cols-2",children:[e.jsxs(P,{type:"button",variant:"secondary",onClick:()=>{v.refetch()},loading:v.isFetching,children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),t("updateHealth.runPreflight",{defaultValue:"Run Preflight"})]}),e.jsxs(P,{type:"button",variant:"secondary",onClick:()=>{H()},disabled:C.length===0,children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),t("updateHealth.copyFixes",{defaultValue:"Copy Fixes"})]}),e.jsxs(P,{type:"button",variant:"danger",onClick:()=>{f(!0)},loading:w.isPending,disabled:!l,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),t("updateHealth.forceUnlock",{defaultValue:"Force Unlock"})]}),e.jsxs(P,{type:"button",variant:"ghost",onClick:()=>b("/settings?tab=system&section=xray-updates"),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),t("updateHealth.openUpdates",{defaultValue:"Open Updates"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted",children:t("updateHealth.body.restricted",{defaultValue:"Update tooling is available for ADMIN and SUPER_ADMIN roles."})}),e.jsx("div",{className:"mt-4",children:e.jsxs(P,{type:"button",variant:"ghost",onClick:()=>b("/settings?tab=system&section=xray-updates"),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),t("updateHealth.openSettings",{defaultValue:"Open Settings"})]})})]}),e.jsx(ce,{open:c,title:t("updateHealth.unlockTitle",{defaultValue:"Force Unlock Update Lock"}),description:$,confirmLabel:t("updateHealth.forceUnlock",{defaultValue:"Force Unlock"}),tone:"danger",loading:w.isPending,onCancel:()=>{w.isPending||f(!1)},onConfirm:()=>{B()}})]})},ge=()=>{var w,u,U;const{t}=A(),{data:b,isLoading:p}=F({queryKey:["system-stats"],queryFn:()=>q.get("/users/stats")}),{data:o}=F({queryKey:["dashboard-session-quality"],queryFn:()=>q.get("/users/sessions",{params:{includeOffline:!0,limit:500}}),refetchInterval:15e3}),h=(b==null?void 0:b.data)||{total:0,active:0,expired:0,totalTraffic:0},g=[{key:"total-users",icon:ne,label:t("dashboard.totalUsers"),value:h.total,tone:"from-brand-500/15 to-brand-600/5 text-brand-500"},{key:"active-users",icon:re,label:t("dashboard.activeUsers"),value:h.active,tone:"from-emerald-500/15 to-emerald-500/5 text-emerald-500"},{key:"total-traffic",icon:oe,label:t("dashboard.totalTraffic"),value:R(h.totalTraffic),tone:"from-violet-500/15 to-violet-500/5 text-violet-500"},{key:"expired-users",icon:ie,label:t("dashboard.expiredUsers"),value:h.expired,tone:"from-rose-500/15 to-rose-500/5 text-rose-500"}],m=(((w=o==null?void 0:o.data)==null?void 0:w.sessions)||[]).reduce((r,i)=>{var n,d,l,s;return r.connects+=Number(((n=i==null?void 0:i.quality)==null?void 0:n.connectSuccesses)||0),r.rejects+=Number(((d=i==null?void 0:i.quality)==null?void 0:d.limitRejects)||0),r.reconnects+=Number(((l=i==null?void 0:i.quality)==null?void 0:l.reconnects)||0),r.trafficPerMinute+=Number(((s=i==null?void 0:i.quality)==null?void 0:s.avgTrafficPerMinute)||0),r},{connects:0,rejects:0,reconnects:0,trafficPerMinute:0}),v=M.useMemo(()=>{var n,d;const r=new Map;for(const l of((n=o==null?void 0:o.data)==null?void 0:n.sessions)||[])for(const s of((d=l==null?void 0:l.quality)==null?void 0:d.byProtocol)||[]){const a=String((s==null?void 0:s.protocol)||"UNKNOWN").toUpperCase(),c=r.get(a)||{protocol:a,connects:0,rejects:0,reconnects:0,trafficPerMinute:0};c.connects+=Number((s==null?void 0:s.connectSuccesses)||0),c.rejects+=Number((s==null?void 0:s.limitRejects)||0),c.reconnects+=Number((s==null?void 0:s.reconnects)||0),c.trafficPerMinute+=Number((s==null?void 0:s.avgTrafficPerMinute)||0),r.set(a,c)}const i=l=>{const s=l.connects+l.rejects,a=s>0?l.rejects/s:0,c=l.connects>0?l.reconnects/l.connects:l.reconnects;return Number((l.connects*10-l.rejects*16-l.reconnects*6-a*25-c*10).toFixed(2))};return Array.from(r.values()).map(l=>({...l,score:i(l)})).sort((l,s)=>l.score!==s.score?s.score-l.score:l.connects!==s.connects?s.connects-l.connects:l.protocol.localeCompare(s.protocol)).slice(0,4)},[(u=o==null?void 0:o.data)==null?void 0:u.sessions]),N=M.useMemo(()=>{var n,d;const r=new Map;for(const l of((n=o==null?void 0:o.data)==null?void 0:n.sessions)||[])for(const s of((d=l==null?void 0:l.quality)==null?void 0:d.byProfile)||[]){const a=Number.isInteger(Number(s==null?void 0:s.inboundId))?Number(s.inboundId):null,c=String((s==null?void 0:s.protocol)||"UNKNOWN").toUpperCase(),f=String((s==null?void 0:s.tag)||(a?`inbound-${a}`:"unknown")),j=a?`id:${a}`:`tag:${f}`,V=r.get(j)||{key:j,inboundId:a,tag:f,protocol:c,port:Number((s==null?void 0:s.port)||0),connects:0,rejects:0,reconnects:0,trafficPerMinute:0};V.connects+=Number((s==null?void 0:s.connectSuccesses)||0),V.rejects+=Number((s==null?void 0:s.limitRejects)||0),V.reconnects+=Number((s==null?void 0:s.reconnects)||0),V.trafficPerMinute+=Number((s==null?void 0:s.avgTrafficPerMinute)||0),r.set(j,V)}const i=l=>{const s=l.connects+l.rejects,a=s>0?l.rejects/s:0,c=l.connects>0?l.reconnects/l.connects:l.reconnects;return Number((l.connects*10-l.rejects*16-l.reconnects*6-a*25-c*10).toFixed(2))};return Array.from(r.values()).map(l=>({...l,score:i(l)})).sort((l,s)=>l.score!==s.score?s.score-l.score:l.connects!==s.connects?s.connects-l.connects:l.tag.localeCompare(s.tag)).slice(0,6)},[(U=o==null?void 0:o.data)==null?void 0:U.sessions]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap items-end justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:t("dashboard.title")}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("dashboard.tagline",{defaultValue:"Realtime overview of your users, usage, and service status."})})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4",children:p?Array.from({length:4}).map((r,i)=>e.jsx(k,{className:"relative overflow-hidden",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{className:"h-3 w-24"}),e.jsx(y,{className:"h-7 w-16"})]}),e.jsx(y,{className:"h-10 w-10 rounded-xl"})]})},i)):g.map(({key:r,icon:i,label:n,value:d,tone:l})=>e.jsxs(k,{className:"relative overflow-hidden",children:[e.jsx("div",{className:`pointer-events-none absolute inset-0 bg-gradient-to-br ${l} opacity-90`}),e.jsxs("div",{className:"relative flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted",children:n}),e.jsx("p",{className:"mt-2 text-2xl font-bold text-foreground",children:d})]}),e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/70 p-2.5",children:e.jsx(i,{className:"h-5 w-5 text-foreground"})})]})]},r))}),e.jsxs(k,{className:"relative overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-r from-brand-500/10 via-emerald-500/5 to-transparent"}),e.jsxs("div",{className:"relative grid grid-cols-1 gap-3 text-sm sm:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("dashboard.quality.connectSuccess60m",{defaultValue:"Connect Success (60m)"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:m.connects})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("dashboard.quality.limitRejects60m",{defaultValue:"Limit Rejects (60m)"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-rose-400",children:m.rejects})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("dashboard.quality.reconnects60m",{defaultValue:"Reconnects (60m)"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-amber-300",children:m.reconnects})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("dashboard.quality.avgTrafficPerMin",{defaultValue:"Avg Traffic / Min"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-emerald-400",children:R(m.trafficPerMinute)})]})]})]}),e.jsxs(k,{className:"relative overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-r from-violet-500/10 via-brand-500/5 to-transparent"}),e.jsxs("div",{className:"relative",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted",children:t("dashboard.topProtocolQuality.title",{defaultValue:"Top Protocol Quality (60m)"})}),v.length===0?e.jsx("p",{className:"mt-3 text-sm text-muted",children:t("dashboard.topProtocolQuality.empty",{defaultValue:"No protocol quality data yet."})}):e.jsx("div",{className:"mt-3 grid grid-cols-1 gap-2 sm:grid-cols-2 xl:grid-cols-4",children:v.map(r=>e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/45 p-3 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"font-semibold text-foreground",children:r.protocol}),e.jsx("span",{className:`rounded-full px-2 py-0.5 font-semibold ${r.score>=0?"bg-emerald-500/15 text-emerald-300":"bg-rose-500/15 text-rose-300"}`,children:r.score})]}),e.jsx("p",{className:"mt-2 text-muted",children:t("dashboard.quality.row",{defaultValue:"Connect {{connects}} • Reject {{rejects}} • Reconnect {{reconnects}}",connects:r.connects,rejects:r.rejects,reconnects:r.reconnects})}),e.jsx("p",{className:"mt-1 text-muted",children:t("dashboard.quality.trafficPerMin",{defaultValue:"Traffic/min {{traffic}}",traffic:R(r.trafficPerMinute)})})]},r.protocol))})]})]}),e.jsxs(k,{className:"relative overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-r from-cyan-500/10 via-brand-500/5 to-transparent"}),e.jsxs("div",{className:"relative",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted",children:t("dashboard.topInboundProfiles.title",{defaultValue:"Top Inbound Profiles (60m)"})}),N.length===0?e.jsx("p",{className:"mt-3 text-sm text-muted",children:t("dashboard.topInboundProfiles.empty",{defaultValue:"No inbound profile telemetry yet."})}):e.jsx("div",{className:"mt-3 grid grid-cols-1 gap-2 sm:grid-cols-2 xl:grid-cols-3",children:N.map(r=>e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/45 p-3 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"font-semibold text-foreground",children:[r.protocol," • ",r.port||"-"]}),e.jsx("span",{className:`rounded-full px-2 py-0.5 font-semibold ${r.score>=0?"bg-emerald-500/15 text-emerald-300":"bg-rose-500/15 text-rose-300"}`,children:r.score})]}),e.jsx("p",{className:"mt-1 truncate text-muted",title:r.tag,children:r.tag}),e.jsx("p",{className:"mt-2 text-muted",children:t("dashboard.quality.row",{defaultValue:"Connect {{connects}} • Reject {{rejects}} • Reconnect {{reconnects}}",connects:r.connects,rejects:r.rejects,reconnects:r.reconnects})}),e.jsx("p",{className:"mt-1 text-muted",children:t("dashboard.quality.trafficPerMin",{defaultValue:"Traffic/min {{traffic}}",traffic:R(r.trafficPerMinute)})})]},r.key))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-3",children:[e.jsx(je,{}),p?e.jsxs(k,{children:[e.jsx(y,{className:"mb-4 h-5 w-40"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{className:"h-4 w-full"}),e.jsx(y,{className:"h-4 w-3/4"}),e.jsx(y,{className:"h-4 w-5/6"}),e.jsx(y,{className:"h-32 w-full"})]})]}):e.jsx(he,{}),p?e.jsxs(k,{children:[e.jsx(y,{className:"mb-4 h-5 w-32"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{className:"h-4 w-full"}),e.jsx(y,{className:"h-4 w-2/3"}),e.jsx(y,{className:"h-4 w-4/5"}),e.jsx(y,{className:"h-32 w-full"})]})]}):e.jsx(xe,{})]})]})},Be=ge;export{ge as Dashboard,Be as DashboardPage};
