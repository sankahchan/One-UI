import{c as G,r as c,j as e,b as K}from"./index-Mm4FQecB.js";import{u as V}from"./useQuery-Dl3gJxFq.js";import{Q as N}from"./index-DQBcqvLC.js";import{u as F,C as j}from"./useToast-CQz3nkev.js";import{d as $,r as W,b as H}from"./subscriptionApps-BkFFy6rX.js";import{C as b,c as J}from"./clipboard-CARLoSHl.js";import{S as T,o as X}from"./deepLink-DWWOqhHF.js";import{B as i}from"./Button-OXbbz5eU.js";import{C as w}from"./MyanmarPriorityPreviewModal-CScVE8oN.js";import{E as A}from"./external-link-BW6XFdUK.js";import{D as Y}from"./download-Dni7SBkV.js";import{Q as Z}from"./qr-code-CbLRIxQC.js";import{C as ee}from"./chevron-up-CQ5TAI5w.js";import{C as se}from"./chevron-down-BbHQv_G3.js";import"./cn-BLSKlp9E.js";import"./index.esm-BAmWvLKz.js";import"./useGroups-DDATsIs8.js";import"./inbounds-kGLu76Pi.js";import"./useMutation-BqgM2-rT.js";import"./users-NDPCx2dd.js";import"./useUsers-BlUVk6Rv.js";import"./Input-BtZIH1S2.js";import"./useTranslation-DKz5Ms18.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=G("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),E=[{key:"v2ray",label:"V2RayNG",colorClass:"bg-blue-500 text-white"},{key:"clash",label:"Clash",colorClass:"bg-indigo-500 text-white"},{key:"shadowrocket",label:"Shadowrocket",colorClass:"bg-orange-500 text-white"},{key:"singbox",label:"Sing-box",colorClass:"bg-emerald-500 text-white"}],te={VLESS:"bg-blue-500/15 text-blue-400",VMESS:"bg-indigo-500/15 text-indigo-400",TROJAN:"bg-amber-500/15 text-amber-400",SHADOWSOCKS:"bg-purple-500/15 text-purple-400"},le=t=>te[t.toUpperCase()]||"bg-zinc-500/15 text-zinc-400",oe=(t,n)=>{if(!n)return null;switch(t){case"v2ray":return`v2rayng://install-sub?url=${encodeURIComponent(n)}`;case"clash":return`clash://install-config?url=${encodeURIComponent(n)}`;case"shadowrocket":return n;default:return null}},Q=(t,n)=>{const l=t.urls;return l?n==="shadowrocket"?l.v2ray||"":l[n]||"":""},Re=({userId:t})=>{var S,L,U,O;const n=F(),[l,p]=c.useState("v2ray"),[d,x]=c.useState(""),[D,M]=c.useState(new Set),[P,z]=c.useState(!1),[v,y]=c.useState(()=>$()),{data:r,isLoading:I}=V({queryKey:["subscription-info",t],queryFn:async()=>{const s=await K.get("/users/"+t+"/subscription");return s==null?void 0:s.data},enabled:Number.isInteger(t)&&t>0});c.useEffect(()=>{y($())},[]);const h=c.useMemo(()=>r!=null&&r.urls?E.filter(({key:s})=>s==="shadowrocket"?!!r.urls.v2ray:!!r.urls[s]):[],[r]);c.useEffect(()=>{if(!(r!=null&&r.urls))return;!Q(r,l)&&h.length>0&&p(h[0].key)},[h,l,r]);const u=async(s,a)=>{if(!await J(s)){n.error("Error","Copy failed. Please copy manually.");return}x(a),setTimeout(()=>x(""),1600),n.success("Copied","Link copied to clipboard.")},B=s=>{M(a=>{const o=new Set(a);return o.has(s)?o.delete(s):o.add(s),o})},_=()=>{var R;if(!((R=r==null?void 0:r.links)!=null&&R.length))return;const s=r.links.map(g=>`# ${g.remark} [${g.protocol}]
${g.url}`).join(`

`),a=new Blob([s],{type:"text/plain"}),o=URL.createObjectURL(a),f=document.createElement("a");f.href=o,f.download="protocol-links.txt",f.click(),URL.revokeObjectURL(o)},q=(S=r==null?void 0:r.branding)==null?void 0:S.metadata,k=r!=null&&r.urls?W({platform:v,urls:r.urls,metadata:q}):[];if(I)return e.jsxs(j,{children:[e.jsx("h2",{className:"mb-4 text-xl font-bold text-foreground",children:"Protocol Links"}),e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-line/70 border-t-brand-500"})})]});if(!r)return null;if(!((L=r.links)!=null&&L.length)&&!r.urls)return e.jsxs(j,{children:[e.jsx("h2",{className:"mb-4 text-xl font-bold text-foreground",children:"Subscription Link Generator"}),e.jsx("p",{className:"text-sm text-muted",children:"No subscription data available for this user."})]});const m=Q(r,l),C=oe(l,m);return e.jsxs(j,{children:[e.jsx("h2",{className:"mb-4 text-xl font-bold text-foreground",children:"Subscription Link Generator"}),e.jsx("div",{className:"mb-6 flex flex-wrap gap-2",children:h.map(({key:s,label:a,colorClass:o})=>e.jsx("button",{onClick:()=>p(s),className:`rounded-xl px-3 py-2 text-sm font-medium transition sm:px-4 ${l===s?o:"border border-line/70 bg-card/70 text-muted hover:text-foreground"}`,children:a},s))}),m&&e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-2xl border border-line/70 bg-panel/55 p-5",children:[e.jsx("div",{className:"rounded-2xl border border-line/70 bg-white p-4",children:m?e.jsx(N,{value:m,size:200,level:"M",includeMargin:!1}):e.jsx("div",{className:"flex h-[200px] w-[200px] items-center justify-center text-sm text-muted",children:"No URL"})}),e.jsxs("p",{className:"mt-4 text-center text-sm text-muted",children:["Scan with ",(U=E.find(s=>s.key===l))==null?void 0:U.label]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Subscription URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:m,onClick:s=>{s.target.select(),u(m,`sub-${l}`)},className:"flex-1 cursor-pointer select-all rounded-xl border border-line/80 bg-card/80 px-3 py-2 font-mono text-xs text-foreground sm:text-sm"}),e.jsx(i,{variant:"secondary",onClick:()=>{u(m,`sub-${l}`)},children:d===`sub-${l}`?e.jsx(w,{className:"h-4 w-4 text-emerald-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]}),C&&e.jsxs(i,{variant:"secondary",className:"w-full",onClick:()=>window.open(C,"_blank","noopener,noreferrer"),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"One-Click Import"]}),k.length>0?e.jsxs("details",{className:"rounded-2xl border border-line/70 bg-panel/55 p-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-foreground",children:"Add to app (platform)"}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:["android","ios","windows"].map(s=>e.jsxs("button",{onClick:()=>y(s),className:`rounded-xl px-3 py-2 text-sm font-semibold transition ${v===s?"bg-brand-500 text-white shadow-soft":"border border-line/70 bg-card/70 text-muted hover:text-foreground"}`,children:[s==="android"?"Android":null,s==="ios"?"iOS":null,s==="windows"?"Desktop":null]},s))}),e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2",children:k.map(s=>{const a=`app-${s.id}`,o=H({appId:s.id,importUrl:s.importUrl,manualUrl:s.manualUrl});return e.jsxs("div",{className:"rounded-2xl border border-line/70 bg-card/65 p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl border border-line/70 bg-panel text-xl",children:s.icon}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s.name}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:s.description})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2",children:[s.importUrl?e.jsxs(i,{className:"w-full",onClick:()=>{X(o)},children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"One-Click"]}):e.jsxs(i,{variant:"secondary",className:"w-full",onClick:()=>{u(s.manualUrl,`manual-${s.id}`)},children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Copy URL"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"ghost",className:"flex-1 justify-center",onClick:()=>{u(s.manualUrl,a)},children:[d===a?e.jsx(w,{className:"mr-2 h-4 w-4 text-emerald-500"}):e.jsx(b,{className:"mr-2 h-4 w-4"}),d===a?"Copied":"Copy"]}),e.jsx(i,{variant:"ghost",onClick:()=>{s.storeLink&&window.open(s.storeLink,"_blank","noopener,noreferrer")},disabled:!s.storeLink,"aria-label":"Open app download page",children:e.jsx(A,{className:"h-4 w-4"})})]})]})]},s.id)})})]}):null]})]}),r.links&&r.links.length>0&&e.jsxs("div",{className:"mb-4 border-t border-line/70 pt-6",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-foreground",children:"Individual Protocol Links"}),e.jsx("div",{className:"space-y-3",children:r.links.map(s=>e.jsx(ne,{link:s,expanded:D.has(s.inboundId),copied:d,onToggleQr:()=>B(s.inboundId),onCopy:(a,o)=>{u(a,o)}},s.inboundId))})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 border-t border-line/70 pt-4",children:[e.jsxs(i,{variant:"secondary",onClick:_,disabled:!((O=r.links)!=null&&O.length),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Download All Links"]}),r.shareUrl&&e.jsxs(i,{variant:"secondary",onClick:()=>{u(r.shareUrl,"share"),z(s=>!s)},children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),d==="share"?"Copied":"Share"]})]}),P&&r.shareUrl&&e.jsxs("div",{className:"mt-4 flex flex-col items-center rounded-2xl border border-line/70 bg-panel/55 p-5",children:[e.jsx("div",{className:"rounded-2xl border border-line/70 bg-white p-4",children:e.jsx(N,{value:r.shareUrl,size:180,level:"M",includeMargin:!1})}),e.jsx("p",{className:"mt-3 text-center text-sm text-muted",children:"Scan to open share page"}),e.jsx("p",{className:"mt-1 break-all text-center font-mono text-xs text-muted",children:r.shareUrl})]})]})},ne=({link:t,expanded:n,copied:l,onToggleQr:p,onCopy:d})=>{const x=`link-${t.inboundId}`;return e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`rounded-lg px-2.5 py-1 text-xs font-semibold ${le(t.protocol)}`,children:t.protocol}),e.jsx("span",{className:"flex-1 truncate text-sm font-medium text-foreground",children:t.remark}),e.jsxs("span",{className:"text-xs text-muted",children:[t.network," / ",t.security]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>d(t.url,x),children:[l===x?e.jsx(w,{className:"mr-1.5 h-3.5 w-3.5 text-emerald-500"}):e.jsx(b,{className:"mr-1.5 h-3.5 w-3.5"}),l===x?"Copied":"Copy"]}),e.jsxs(i,{size:"sm",variant:"ghost",onClick:p,children:[e.jsx(Z,{className:"mr-1.5 h-3.5 w-3.5"}),"QR",n?e.jsx(ee,{className:"ml-1 h-3.5 w-3.5"}):e.jsx(se,{className:"ml-1 h-3.5 w-3.5"})]}),e.jsxs(i,{size:"sm",variant:"ghost",onClick:()=>window.open(t.url,"_blank","noopener,noreferrer"),children:[e.jsx(A,{className:"mr-1.5 h-3.5 w-3.5"}),"Open"]})]}),n&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"rounded-xl border border-line/70 bg-white p-3",children:e.jsx(N,{value:t.url,size:180,level:"M",includeMargin:!1})})})]})};export{Re as SubscriptionLinksPanel};
