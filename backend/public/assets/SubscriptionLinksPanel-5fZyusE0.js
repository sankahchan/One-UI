import{c as q,r as c,j as e}from"./index-4Z_ADcz-.js";import{u as G}from"./useQuery-gRsyD88e.js";import{Q as w}from"./index-CRt7-nX-.js";import{apiClient as K}from"./client-CSi9HbAr.js";import{d as $,r as V}from"./subscriptionApps-DtH1h3Op.js";import{B as a}from"./Button-O3SqeR70.js";import{C as j}from"./useToast-CdNAe9X_.js";import{C as N}from"./MyanmarPriorityPreviewModal-BuK7Kqrr.js";import{C as b}from"./copy-vLPk0au-.js";import{S as Q}from"./smartphone-BwcYy7ZL.js";import{E as A}from"./external-link-Bos5Xh-m.js";import{D as F}from"./download-KXj8IBPk.js";import{Q as H}from"./qr-code-DUxn4pSc.js";import{C as J}from"./chevron-up-BhGpwuhi.js";import{C as W}from"./chevron-down-B4xFnGu_.js";import"./cn-BLSKlp9E.js";import"./index.esm-DeTgqkeM.js";import"./useGroups-DQ1RQ18m.js";import"./inbounds-BCv4m568.js";import"./useMutation-hs9vH3uM.js";import"./users-Be35gZk0.js";import"./useUsers-DLW3FWGw.js";import"./Input-DUHma6SA.js";import"./useTranslation-GDJgXote.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=q("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),E=[{key:"v2ray",label:"V2RayNG",colorClass:"bg-blue-500 text-white"},{key:"clash",label:"Clash",colorClass:"bg-indigo-500 text-white"},{key:"shadowrocket",label:"Shadowrocket",colorClass:"bg-orange-500 text-white"},{key:"singbox",label:"Sing-box",colorClass:"bg-emerald-500 text-white"}],Y={VLESS:"bg-blue-500/15 text-blue-400",VMESS:"bg-indigo-500/15 text-indigo-400",TROJAN:"bg-amber-500/15 text-amber-400",SHADOWSOCKS:"bg-purple-500/15 text-purple-400"},Z=t=>Y[t.toUpperCase()]||"bg-zinc-500/15 text-zinc-400",ee=(t,l)=>{if(!l)return null;switch(t){case"v2ray":return`v2rayng://install-sub?url=${encodeURIComponent(l)}`;case"clash":return`clash://install-config?url=${encodeURIComponent(l)}`;case"shadowrocket":return l;default:return null}},T=(t,l)=>{const i=t.urls;return i?l==="shadowrocket"?i.v2ray||"":i[l]||"":""},Se=({userId:t})=>{var S,L,U,O;const[l,i]=c.useState("v2ray"),[d,h]=c.useState(""),[x,M]=c.useState(new Set),[z,D]=c.useState(!1),[v,y]=c.useState(()=>$()),{data:s,isLoading:P}=G({queryKey:["subscription-info",t],queryFn:async()=>{const r=await K.get("/users/"+t+"/subscription");return r==null?void 0:r.data},enabled:Number.isInteger(t)&&t>0});c.useEffect(()=>{y($())},[]);const p=c.useMemo(()=>s!=null&&s.urls?E.filter(({key:r})=>r==="shadowrocket"?!!s.urls.v2ray:!!s.urls[r]):[],[s]);c.useEffect(()=>{if(!(s!=null&&s.urls))return;!T(s,l)&&p.length>0&&i(p[0].key)},[p,l,s]);const u=(r,n)=>{navigator.clipboard.writeText(r),h(n),setTimeout(()=>h(""),1600)},B=r=>{M(n=>{const o=new Set(n);return o.has(r)?o.delete(r):o.add(r),o})},I=()=>{var R;if(!((R=s==null?void 0:s.links)!=null&&R.length))return;const r=s.links.map(g=>`# ${g.remark} [${g.protocol}]
${g.url}`).join(`

`),n=new Blob([r],{type:"text/plain"}),o=URL.createObjectURL(n),f=document.createElement("a");f.href=o,f.download="protocol-links.txt",f.click(),URL.revokeObjectURL(o)},_=(S=s==null?void 0:s.branding)==null?void 0:S.metadata,C=s!=null&&s.urls?V({platform:v,urls:s.urls,metadata:_}):[];if(P)return e.jsxs(j,{children:[e.jsx("h2",{className:"mb-4 text-xl font-bold text-foreground",children:"Protocol Links"}),e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-line/70 border-t-brand-500"})})]});if(!s)return null;if(!((L=s.links)!=null&&L.length)&&!s.urls)return e.jsxs(j,{children:[e.jsx("h2",{className:"mb-4 text-xl font-bold text-foreground",children:"Subscription Link Generator"}),e.jsx("p",{className:"text-sm text-muted",children:"No subscription data available for this user."})]});const m=T(s,l),k=ee(l,m);return e.jsxs(j,{children:[e.jsx("h2",{className:"mb-4 text-xl font-bold text-foreground",children:"Subscription Link Generator"}),e.jsx("div",{className:"mb-6 flex flex-wrap gap-2",children:p.map(({key:r,label:n,colorClass:o})=>e.jsx("button",{onClick:()=>i(r),className:`rounded-xl px-3 py-2 text-sm font-medium transition sm:px-4 ${l===r?o:"border border-line/70 bg-card/70 text-muted hover:text-foreground"}`,children:n},r))}),m&&e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 xl:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-2xl border border-line/70 bg-panel/55 p-5",children:[e.jsx("div",{className:"rounded-2xl border border-line/70 bg-white p-4",children:m?e.jsx(w,{value:m,size:200,level:"M",includeMargin:!1}):e.jsx("div",{className:"flex h-[200px] w-[200px] items-center justify-center text-sm text-muted",children:"No URL"})}),e.jsxs("p",{className:"mt-4 text-center text-sm text-muted",children:["Scan with ",(U=E.find(r=>r.key===l))==null?void 0:U.label]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Subscription URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:m,className:"flex-1 rounded-xl border border-line/80 bg-card/80 px-3 py-2 font-mono text-xs text-foreground sm:text-sm"}),e.jsx(a,{variant:"secondary",onClick:()=>u(m,`sub-${l}`),children:d===`sub-${l}`?e.jsx(N,{className:"h-4 w-4 text-emerald-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]}),k&&e.jsxs(a,{variant:"secondary",className:"w-full",onClick:()=>window.open(k,"_blank","noopener,noreferrer"),children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"One-Click Import"]}),C.length>0?e.jsxs("details",{className:"rounded-2xl border border-line/70 bg-panel/55 p-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-foreground",children:"Add to app (platform)"}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:["android","ios","windows"].map(r=>e.jsxs("button",{onClick:()=>y(r),className:`rounded-xl px-3 py-2 text-sm font-semibold transition ${v===r?"bg-brand-500 text-white shadow-soft":"border border-line/70 bg-card/70 text-muted hover:text-foreground"}`,children:[r==="android"?"Android":null,r==="ios"?"iOS":null,r==="windows"?"Desktop":null]},r))}),e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2",children:C.map(r=>{const n=`app-${r.id}`;return e.jsxs("div",{className:"rounded-2xl border border-line/70 bg-card/65 p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl border border-line/70 bg-panel text-xl",children:r.icon}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:r.name}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:r.description})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2",children:[r.importUrl?e.jsxs(a,{className:"w-full",onClick:()=>{window.location.href=r.importUrl},children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"One-Click"]}):e.jsxs(a,{variant:"secondary",className:"w-full",onClick:()=>u(r.manualUrl,`manual-${r.id}`),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Copy URL"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(a,{variant:"ghost",className:"flex-1 justify-center",onClick:()=>u(r.manualUrl,n),children:[d===n?e.jsx(N,{className:"mr-2 h-4 w-4 text-emerald-500"}):e.jsx(b,{className:"mr-2 h-4 w-4"}),d===n?"Copied":"Copy"]}),e.jsx(a,{variant:"ghost",onClick:()=>{r.storeLink&&window.open(r.storeLink,"_blank","noopener,noreferrer")},disabled:!r.storeLink,"aria-label":"Open app download page",children:e.jsx(A,{className:"h-4 w-4"})})]})]})]},r.id)})})]}):null]})]}),s.links&&s.links.length>0&&e.jsxs("div",{className:"mb-4 border-t border-line/70 pt-6",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-foreground",children:"Individual Protocol Links"}),e.jsx("div",{className:"space-y-3",children:s.links.map(r=>e.jsx(re,{link:r,expanded:x.has(r.inboundId),copied:d,onToggleQr:()=>B(r.inboundId),onCopy:(n,o)=>u(n,o)},r.inboundId))})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 border-t border-line/70 pt-4",children:[e.jsxs(a,{variant:"secondary",onClick:I,disabled:!((O=s.links)!=null&&O.length),children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Download All Links"]}),s.shareUrl&&e.jsxs(a,{variant:"secondary",onClick:()=>{u(s.shareUrl,"share"),D(r=>!r)},children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),d==="share"?"Copied":"Share"]})]}),z&&s.shareUrl&&e.jsxs("div",{className:"mt-4 flex flex-col items-center rounded-2xl border border-line/70 bg-panel/55 p-5",children:[e.jsx("div",{className:"rounded-2xl border border-line/70 bg-white p-4",children:e.jsx(w,{value:s.shareUrl,size:180,level:"M",includeMargin:!1})}),e.jsx("p",{className:"mt-3 text-center text-sm text-muted",children:"Scan to open share page"}),e.jsx("p",{className:"mt-1 break-all text-center font-mono text-xs text-muted",children:s.shareUrl})]})]})},re=({link:t,expanded:l,copied:i,onToggleQr:d,onCopy:h})=>{const x=`link-${t.inboundId}`;return e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`rounded-lg px-2.5 py-1 text-xs font-semibold ${Z(t.protocol)}`,children:t.protocol}),e.jsx("span",{className:"flex-1 truncate text-sm font-medium text-foreground",children:t.remark}),e.jsxs("span",{className:"text-xs text-muted",children:[t.network," / ",t.security]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsxs(a,{size:"sm",variant:"secondary",onClick:()=>h(t.url,x),children:[i===x?e.jsx(N,{className:"mr-1.5 h-3.5 w-3.5 text-emerald-500"}):e.jsx(b,{className:"mr-1.5 h-3.5 w-3.5"}),i===x?"Copied":"Copy"]}),e.jsxs(a,{size:"sm",variant:"ghost",onClick:d,children:[e.jsx(H,{className:"mr-1.5 h-3.5 w-3.5"}),"QR",l?e.jsx(J,{className:"ml-1 h-3.5 w-3.5"}):e.jsx(W,{className:"ml-1 h-3.5 w-3.5"})]}),e.jsxs(a,{size:"sm",variant:"ghost",onClick:()=>window.open(t.url,"_blank","noopener,noreferrer"),children:[e.jsx(A,{className:"mr-1.5 h-3.5 w-3.5"}),"Open"]})]}),l&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"rounded-xl border border-line/70 bg-white p-3",children:e.jsx(w,{value:t.url,size:180,level:"M",includeMargin:!1})})})]})};export{Se as SubscriptionLinksPanel};
