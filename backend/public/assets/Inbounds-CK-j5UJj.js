import{c as pe,j as e,X as Et,b as T,C as ms,R as oe,A as ps,I as xs,u as gs,e as fs,r as f,h as hs,f as bs,k as ys}from"./index-CcK4tOfC.js";import{u as et}from"./useQuery-B_n5M2_v.js";import{u as z}from"./useMutation-DZpYtY5A.js";import{B as Rt}from"./Badge-DKtFh9Vg.js";import{B as p,L as vs}from"./Button-D1Vl4E60.js";import{u as mt,C as ee}from"./useToast-BnKQFuqP.js";import{D as Ns,M as js}from"./DropdownMenu-DSsZCamQ.js";import{C as ws}from"./ConfirmDialog-Cfo88enq.js";import{P as Ss,a as ks,I as Ps}from"./InboundClientProfileModal-BkVrUSA-.js";import{R as Ts,u as at}from"./useTranslation-BAr0hstR.js";import{A as Cs}from"./arrow-right-DUibZsvi.js";import{u as Vs}from"./index.esm-6ooOXtNp.js";import{Q as St}from"./index-D21TPvDG.js";import{I as k}from"./Input-CQ9kTGid.js";import{c as As,C as Is}from"./clipboard-Be9-ly6g.js";import{S as Es}from"./shield-check-GimFvZt1.js";import{a as Rs}from"./system-BhemnE6i.js";import{P as tt}from"./plus-BgytMRdz.js";import{T as Dt}from"./trash-2-Babwtisv.js";import{g as Ds}from"./users-DJwBx_cg.js";import{u as Ms,a as Ls,b as Os}from"./useSmartAutoRefresh-DqWn8HDG.js";import{q as Fs}from"./useUsers-B7GL2jXA.js";import{S as Ge}from"./Skeleton-BQEtEzO0.js";import{D as Ks}from"./download-DLQAnIUC.js";import{U as $s}from"./upload-MfYl1yJB.js";import{S as kt}from"./sparkles-Cs6qvA-A.js";import{C as Pt}from"./chevron-down-2QwyzXam.js";import{F as Us}from"./file-code-2-BDRfaCQX.js";import{P as Bs}from"./pen-square-C0gg5aIz.js";import"./cn-BLSKlp9E.js";import"./Spinner-Cx6HiN6D.js";import"./qr-code-C-rMdsA0.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=pe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=pe("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=pe("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=pe("Radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=pe("ShieldOff",[["path",{d:"M19.7 14a6.9 6.9 0 0 0 .3-2V5l-8-3-3.2 1.2",key:"342pvf"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M4.7 4.7 4 5v7c0 6 8 10 8 10a20.3 20.3 0 0 0 5.62-4.38",key:"p0ycf4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=pe("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=pe("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=pe("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);function Tt(t){if(!Number.isFinite(t)||t<=0)return"0 B";const d=["B","KB","MB","GB","TB","PB"],l=Math.min(Math.floor(Math.log(t)/Math.log(1024)),d.length-1),o=t/1024**l;return`${o.toFixed(o>=100?0:o>=10?1:2)} ${d[l]}`}function _s(t){const d=new Date(t);if(Number.isNaN(d.getTime()))return"N/A";const l=d.getTime()-Date.now(),o=Math.ceil(l/(1e3*60*60*24));return o>0?`${o}d left`:"Expired"}function Xs(t){if(!t)return"No activity";const d=new Date(t).getTime();if(Number.isNaN(d))return"No activity";const l=Math.floor((Date.now()-d)/6e4);if(l<1)return"just now";if(l<60)return`${l}m ago`;const o=Math.floor(l/60);return o<24?`${o}h ago`:`${Math.floor(o/24)}d ago`}function Qs({inbound:t,clients:d,sessionsByUuid:l,onClose:o,onViewUser:v,onToggleAccess:g,onResetTraffic:M,onExtendExpiry:C,onDisableUser:V,onDecreasePriority:D,onIncreasePriority:L,actionLoadingKey:A=null}){return e.jsx("div",{className:"fixed inset-0 z-50 flex justify-end bg-black/45 backdrop-blur-sm",children:e.jsxs("div",{className:"flex h-full w-full max-w-3xl flex-col border-l border-line/70 bg-card/95 shadow-soft",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-line/70 px-5 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:"Inbound Details"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:t.remark||t.tag}),e.jsxs("p",{className:"mt-1 text-sm text-muted",children:[t.protocol," • Port ",t.port," • ",t.network,"/",t.security]})]}),e.jsx("button",{type:"button",onClick:o,className:"rounded-lg p-2 text-muted transition-colors hover:bg-card/80 hover:text-foreground","aria-label":"Close drawer",children:e.jsx(Et,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:d.length===0?e.jsx("div",{className:"rounded-xl border border-line/70 bg-panel/40 px-4 py-10 text-center text-sm text-muted",children:"No clients are assigned to this inbound yet."}):e.jsx("div",{className:"space-y-3",children:d.map(x=>{const m=l.get(x.uuid),$=!!(m!=null&&m.online),u=x.dataLimit>0?Math.min(x.totalUsed/x.dataLimit*100,100):0,y=`u${x.id}-`;return e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/45 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:x.email}),e.jsxs("p",{className:"text-xs text-muted",children:[x.uuid.slice(0,10),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs ${$?"bg-emerald-500/15 text-emerald-300":"bg-zinc-500/15 text-zinc-300"}`,children:[e.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[$?e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-400 opacity-70"}):null,e.jsx("span",{className:`relative inline-flex h-2.5 w-2.5 rounded-full ${$?"bg-emerald-400":"bg-zinc-400"}`})]}),$?"Online":"Offline"]}),e.jsx("span",{className:"rounded-full bg-card/80 px-2 py-0.5 text-xs text-muted",children:x.status}),e.jsxs("span",{className:"rounded-full bg-brand-500/15 px-2 py-0.5 text-xs text-brand-300",children:["Priority ",x.priority]}),x.enabled?null:e.jsx("span",{className:"rounded-full bg-amber-500/15 px-2 py-0.5 text-xs text-amber-300",children:"Key Off"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-line/60 bg-card/60 p-2.5",children:[e.jsx("p",{className:"text-muted",children:"Traffic"}),e.jsxs("p",{className:"mt-1 text-sm text-foreground",children:[Tt(x.totalUsed)," / ",x.dataLimit>0?Tt(x.dataLimit):"∞"]}),e.jsx("div",{className:"mt-2 h-2 rounded-full bg-panel/90",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-brand-500 to-brand-600",style:{width:`${u}%`}})})]}),e.jsxs("div",{className:"rounded-lg border border-line/60 bg-card/60 p-2.5",children:[e.jsx("p",{className:"text-muted",children:"Expiry"}),e.jsx("p",{className:"mt-1 text-sm text-foreground",children:_s(x.expireDate)}),e.jsx("p",{className:"mt-1 text-muted",children:new Date(x.expireDate).toLocaleDateString()})]}),e.jsxs("div",{className:"rounded-lg border border-line/60 bg-card/60 p-2.5",children:[e.jsx("p",{className:"text-muted",children:"Session"}),e.jsx("p",{className:"mt-1 text-sm text-foreground",children:$?(m==null?void 0:m.currentIp)||"Connected":`Last seen ${Xs((m==null?void 0:m.lastSeenAt)||null)}`}),!$&&(m!=null&&m.currentIp)?e.jsx("p",{className:"mt-1 text-muted",children:m.currentIp}):null]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-6",children:[e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>v(x.id),children:"View"}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>D(x),loading:A===`${y}priority-down`,children:"Priority -"}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>L(x),loading:A===`${y}priority-up`,children:"Priority +"}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>g(x),loading:A===`${y}toggle`,children:[x.enabled?e.jsx(Ys,{className:"mr-1 h-4 w-4"}):e.jsx(qs,{className:"mr-1 h-4 w-4"}),"Key"]}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>M(x),loading:A===`${y}reset`,children:[e.jsx(Ts,{className:"mr-1 h-4 w-4"}),"Reset"]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>C(x,7),loading:A===`${y}extend7`,children:"+7d"}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>C(x,30),loading:A===`${y}extend30`,children:"+30d"}),e.jsxs(p,{size:"sm",variant:"danger",onClick:()=>V(x),loading:A===`${y}disable`,children:[e.jsx(zs,{className:"mr-1 h-4 w-4"}),"Disable"]})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>v(x.id),className:"inline-flex items-center gap-1 text-xs font-medium text-brand-500 hover:text-brand-600",children:["Open user page",e.jsx(Cs,{className:"h-3.5 w-3.5"})]})})]},`${t.id}-${x.id}`)})})})]})})}const st=[{id:"vless-reality-xhttp",name:"VLESS + REALITY + XHTTP",description:"Modern anti-censorship profile for latest Xray clients.",category:"recommended",highlights:["Anti-censorship","Modern Xray","XHTTP"],values:{protocol:"VLESS",network:"XHTTP",security:"REALITY",port:443,tag:"vless-reality-xhttp",remark:"VLESS REALITY XHTTP",wsPath:"/xhttp",xhttpMode:"auto",serverName:"www.microsoft.com",realityFingerprint:"chrome"}},{id:"vless-reality-tcp",name:"VLESS + REALITY + TCP",description:"Lean REALITY profile with plain TCP transport.",category:"recommended",highlights:["Low overhead","REALITY","TCP"],values:{protocol:"VLESS",network:"TCP",security:"REALITY",port:443,tag:"vless-reality-tcp",remark:"VLESS REALITY TCP",serverName:"www.cloudflare.com",realityFingerprint:"chrome"}},{id:"vless-ws-tls",name:"VLESS + WS + TLS",description:"Compatible profile for websocket clients and CDN edge.",category:"cdn",highlights:["CDN friendly","WS","TLS"],values:{protocol:"VLESS",network:"WS",security:"TLS",port:443,tag:"vless-ws-tls",remark:"VLESS WS TLS",wsPath:"/vless",alpn:'["h2","http/1.1"]'}},{id:"vless-httpupgrade-tls",name:"VLESS + HTTPUpgrade + TLS",description:"HTTPUpgrade profile for edge/CDN traffic blending.",category:"cdn",highlights:["HTTPUpgrade","CDN edge","TLS"],values:{protocol:"VLESS",network:"HTTPUPGRADE",security:"TLS",port:443,tag:"vless-httpupgrade-tls",remark:"VLESS HTTPUpgrade TLS",wsPath:"/upgrade",alpn:'["h2","http/1.1"]'}},{id:"trojan-grpc",name:"Trojan + gRPC + TLS",description:"Stable TLS profile with gRPC transport.",category:"transport",highlights:["TLS only","gRPC","Stable"],values:{protocol:"TROJAN",network:"GRPC",security:"TLS",port:443,tag:"trojan-grpc",remark:"Trojan gRPC",grpcServiceName:"trojan-grpc",alpn:'["h2","http/1.1"]'}},{id:"trojan-ws-tls",name:"Trojan + WS + TLS",description:"Trojan profile tuned for websocket deployments.",category:"transport",highlights:["Trojan","WebSocket","TLS"],values:{protocol:"TROJAN",network:"WS",security:"TLS",port:443,tag:"trojan-ws-tls",remark:"Trojan WS TLS",wsPath:"/trojan",alpn:'["h2","http/1.1"]'}},{id:"vmess-ws-tls",name:"VMess + WS + TLS",description:"Classic VMess deployment profile.",category:"transport",highlights:["Legacy compatible","WS","TLS"],values:{protocol:"VMESS",network:"WS",security:"TLS",port:443,tag:"vmess-ws-tls",remark:"VMess WS TLS",wsPath:"/vmess",alpn:'["h2","http/1.1"]'}},{id:"vmess-grpc-tls",name:"VMess + gRPC + TLS",description:"VMess profile with gRPC transport for modern clients.",category:"transport",highlights:["VMess","gRPC","TLS"],values:{protocol:"VMESS",network:"GRPC",security:"TLS",port:443,tag:"vmess-grpc-tls",remark:"VMess gRPC TLS",grpcServiceName:"vmess-grpc",alpn:'["h2","http/1.1"]'}},{id:"dokodemo-dns-forward",name:"Dokodemo DNS Forward",description:"Forward DNS traffic to an upstream resolver.",category:"utility",highlights:["DNS relay","UDP","Resolver"],values:{protocol:"DOKODEMO_DOOR",network:"TCP",security:"NONE",port:5353,tag:"dokodemo-dns",remark:"Dokodemo DNS Forward",serverAddress:"1.1.1.1",dokodemoTargetPort:53,dokodemoNetwork:"udp",dokodemoFollowRedirect:!1}},{id:"dokodemo-tcp-forward",name:"Dokodemo TCP Forward",description:"Forward raw TCP traffic to a target service.",category:"utility",highlights:["TCP relay","Debugging","Forward"],values:{protocol:"DOKODEMO_DOOR",network:"TCP",security:"NONE",port:10080,tag:"dokodemo-tcp-forward",remark:"Dokodemo TCP Forward",serverAddress:"127.0.0.1",dokodemoTargetPort:80,dokodemoNetwork:"tcp",dokodemoFollowRedirect:!1}},{id:"shadowsocks-tcp",name:"Shadowsocks (TCP/UDP)",description:"Lightweight encrypted proxy profile for broad client compatibility.",category:"recommended",highlights:["Fast","Simple","Broad client support"],values:{protocol:"SHADOWSOCKS",network:"TCP",security:"NONE",port:8388,tag:"shadowsocks-main",remark:"Shadowsocks Main",cipher:"chacha20-ietf-poly1305"}},{id:"socks5-local-lan",name:"SOCKS5 LAN Gateway",description:"SOCKS gateway profile for local/LAN applications.",category:"utility",highlights:["LAN apps","SOCKS5","Simple"],values:{protocol:"SOCKS",network:"TCP",security:"NONE",port:1080,tag:"socks5-lan-gateway",remark:"SOCKS5 LAN Gateway",serverAddress:"0.0.0.0"}},{id:"socks5-auth",name:"SOCKS5 Auth Gateway",description:"Username/password SOCKS proxy using panel user credentials.",category:"utility",highlights:["Auth","SOCKS5","Gateway"],values:{protocol:"SOCKS",network:"TCP",security:"NONE",port:10808,tag:"socks-auth",remark:"SOCKS5 Auth Gateway"}},{id:"http-proxy-auth",name:"HTTP Proxy Auth",description:"Classic authenticated HTTP forward proxy for browser/system use.",category:"utility",highlights:["HTTP proxy","Auth","Legacy tools"],values:{protocol:"HTTP",network:"TCP",security:"NONE",port:10809,tag:"http-proxy-auth",remark:"HTTP Proxy Auth"}},{id:"wireguard-egress",name:"WireGuard Egress Tunnel",description:"Expose a local SOCKS listener routed over WireGuard outbound.",category:"transport",highlights:["WireGuard","Egress","Secure tunnel"],values:{protocol:"WIREGUARD",network:"TCP",security:"NONE",port:51820,tag:"wireguard-egress",remark:"WireGuard Egress",wgAddress:"10.66.2.2/32",wgAllowedIPs:"0.0.0.0/0, ::/0",wgMtu:1420}},{id:"mtproto-telegram",name:"MTProto Telegram",description:"Telegram-oriented proxy inbound using MTProto protocol.",category:"utility",highlights:["Telegram","MTProto","Stealth"],values:{protocol:"MTPROTO",network:"TCP",security:"NONE",port:443,tag:"mtproto-telegram",remark:"MTProto Telegram"}}];function Ct(t){return t&&typeof t=="object"&&"data"in t?t.data:t}const Js=({register:t,watch:d,setValue:l,errors:o})=>{var m,$;const v=mt(),{t:g}=at(),M=(d("realityDest")||"").trim(),C=(d("serverName")||"").trim(),V=String(d("realityServerName")||"").split(",").map(u=>u.trim()).filter(Boolean),{data:D,isLoading:L}=et({queryKey:["reality-destinations"],queryFn:async()=>{const u=await T.get("/reality/destinations"),y=Ct(u)||{};return{destinations:Array.isArray(y.destinations)?y.destinations:[],recommendedWsPaths:Array.isArray(y.recommendedWsPaths)?y.recommendedWsPaths:[]}}}),A=z({mutationFn:async u=>{const y=await T.post("/reality/test-destination",{dest:u});return Ct(y)},onSuccess:u=>{if(u!=null&&u.accessible){v.success(g("common.success",{defaultValue:"Success"}),g("inbounds.toast.destinationReachable",{defaultValue:"Destination reachable: {{dest}}",dest:String(u.destination||M||"")}));return}v.warning(g("common.warning",{defaultValue:"Warning"}),String((u==null?void 0:u.message)||(u==null?void 0:u.destination)||g("inbounds.toast.destinationUnavailable",{defaultValue:"Destination is not reachable"})))},onError:u=>{v.error(g("common.error",{defaultValue:"Error"}),(u==null?void 0:u.message)||g("inbounds.toast.destinationTestFailed",{defaultValue:"Failed to test destination"}))}}),x=u=>{l("realityDest",u.dest,{shouldDirty:!0,shouldValidate:!0});const y=Array.isArray(u.serverNames)?u.serverNames.join(","):"";y&&V.length===0&&l("realityServerName",y,{shouldDirty:!0,shouldValidate:!0}),!C&&Array.isArray(u.serverNames)&&u.serverNames[0]&&l("serverName",u.serverNames[0],{shouldDirty:!0,shouldValidate:!0})};return e.jsxs("div",{className:"space-y-4 rounded-xl border border-line/70 bg-panel/45 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"REALITY Destination Controls"}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:"Use a high-trust TLS destination to improve DPI resistance."})]}),e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-500/30 bg-emerald-500/10 px-2 py-1 text-[11px] font-semibold text-emerald-300",children:[e.jsx(Es,{className:"h-3.5 w-3.5"}),"Myanmar Optimized"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(k,{label:"Reality Destination (host:port)",...t("realityDest",{validate:u=>u?/^[^:\s]+:\d{1,5}$/.test(String(u).trim())||"Use host:port format, e.g. www.microsoft.com:443":!0}),error:(m=o.realityDest)==null?void 0:m.message,placeholder:"www.microsoft.com:443"}),e.jsx(k,{label:"Reality Spider X (Optional)",...t("realitySpiderX"),error:($=o.realitySpiderX)==null?void 0:$.message,placeholder:"/"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>{if(!M){v.warning(g("common.warning",{defaultValue:"Warning"}),g("inbounds.toast.destinationRequired",{defaultValue:"Select or enter a destination first."}));return}A.mutate(M)},loading:A.isPending,children:[e.jsx(Gs,{className:"mr-2 h-4 w-4"}),"Test Current Destination"]}),Array.isArray(D==null?void 0:D.recommendedWsPaths)&&D.recommendedWsPaths.length>0?e.jsxs("span",{className:"text-xs text-muted",children:["Suggested WS paths: ",D.recommendedWsPaths.slice(0,3).join(", ")]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-muted",children:"Curated Destinations"}),L?e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-line/70 bg-card/60 px-3 py-2 text-xs text-muted",children:[e.jsx(vs,{className:"h-4 w-4 animate-spin"}),"Loading destination catalog..."]}):null,!L&&(!(D!=null&&D.destinations)||D.destinations.length===0)?e.jsx("div",{className:"rounded-lg border border-line/70 bg-card/60 px-3 py-2 text-xs text-muted",children:"Destination catalog unavailable. You can still set destination manually."}):null,!L&&Array.isArray(D==null?void 0:D.destinations)?e.jsx("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:D.destinations.map(u=>{const y=M===u.dest;return e.jsxs("button",{type:"button",onClick:()=>x(u),className:`rounded-lg border px-3 py-2 text-left transition ${y?"border-brand-500/60 bg-brand-500/10":"border-line/70 bg-card/60 hover:border-brand-400/40"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:u.name}),y?e.jsx(ms,{className:"h-4 w-4 text-brand-300"}):null]}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:u.dest}),e.jsxs("p",{className:"mt-1 text-[11px] text-muted",children:[u.region||"Global"," • ",u.reliability||"High"]})]},u.dest)})}):null]})]})},Mt=t=>({id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,dest:"",path:"",alpn:"",name:"",xver:"",...t}),Vt=t=>Array.isArray(t)?t.filter(d=>d&&typeof d=="object").map(d=>{const l=d;return Mt({dest:l.dest?String(l.dest):"",path:l.path?String(l.path):"",name:l.name?String(l.name):"",xver:l.xver!==void 0&&l.xver!==null?String(l.xver):"",alpn:Array.isArray(l.alpn)?l.alpn.map(o=>String(o).trim()).filter(Boolean).join(","):l.alpn?String(l.alpn):""})}):[],At=t=>t.map(d=>{const l=d.dest.trim(),o=d.path.trim(),v=d.name.trim(),g=d.xver.trim(),M=d.alpn.split(",").map(V=>V.trim()).filter(Boolean);if(!l)return null;const C={dest:l};if(o&&(C.path=o),v&&(C.name=v),M.length>0&&(C.alpn=M),g){const V=Number.parseInt(g,10);Number.isNaN(V)||(C.xver=V)}return C}).filter(d=>!!d),Zs=({inbound:t,initialValues:d,onClose:l,onSuccess:o})=>{var Ee,Re,He,be;const v=mt(),{t:g}=at(),[M,C]=oe.useState(!1),V=!!t,D=t==null?void 0:t.domains,L=t==null?void 0:t.fallbacks,[A,x]=oe.useState(()=>Vt(L)),{register:m,handleSubmit:$,setValue:u,getValues:y,watch:N,formState:{errors:te}}=Vs({defaultValues:t?{...t,realityShortId:Array.isArray(t.realityShortIds)?t.realityShortIds.join(","):void 0,realityServerName:Array.isArray(t.realityServerNames)?t.realityServerNames.join(","):void 0,domains:D?D.join(", "):void 0,fallbacks:L&&L.length>0?JSON.stringify(L,null,2):""}:{protocol:"VLESS",network:"TCP",security:"NONE",alpn:'["h2","http/1.1"]',...d}}),O=N("protocol"),I=N("network"),F=N("security"),ie=N("serverName"),Me=N("wsPath"),je=N("wsHost"),we=N("grpcServiceName"),Se=N("xhttpMode"),ke=N("realityPublicKey"),Le=N("realityPrivateKey"),Pe=N("realityShortId"),Te=N("realityServerName"),_=N("realityFingerprint"),q=N("realitySpiderX"),w=N("tag"),xe=N("dokodemoTargetPort"),ze=N("dokodemoNetwork"),J=O==="DOKODEMO_DOOR",P=["VLESS","VMESS","TROJAN","SHADOWSOCKS"].includes(O),B=["VLESS","VMESS","TROJAN","SHADOWSOCKS"].includes(O),Y=O==="VLESS",ge=["VLESS","TROJAN"].includes(O),Oe=N("wgPrivateKey"),Fe=N("wgPeerPublicKey"),fe=N("wgPublicKey"),de=N("wgPeerEndpoint"),Ce=N("serverAddress"),qe=N("port"),Z=N("wgAllowedIPs"),Ke=N("wgMtu"),K=N("wgAddress");oe.useEffect(()=>{if(V)return;const r=String(y("serverAddress")||"").trim();(!r||r==="your.domain.com")&&Rs().then(n=>{const h=n.ip||(typeof window<"u"?window.location.hostname:"");h&&u("serverAddress",h,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!0})}).catch(()=>{typeof window<"u"&&window.location.hostname&&u("serverAddress",window.location.hostname,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!0})})},[y,V,u]),oe.useEffect(()=>{x(Vt(L))},[L]),oe.useEffect(()=>{const r=document.body.style.overflow,n=document.body.style.paddingRight,h=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",h>0&&(document.body.style.paddingRight=`${h}px`),()=>{document.body.style.overflow=r,document.body.style.paddingRight=n}},[]);const $e=oe.useMemo(()=>JSON.stringify(At(A),null,2),[A]),se=oe.useMemo(()=>{const r={recommended:0,cdn:1,transport:2,utility:3};return[...st].sort((n,h)=>{const b=r[n.category]-r[h.category];return b!==0?b:n.name.localeCompare(h.name)}).slice(0,12)},[]),ae=oe.useMemo(()=>{const r=[],n=[];if((Ce||"").trim()||r.push("Server address is required."),O==="TROJAN"&&F!=="TLS"&&n.push("Trojan always uses TLS. One-UI will enforce TLS on save."),O==="VLESS"&&F==="REALITY"&&((ke||"").trim()||r.push("REALITY requires a Public Key."),(Le||"").trim()||r.push("REALITY requires a Private Key."),!(ie||"").trim()&&!(Te||"").trim()&&r.push("REALITY requires SNI or Reality Server Names."),(Pe||"").trim()||n.push("Set a REALITY Short ID for better client compatibility.")),O==="WIREGUARD"&&((Oe||"").trim()||r.push("WireGuard requires a local Private Key."),(Fe||"").trim()||r.push("WireGuard requires Peer Public Key."),(de||"").trim()||r.push("WireGuard requires Peer Endpoint (host:port)."),(Z||"").trim()||n.push("Allowed IPs is empty; recommended: 0.0.0.0/0, ::/0")),J){const h=Number(xe);(!Number.isInteger(h)||h<1||h>65535)&&r.push("Dokodemo-door requires a valid Target Port."),(ze||"").trim()||n.push("Set Target Network (tcp/udp) explicitly for predictable routing.")}return P&&(I==="WS"||I==="HTTPUPGRADE"||I==="XHTTP")&&!(Me||"").trim()&&n.push("Path is empty; define wsPath/xhttp path for client consistency."),P&&I==="GRPC"&&!(we||"").trim()&&n.push("gRPC Service Name is empty; most clients require a matching service name."),F==="TLS"&&!(ie||"").trim()&&n.push("TLS SNI is empty; set Server Name to avoid certificate mismatch."),ge&&F==="TLS"&&(A.some(b=>[b.dest,b.path,b.alpn,b.name,b.xver].some(W=>W.trim().length>0)&&!b.dest.trim())?r.push("Each fallback row with values must include Dest."):A.length===0&&n.push("Fallbacks are optional. Add them only if your routing requires fallback destinations.")),{issues:r,tips:n}},[ze,xe,we,J,I,O,Le,ke,Pe,F,Ce,ie,Te,P,ge,A,Z,de,Fe,Oe,Me]),Ye=r=>{for(const[n,h]of Object.entries(r.values))u(n,h,{shouldDirty:!0,shouldValidate:!0})},Ve=()=>{x(r=>[...r,Mt()])},_e=r=>{x(n=>n.filter(h=>h.id!==r))},ce=(r,n,h)=>{x(b=>b.map(U=>U.id!==r?U:{...U,[n]:h}))},Ue=r=>{r==="multiplexer"?x([{id:Math.random().toString(36).substring(7),path:"/api/v2/telemetry",dest:"10002",name:"Internal VMess",alpn:"",xver:"1"},{id:Math.random().toString(36).substring(7),path:"",dest:"10001",name:"Internal Trojan",alpn:"h2",xver:"1"},{id:Math.random().toString(36).substring(7),path:"",dest:"80",name:"Web Camouflage",alpn:"",xver:"0"}]):r==="shadowsocks"?x([{id:Math.random().toString(36).substring(7),path:"",dest:"10003",name:"Internal Shadowsocks",alpn:"",xver:"1"},{id:Math.random().toString(36).substring(7),path:"",dest:"80",name:"Web Camouflage",alpn:"",xver:"0"}]):r==="web"&&x([{id:Math.random().toString(36).substring(7),path:"",dest:"80",name:"Web Camouflage",alpn:"",xver:"0"}])},re=z({mutationFn:async r=>{V&&t?await T.put(`/inbounds/${t.id}`,r):await T.post("/inbounds",r)},onSuccess:()=>{o()},onError:r=>{v.error(g("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||g("inbounds.toast.saveFailed",{defaultValue:"Failed to save inbound"}))}}),Be=z({mutationFn:async()=>{var n;const r=await T.get("/inbounds/random-port");return Number(((n=r==null?void 0:r.data)==null?void 0:n.port)||0)},onSuccess:r=>{if(!Number.isInteger(r)||r<1||r>65535)return;u("port",r,{shouldDirty:!0,shouldValidate:!0}),(y("tag")||"").trim()||u("tag",`${String(O).toLowerCase()}-${r}`,{shouldDirty:!0,shouldValidate:!0})},onError:r=>{v.error(g("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||g("inbounds.toast.randomPortFailed",{defaultValue:"Failed to generate random port"}))}}),E=z({mutationFn:async()=>await T.get("/inbounds/wireguard/keys"),onSuccess:r=>{const n=(r==null?void 0:r.data)||r;n!=null&&n.privateKey&&u("wgPrivateKey",n.privateKey,{shouldDirty:!0,shouldValidate:!0}),n!=null&&n.publicKey&&u("wgPublicKey",n.publicKey,{shouldDirty:!0,shouldValidate:!0}),y("wgAllowedIPs")||u("wgAllowedIPs","0.0.0.0/0, ::/0",{shouldDirty:!0,shouldValidate:!1})},onError:r=>{v.error(g("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||g("inbounds.toast.wireguardKeygenFailed",{defaultValue:"Failed to generate WireGuard keys"}))}}),Xe=z({mutationFn:async()=>await T.post("/reality/generate-keys",{serverName:y("serverName")||void 0}),onSuccess:r=>{const n=(r==null?void 0:r.data)||r;n!=null&&n.privateKey&&u("realityPrivateKey",n.privateKey,{shouldDirty:!0,shouldValidate:!0}),n!=null&&n.publicKey&&u("realityPublicKey",n.publicKey,{shouldDirty:!0,shouldValidate:!0});const h=Array.isArray(n==null?void 0:n.shortIds)?n.shortIds:n!=null&&n.shortId?[n.shortId]:[];if(h.length>0){const U=[(y("realityShortId")||"").trim(),h.join(",")].filter(Boolean).join(",").split(",").map(W=>W.trim()).filter(Boolean);u("realityShortId",Array.from(new Set(U)).join(","),{shouldDirty:!0,shouldValidate:!0})}y("realityFingerprint")||u("realityFingerprint",(n==null?void 0:n.fingerprint)||"chrome",{shouldDirty:!0,shouldValidate:!1}),y("serverName")||u("serverName",(n==null?void 0:n.serverName)||"www.microsoft.com",{shouldDirty:!0,shouldValidate:!0}),!y("realityServerName")&&(n!=null&&n.serverName)&&u("realityServerName",n.serverName,{shouldDirty:!0,shouldValidate:!1})},onError:r=>{v.error(g("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||g("inbounds.toast.realityKeygenFailed",{defaultValue:"Failed to generate REALITY keys"}))}}),he=r=>{const n={...r,domains:typeof r.domains=="string"?r.domains.split(",").map(b=>b.trim()).filter(Boolean):Array.isArray(r.domains)?r.domains:[]},h=At(A);if(n.fallbacks=JSON.stringify(h),P||(n.network="TCP",n.security="NONE"),J&&!n.dokodemoTargetPort&&(n.dokodemoTargetPort=80),!B&&n.security==="TLS"&&(n.security="NONE"),!Y&&n.security==="REALITY"&&(n.security="NONE"),n.protocol==="TROJAN"&&(n.security="TLS"),n.security==="REALITY"){const b=typeof n.realityShortId=="string"?n.realityShortId.split(",").map(W=>W.trim()).filter(Boolean):[];n.realityShortId=b.join(",");const U=typeof n.realityServerName=="string"?n.realityServerName.split(",").map(W=>W.trim()).filter(Boolean):[];n.realityServerName=U.join(","),!n.serverName&&U.length>0&&(n.serverName=U[0])}re.mutate(n)},Qe=()=>{const r=(Ce||"").trim();if((de||"").trim())return;if(!r){v.warning(g("common.warning",{defaultValue:"Warning"}),g("inbounds.toast.missingServerAddress",{defaultValue:"Set Server Address first."}));return}const h=Number(qe),b=Number.isInteger(h)&&h>0?h:51820;u("wgPeerEndpoint",`${r}:${b}`,{shouldDirty:!0,shouldValidate:!0})},Ae=(()=>{if(O!=="WIREGUARD")return"";const r=(Oe||"").trim(),n=(Fe||fe||"").trim(),h=(de||"").trim();if(!r||!n||!h)return"";const b=(K||"").trim()||"10.66.2.2/32",U=(Z||"").trim()||"0.0.0.0/0, ::/0",W=Number(Ke),ne=Number.isInteger(W)&&W>0,ye=["[Interface]",`PrivateKey = ${r}`,`Address = ${b}`,"","[Peer]",`PublicKey = ${n}`,`Endpoint = ${h}`,`AllowedIPs = ${U}`,"PersistentKeepalive = 25"];return ne&&ye.splice(3,0,`MTU = ${W}`),ye.join(`
`)})(),ue=(()=>{if(O!=="VLESS"||F!=="REALITY")return"";const r=(Ce||"").trim(),n=Number(qe),h=(ke||"").trim();if(!r||!Number.isInteger(n)||n<1||!h)return"";const b=new URLSearchParams,U=(I||"TCP").toLowerCase();b.set("type",U),b.set("security","reality");const W=(Te||"").split(",").map(H=>H.trim()).filter(Boolean)[0];b.set("sni",(ie||W||r).trim()),b.set("fp",(_||"chrome").trim()||"chrome"),b.set("pbk",h),b.set("flow","xtls-rprx-vision");const ne=(Pe||"").split(",").map(H=>H.trim()).filter(Boolean);ne.length>0&&b.set("sid",ne[0]),q&&String(q).trim()&&b.set("spx",String(q).trim()),I==="WS"||I==="HTTPUPGRADE"||I==="XHTTP"?(b.set("path",(Me||"/").trim()||"/"),je&&String(je).trim()&&b.set("host",String(je).trim()),I==="XHTTP"&&Se&&String(Se).trim()&&b.set("mode",String(Se).trim())):I==="GRPC"&&(b.set("serviceName",(we||"").trim()),b.set("mode","gun"));const ye=encodeURIComponent((w||"vless-reality").trim()||"vless-reality");return`vless://{UUID}@${r}:${n}?${b.toString()}#${ye}`})(),Ie=async()=>{if(!ue)return;if(!await As(ue)){v.error(g("common.error",{defaultValue:"Error"}),g("inbounds.toast.copyRealityTemplateFailed",{defaultValue:"Failed to copy template"}));return}C(!0),window.setTimeout(()=>C(!1),1600)};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto overscroll-contain bg-black/45 p-2 backdrop-blur-sm sm:p-4",style:{WebkitOverflowScrolling:"touch"},children:e.jsx("div",{className:"flex min-h-full items-end justify-center sm:items-center",children:e.jsxs("div",{className:"my-2 flex max-h-[calc(100dvh-1rem)] w-full max-w-3xl flex-col overflow-hidden rounded-3xl glass-card sm:my-4 sm:max-h-[calc(100dvh-2rem)]",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-line/50 bg-card/60 p-5 backdrop-blur-md",children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent sm:text-2xl",children:V?"Edit Inbound":"Add New Inbound"}),e.jsx("button",{onClick:l,className:"rounded-xl p-2 text-muted transition-all hover:bg-white/10 hover:text-foreground active:scale-95",children:e.jsx(Et,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:$(he),className:"min-h-0 flex-1 space-y-6 overflow-y-auto overscroll-contain px-5 pb-28 pt-5 sm:px-6 sm:pb-32 sm:pt-6",style:{WebkitOverflowScrolling:"touch"},children:[V?null:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Quick Presets"}),e.jsx("span",{className:"text-xs text-muted",children:"One-click inbound wizard"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:se.map(r=>e.jsxs("button",{type:"button",onClick:()=>Ye(r),className:"rounded-xl border border-line/80 bg-card/70 p-3 text-left transition hover:border-brand-400/55 hover:bg-card",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:r.name}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:r.values.protocol}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:r.values.network})]}),e.jsx("p",{className:"mt-1 text-xs leading-relaxed text-muted",children:r.description}),e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:r.highlights.slice(0,3).map(n=>e.jsx("span",{className:"rounded-md border border-brand-500/20 bg-brand-500/10 px-1.5 py-0.5 text-[10px] font-medium text-brand-700 dark:text-brand-300",children:n},`${r.id}-${n}`))})]},r.id))})]}),ae.issues.length>0||ae.tips.length>0?e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[ae.issues.length>0?e.jsx(ps,{className:"h-4 w-4 text-amber-500"}):e.jsx(xs,{className:"h-4 w-4 text-brand-500"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Validation Guide"})]}),ae.issues.map(r=>e.jsxs("p",{className:"mb-1 text-xs text-red-500",children:["• ",r]},`issue-${r}`)),ae.tips.map(r=>e.jsxs("p",{className:"mb-1 text-xs text-muted",children:["• ",r]},`tip-${r}`))]}):null,e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Basic Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Protocol *"}),e.jsxs("select",{...m("protocol",{required:"Protocol is required"}),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"VLESS",children:"VLESS"}),e.jsx("option",{value:"VMESS",children:"VMess"}),e.jsx("option",{value:"TROJAN",children:"Trojan"}),e.jsx("option",{value:"SHADOWSOCKS",children:"Shadowsocks"}),e.jsx("option",{value:"SOCKS",children:"SOCKS5"}),e.jsx("option",{value:"HTTP",children:"HTTP Proxy"}),e.jsx("option",{value:"DOKODEMO_DOOR",children:"Dokodemo-door"}),e.jsx("option",{value:"WIREGUARD",children:"Wireguard"}),e.jsx("option",{value:"MTPROTO",children:"MTProto (Telegram)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{label:"Port *",type:"number",...m("port",{required:"Port is required",min:{value:1,message:"Port must be between 1-65535"},max:{value:65535,message:"Port must be between 1-65535"}}),error:(Ee=te.port)==null?void 0:Ee.message,placeholder:"443"}),e.jsxs(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Be.mutate(),loading:Be.isPending,children:[e.jsx(ut,{className:"mr-2 h-4 w-4"}),"Random Free Port"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(k,{label:"Tag *",...m("tag",{required:"Tag is required"}),error:(Re=te.tag)==null?void 0:Re.message,placeholder:"vless-ws-tls"}),e.jsx(k,{label:"Remark",...m("remark"),placeholder:"My VLESS Inbound"})]}),e.jsx(k,{label:J?"Target Address *":"Server Address *",...m("serverAddress",{required:"Server address is required"}),error:(He=te.serverAddress)==null?void 0:He.message,placeholder:J?"127.0.0.1":"your.domain.com or IP"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Additional Domains"}),e.jsx(k,{placeholder:"cdn.domain.com, worker.domain.com (comma separated)",...m("domains")}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:"Optional: Comma-separated list of additional domains for this inbound."})]})]}),J?e.jsxs("div",{className:"space-y-4 rounded-xl border border-line/70 bg-panel/50 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Dokodemo-door Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(k,{label:"Target Port *",type:"number",...m("dokodemoTargetPort",{valueAsNumber:!0,min:{value:1,message:"Target port must be between 1-65535"},max:{value:65535,message:"Target port must be between 1-65535"}}),error:(be=te.dokodemoTargetPort)==null?void 0:be.message,placeholder:"80"}),e.jsx(k,{label:"Target Network",...m("dokodemoNetwork"),placeholder:"tcp,udp"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",...m("dokodemoFollowRedirect"),className:"h-4 w-4 rounded border-line bg-card"}),"Follow redirect"]})]}):null,P?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Network Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Network *"}),e.jsxs("select",{...m("network",{required:"Network is required"}),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"TCP",children:"TCP"}),e.jsx("option",{value:"WS",children:"WebSocket"}),e.jsx("option",{value:"HTTPUPGRADE",children:"HTTP Upgrade"}),e.jsx("option",{value:"XHTTP",children:"XHTTP"}),e.jsx("option",{value:"GRPC",children:"gRPC"}),e.jsx("option",{value:"HTTP",children:"HTTP/2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Security *"}),e.jsxs("select",{...m("security",{required:"Security is required"}),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"NONE",children:"None"}),B?e.jsx("option",{value:"TLS",children:"TLS"}):null,Y?e.jsx("option",{value:"REALITY",children:"REALITY"}):null]})]})]})]}):e.jsx("div",{className:"rounded-xl border border-line/80 bg-panel/50 p-3 text-sm text-muted",children:"This protocol uses direct listener mode. Network and TLS settings are not required."}),F==="TLS"&&B&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"TLS Settings"}),e.jsx(k,{label:"Server Name (SNI)",...m("serverName"),placeholder:"your.domain.com"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"ALPN (JSON Array)"}),e.jsx("input",{...m("alpn"),className:"w-full rounded-xl border border-line/80 bg-card/75 px-3 py-2 font-mono text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:'["h2","http/1.1"]'}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:'Example: ["h2","http/1.1"] or ["h2"]'})]}),ge?e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Fallbacks"}),e.jsxs(p,{type:"button",size:"sm",variant:"secondary",onClick:Ve,children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Add Fallback"]})]}),A.length===0?e.jsx("p",{className:"text-xs text-muted",children:"No fallbacks configured. Add fallback rows only when you need path/destination based routing."}):null,A.map(r=>e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-card/70 p-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Dest *"}),e.jsx("input",{value:r.dest,onChange:n=>ce(r.id,"dest",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"3001 or 127.0.0.1:3001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Path"}),e.jsx("input",{value:r.path,onChange:n=>ce(r.id,"path",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"/ws"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Name"}),e.jsx("input",{value:r.name,onChange:n=>ce(r.id,"name",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"fallback-api"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"ALPN"}),e.jsx("input",{value:r.alpn,onChange:n=>ce(r.id,"alpn",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"h2,http/1.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Xver"}),e.jsx("input",{value:r.xver,onChange:n=>ce(r.id,"xver",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"1",inputMode:"numeric"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(p,{type:"button",size:"sm",variant:"ghost",onClick:()=>_e(r.id),children:[e.jsx(Dt,{className:"mr-2 h-4 w-4 text-red-500"}),"Remove"]})})]},r.id)),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"JSON Preview"}),e.jsx("pre",{className:"max-h-36 overflow-auto rounded-lg border border-line/70 bg-card/80 p-3 text-xs text-foreground",children:$e})]}),e.jsxs("div",{className:"pt-2 border-t border-line/50",children:[e.jsx("p",{className:"mb-1 text-sm font-semibold text-foreground",children:"Quick Fallback Presets"}),e.jsx("p",{className:"mb-3 text-xs text-muted",children:"Note: Users assigned to fallback destinations automatically inherit this Master Inbound's port and REALITY security."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Ue("multiplexer"),className:"bg-brand-500/10 text-brand-700 hover:bg-brand-500/20 border-brand-500/20",children:"Setup VLESS+VMess+Trojan Multiplexer"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Ue("shadowsocks"),className:"bg-brand-500/5 text-brand-600 hover:bg-brand-500/15 border-brand-500/20",children:"Setup Shadowsocks Multiplexer"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Ue("web"),children:"Nginx Web Camouflage (Port 80)"})]})]})]}):null]}),F==="REALITY"&&Y&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"REALITY Settings"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Xe.mutate(),loading:Xe.isPending,children:"Generate REALITY Keys"})]}),e.jsx(Js,{register:m,watch:N,setValue:u,errors:te}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(k,{label:"Server Name (SNI) *",...m("serverName",{required:F==="REALITY"?"SNI is required for REALITY":!1}),placeholder:"www.microsoft.com"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Fingerprint"}),e.jsxs("select",{...m("realityFingerprint"),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"chrome",children:"Chrome"}),e.jsx("option",{value:"firefox",children:"Firefox"}),e.jsx("option",{value:"safari",children:"Safari"}),e.jsx("option",{value:"ios",children:"iOS"}),e.jsx("option",{value:"android",children:"Android"}),e.jsx("option",{value:"edge",children:"Edge"}),e.jsx("option",{value:"random",children:"Random"})]})]})]}),e.jsx(k,{label:"Public Key *",...m("realityPublicKey",{required:F==="REALITY"?"Public key is required":!1}),placeholder:"Enter REALITY public key"}),e.jsx(k,{label:"Private Key *",...m("realityPrivateKey",{required:F==="REALITY"?"Private key is required":!1}),placeholder:"Enter REALITY private key"}),e.jsx(k,{label:"Short ID",...m("realityShortId"),placeholder:"e.g., 0123456789abcdef,abcdef0123456789"}),e.jsx(k,{label:"Reality Server Names",...m("realityServerName"),placeholder:"www.microsoft.com,www.cloudflare.com"}),ue?e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"REALITY Link Template"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>{Ie()},children:M?"Copied":"Copy Template"})]}),e.jsx("pre",{className:"max-h-44 overflow-auto rounded-lg border border-line/70 bg-card/80 p-3 text-xs text-foreground",children:ue}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"w-fit rounded-lg border border-line/70 bg-white p-2",children:e.jsx(St,{value:ue,size:132})}),e.jsxs("p",{className:"text-xs text-muted",children:["Replace ","{UUID}"," with the user UUID for manual links, or use subscription URLs for automatic client import."]})]})]}):e.jsx("p",{className:"text-xs text-muted",children:"Enter server address, port, and REALITY keys to preview a share-link template."})]}),O==="WIREGUARD"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Wireguard Settings"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:Qe,children:"Auto Endpoint"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>E.mutate(),loading:E.isPending,children:"Generate Key Pair"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(k,{label:"Private Key *",...m("wgPrivateKey",{required:O==="WIREGUARD"?"Private key is required":!1}),placeholder:"Your Wireguard private key"}),e.jsx(k,{label:"Public Key",...m("wgPublicKey"),placeholder:"Your Wireguard public key"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(k,{label:"Peer Public Key *",...m("wgPeerPublicKey",{required:O==="WIREGUARD"?"Peer public key is required":!1}),placeholder:"Server's Wireguard public key"}),e.jsx(k,{label:"Peer Endpoint",...m("wgPeerEndpoint"),placeholder:"server:51820"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(k,{label:"Allowed IPs",...m("wgAllowedIPs"),placeholder:"0.0.0.0/0, ::/0"}),e.jsx(k,{label:"MTU",type:"number",...m("wgMtu",{valueAsNumber:!0}),placeholder:"1420"})]}),e.jsx(k,{label:"Client Address (optional)",...m("wgAddress"),placeholder:"10.66.2.2/32"}),Ae?e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"WireGuard Config Preview"}),e.jsx("pre",{className:"max-h-52 overflow-auto rounded-lg border border-line/70 bg-card/80 p-3 text-xs text-foreground",children:Ae}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"w-fit rounded-lg border border-line/70 bg-white p-2",children:e.jsx(St,{value:Ae,size:132})}),e.jsx("p",{className:"text-xs text-muted",children:'Scan this QR in WireGuard mobile app using "Create from QR code".'})]})]}):e.jsx("p",{className:"text-xs text-muted",children:"Enter Private Key, Peer Public Key, and Peer Endpoint to preview WireGuard config and QR."})]}),(I==="WS"||I==="XHTTP"||I==="HTTPUPGRADE")&&P&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:I==="XHTTP"?"XHTTP Settings":I==="HTTPUPGRADE"?"HTTP Upgrade Settings":"WebSocket Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(k,{label:"Path",...m("wsPath"),placeholder:I==="XHTTP"?"/xhttp":"/vless"}),e.jsx(k,{label:I==="XHTTP"?"Host (comma-separated)":"Host",...m("wsHost"),placeholder:"your.domain.com"})]}),I==="XHTTP"?e.jsx(k,{label:"Mode",...m("xhttpMode"),placeholder:"auto or packet-up"}):null]}),I==="GRPC"&&P&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"gRPC Settings"}),e.jsx(k,{label:"Service Name",...m("grpcServiceName"),placeholder:"grpc-service"})]}),O==="SHADOWSOCKS"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Shadowsocks Settings"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Cipher Method"}),e.jsxs("select",{...m("cipher"),className:"w-full rounded-xl border border-line/60 bg-card/60 px-4 py-2.5 text-sm sm:text-base text-foreground backdrop-blur-md outline-none transition-all duration-300 focus:bg-card/90 focus:border-brand-500/60 focus:ring-4 focus:ring-brand-500/10 focus:shadow-[0_0_20px_rgba(59,130,246,0.15)]",children:[e.jsx("option",{value:"chacha20-ietf-poly1305",children:"chacha20-ietf-poly1305"}),e.jsx("option",{value:"aes-256-gcm",children:"aes-256-gcm"}),e.jsx("option",{value:"aes-128-gcm",children:"aes-128-gcm"})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 z-10 -mx-5 flex flex-col gap-2 border-t border-line/70 bg-card/95 px-5 pb-2 pt-4 sm:-mx-6 sm:flex-row sm:px-6",children:[e.jsx(p,{type:"submit",className:"flex-1",loading:re.isPending,children:V?"Update Inbound":"Create Inbound"}),e.jsx(p,{type:"button",variant:"secondary",onClick:l,className:"flex-1",children:"Cancel"})]})]})]})})})},ea=[{protocol:"VLESS",title:"VLESS",useCase:"Best overall protocol for modern Xray deployments",networks:["TCP","WS","GRPC","HTTPUPGRADE","XHTTP"],security:["NONE","TLS","REALITY"],clients:["v2rayN","v2rayNG","Clash Meta","sing-box"],recommendation:"Use REALITY + XHTTP for anti-censorship or WS+TLS for CDN."},{protocol:"VMESS",title:"VMess",useCase:"Legacy compatibility with older V2Ray clients",networks:["TCP","WS","GRPC","HTTP"],security:["NONE","TLS"],clients:["v2rayN","v2rayNG","some Clash cores"],recommendation:"Prefer VLESS for new installs; keep VMess for migration."},{protocol:"TROJAN",title:"Trojan",useCase:"TLS-native protocol with strong censorship resistance",networks:["TCP","WS","GRPC"],security:["TLS"],clients:["Clash","sing-box","NekoBox"],recommendation:"Use gRPC+TLS for clean setup and stable performance."},{protocol:"SHADOWSOCKS",title:"Shadowsocks",useCase:"Lightweight encrypted proxy for low overhead scenarios",networks:["TCP"],security:["NONE"],clients:["Shadowrocket","Clash","Outline-compatible apps"],recommendation:"Great fallback profile; pair with strong cipher."},{protocol:"SOCKS",title:"SOCKS5",useCase:"Generic proxy for apps and browsers",networks:["TCP"],security:["NONE"],clients:["Browsers","OS proxy","Proxifier"],recommendation:"Use for local gateway use-cases with account auth."},{protocol:"HTTP",title:"HTTP Proxy",useCase:"Simple forward proxy for standard HTTP tooling",networks:["TCP"],security:["NONE"],clients:["Browsers","curl","system proxy"],recommendation:"Use where HTTP proxy support is explicitly required."},{protocol:"DOKODEMO_DOOR",title:"Dokodemo-door",useCase:"Traffic forwarding and transparent proxy integration",networks:["TCP"],security:["NONE"],clients:["Xray internal routing","DNS forwarders"],recommendation:"Ideal for DNS forward and transparent redirection flows."},{protocol:"WIREGUARD",title:"WireGuard",useCase:"Tunnel outbound transport through WireGuard peer",networks:["TCP"],security:["NONE"],clients:["WireGuard app (for preview config)","Xray upstream"],recommendation:"Set peer endpoint + keys first, then route traffic through it."},{protocol:"MTPROTO",title:"MTProto",useCase:"Telegram-specific proxy protocol",networks:["TCP"],security:["NONE"],clients:["Telegram MTProto proxy clients"],recommendation:"Use dedicated port and isolate from normal user traffic."}],ta=({onQuickCreate:t})=>{const{t:d}=at();return e.jsxs(ee,{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4 text-brand-500"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:d("compatibility.title",{defaultValue:"Protocol Compatibility Matrix"})})]}),e.jsx("div",{className:"space-y-3",children:ea.map(l=>e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/65 p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:l.title}),e.jsx(Rt,{variant:"info",children:l.protocol})]}),e.jsx("p",{className:"text-sm text-muted",children:l.useCase}),e.jsx("p",{className:"text-xs text-muted",children:l.recommendation}),e.jsxs("div",{className:"pt-1",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted",children:d("compatibility.networks",{defaultValue:"Networks"})}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.networks.map(o=>e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-1 text-xs font-medium text-foreground",children:o},`${l.protocol}-${o}`))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted",children:d("compatibility.security",{defaultValue:"Security"})}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.security.map(o=>e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-1 text-xs font-medium text-foreground",children:o},`${l.protocol}-${o}`))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted",children:d("compatibility.clients",{defaultValue:"Supported Clients"})}),e.jsx("p",{className:"text-xs text-foreground/90",children:l.clients.join(" · ")})]})]}),e.jsx("div",{className:"md:pl-4",children:e.jsx(p,{type:"button",size:"sm",onClick:()=>t(l.protocol),className:"w-full md:w-auto",children:d("compatibility.quickCreate",{defaultValue:"Quick Create"})})})]})},l.protocol))})]})},sa=["recommended","cdn","transport","utility"],me={recommended:{title:"Recommended",hint:"Balanced defaults for most deployments."},cdn:{title:"CDN & Edge",hint:"Traffic profiles optimized for edge/CDN transport."},transport:{title:"Transport Profiles",hint:"Focused presets for specific transport behaviors."},utility:{title:"Utility & Gateway",hint:"DNS forwarders, gateways, and service adapters."}};function It(t){return t==="inbounds"||t==="templates"||t==="compatibility"}function ct(t){if(typeof t=="number")return Number.isFinite(t)?t:0;if(typeof t=="string"&&t.trim()){const d=Number.parseFloat(t);return Number.isFinite(d)?d:0}return 0}const aa=new Set(["VLESS","VMESS","TROJAN","SHADOWSOCKS","SOCKS","HTTP","DOKODEMO_DOOR","WIREGUARD","MTPROTO"]),ra=new Set(["TCP","WS","GRPC","HTTP","HTTPUPGRADE","XHTTP"]),na=new Set(["NONE","TLS","REALITY"]);function la(t){const d=String(t||"VLESS").toUpperCase();return aa.has(d)?d:"VLESS"}function oa(t,d){const l=String(t||"").toUpperCase();return ra.has(l)?l:d==="DOKODEMO_DOOR"||d==="SOCKS"||d==="HTTP"?"TCP":"WS"}function ia(t,d){const l=String(t||"").toUpperCase();return d==="TROJAN"?"TLS":na.has(l)?l==="REALITY"&&d!=="VLESS"?"NONE":l:"NONE"}function Lt(t,d,l){const o=String(t||d).trim().replace(/\s+/g,"-").toLowerCase();let v=o||d,g=1;for(;l.has(v);)v=`${o||d}-${g}`,g+=1;return l.add(v),v}function Ot(t,d,l){let o=Number.parseInt(String(t??l),10);for((Number.isNaN(o)||o<1||o>65535)&&(o=l);d.has(o)||o<1||o>65535;)o+=1,o>65535&&(o=1024);return d.add(o),o}function da(t,d,l,o){const v=la(t.protocol),g=oa(t.network,v),M=ia(t.security,v),C=2e4+d,V=Ot(t.port,o,C),D=Lt(t.tag,`${v.toLowerCase()}-${V}`,l),L={protocol:v,network:g,security:M,port:V,tag:D,remark:typeof t.remark=="string"?t.remark:void 0,serverAddress:typeof t.serverAddress=="string"&&t.serverAddress.trim()?t.serverAddress.trim():"127.0.0.1"},A=["serverName","wsPath","wsHost","xhttpMode","grpcServiceName","alpn","cipher","realityPublicKey","realityPrivateKey","realityShortId","realityFingerprint","wgPrivateKey","wgPublicKey","wgAddress","wgPeerPublicKey","wgPeerEndpoint","wgAllowedIPs","wgMtu","dokodemoTargetPort","dokodemoNetwork","dokodemoFollowRedirect","domains","fallbacks"];for(const x of A){const m=t[x];m!==void 0&&(L[x]=m)}return v==="DOKODEMO_DOOR"&&L.dokodemoTargetPort===void 0&&(L.dokodemoTargetPort=80),L}function Ft(t){const d={port:t.port,protocol:t.protocol,tag:t.tag,remark:t.remark,enabled:t.enabled,network:t.network,security:t.security,serverName:t.serverName,serverAddress:t.serverAddress,alpn:t.alpn,wsPath:t.wsPath,wsHost:t.wsHost,xhttpMode:t.xhttpMode,grpcServiceName:t.grpcServiceName,cipher:t.cipher,realityPublicKey:t.realityPublicKey,realityPrivateKey:t.realityPrivateKey,realityFingerprint:t.realityFingerprint,realityShortIds:t.realityShortIds,realityServerNames:t.realityServerNames,wgPrivateKey:t.wgPrivateKey,wgPublicKey:t.wgPublicKey,wgAddress:t.wgAddress,wgPeerPublicKey:t.wgPeerPublicKey,wgPeerEndpoint:t.wgPeerEndpoint,wgAllowedIPs:t.wgAllowedIPs,wgMtu:t.wgMtu,dokodemoTargetPort:t.dokodemoTargetPort,dokodemoNetwork:t.dokodemoNetwork,dokodemoFollowRedirect:t.dokodemoFollowRedirect,domains:t.domains,fallbacks:t.fallbacks};return Object.fromEntries(Object.entries(d).filter(([,l])=>l!=null))}function Ze(t){const d=String(t.values.protocol||"vless").toLowerCase(),l=Number(t.values.port||443);return{...t.values,tag:t.values.tag||`${d}-${l}`,serverAddress:t.values.serverAddress||"your.domain.com"}}function Kt(t,d){const l=Ft(t),o=new Set(d.map(C=>C.tag)),v=new Set(d.map(C=>C.port)),g=Lt(`${t.tag}-copy`,`${t.protocol.toLowerCase()}-copy`,o),M=Ot(t.port+1,v,t.port+1);return{...l,tag:g,port:M,remark:`${t.remark||t.tag} (Clone)`}}function ca(t){var l;const d={...t};if(Array.isArray(t.domains)&&(d.domains=t.domains.map(o=>String(o)).join(", ")),Array.isArray(t.fallbacks)&&(d.fallbacks=JSON.stringify(t.fallbacks,null,2)),!d.realityShortId&&Array.isArray(t.realityShortIds)){const o=(l=t.realityShortIds)==null?void 0:l[0];o!=null&&(d.realityShortId=String(o))}return d}function ua(t,d){return ca(Kt(t,d))}function ma(t){const d=t.toLowerCase().replace(/_/g,"-");return{protocol:t,port:443,tag:`${d}-new`,remark:`${t} inbound`,network:"TCP",security:"NONE",serverAddress:"your.domain.com"}}const pa=()=>{var jt,wt;const{t}=at(),d=gs(),l=fs(),o=mt(),v=f.useRef(null),[g,M]=hs(),C=bs(s=>s.admin),V=(C==null?void 0:C.role)==="SUPER_ADMIN",D=f.useMemo(()=>[{id:"inbounds",label:t("inbounds.tabs.inbounds",{defaultValue:"Inbounds"})},{id:"templates",label:t("inbounds.tabs.templates",{defaultValue:"Templates"})},{id:"compatibility",label:t("inbounds.tabs.compatibility",{defaultValue:"Compatibility"})}],[t]),L=f.useMemo(()=>({recommended:{title:t("inbounds.templateCategories.recommended.title",{defaultValue:me.recommended.title}),hint:t("inbounds.templateCategories.recommended.hint",{defaultValue:me.recommended.hint})},cdn:{title:t("inbounds.templateCategories.cdn.title",{defaultValue:me.cdn.title}),hint:t("inbounds.templateCategories.cdn.hint",{defaultValue:me.cdn.hint})},transport:{title:t("inbounds.templateCategories.transport.title",{defaultValue:me.transport.title}),hint:t("inbounds.templateCategories.transport.hint",{defaultValue:me.transport.hint})},utility:{title:t("inbounds.templateCategories.utility.title",{defaultValue:me.utility.title}),hint:t("inbounds.templateCategories.utility.hint",{defaultValue:me.utility.hint})}}),[t]),[A,x]=f.useState(!1),[m,$]=f.useState(null),[u,y]=f.useState(null),[N,te]=f.useState(null),[O,I]=f.useState(null),[F,ie]=f.useState(null),[Me,je]=f.useState(null),[we,Se]=f.useState(null),[ke,Le]=f.useState(null),[Pe,Te]=f.useState([]),[_,q]=f.useState([]),[w,xe]=f.useState(null),[ze,J]=f.useState(!1),[P,B]=f.useState({serverAddress:"",serverName:"",cdnHost:"",fallbackPorts:"8443,9443",assignUserIds:[],assignGroupIds:[]}),[Y,ge]=f.useState(null),[Oe,Fe]=f.useState(()=>Date.now()),fe=Ms("one-ui/inbounds-filters",{defaultTab:"inbounds",viewMode:"auto"}),{views:de,saveView:Ce,deleteView:qe}=Ls("one-ui/inbounds-saved-views"),[Z,Ke]=f.useState(""),[K,$e]=f.useState(()=>{const s=g.get("tab");return It(s)?s:fe.value.defaultTab}),se=fe.value.viewMode,ae=s=>{fe.setValue(a=>({...a,viewMode:s}))},Ye=g.get("quick"),Ve=g.get("tab");f.useEffect(()=>{if(Ye==="create"){$(null),y(null),x(!0),$e("inbounds");const s=new URLSearchParams(g);s.delete("quick"),s.set("tab","inbounds"),M(s,{replace:!0})}},[Ye,g,M]),f.useEffect(()=>{It(Ve)&&Ve!==K&&$e(Ve)},[Ve,K]),f.useEffect(()=>{fe.setValue(s=>s.defaultTab===K?s:{...s,defaultTab:K})},[K,fe]);const{data:_e,isLoading:ce,isFetching:Ue}=et({queryKey:["inbounds"],queryFn:async()=>(await T.get("/inbounds")).data,placeholderData:ys,staleTime:3e4}),{data:re=[]}=et({queryKey:["inbounds-users-directory"],queryFn:async()=>{var j;let a=1,i=1;const c=[];for(;a<=i&&a<=50;){const S=await T.get("/users",{params:{page:a,limit:100}});Array.isArray(S.data)&&c.push(...S.data),i=Number(((j=S.meta)==null?void 0:j.totalPages)||1),a+=1}return c},staleTime:2e4}),{data:Be=[]}=et({queryKey:["inbounds-assignable-groups"],queryFn:async()=>(await Ds.list({page:1,limit:100,includeDisabled:!0})).data||[],staleTime:3e4}),E=f.useMemo(()=>_e||[],[_e]),Xe=f.useMemo(()=>re.map(s=>Number(s.id)).filter(s=>Number.isInteger(s)&&s>0),[re]),he=Fs(Xe,{includeOffline:!0,live:!0,streamInterval:2e3}),Qe=_.length,rt=E.length>0&&_.length===E.length,Ae=z({mutationFn:async s=>{const a=new Set(E.map(S=>S.tag)),i=new Set(E.map(S=>S.port));let c=0;const j=[];for(const[S,X]of s.entries())try{const G=da(X,S,a,i);await T.post("/inbounds",G),c+=1}catch(G){j.push(`Item ${S+1}: ${(G==null?void 0:G.message)||"Unknown error"}`)}return{success:c,failures:j}},onSuccess:async({success:s,failures:a})=>{await l.invalidateQueries({queryKey:["inbounds"]});const i=a.length;i>0?o.error(t("inbounds.import.completedWarningsTitle",{defaultValue:"Import completed with warnings"}),t("inbounds.import.completedWarningsBody",{defaultValue:"Imported {{success}} profile(s), {{failed}} failed. {{details}}",success:s,failed:i,details:a.slice(0,3).join(" | ")})):o.success(t("inbounds.import.completedTitle",{defaultValue:"Import completed"}),t("inbounds.import.completedBody",{defaultValue:"Successfully imported {{count}} profile(s).",count:s}))},onError:s=>{o.error(t("inbounds.import.failedTitle",{defaultValue:"Import failed"}),(s==null?void 0:s.message)||t("inbounds.import.failedBody",{defaultValue:"Failed to import inbound profiles"}))}}),We=z({mutationFn:async s=>T.post("/inbounds/presets/myanmar",s),onSuccess:async s=>{var Q,le;const a=(s==null?void 0:s.data)||{},i=!!a.dryRun,c=a.warnings||[];if(i){ge(a);const Ne=((Q=a.planned)==null?void 0:Q.length)||0;c.length>0?o.error(t("inbounds.myanmarPack.previewWarningsTitle",{defaultValue:"Myanmar pack preview generated with warnings"}),t("inbounds.myanmarPack.previewWarningsBody",{defaultValue:"{{count}} planned profile(s). {{details}}",count:Ne,details:c.slice(0,3).join(" | ")})):o.success(t("inbounds.myanmarPack.previewTitle",{defaultValue:"Myanmar pack preview generated"}),t("inbounds.myanmarPack.previewBody",{defaultValue:"{{count}} planned profile(s).",count:Ne}));return}await l.invalidateQueries({queryKey:["inbounds"]});const j=((le=a.created)==null?void 0:le.length)||0,S=a.assignment||{},X=Number(S.assignedUsers||0),G=Number(S.assignedGroups||0);let R="";(X>0||G>0)&&(R=`
${t("inbounds.myanmarPack.assignedSummary",{defaultValue:"Assigned to {{users}} user(s) and {{groups}} group(s).",users:X,groups:G})}`),await Promise.all([l.invalidateQueries({queryKey:["users"]}),l.invalidateQueries({queryKey:["groups"]}),l.invalidateQueries({queryKey:["inbounds-assignable-groups"]}),l.invalidateQueries({queryKey:["inbounds-users-directory"]})]),c.length>0?o.error(t("inbounds.myanmarPack.appliedWarningsTitle",{defaultValue:"Myanmar pack applied with warnings"}),t("inbounds.myanmarPack.appliedWarningsBody",{defaultValue:"{{count}} profile(s) created.{{assignment}} {{details}}",count:j,assignment:R,details:c.slice(0,3).join(" | ")})):o.success(t("inbounds.myanmarPack.appliedTitle",{defaultValue:"Myanmar pack applied"}),t("inbounds.myanmarPack.appliedBody",{defaultValue:"{{count}} profile(s) created.{{assignment}}",count:j,assignment:R})),J(!1),ge(null)},onError:s=>{o.error(t("inbounds.myanmarPack.failedTitle",{defaultValue:"Myanmar pack failed"}),(s==null?void 0:s.message)||t("inbounds.myanmarPack.failedBody",{defaultValue:"Failed to apply Myanmar pack"}))}}),ue=z({mutationFn:async s=>{await T.delete(`/inbounds/${s}`)},onSuccess:()=>{l.invalidateQueries({queryKey:["inbounds"]})}}),Ie=z({mutationFn:async s=>{await T.post("/inbounds/bulk/delete",{inboundIds:s})},onSuccess:async()=>{q([]),await l.invalidateQueries({queryKey:["inbounds"]})}}),Ee=z({mutationFn:async s=>{await T.post("/inbounds/bulk/enable",{inboundIds:s})},onSuccess:async()=>{q([]),await l.invalidateQueries({queryKey:["inbounds"]})}}),Re=z({mutationFn:async s=>{await T.post("/inbounds/bulk/disable",{inboundIds:s})},onSuccess:async()=>{q([]),await l.invalidateQueries({queryKey:["inbounds"]})}}),He=z({mutationFn:async s=>{await T.post(`/inbounds/${s}/toggle`)},onSuccess:()=>{l.invalidateQueries({queryKey:["inbounds"]})}}),be=z({mutationFn:async s=>{await T.post(`/inbounds/${s}/random-port`)},onMutate:s=>{Le(s)},onSuccess:async()=>{await l.invalidateQueries({queryKey:["inbounds"]})},onError:s=>{o.error(t("inbounds.randomPortFailedTitle",{defaultValue:"Randomize port failed"}),(s==null?void 0:s.message)||t("inbounds.randomPortFailedBody",{defaultValue:"Failed to randomize inbound port"}))},onSettled:()=>{Le(null)}});f.useEffect(()=>{q(s=>s.filter(a=>E.some(i=>i.id===a)))},[E]),f.useEffect(()=>{Te(s=>s.filter(a=>E.some(i=>i.id===a)))},[E]),f.useEffect(()=>{const s=window.setInterval(()=>{Fe(Date.now())},6e4);return()=>{window.clearInterval(s)}},[]);const r=f.useMemo(()=>{var a;const s=new Map;for(const i of((a=he.data)==null?void 0:a.sessions)||[])s.set(String(i.uuid||""),{online:!!i.online,currentIp:i.currentIp,lastSeenAt:i.lastSeenAt});return s},[(jt=he.data)==null?void 0:jt.sessions]),n=f.useMemo(()=>{var a;const s=(((a=he.data)==null?void 0:a.sessions)||[]).filter(i=>i.online).map(i=>String(i.uuid||"")).filter(Boolean);return new Set(s)},[(wt=he.data)==null?void 0:wt.sessions]),h=f.useMemo(()=>{var a;const s=new Map;for(const i of re){const c=Array.isArray(i.inbounds)?i.inbounds:[];for(const j of c){const S=Number(j.inboundId??((a=j.inbound)==null?void 0:a.id));if(!Number.isInteger(S)||S<1)continue;const X=ct(i.uploadUsed),G=ct(i.downloadUsed),R=ct(i.dataLimit),Q=X+G,le={id:Number(i.id),email:String(i.email||""),uuid:String(i.uuid||""),status:String(i.status||""),enabled:!!j.enabled,priority:Number.isInteger(Number(j.priority))?Number(j.priority):100,expireDate:String(i.expireDate||""),uploadUsed:X,downloadUsed:G,dataLimit:R,totalUsed:Q},Ne=s.get(S)||[];Ne.push(le),s.set(S,Ne)}}for(const[i,c]of s.entries())c.sort((j,S)=>j.priority!==S.priority?j.priority-S.priority:j.email.localeCompare(S.email)),s.set(i,c);return s},[re]),b=s=>{q(a=>a.includes(s)?a.filter(i=>i!==s):[...a,s])},U=s=>{Te(a=>a.includes(s)?a.filter(i=>i!==s):[...a,s])},W=()=>{if(rt){q([]);return}q(E.map(s=>s.id))},ne=Ie.isPending||Ee.isPending||Re.isPending,ye=async(s={})=>{const a=[l.invalidateQueries({queryKey:["inbounds"]})];he.streamStatus!=="connected"&&a.push(l.invalidateQueries({queryKey:["user-sessions"]})),s.includeUsersDirectory&&a.push(l.invalidateQueries({queryKey:["inbounds-users-directory"]})),await Promise.all(a)},H=Os(()=>ye(),{enabled:K==="inbounds",intervalMs:5e3}),De=async(s,a,i)=>{je(s);try{await a(),await ye({includeUsersDirectory:!0})}catch(c){o.error(t("inbounds.clientActionFailedTitle",{defaultValue:"Client action failed"}),(c==null?void 0:c.message)||i)}finally{je(null)}},$t=async()=>{if(!V){o.error(t("inbounds.permissionDeniedTitle",{defaultValue:"Permission denied"}),t("inbounds.permissionDeniedDeleteBody",{defaultValue:"Only SUPER_ADMIN can delete inbounds."}));return}_.length!==0&&xe({type:"bulk-delete",ids:[..._]})},Ut=async()=>{if(w)try{w.type==="bulk-delete"?(await Ie.mutateAsync(w.ids),o.success(t("inbounds.bulkDeleteSuccessTitle",{defaultValue:"Bulk delete completed"}),t("inbounds.bulkDeleteSuccessBody",{defaultValue:"Deleted {{count}} inbound(s).",count:w.ids.length}))):(await ue.mutateAsync(w.id),o.success(t("inbounds.deleteSuccessTitle",{defaultValue:"Inbound deleted"}),t("inbounds.deleteSuccessBody",{defaultValue:'Deleted inbound "{{name}}".',name:w.label}))),xe(null)}catch(s){o.error(t("inbounds.deleteFailedTitle",{defaultValue:"Delete failed"}),(s==null?void 0:s.message)||t("inbounds.deleteFailedBody",{defaultValue:"Failed to delete inbound"}))}},Bt=async()=>{if(_.length!==0)try{await Ee.mutateAsync(_),o.success(t("inbounds.bulkEnableSuccessTitle",{defaultValue:"Bulk enable completed"}),t("inbounds.bulkEnableSuccessBody",{defaultValue:"Selected inbounds enabled."}))}catch(s){o.error(t("inbounds.bulkEnableFailedTitle",{defaultValue:"Bulk enable failed"}),(s==null?void 0:s.message)||t("inbounds.bulkEnableFailedBody",{defaultValue:"Failed to enable selected inbounds"}))}},Wt=async()=>{if(_.length!==0)try{await Re.mutateAsync(_),o.success(t("inbounds.bulkDisableSuccessTitle",{defaultValue:"Bulk disable completed"}),t("inbounds.bulkDisableSuccessBody",{defaultValue:"Selected inbounds disabled."}))}catch(s){o.error(t("inbounds.bulkDisableFailedTitle",{defaultValue:"Bulk disable failed"}),(s==null?void 0:s.message)||t("inbounds.bulkDisableFailedBody",{defaultValue:"Failed to disable selected inbounds"}))}},nt=z({mutationFn:async s=>{const a=Kt(s,E);await T.post("/inbounds",a)},onMutate:s=>{Se(s.id)},onSuccess:async()=>{await l.invalidateQueries({queryKey:["inbounds"]}),o.success(t("inbounds.cloneSuccessTitle",{defaultValue:"Inbound cloned"}),t("inbounds.cloneSuccessBody",{defaultValue:"Inbound cloned successfully."}))},onError:s=>{o.error(t("inbounds.cloneFailedTitle",{defaultValue:"Clone failed"}),(s==null?void 0:s.message)||t("inbounds.cloneFailedBody",{defaultValue:"Failed to clone inbound"}))},onSettled:()=>{Se(null)}}),pt=f.useMemo(()=>({VLESS:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",VMESS:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",TROJAN:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",SHADOWSOCKS:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",SOCKS:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300",HTTP:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-300",DOKODEMO_DOOR:"bg-teal-100 text-teal-800 dark:bg-teal-900/30 dark:text-teal-300",WIREGUARD:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-300",MTPROTO:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300"}),[]),xt=(s,a={})=>{const i=!!a.mobile,c=[];if(c.push({key:"templates",label:t("inbounds.actionMenu.templates",{defaultValue:"Client templates"}),icon:Us,onClick:()=>I(s)}),c.push({key:"details",label:t("inbounds.actionMenu.details",{defaultValue:"Inbound details"}),icon:dt,onClick:()=>ie(s)}),a.includeRandomPort){const j=!!(be.isPending&&ke===s.id);c.push({key:"random-port",label:j?t("inbounds.actionMenu.randomPortPending",{defaultValue:"Assigning random port..."}):t("inbounds.actionMenu.randomPort",{defaultValue:"Assign random free port"}),icon:ut,disabled:j,onClick:()=>be.mutate(s.id)})}return c.push({key:"clone",label:we===s.id&&nt.isPending?t("inbounds.actionMenu.clonePending",{defaultValue:"Cloning..."}):t("inbounds.actionMenu.clone",{defaultValue:"Clone inbound"}),icon:Is,disabled:!!(we===s.id&&nt.isPending),onClick:()=>nt.mutate(s)}),c.push({key:"clone-edit",label:t("inbounds.actionMenu.cloneEdit",{defaultValue:"Clone + edit"}),icon:tt,onClick:()=>ts(s)}),c.push({key:"edit",label:t("inbounds.actionMenu.edit",{defaultValue:"Edit inbound"}),icon:Bs,onClick:()=>{y(null),$(s)}}),V&&c.push({key:"delete",label:t("inbounds.actionMenu.delete",{defaultValue:"Delete inbound"}),icon:Dt,tone:"danger",onClick:()=>void as(s.id)}),c.length===0?null:e.jsx(Ns,{items:c,ariaLabel:t("common.moreActions",{defaultValue:"More actions"}),triggerClassName:`rounded-lg border border-line/60 bg-card/70 px-2 py-1 text-foreground transition hover:bg-panel/70 focus:outline-none focus:ring-2 focus:ring-brand-500/40 disabled:cursor-not-allowed disabled:opacity-50 ${i?"inline-flex h-10 w-10 items-center justify-center":"inline-flex h-8 w-8 items-center justify-center"}`,children:e.jsx(js,{className:"h-4 w-4"})})},lt=f.useMemo(()=>[...re].sort((s,a)=>String(s.email||"").localeCompare(String(a.email||""))).slice(0,500),[re]),ot=f.useMemo(()=>[...Be].sort((s,a)=>String(s.name||"").localeCompare(String(a.name||""))),[Be]),Ht=f.useMemo(()=>new Set(P.assignUserIds),[P.assignUserIds]),Gt=f.useMemo(()=>new Set(P.assignGroupIds),[P.assignGroupIds]),zt=f.useMemo(()=>{const s=new Map;for(const a of st)s.has(a.values.protocol)||s.set(a.values.protocol,a);return s},[]),qt=f.useMemo(()=>{const s={recommended:[],cdn:[],transport:[],utility:[]};for(const a of st)s[a.category].push(a);return s},[]),ve=s=>{$(null),y(s||null),x(!0)},Yt=()=>{B(s=>({...s,serverAddress:s.serverAddress||"",serverName:s.serverName||"",cdnHost:s.cdnHost||"",fallbackPorts:s.fallbackPorts||"8443,9443"})),ge(null),J(!0)},_t=(s,a)=>{B(i=>{const c=new Set(i.assignUserIds);return a?c.add(s):c.delete(s),{...i,assignUserIds:Array.from(c)}})},Xt=(s,a)=>{B(i=>{const c=new Set(i.assignGroupIds);return a?c.add(s):c.delete(s),{...i,assignGroupIds:Array.from(c)}})},Qt=()=>{B(s=>({...s,assignUserIds:lt.map(a=>Number(a.id))}))},Jt=()=>{B(s=>({...s,assignUserIds:[]}))},Zt=()=>{B(s=>({...s,assignGroupIds:ot.map(a=>Number(a.id))}))},es=()=>{B(s=>({...s,assignGroupIds:[]}))},gt=async(s=!1)=>{if(!P.serverAddress.trim()){o.error(t("common.validationFailed",{defaultValue:"Validation failed"}),t("inbounds.myanmarPack.serverAddressRequired",{defaultValue:"Server address is required."}));return}const a={serverAddress:P.serverAddress.trim(),serverName:P.serverName.trim()||P.serverAddress.trim(),cdnHost:P.cdnHost.trim()||void 0,fallbackPorts:P.fallbackPorts.trim()||void 0,userIds:P.assignUserIds,groupIds:P.assignGroupIds,dryRun:s};await We.mutateAsync(a)},ts=s=>{ve(ua(s,E))},ss=s=>{const a=zt.get(s);if(a){ve(Ze(a));return}ve(ma(s))},ft=()=>{x(!1),$(null),y(null)},ht=s=>{$e(s);const a=new URLSearchParams(g);a.set("tab",s),M(a,{replace:!0})},bt=()=>{const s=window.prompt(t("inbounds.savedViews.promptName",{defaultValue:"Name this inbounds view"}));if(s)try{const a=Ce(s,{tab:K,viewMode:se});Ke(a.id),o.success(t("inbounds.savedViews.savedTitle",{defaultValue:"View saved"}),t("inbounds.savedViews.savedBody",{defaultValue:'Saved view "{{name}}".',name:a.name}))}catch(a){o.error(t("inbounds.savedViews.saveFailedTitle",{defaultValue:"Save view failed"}),(a==null?void 0:a.message)||t("inbounds.savedViews.saveFailedBody",{defaultValue:"Failed to save view"}))}},yt=s=>{Ke(s);const a=de.find(i=>i.id===s);a&&(ae(a.filters.viewMode||"auto"),ht(a.filters.tab||"inbounds"))},vt=()=>{Z&&(qe(Z),Ke(""))},as=async s=>{if(!V){o.error(t("inbounds.permissionDeniedTitle",{defaultValue:"Permission denied"}),t("inbounds.permissionDeniedDeleteBody",{defaultValue:"Only SUPER_ADMIN can delete inbounds."}));return}const a=E.find(i=>i.id===s);xe({type:"single-delete",id:s,label:(a==null?void 0:a.remark)||(a==null?void 0:a.tag)||`#${s}`})},rs=()=>{if(E.length===0){o.error(t("inbounds.export.unavailableTitle",{defaultValue:"Export unavailable"}),t("inbounds.export.unavailableBody",{defaultValue:"No inbounds to export."}));return}const s={app:"One-UI",version:"1.0.0",exportedAt:new Date().toISOString(),inbounds:E.map(Ft)},a=new Blob([JSON.stringify(s,null,2)],{type:"application/json;charset=utf-8"}),i=URL.createObjectURL(a),c=document.createElement("a");c.href=i,c.download=`one-ui-inbounds-${new Date().toISOString().replace(/[:.]/g,"-")}.json`,c.click(),URL.revokeObjectURL(i)},ns=s=>{if(Array.isArray(s))return s.filter(a=>a&&typeof a=="object");if(s&&typeof s=="object"){const a=s;return Array.isArray(a.inbounds)?a.inbounds.filter(i=>i&&typeof i=="object"):[a]}return[]},ls=async s=>{var i;const a=(i=s.target.files)==null?void 0:i[0];if(s.target.value="",!!a)try{const c=await a.text(),j=JSON.parse(c),S=ns(j);if(S.length===0){o.error(t("inbounds.import.failedTitle",{defaultValue:"Import failed"}),t("inbounds.import.noValidProfilesBody",{defaultValue:"No valid inbound profiles found in selected file."}));return}await Ae.mutateAsync(S)}catch(c){o.error(t("inbounds.import.failedTitle",{defaultValue:"Import failed"}),(c==null?void 0:c.message)||t("inbounds.import.invalidJsonBody",{defaultValue:"Invalid JSON file"}))}},Je=s=>{if(!Number.isFinite(s)||s<=0)return"0 B";const a=["B","KB","MB","GB","TB","PB"],i=Math.min(Math.floor(Math.log(s)/Math.log(1024)),a.length-1),c=s/1024**i;return`${c.toFixed(c>=100?0:c>=10?1:2)} ${a[i]}`},os=s=>{const a=new Date(s);if(Number.isNaN(a.getTime()))return null;const i=a.getTime()-Oe;return Math.ceil(i/(1e3*60*60*24))},is=(w==null?void 0:w.type)==="bulk-delete"?t("inbounds.bulkDeleteTitle",{defaultValue:"Delete Selected Inbounds"}):(w==null?void 0:w.type)==="single-delete"?t("inbounds.deleteTitle",{defaultValue:"Delete Inbound"}):"",ds=(w==null?void 0:w.type)==="bulk-delete"?t("inbounds.bulkDeleteBody",{defaultValue:"Delete {{count}} selected inbound(s)? This action cannot be undone.",count:w.ids.length}):(w==null?void 0:w.type)==="single-delete"?t("inbounds.deleteBody",{defaultValue:'Delete inbound "{{name}}"? Associated users may lose access.',name:w.label}):"",Nt=(w==null?void 0:w.type)==="bulk-delete"?Ie.isPending:(w==null?void 0:w.type)==="single-delete"?ue.isPending:!1,cs=se==="auto"?"hidden overflow-hidden p-0 lg:block":se==="table"?"overflow-hidden p-0":"hidden",us=se==="auto"?"grid grid-cols-1 gap-4 lg:hidden":se==="cards"?"grid grid-cols-1 gap-4":"hidden";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("input",{ref:v,type:"file",accept:"application/json,.json",className:"hidden",onChange:ls}),e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:t("inbounds.title",{defaultValue:"Inbounds"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("inbounds.subtitle",{defaultValue:"Manage your Xray inbound configurations and reusable profiles."})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[K==="inbounds"?e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"secondary",onClick:W,disabled:E.length===0,children:rt?t("inbounds.clearSelection",{defaultValue:"Clear Selection"}):t("common.selectAll",{defaultValue:"Select All"})}),e.jsxs(p,{variant:"secondary",onClick:rs,children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),t("inbounds.exportJson",{defaultValue:"Export JSON"})]}),e.jsxs(p,{variant:"secondary",onClick:()=>{var s;return(s=v.current)==null?void 0:s.click()},loading:Ae.isPending,children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),t("inbounds.importJson",{defaultValue:"Import JSON"})]}),e.jsxs(p,{variant:"secondary",onClick:Yt,loading:We.isPending,children:[e.jsx(kt,{className:"mr-2 h-4 w-4"}),t("inbounds.applyMyanmarPack",{defaultValue:"Apply Myanmar Pack"})]})]}):null,e.jsxs(p,{onClick:()=>ve(),children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),t("inbounds.addInbound",{defaultValue:"Add Inbound"})]})]})]}),e.jsx(ee,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/40 p-3",children:[e.jsxs("details",{className:"group lg:hidden",children:[e.jsxs("summary",{className:"flex list-none items-center justify-between gap-3 rounded-xl px-2 py-2 text-left text-sm font-medium text-foreground transition hover:bg-panel/50 [&::-webkit-details-marker]:hidden",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate",children:t("common.advancedControls",{defaultValue:"Advanced controls"})}),e.jsx("p",{className:"mt-0.5 text-xs font-normal text-muted",children:t("autoRefresh.line",{defaultValue:"Auto refresh: {{status}} ({{seconds}}s)",status:t(`autoRefresh.status.${H.status}`,{defaultValue:H.statusLabel}),seconds:Math.ceil(H.nextRunInMs/1e3)})})]}),e.jsx(Pt,{className:"h-5 w-5 shrink-0 text-muted transition-transform group-open:rotate-180"})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"min-w-[180px] flex-1 rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",value:Z,onChange:s=>yt(s.target.value),children:[e.jsx("option",{value:"",children:t("common.savedViews",{defaultValue:"Saved views"})}),de.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:bt,children:t("common.saveView",{defaultValue:"Save View"})}),e.jsx(p,{size:"sm",variant:"ghost",onClick:vt,disabled:!Z,children:t("common.removeView",{defaultValue:"Remove View"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"inline-flex rounded-xl border border-line/70 bg-card/70 p-1",children:["auto","table","cards"].map(s=>e.jsx("button",{type:"button",onClick:()=>ae(s),className:`rounded-lg px-3 py-1.5 text-xs font-medium transition-colors ${se===s?"bg-gradient-to-r from-brand-500 to-brand-600 text-white":"text-muted hover:text-foreground"}`,children:t(`viewMode.${s}`,{defaultValue:s.toUpperCase()})},s))}),e.jsx(p,{size:"sm",variant:"ghost",onClick:H.togglePaused,children:H.paused?t("autoRefresh.resume",{defaultValue:"Resume Auto"}):t("autoRefresh.pause",{defaultValue:"Pause Auto"})})]})]})]}),e.jsxs("div",{className:"hidden items-center justify-between gap-3 lg:flex",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"min-w-[180px] rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",value:Z,onChange:s=>yt(s.target.value),children:[e.jsx("option",{value:"",children:t("common.savedViews",{defaultValue:"Saved views"})}),de.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:bt,children:t("common.saveView",{defaultValue:"Save View"})}),e.jsx(p,{size:"sm",variant:"ghost",onClick:vt,disabled:!Z,children:t("common.removeView",{defaultValue:"Remove View"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"inline-flex rounded-xl border border-line/70 bg-card/70 p-1",children:["auto","table","cards"].map(s=>e.jsx("button",{type:"button",onClick:()=>ae(s),className:`rounded-lg px-3 py-1.5 text-xs font-medium transition-colors ${se===s?"bg-gradient-to-r from-brand-500 to-brand-600 text-white":"text-muted hover:text-foreground"}`,children:t(`viewMode.${s}`,{defaultValue:s.toUpperCase()})},s))}),e.jsx(p,{size:"sm",variant:"ghost",onClick:H.togglePaused,children:H.paused?t("autoRefresh.resume",{defaultValue:"Resume Auto"}):t("autoRefresh.pause",{defaultValue:"Pause Auto"})}),e.jsx("span",{className:"text-xs text-muted",children:t("autoRefresh.line",{defaultValue:"Auto refresh: {{status}} ({{seconds}}s)",status:t(`autoRefresh.status.${H.status}`,{defaultValue:H.statusLabel}),seconds:Math.ceil(H.nextRunInMs/1e3)})})]})]})]})}),e.jsx(ee,{className:"p-3 sm:p-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-flex min-w-full gap-1 rounded-xl border border-line/70 bg-panel/45 p-1",children:D.map(s=>{const a=K===s.id,i=s.id==="inbounds"?E.length:s.id==="templates"?st.length:void 0;return e.jsxs("button",{type:"button",onClick:()=>ht(s.id),className:`flex min-w-[130px] flex-1 items-center justify-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-colors sm:min-w-[150px] ${a?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-soft":"text-muted hover:bg-card/70 hover:text-foreground"}`,children:[e.jsx("span",{children:s.label}),typeof i=="number"?e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs ${a?"bg-white/20 text-white":"bg-card/80 text-foreground/80"}`,children:i}):null]},s.id)})})})}),K==="inbounds"&&Qe>0?e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx("p",{className:"text-sm text-foreground",children:t("inbounds.selectedCount",{defaultValue:"{{count}} inbounds selected",count:Qe})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>{q([])},disabled:ne,children:t("common.clear",{defaultValue:"Clear"})}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>{Bt()},loading:Ee.isPending,disabled:ne,children:t("inbounds.bulk.enableSelected",{defaultValue:"Enable Selected"})}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>{Wt()},loading:Re.isPending,disabled:ne,children:t("inbounds.bulk.disableSelected",{defaultValue:"Disable Selected"})}),V?e.jsx(p,{size:"sm",variant:"danger",onClick:()=>{$t()},loading:Ie.isPending,disabled:ne,children:t("inbounds.bulk.deleteSelected",{defaultValue:"Delete Selected"})}):null]})]})}):null,K==="templates"?e.jsxs(ee,{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(kt,{className:"h-4 w-4 text-brand-500"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("inbounds.templateLibrary.title",{defaultValue:"Template Library"})})]}),e.jsx("div",{className:"space-y-5",children:sa.map(s=>{const a=qt[s];if(a.length===0)return null;const i=L[s];return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:i.title}),e.jsx("p",{className:"text-xs text-muted",children:i.hint})]}),e.jsx("span",{className:"rounded-full border border-line/70 bg-panel/70 px-2.5 py-1 text-xs text-muted",children:t("inbounds.templateLibrary.count",{defaultValue:"{{count}} templates",count:a.length})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:a.map(c=>e.jsxs("div",{className:"rounded-xl border border-line/70 bg-card/65 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("p",{className:"mr-1 text-sm font-semibold text-foreground",children:c.name}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:c.values.protocol}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:c.values.network}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:c.values.security})]}),e.jsx("p",{className:"mt-1 text-xs leading-relaxed text-muted",children:c.description}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1.5",children:c.highlights.map(j=>e.jsx("span",{className:"rounded-md border border-brand-500/25 bg-brand-500/10 px-2 py-0.5 text-[10px] font-medium text-brand-700 dark:text-brand-300",children:j},`${c.id}-${j}`))}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>te(c),children:[e.jsx(dt,{className:"mr-1 h-4 w-4"}),t("common.preview",{defaultValue:"Preview"})]}),e.jsx(p,{size:"sm",onClick:()=>{ve(Ze(c))},children:t("inbounds.templateLibrary.useTemplate",{defaultValue:"Use Template"})})]})]},c.id))})]},s)})})]}):null,K==="compatibility"?e.jsx(ta,{onQuickCreate:ss}):null,K==="inbounds"&&ce?e.jsx(ee,{children:e.jsx("div",{className:"space-y-4 p-2",children:Array.from({length:5}).map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 rounded-xl border border-line/40 p-4",children:[e.jsx(Ge,{className:"h-8 w-20 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Ge,{className:"h-4 w-1/3"}),e.jsx(Ge,{className:"h-3 w-1/5"})]}),e.jsx(Ge,{className:"h-6 w-16 rounded-full"}),e.jsx(Ge,{className:"h-8 w-8 rounded-lg"})]},a))})}):K==="inbounds"&&E.length===0?e.jsx(ee,{children:e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"mb-4 text-muted",children:t("inbounds.empty",{defaultValue:"No inbounds configured yet."})}),e.jsxs(p,{onClick:()=>ve(),children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),t("inbounds.addFirst",{defaultValue:"Add Your First Inbound"})]})]})}):K==="inbounds"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ee,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("inbounds.stats.total",{defaultValue:"Total Inbounds"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:E.length})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("inbounds.stats.onlineClients",{defaultValue:"Online Clients"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:n.size})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:t("inbounds.stats.expanded",{defaultValue:"Expanded Rows"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:Pe.length})]})]})}),e.jsx(ee,{className:cs,children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[1080px] w-full text-sm",children:[e.jsx("thead",{className:"bg-panel/70",children:e.jsxs("tr",{className:"border-b border-line/70 text-left text-xs uppercase tracking-wide text-muted",children:[e.jsx("th",{className:"px-3 py-3",children:t("common.select",{defaultValue:"Select"})}),e.jsx("th",{className:"px-3 py-3",children:t("common.details",{defaultValue:"Details"})}),e.jsx("th",{className:"px-3 py-3",children:t("common.enabled",{defaultValue:"Enabled"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.remark",{defaultValue:"Remark"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.port",{defaultValue:"Port"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.protocol",{defaultValue:"Protocol"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.clients",{defaultValue:"Clients"})}),e.jsx("th",{className:"px-3 py-3",children:t("inbounds.traffic",{defaultValue:"Traffic"})}),e.jsx("th",{className:"px-3 py-3",children:t("common.actions",{defaultValue:"Actions"})})]})}),e.jsx("tbody",{children:E.map(s=>{var G;const a=h.get(s.id)||[],i=a.filter(R=>n.has(R.uuid)).length,c=a.reduce((R,Q)=>R+Q.totalUsed,0),j=a.reduce((R,Q)=>R+Q.dataLimit,0),S=j>0?Math.min(c/j*100,100):0,X=Pe.includes(s.id);return e.jsxs(oe.Fragment,{children:[e.jsxs("tr",{className:"border-b border-line/70 hover:bg-panel/35",children:[e.jsx("td",{className:"px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:_.includes(s.id),onChange:()=>b(s.id),className:"h-4 w-4 rounded border-line/70 bg-card text-brand-500 focus:ring-brand-500/50"})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("button",{type:"button",onClick:()=>U(s.id),className:"inline-flex items-center gap-1 rounded-md border border-line/70 px-2 py-1 text-xs text-muted transition-colors hover:bg-card/80 hover:text-foreground",children:[X?e.jsx(Pt,{className:"h-4 w-4"}):e.jsx(Ws,{className:"h-4 w-4"}),X?t("common.hide",{defaultValue:"Hide"}):t("common.show",{defaultValue:"Show"})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("button",{type:"button",onClick:()=>He.mutate(s.id),className:`inline-flex items-center gap-2 rounded-full border px-2.5 py-1 text-xs ${s.enabled?"border-green-400/50 bg-green-500/10 text-green-300":"border-amber-400/50 bg-amber-500/10 text-amber-300"}`,children:s.enabled?t("common.on",{defaultValue:"On"}):t("common.off",{defaultValue:"Off"})})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.remark||s.tag}),e.jsx("span",{className:"text-xs text-muted",children:s.tag})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-foreground",children:s.port}),e.jsxs("button",{type:"button",onClick:()=>be.mutate(s.id),disabled:be.isPending&&ke===s.id,className:"inline-flex items-center gap-1 rounded-md border border-line/70 px-2 py-1 text-xs text-muted transition-colors hover:bg-card/80 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",title:t("inbounds.randomPortTitle",{defaultValue:"Assign random free port"}),children:[e.jsx(ut,{className:"h-3.5 w-3.5"}),t("inbounds.randomPort",{defaultValue:"Random"})]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs font-medium ${pt[s.protocol]}`,children:s.protocol}),e.jsxs("span",{className:"text-xs text-muted",children:[s.network,"/",s.security]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-foreground",children:t("inbounds.onlineTotal",{defaultValue:"{{online}} online / {{total}} total",online:i,total:a.length})}),e.jsx("p",{className:"text-xs text-muted",children:t("inbounds.assignedCount",{defaultValue:"Assigned: {{count}}",count:((G=s._count)==null?void 0:G.userInbounds)||0})})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"w-40",children:[e.jsxs("p",{className:"text-xs text-muted",children:[Je(c)," / ",j>0?Je(j):"∞"]}),e.jsx("div",{className:"mt-1 h-2 rounded-full bg-panel/80",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-brand-500 to-brand-600",style:{width:`${S}%`}})})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"flex justify-end",children:xt(s)})})]}),X?e.jsx("tr",{className:"border-b border-line/70 bg-panel/30",children:e.jsx("td",{colSpan:9,className:"px-4 py-4",children:a.length===0?e.jsx("p",{className:"text-sm text-muted",children:t("inbounds.noClients",{defaultValue:"No clients assigned to this inbound yet."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[880px] w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs uppercase tracking-wide text-muted",children:[e.jsx("th",{className:"px-2 py-2",children:t("common.client",{defaultValue:"Client"})}),e.jsx("th",{className:"px-2 py-2",children:t("common.online",{defaultValue:"Online"})}),e.jsx("th",{className:"px-2 py-2",children:t("common.status",{defaultValue:"Status"})}),e.jsx("th",{className:"px-2 py-2",children:t("inbounds.traffic",{defaultValue:"Traffic"})}),e.jsx("th",{className:"px-2 py-2",children:t("common.expiry",{defaultValue:"Expiry"})}),e.jsx("th",{className:"px-2 py-2",children:t("common.action",{defaultValue:"Action"})})]})}),e.jsx("tbody",{children:a.map(R=>{const Q=n.has(R.uuid),le=R.dataLimit,Ne=le>0?Math.min(R.totalUsed/le*100,100):0,it=os(R.expireDate);return e.jsxs("tr",{className:"border-t border-line/70",children:[e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-foreground",children:R.email}),e.jsxs("span",{className:"text-xs text-muted",children:[R.uuid.slice(0,10),"..."]})]})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs ${Q?"bg-green-500/15 text-green-300":"bg-zinc-500/15 text-zinc-300"}`,children:Q?t("common.online",{defaultValue:"Online"}):t("common.offline",{defaultValue:"Offline"})})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs ${R.status==="ACTIVE"?"bg-emerald-500/15 text-emerald-300":"bg-amber-500/15 text-amber-300"}`,children:R.status})}),e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"w-48",children:[e.jsxs("p",{className:"text-xs text-muted",children:[Je(R.totalUsed)," / ",le>0?Je(le):"∞"]}),e.jsx("div",{className:"mt-1 h-2 rounded-full bg-panel/80",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-brand-500 to-brand-600",style:{width:`${Ne}%`}})})]})}),e.jsx("td",{className:"px-2 py-2 text-xs text-muted",children:it===null?t("common.na",{defaultValue:"N/A"}):it>0?t("common.daysLeft",{defaultValue:"{{count}}d left",count:it}):t("common.expired",{defaultValue:"Expired"})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>d(`/users/${R.id}`),children:t("common.view",{defaultValue:"View"})})})]},`${s.id}-${R.id}`)})})]})})})}):null]},s.id)})})]})})}),e.jsx("div",{className:us,children:E.map(s=>{const a=h.get(s.id)||[],i=a.filter(c=>n.has(c.uuid)).length;return e.jsx(ee,{className:"transition-shadow hover:shadow-lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:`inline-block rounded-full px-3 py-1 text-sm font-medium ${pt[s.protocol]}`,children:s.protocol}),e.jsx("h3",{className:"mt-2 text-base font-semibold text-foreground",children:s.remark||s.tag}),e.jsxs("p",{className:"text-xs text-muted",children:[t("inbounds.portLabel",{defaultValue:"Port"})," ",s.port," • ",s.network,"/",s.security]})]}),e.jsx(Rt,{variant:s.enabled?"success":"warning",children:s.enabled?t("common.active",{defaultValue:"Active"}):t("common.disabled",{defaultValue:"Disabled"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted",children:t("inbounds.clients",{defaultValue:"Clients"})}),e.jsxs("span",{className:"text-foreground",children:[i," online / ",a.length," total"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 border-t border-line/70 pt-3",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>He.mutate(s.id),children:[s.enabled?e.jsx(Ss,{className:"mr-1 h-4 w-4"}):e.jsx(ks,{className:"mr-1 h-4 w-4"}),s.enabled?t("common.disable",{defaultValue:"Disable"}):t("common.enable",{defaultValue:"Enable"})]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>ie(s),children:[e.jsx(dt,{className:"h-4 w-4"}),t("common.details",{defaultValue:"Details"})]}),e.jsx("div",{className:"ml-auto flex items-center",children:xt(s,{mobile:!0,includeRandomPort:!0})})]})]})},`mobile-${s.id}`)})})]}):null,ze?e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-2 backdrop-blur-sm sm:items-center sm:p-4",children:e.jsxs("div",{className:"w-full max-w-xl rounded-2xl border border-line/80 bg-card/95 shadow-soft",children:[e.jsxs("div",{className:"border-b border-line/70 px-5 py-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t("inbounds.myanmarPack.title",{defaultValue:"Apply Myanmar Resilience Pack"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:t("inbounds.myanmarPack.subtitle",{defaultValue:"Creates three optimized profiles: VLESS REALITY XHTTP, VLESS WS TLS, and Trojan WS TLS."})})]}),e.jsxs("div",{className:"space-y-4 px-5 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.serverAddress",{defaultValue:"Server Address"})}),e.jsx("input",{value:P.serverAddress,onChange:s=>B(a=>({...a,serverAddress:s.target.value})),placeholder:"your.domain.com",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.serverName",{defaultValue:"Server Name (SNI)"})}),e.jsx("input",{value:P.serverName,onChange:s=>B(a=>({...a,serverName:s.target.value})),placeholder:"your.domain.com",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.cdnHost",{defaultValue:"CDN Host (optional)"})}),e.jsx("input",{value:P.cdnHost,onChange:s=>B(a=>({...a,cdnHost:s.target.value})),placeholder:"cdn.your.domain.com",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.fallbackPorts",{defaultValue:"Fallback Ports"})}),e.jsx("input",{value:P.fallbackPorts,onChange:s=>B(a=>({...a,fallbackPorts:s.target.value})),placeholder:"8443,9443",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:t("inbounds.myanmarPack.fallbackPortsHint",{defaultValue:"Comma-separated ports used for WS/TLS fallback profiles."})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-line/70 bg-panel/45 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.assignUsers",{defaultValue:"Assign to Users"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:Qt,children:t("common.all",{defaultValue:"All"})}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:Jt,children:t("common.clear",{defaultValue:"Clear"})})]})]}),e.jsx("p",{className:"mb-2 text-xs text-muted",children:t("inbounds.myanmarPack.assignUsersHint",{defaultValue:"Optional. Adds created profiles to selected users without removing existing keys."})}),e.jsx("div",{className:"max-h-40 space-y-1 overflow-auto pr-1",children:lt.length===0?e.jsx("p",{className:"text-xs text-muted",children:t("inbounds.myanmarPack.noUsers",{defaultValue:"No users found."})}):lt.map(s=>{const a=Number(s.id);return e.jsxs("label",{className:"flex items-center gap-2 rounded-md px-1 py-1 text-xs text-foreground hover:bg-panel/55",children:[e.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-line/70 bg-card/90",checked:Ht.has(a),onChange:i=>_t(a,i.target.checked)}),e.jsx("span",{className:"truncate",children:s.email})]},`mm-pack-user-${a}`)})})]}),e.jsxs("div",{className:"rounded-lg border border-line/70 bg-panel/45 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.assignGroups",{defaultValue:"Assign to Groups"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:Zt,children:t("common.all",{defaultValue:"All"})}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:es,children:t("common.clear",{defaultValue:"Clear"})})]})]}),e.jsx("p",{className:"mb-2 text-xs text-muted",children:t("inbounds.myanmarPack.assignGroupsHint",{defaultValue:"Optional. Merges created profiles into selected groups while keeping existing assignments."})}),e.jsx("div",{className:"max-h-40 space-y-1 overflow-auto pr-1",children:ot.length===0?e.jsx("p",{className:"text-xs text-muted",children:t("inbounds.myanmarPack.noGroups",{defaultValue:"No groups found."})}):ot.map(s=>{const a=Number(s.id);return e.jsxs("label",{className:"flex items-center gap-2 rounded-md px-1 py-1 text-xs text-foreground hover:bg-panel/55",children:[e.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-line/70 bg-card/90",checked:Gt.has(a),onChange:i=>Xt(a,i.target.checked)}),e.jsx("span",{className:"truncate",children:s.name})]},`mm-pack-group-${a}`)})})]})]}),Y!=null&&Y.planned&&Y.planned.length>0?e.jsxs("div",{className:"space-y-2 rounded-lg border border-line/70 bg-panel/50 p-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("inbounds.myanmarPack.previewPlan",{defaultValue:"Preview Plan"})}),e.jsx("div",{className:"space-y-1 text-xs text-muted",children:Y.planned.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-md bg-panel/60 px-2 py-1",children:[e.jsxs("span",{className:"text-foreground",children:[String(s.protocol||"INBOUND")," • ",String(s.network||"TCP")," • ",String(s.security||"NONE")]}),e.jsx("span",{children:String(s.port||"-")})]},`${s.tag||s.protocol||a}`))}),Y.warnings&&Y.warnings.length>0?e.jsx("div",{className:"space-y-1 rounded-md border border-amber-500/30 bg-amber-500/10 px-2 py-2 text-xs text-amber-300",children:Y.warnings.map(s=>e.jsx("p",{children:s},s))}):null]}):null]}),e.jsxs("div",{className:"flex items-center gap-3 border-t border-line/70 px-5 py-4",children:[e.jsx(p,{variant:"secondary",onClick:()=>{gt(!0)},loading:We.isPending,className:"flex-1",children:t("inbounds.myanmarPack.previewPlan",{defaultValue:"Preview Plan"})}),e.jsx(p,{onClick:()=>{gt(!1)},loading:We.isPending,className:"flex-1",children:t("inbounds.myanmarPack.applyPack",{defaultValue:"Apply Pack"})}),e.jsx(p,{variant:"secondary",onClick:()=>J(!1),className:"flex-1",children:t("common.cancel",{defaultValue:"Cancel"})})]})]})}):null,A||m?e.jsx(Zs,{inbound:m||void 0,initialValues:u||void 0,onClose:ft,onSuccess:async()=>{ft(),await l.invalidateQueries({queryKey:["inbounds"]})}}):null,O?e.jsx(Ps,{inbound:O,onClose:()=>I(null)}):null,F?e.jsx(Qs,{inbound:F,clients:h.get(F.id)||[],sessionsByUuid:r,actionLoadingKey:Me,onClose:()=>ie(null),onViewUser:s=>d(`/users/${s}`),onToggleAccess:s=>{De(`u${s.id}-toggle`,async()=>{await T.post(`/users/${s.id}/inbounds/${F.id}/toggle`,{enabled:!s.enabled})},"Failed to toggle user key access")},onResetTraffic:s=>{De(`u${s.id}-reset`,async()=>{await T.post(`/users/${s.id}/reset-traffic`)},"Failed to reset user traffic")},onExtendExpiry:(s,a)=>{De(`u${s.id}-extend${a}`,async()=>{await T.post(`/users/${s.id}/extend-expiry`,{days:a})},"Failed to extend user expiry")},onDisableUser:s=>{De(`u${s.id}-disable`,async()=>{await T.put(`/users/${s.id}`,{status:"DISABLED"})},"Failed to disable user")},onDecreasePriority:s=>{De(`u${s.id}-priority-down`,async()=>{await T.patch(`/users/${s.id}/inbounds/${F.id}/priority`,{priority:Math.max(1,Number(s.priority||100)-1)})},"Failed to update key priority")},onIncreasePriority:s=>{De(`u${s.id}-priority-up`,async()=>{await T.patch(`/users/${s.id}/inbounds/${F.id}/priority`,{priority:Math.min(9999,Number(s.priority||100)+1)})},"Failed to update key priority")}}):null,N?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/55 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl border border-line/80 bg-card/95 p-5 shadow-soft",children:[e.jsx("div",{className:"mb-3 flex items-start justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:N.name}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:N.description})]})}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-semibold uppercase tracking-wider text-muted",children:t("inbounds.templateLibrary.jsonPreview",{defaultValue:"Template JSON Preview"})}),e.jsx("pre",{className:"max-h-[48vh] overflow-auto rounded-lg bg-card/80 p-3 text-xs text-foreground",children:JSON.stringify(Ze(N),null,2)})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-end gap-2",children:[e.jsx(p,{variant:"secondary",onClick:()=>te(null),children:t("common.close",{defaultValue:"Close"})}),e.jsx(p,{onClick:()=>{ve(Ze(N)),te(null)},children:t("inbounds.templateLibrary.useTemplate",{defaultValue:"Use Template"})})]})]})}):null,e.jsx(ws,{open:!!w,title:is,description:ds,confirmLabel:t("common.delete",{defaultValue:"Delete"}),cancelLabel:t("common.cancel",{defaultValue:"Cancel"}),tone:"danger",loading:Nt,onCancel:()=>{Nt||xe(null)},onConfirm:()=>{Ut()}}),Ue&&!ce?e.jsx("div",{className:"fixed bottom-24 right-4 z-40 rounded-full border border-line/80 bg-card/90 px-3 py-1 text-xs text-muted shadow-soft lg:bottom-6",children:t("inbounds.refreshing",{defaultValue:"Refreshing inbounds..."})}):null]})},za=pa;export{pa as Inbounds,za as InboundsPage};
