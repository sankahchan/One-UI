import{c as ie,j as e,X as Es,C as mt,R as pe,A as pt,I as xt,u as gt,b as ft,r as f,g as ht,e as bt,k as yt}from"./index-31dYUl1e.js";import{u as _e}from"./useQuery-CtMNJR7o.js";import{u as G}from"./useMutation-ClUFm1k_.js";import{B as Rs}from"./Badge-CYgjB4Cb.js";import{B as p,L as vt}from"./Button-B1Z0NjYb.js";import{u as ms,C as se}from"./useToast-DwaWtEZ4.js";import{D as Nt,M as jt}from"./DropdownMenu-DeKmLL9S.js";import{C as wt}from"./ConfirmDialog-DQoCmtMH.js";import{P as kt,a as St,I as Pt}from"./InboundClientProfileModal-koqhm62W.js";import{R as Tt,u as ss}from"./useTranslation-BcYYym0T.js";import{A as Ct}from"./arrow-right-CE-EoaYv.js";import{u as Vt}from"./index.esm-DVAEje_9.js";import{Q as ks}from"./index-CO-SCVnj.js";import{I as S}from"./Input-Djb_DGP2.js";import{apiClient as T}from"./client-ZrARDaOq.js";import{S as At}from"./shield-check-Na0YxVTi.js";import{P as Ze}from"./plus-DaEf3fGG.js";import{T as Ds}from"./trash-2-BwfsfCfh.js";import{g as It}from"./users-bIRiBp0D.js";import{u as Et,a as Rt,b as Dt}from"./useSmartAutoRefresh-D96pJdsr.js";import{m as Mt}from"./useUsers-BbUnCN1U.js";import{S as We}from"./Skeleton-Bgx-f_gz.js";import{D as Lt}from"./download-BESVSTzz.js";import{S as Ss}from"./sparkles-VZWbCVsI.js";import{C as Ps}from"./chevron-down-BRVczzCr.js";import{F as Ot}from"./file-code-2-CnUSgRvG.js";import{C as Ft}from"./copy-D6G2TpML.js";import{P as Kt}from"./pen-square-YK_6wpJg.js";import"./cn-BLSKlp9E.js";import"./Spinner-CsqCyjP9.js";import"./qr-code-BZnwKX1J.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=ie("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=ie("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=ie("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=ie("Radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=ie("ShieldOff",[["path",{d:"M19.7 14a6.9 6.9 0 0 0 .3-2V5l-8-3-3.2 1.2",key:"342pvf"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M4.7 4.7 4 5v7c0 6 8 10 8 10a20.3 20.3 0 0 0 5.62-4.38",key:"p0ycf4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=ie("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=ie("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=ie("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=ie("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function Ts(s){if(!Number.isFinite(s)||s<=0)return"0 B";const d=["B","KB","MB","GB","TB","PB"],l=Math.min(Math.floor(Math.log(s)/Math.log(1024)),d.length-1),o=s/1024**l;return`${o.toFixed(o>=100?0:o>=10?1:2)} ${d[l]}`}function qt(s){const d=new Date(s);if(Number.isNaN(d.getTime()))return"N/A";const l=d.getTime()-Date.now(),o=Math.ceil(l/(1e3*60*60*24));return o>0?`${o}d left`:"Expired"}function Yt(s){if(!s)return"No activity";const d=new Date(s).getTime();if(Number.isNaN(d))return"No activity";const l=Math.floor((Date.now()-d)/6e4);if(l<1)return"just now";if(l<60)return`${l}m ago`;const o=Math.floor(l/60);return o<24?`${o}h ago`:`${Math.floor(o/24)}d ago`}function Xt({inbound:s,clients:d,sessionsByUuid:l,onClose:o,onViewUser:N,onToggleAccess:h,onResetTraffic:M,onExtendExpiry:C,onDisableUser:D,onDecreasePriority:R,onIncreasePriority:L,actionLoadingKey:V=null}){return e.jsx("div",{className:"fixed inset-0 z-50 flex justify-end bg-black/45 backdrop-blur-sm",children:e.jsxs("div",{className:"flex h-full w-full max-w-3xl flex-col border-l border-line/70 bg-card/95 shadow-soft",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-line/70 px-5 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:"Inbound Details"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:s.remark||s.tag}),e.jsxs("p",{className:"mt-1 text-sm text-muted",children:[s.protocol," • Port ",s.port," • ",s.network,"/",s.security]})]}),e.jsx("button",{type:"button",onClick:o,className:"rounded-lg p-2 text-muted transition-colors hover:bg-card/80 hover:text-foreground","aria-label":"Close drawer",children:e.jsx(Es,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:d.length===0?e.jsx("div",{className:"rounded-xl border border-line/70 bg-panel/40 px-4 py-10 text-center text-sm text-muted",children:"No clients are assigned to this inbound yet."}):e.jsx("div",{className:"space-y-3",children:d.map(x=>{const m=l.get(x.uuid),$=!!(m!=null&&m.online),u=x.dataLimit>0?Math.min(x.totalUsed/x.dataLimit*100,100):0,y=`u${x.id}-`;return e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/45 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:x.email}),e.jsxs("p",{className:"text-xs text-muted",children:[x.uuid.slice(0,10),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs ${$?"bg-emerald-500/15 text-emerald-300":"bg-zinc-500/15 text-zinc-300"}`,children:[e.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[$?e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-400 opacity-70"}):null,e.jsx("span",{className:`relative inline-flex h-2.5 w-2.5 rounded-full ${$?"bg-emerald-400":"bg-zinc-400"}`})]}),$?"Online":"Offline"]}),e.jsx("span",{className:"rounded-full bg-card/80 px-2 py-0.5 text-xs text-muted",children:x.status}),e.jsxs("span",{className:"rounded-full bg-brand-500/15 px-2 py-0.5 text-xs text-brand-300",children:["Priority ",x.priority]}),x.enabled?null:e.jsx("span",{className:"rounded-full bg-amber-500/15 px-2 py-0.5 text-xs text-amber-300",children:"Key Off"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-line/60 bg-card/60 p-2.5",children:[e.jsx("p",{className:"text-muted",children:"Traffic"}),e.jsxs("p",{className:"mt-1 text-sm text-foreground",children:[Ts(x.totalUsed)," / ",x.dataLimit>0?Ts(x.dataLimit):"∞"]}),e.jsx("div",{className:"mt-2 h-2 rounded-full bg-panel/90",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-brand-500 to-brand-600",style:{width:`${u}%`}})})]}),e.jsxs("div",{className:"rounded-lg border border-line/60 bg-card/60 p-2.5",children:[e.jsx("p",{className:"text-muted",children:"Expiry"}),e.jsx("p",{className:"mt-1 text-sm text-foreground",children:qt(x.expireDate)}),e.jsx("p",{className:"mt-1 text-muted",children:new Date(x.expireDate).toLocaleDateString()})]}),e.jsxs("div",{className:"rounded-lg border border-line/60 bg-card/60 p-2.5",children:[e.jsx("p",{className:"text-muted",children:"Session"}),e.jsx("p",{className:"mt-1 text-sm text-foreground",children:$?(m==null?void 0:m.currentIp)||"Connected":`Last seen ${Yt((m==null?void 0:m.lastSeenAt)||null)}`}),!$&&(m!=null&&m.currentIp)?e.jsx("p",{className:"mt-1 text-muted",children:m.currentIp}):null]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-6",children:[e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>N(x.id),children:"View"}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>R(x),loading:V===`${y}priority-down`,children:"Priority -"}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>L(x),loading:V===`${y}priority-up`,children:"Priority +"}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>h(x),loading:V===`${y}toggle`,children:[x.enabled?e.jsx(Gt,{className:"mr-1 h-4 w-4"}):e.jsx(Ht,{className:"mr-1 h-4 w-4"}),"Key"]}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>M(x),loading:V===`${y}reset`,children:[e.jsx(Tt,{className:"mr-1 h-4 w-4"}),"Reset"]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>C(x,7),loading:V===`${y}extend7`,children:"+7d"}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>C(x,30),loading:V===`${y}extend30`,children:"+30d"}),e.jsxs(p,{size:"sm",variant:"danger",onClick:()=>D(x),loading:V===`${y}disable`,children:[e.jsx(Wt,{className:"mr-1 h-4 w-4"}),"Disable"]})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>N(x.id),className:"inline-flex items-center gap-1 text-xs font-medium text-brand-500 hover:text-brand-600",children:["Open user page",e.jsx(Ct,{className:"h-3.5 w-3.5"})]})})]},`${s.id}-${x.id}`)})})})]})})}const es=[{id:"vless-reality-xhttp",name:"VLESS + REALITY + XHTTP",description:"Modern anti-censorship profile for latest Xray clients.",category:"recommended",highlights:["Anti-censorship","Modern Xray","XHTTP"],values:{protocol:"VLESS",network:"XHTTP",security:"REALITY",port:443,tag:"vless-reality-xhttp",remark:"VLESS REALITY XHTTP",wsPath:"/xhttp",xhttpMode:"auto",serverName:"www.microsoft.com",realityFingerprint:"chrome"}},{id:"vless-reality-tcp",name:"VLESS + REALITY + TCP",description:"Lean REALITY profile with plain TCP transport.",category:"recommended",highlights:["Low overhead","REALITY","TCP"],values:{protocol:"VLESS",network:"TCP",security:"REALITY",port:443,tag:"vless-reality-tcp",remark:"VLESS REALITY TCP",serverName:"www.cloudflare.com",realityFingerprint:"chrome"}},{id:"vless-ws-tls",name:"VLESS + WS + TLS",description:"Compatible profile for websocket clients and CDN edge.",category:"cdn",highlights:["CDN friendly","WS","TLS"],values:{protocol:"VLESS",network:"WS",security:"TLS",port:443,tag:"vless-ws-tls",remark:"VLESS WS TLS",wsPath:"/vless",alpn:'["h2","http/1.1"]'}},{id:"vless-httpupgrade-tls",name:"VLESS + HTTPUpgrade + TLS",description:"HTTPUpgrade profile for edge/CDN traffic blending.",category:"cdn",highlights:["HTTPUpgrade","CDN edge","TLS"],values:{protocol:"VLESS",network:"HTTPUPGRADE",security:"TLS",port:443,tag:"vless-httpupgrade-tls",remark:"VLESS HTTPUpgrade TLS",wsPath:"/upgrade",alpn:'["h2","http/1.1"]'}},{id:"trojan-grpc",name:"Trojan + gRPC + TLS",description:"Stable TLS profile with gRPC transport.",category:"transport",highlights:["TLS only","gRPC","Stable"],values:{protocol:"TROJAN",network:"GRPC",security:"TLS",port:443,tag:"trojan-grpc",remark:"Trojan gRPC",grpcServiceName:"trojan-grpc",alpn:'["h2","http/1.1"]'}},{id:"trojan-ws-tls",name:"Trojan + WS + TLS",description:"Trojan profile tuned for websocket deployments.",category:"transport",highlights:["Trojan","WebSocket","TLS"],values:{protocol:"TROJAN",network:"WS",security:"TLS",port:443,tag:"trojan-ws-tls",remark:"Trojan WS TLS",wsPath:"/trojan",alpn:'["h2","http/1.1"]'}},{id:"vmess-ws-tls",name:"VMess + WS + TLS",description:"Classic VMess deployment profile.",category:"transport",highlights:["Legacy compatible","WS","TLS"],values:{protocol:"VMESS",network:"WS",security:"TLS",port:443,tag:"vmess-ws-tls",remark:"VMess WS TLS",wsPath:"/vmess",alpn:'["h2","http/1.1"]'}},{id:"vmess-grpc-tls",name:"VMess + gRPC + TLS",description:"VMess profile with gRPC transport for modern clients.",category:"transport",highlights:["VMess","gRPC","TLS"],values:{protocol:"VMESS",network:"GRPC",security:"TLS",port:443,tag:"vmess-grpc-tls",remark:"VMess gRPC TLS",grpcServiceName:"vmess-grpc",alpn:'["h2","http/1.1"]'}},{id:"dokodemo-dns-forward",name:"Dokodemo DNS Forward",description:"Forward DNS traffic to an upstream resolver.",category:"utility",highlights:["DNS relay","UDP","Resolver"],values:{protocol:"DOKODEMO_DOOR",network:"TCP",security:"NONE",port:5353,tag:"dokodemo-dns",remark:"Dokodemo DNS Forward",serverAddress:"1.1.1.1",dokodemoTargetPort:53,dokodemoNetwork:"udp",dokodemoFollowRedirect:!1}},{id:"dokodemo-tcp-forward",name:"Dokodemo TCP Forward",description:"Forward raw TCP traffic to a target service.",category:"utility",highlights:["TCP relay","Debugging","Forward"],values:{protocol:"DOKODEMO_DOOR",network:"TCP",security:"NONE",port:10080,tag:"dokodemo-tcp-forward",remark:"Dokodemo TCP Forward",serverAddress:"127.0.0.1",dokodemoTargetPort:80,dokodemoNetwork:"tcp",dokodemoFollowRedirect:!1}},{id:"shadowsocks-tcp",name:"Shadowsocks (TCP/UDP)",description:"Lightweight encrypted proxy profile for broad client compatibility.",category:"recommended",highlights:["Fast","Simple","Broad client support"],values:{protocol:"SHADOWSOCKS",network:"TCP",security:"NONE",port:8388,tag:"shadowsocks-main",remark:"Shadowsocks Main",cipher:"chacha20-ietf-poly1305"}},{id:"socks5-local-lan",name:"SOCKS5 LAN Gateway",description:"SOCKS gateway profile for local/LAN applications.",category:"utility",highlights:["LAN apps","SOCKS5","Simple"],values:{protocol:"SOCKS",network:"TCP",security:"NONE",port:1080,tag:"socks5-lan-gateway",remark:"SOCKS5 LAN Gateway",serverAddress:"0.0.0.0"}},{id:"socks5-auth",name:"SOCKS5 Auth Gateway",description:"Username/password SOCKS proxy using panel user credentials.",category:"utility",highlights:["Auth","SOCKS5","Gateway"],values:{protocol:"SOCKS",network:"TCP",security:"NONE",port:10808,tag:"socks-auth",remark:"SOCKS5 Auth Gateway"}},{id:"http-proxy-auth",name:"HTTP Proxy Auth",description:"Classic authenticated HTTP forward proxy for browser/system use.",category:"utility",highlights:["HTTP proxy","Auth","Legacy tools"],values:{protocol:"HTTP",network:"TCP",security:"NONE",port:10809,tag:"http-proxy-auth",remark:"HTTP Proxy Auth"}},{id:"wireguard-egress",name:"WireGuard Egress Tunnel",description:"Expose a local SOCKS listener routed over WireGuard outbound.",category:"transport",highlights:["WireGuard","Egress","Secure tunnel"],values:{protocol:"WIREGUARD",network:"TCP",security:"NONE",port:51820,tag:"wireguard-egress",remark:"WireGuard Egress",wgAddress:"10.66.2.2/32",wgAllowedIPs:"0.0.0.0/0, ::/0",wgMtu:1420}},{id:"mtproto-telegram",name:"MTProto Telegram",description:"Telegram-oriented proxy inbound using MTProto protocol.",category:"utility",highlights:["Telegram","MTProto","Stealth"],values:{protocol:"MTPROTO",network:"TCP",security:"NONE",port:443,tag:"mtproto-telegram",remark:"MTProto Telegram"}}];function Cs(s){return s&&typeof s=="object"&&"data"in s?s.data:s}const Jt=({register:s,watch:d,setValue:l,errors:o})=>{var m,$;const N=ms(),{t:h}=ss(),M=(d("realityDest")||"").trim(),C=(d("serverName")||"").trim(),D=String(d("realityServerName")||"").split(",").map(u=>u.trim()).filter(Boolean),{data:R,isLoading:L}=_e({queryKey:["reality-destinations"],queryFn:async()=>{const u=await T.get("/reality/destinations"),y=Cs(u)||{};return{destinations:Array.isArray(y.destinations)?y.destinations:[],recommendedWsPaths:Array.isArray(y.recommendedWsPaths)?y.recommendedWsPaths:[]}}}),V=G({mutationFn:async u=>{const y=await T.post("/reality/test-destination",{dest:u});return Cs(y)},onSuccess:u=>{if(u!=null&&u.accessible){N.success(h("common.success",{defaultValue:"Success"}),h("inbounds.toast.destinationReachable",{defaultValue:"Destination reachable: {{dest}}",dest:String(u.destination||M||"")}));return}N.warning(h("common.warning",{defaultValue:"Warning"}),String((u==null?void 0:u.message)||(u==null?void 0:u.destination)||h("inbounds.toast.destinationUnavailable",{defaultValue:"Destination is not reachable"})))},onError:u=>{N.error(h("common.error",{defaultValue:"Error"}),(u==null?void 0:u.message)||h("inbounds.toast.destinationTestFailed",{defaultValue:"Failed to test destination"}))}}),x=u=>{l("realityDest",u.dest,{shouldDirty:!0,shouldValidate:!0});const y=Array.isArray(u.serverNames)?u.serverNames.join(","):"";y&&D.length===0&&l("realityServerName",y,{shouldDirty:!0,shouldValidate:!0}),!C&&Array.isArray(u.serverNames)&&u.serverNames[0]&&l("serverName",u.serverNames[0],{shouldDirty:!0,shouldValidate:!0})};return e.jsxs("div",{className:"space-y-4 rounded-xl border border-line/70 bg-panel/45 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"REALITY Destination Controls"}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:"Use a high-trust TLS destination to improve DPI resistance."})]}),e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-500/30 bg-emerald-500/10 px-2 py-1 text-[11px] font-semibold text-emerald-300",children:[e.jsx(At,{className:"h-3.5 w-3.5"}),"Myanmar Optimized"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Reality Destination (host:port)",...s("realityDest",{validate:u=>u?/^[^:\s]+:\d{1,5}$/.test(String(u).trim())||"Use host:port format, e.g. www.microsoft.com:443":!0}),error:(m=o.realityDest)==null?void 0:m.message,placeholder:"www.microsoft.com:443"}),e.jsx(S,{label:"Reality Spider X (Optional)",...s("realitySpiderX"),error:($=o.realitySpiderX)==null?void 0:$.message,placeholder:"/"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>{if(!M){N.warning(h("common.warning",{defaultValue:"Warning"}),h("inbounds.toast.destinationRequired",{defaultValue:"Select or enter a destination first."}));return}V.mutate(M)},loading:V.isPending,children:[e.jsx(Bt,{className:"mr-2 h-4 w-4"}),"Test Current Destination"]}),Array.isArray(R==null?void 0:R.recommendedWsPaths)&&R.recommendedWsPaths.length>0?e.jsxs("span",{className:"text-xs text-muted",children:["Suggested WS paths: ",R.recommendedWsPaths.slice(0,3).join(", ")]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-muted",children:"Curated Destinations"}),L?e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-line/70 bg-card/60 px-3 py-2 text-xs text-muted",children:[e.jsx(vt,{className:"h-4 w-4 animate-spin"}),"Loading destination catalog..."]}):null,!L&&(!(R!=null&&R.destinations)||R.destinations.length===0)?e.jsx("div",{className:"rounded-lg border border-line/70 bg-card/60 px-3 py-2 text-xs text-muted",children:"Destination catalog unavailable. You can still set destination manually."}):null,!L&&Array.isArray(R==null?void 0:R.destinations)?e.jsx("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:R.destinations.map(u=>{const y=M===u.dest;return e.jsxs("button",{type:"button",onClick:()=>x(u),className:`rounded-lg border px-3 py-2 text-left transition ${y?"border-brand-500/60 bg-brand-500/10":"border-line/70 bg-card/60 hover:border-brand-400/40"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:u.name}),y?e.jsx(mt,{className:"h-4 w-4 text-brand-300"}):null]}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:u.dest}),e.jsxs("p",{className:"mt-1 text-[11px] text-muted",children:[u.region||"Global"," • ",u.reliability||"High"]})]},u.dest)})}):null]})]})},Ms=s=>({id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,dest:"",path:"",alpn:"",name:"",xver:"",...s}),Vs=s=>Array.isArray(s)?s.filter(d=>d&&typeof d=="object").map(d=>{const l=d;return Ms({dest:l.dest?String(l.dest):"",path:l.path?String(l.path):"",name:l.name?String(l.name):"",xver:l.xver!==void 0&&l.xver!==null?String(l.xver):"",alpn:Array.isArray(l.alpn)?l.alpn.map(o=>String(o).trim()).filter(Boolean).join(","):l.alpn?String(l.alpn):""})}):[],As=s=>s.map(d=>{const l=d.dest.trim(),o=d.path.trim(),N=d.name.trim(),h=d.xver.trim(),M=d.alpn.split(",").map(D=>D.trim()).filter(Boolean);if(!l)return null;const C={dest:l};if(o&&(C.path=o),N&&(C.name=N),M.length>0&&(C.alpn=M),h){const D=Number.parseInt(h,10);Number.isNaN(D)||(C.xver=D)}return C}).filter(d=>!!d),Qt=({inbound:s,initialValues:d,onClose:l,onSuccess:o})=>{var be,Ce,Ve,Be;const N=ms(),{t:h}=ss(),[M,C]=pe.useState(!1),D=!!s,R=s==null?void 0:s.domains,L=s==null?void 0:s.fallbacks,[V,x]=pe.useState(()=>Vs(L)),{register:m,handleSubmit:$,setValue:u,getValues:y,watch:v,formState:{errors:te}}=Vt({defaultValues:s?{...s,realityShortId:Array.isArray(s.realityShortIds)?s.realityShortIds.join(","):void 0,realityServerName:Array.isArray(s.realityServerNames)?s.realityServerNames.join(","):void 0,domains:R?R.join(", "):void 0,fallbacks:L&&L.length>0?JSON.stringify(L,null,2):""}:{protocol:"VLESS",network:"TCP",security:"NONE",alpn:'["h2","http/1.1"]',...d}}),O=v("protocol"),A=v("network"),F=v("security"),de=v("serverName"),Re=v("wsPath"),De=v("wsHost"),Ne=v("grpcServiceName"),Me=v("xhttpMode"),je=v("realityPublicKey"),Le=v("realityPrivateKey"),we=v("realityShortId"),ke=v("realityServerName"),q=v("realityFingerprint"),Y=v("realitySpiderX"),w=v("tag"),xe=v("dokodemoTargetPort"),He=v("dokodemoNetwork"),Q=O==="DOKODEMO_DOOR",P=["VLESS","VMESS","TROJAN","SHADOWSOCKS"].includes(O),B=["VLESS","VMESS","TROJAN","SHADOWSOCKS"].includes(O),z=O==="VLESS",ge=["VLESS","TROJAN"].includes(O),Oe=v("wgPrivateKey"),Fe=v("wgPeerPublicKey"),fe=v("wgPublicKey"),ce=v("wgPeerEndpoint"),Se=v("serverAddress"),Ge=v("port"),_=v("wgAllowedIPs"),Ke=v("wgMtu"),K=v("wgAddress");pe.useEffect(()=>{x(Vs(L))},[L]),pe.useEffect(()=>{const r=document.body.style.overflow,n=document.body.style.paddingRight,b=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",b>0&&(document.body.style.paddingRight=`${b}px`),()=>{document.body.style.overflow=r,document.body.style.paddingRight=n}},[]);const $e=pe.useMemo(()=>JSON.stringify(As(V),null,2),[V]),ae=pe.useMemo(()=>{const r={recommended:0,cdn:1,transport:2,utility:3};return[...es].sort((n,b)=>{const g=r[n.category]-r[b.category];return g!==0?g:n.name.localeCompare(b.name)}).slice(0,12)},[]),re=pe.useMemo(()=>{const r=[],n=[];if((Se||"").trim()||r.push("Server address is required."),O==="TROJAN"&&F!=="TLS"&&n.push("Trojan always uses TLS. One-UI will enforce TLS on save."),O==="VLESS"&&F==="REALITY"&&((je||"").trim()||r.push("REALITY requires a Public Key."),(Le||"").trim()||r.push("REALITY requires a Private Key."),!(de||"").trim()&&!(ke||"").trim()&&r.push("REALITY requires SNI or Reality Server Names."),(we||"").trim()||n.push("Set a REALITY Short ID for better client compatibility.")),O==="WIREGUARD"&&((Oe||"").trim()||r.push("WireGuard requires a local Private Key."),(Fe||"").trim()||r.push("WireGuard requires Peer Public Key."),(ce||"").trim()||r.push("WireGuard requires Peer Endpoint (host:port)."),(_||"").trim()||n.push("Allowed IPs is empty; recommended: 0.0.0.0/0, ::/0")),Q){const b=Number(xe);(!Number.isInteger(b)||b<1||b>65535)&&r.push("Dokodemo-door requires a valid Target Port."),(He||"").trim()||n.push("Set Target Network (tcp/udp) explicitly for predictable routing.")}return P&&(A==="WS"||A==="HTTPUPGRADE"||A==="XHTTP")&&!(Re||"").trim()&&n.push("Path is empty; define wsPath/xhttp path for client consistency."),P&&A==="GRPC"&&!(Ne||"").trim()&&n.push("gRPC Service Name is empty; most clients require a matching service name."),F==="TLS"&&!(de||"").trim()&&n.push("TLS SNI is empty; set Server Name to avoid certificate mismatch."),ge&&F==="TLS"&&(V.some(g=>[g.dest,g.path,g.alpn,g.name,g.xver].some(W=>W.trim().length>0)&&!g.dest.trim())?r.push("Each fallback row with values must include Dest."):V.length===0&&n.push("Fallbacks are optional. Add them only if your routing requires fallback destinations.")),{issues:r,tips:n}},[He,xe,Ne,Q,A,O,Le,je,we,F,Se,de,ke,P,ge,V,_,ce,Fe,Oe,Re]),ze=r=>{for(const[n,b]of Object.entries(r.values))u(n,b,{shouldDirty:!0,shouldValidate:!0})},Pe=()=>{x(r=>[...r,Ms()])},qe=r=>{x(n=>n.filter(b=>b.id!==r))},ue=(r,n,b)=>{x(g=>g.map(U=>U.id!==r?U:{...U,[n]:b}))},Ye=G({mutationFn:async r=>{D&&s?await T.put(`/inbounds/${s.id}`,r):await T.post("/inbounds",r)},onSuccess:()=>{o()},onError:r=>{N.error(h("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||h("inbounds.toast.saveFailed",{defaultValue:"Failed to save inbound"}))}}),ne=G({mutationFn:async()=>{var n;const r=await T.get("/inbounds/random-port");return Number(((n=r==null?void 0:r.data)==null?void 0:n.port)||0)},onSuccess:r=>{if(!Number.isInteger(r)||r<1||r>65535)return;u("port",r,{shouldDirty:!0,shouldValidate:!0}),(y("tag")||"").trim()||u("tag",`${String(O).toLowerCase()}-${r}`,{shouldDirty:!0,shouldValidate:!0})},onError:r=>{N.error(h("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||h("inbounds.toast.randomPortFailed",{defaultValue:"Failed to generate random port"}))}}),Ue=G({mutationFn:async()=>await T.get("/inbounds/wireguard/keys"),onSuccess:r=>{const n=(r==null?void 0:r.data)||r;n!=null&&n.privateKey&&u("wgPrivateKey",n.privateKey,{shouldDirty:!0,shouldValidate:!0}),n!=null&&n.publicKey&&u("wgPublicKey",n.publicKey,{shouldDirty:!0,shouldValidate:!0}),y("wgAllowedIPs")||u("wgAllowedIPs","0.0.0.0/0, ::/0",{shouldDirty:!0,shouldValidate:!1})},onError:r=>{N.error(h("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||h("inbounds.toast.wireguardKeygenFailed",{defaultValue:"Failed to generate WireGuard keys"}))}}),I=G({mutationFn:async()=>await T.post("/reality/generate-keys",{serverName:y("serverName")||void 0}),onSuccess:r=>{const n=(r==null?void 0:r.data)||r;n!=null&&n.privateKey&&u("realityPrivateKey",n.privateKey,{shouldDirty:!0,shouldValidate:!0}),n!=null&&n.publicKey&&u("realityPublicKey",n.publicKey,{shouldDirty:!0,shouldValidate:!0});const b=Array.isArray(n==null?void 0:n.shortIds)?n.shortIds:n!=null&&n.shortId?[n.shortId]:[];if(b.length>0){const U=[(y("realityShortId")||"").trim(),b.join(",")].filter(Boolean).join(",").split(",").map(W=>W.trim()).filter(Boolean);u("realityShortId",Array.from(new Set(U)).join(","),{shouldDirty:!0,shouldValidate:!0})}y("realityFingerprint")||u("realityFingerprint",(n==null?void 0:n.fingerprint)||"chrome",{shouldDirty:!0,shouldValidate:!1}),y("serverName")||u("serverName",(n==null?void 0:n.serverName)||"www.microsoft.com",{shouldDirty:!0,shouldValidate:!0}),!y("realityServerName")&&(n!=null&&n.serverName)&&u("realityServerName",n.serverName,{shouldDirty:!0,shouldValidate:!1})},onError:r=>{N.error(h("common.error",{defaultValue:"Error"}),(r==null?void 0:r.message)||h("inbounds.toast.realityKeygenFailed",{defaultValue:"Failed to generate REALITY keys"}))}}),ts=r=>{const n={...r,domains:typeof r.domains=="string"?r.domains.split(",").map(g=>g.trim()).filter(Boolean):Array.isArray(r.domains)?r.domains:[]},b=As(V);if(n.fallbacks=JSON.stringify(b),P||(n.network="TCP",n.security="NONE"),Q&&!n.dokodemoTargetPort&&(n.dokodemoTargetPort=80),!B&&n.security==="TLS"&&(n.security="NONE"),!z&&n.security==="REALITY"&&(n.security="NONE"),n.protocol==="TROJAN"&&(n.security="TLS"),n.security==="REALITY"){const g=typeof n.realityShortId=="string"?n.realityShortId.split(",").map(W=>W.trim()).filter(Boolean):[];n.realityShortId=g.join(",");const U=typeof n.realityServerName=="string"?n.realityServerName.split(",").map(W=>W.trim()).filter(Boolean):[];n.realityServerName=U.join(","),!n.serverName&&U.length>0&&(n.serverName=U[0])}Ye.mutate(n)},he=()=>{const r=(Se||"").trim();if((ce||"").trim())return;if(!r){N.warning(h("common.warning",{defaultValue:"Warning"}),h("inbounds.toast.missingServerAddress",{defaultValue:"Set Server Address first."}));return}const b=Number(Ge),g=Number.isInteger(b)&&b>0?b:51820;u("wgPeerEndpoint",`${r}:${g}`,{shouldDirty:!0,shouldValidate:!0})},Te=(()=>{if(O!=="WIREGUARD")return"";const r=(Oe||"").trim(),n=(Fe||fe||"").trim(),b=(ce||"").trim();if(!r||!n||!b)return"";const g=(K||"").trim()||"10.66.2.2/32",U=(_||"").trim()||"0.0.0.0/0, ::/0",W=Number(Ke),Ae=Number.isInteger(W)&&W>0,le=["[Interface]",`PrivateKey = ${r}`,`Address = ${g}`,"","[Peer]",`PublicKey = ${n}`,`Endpoint = ${b}`,`AllowedIPs = ${U}`,"PersistentKeepalive = 25"];return Ae&&le.splice(3,0,`MTU = ${W}`),le.join(`
`)})(),Z=(()=>{if(O!=="VLESS"||F!=="REALITY")return"";const r=(Se||"").trim(),n=Number(Ge),b=(je||"").trim();if(!r||!Number.isInteger(n)||n<1||!b)return"";const g=new URLSearchParams,U=(A||"TCP").toLowerCase();g.set("type",U),g.set("security","reality");const W=(ke||"").split(",").map(Ie=>Ie.trim()).filter(Boolean)[0];g.set("sni",(de||W||r).trim()),g.set("fp",(q||"chrome").trim()||"chrome"),g.set("pbk",b),g.set("flow","xtls-rprx-vision");const Ae=(we||"").split(",").map(Ie=>Ie.trim()).filter(Boolean);Ae.length>0&&g.set("sid",Ae[0]),(Y||"").trim()&&g.set("spx",String(Y).trim()),A==="WS"||A==="HTTPUPGRADE"||A==="XHTTP"?(g.set("path",(Re||"/").trim()||"/"),(De||"").trim()&&g.set("host",De.trim()),A==="XHTTP"&&(Me||"").trim()&&g.set("mode",Me.trim())):A==="GRPC"&&(g.set("serviceName",(Ne||"").trim()),g.set("mode","gun"));const le=encodeURIComponent((w||"vless-reality").trim()||"vless-reality");return`vless://{UUID}@${r}:${n}?${g.toString()}#${le}`})(),Xe=async()=>{Z&&(await navigator.clipboard.writeText(Z),C(!0),window.setTimeout(()=>C(!1),1600))};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto overscroll-contain bg-black/45 p-2 backdrop-blur-sm sm:p-4",style:{WebkitOverflowScrolling:"touch"},children:e.jsx("div",{className:"flex min-h-full items-end justify-center sm:items-center",children:e.jsxs("div",{className:"my-2 flex max-h-[calc(100dvh-1rem)] w-full max-w-3xl flex-col overflow-hidden rounded-2xl border border-line/80 bg-card/95 shadow-soft backdrop-blur-xl sm:my-4 sm:max-h-[calc(100dvh-2rem)]",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-line/80 bg-card/95 p-5",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground sm:text-2xl",children:D?"Edit Inbound":"Add New Inbound"}),e.jsx("button",{onClick:l,className:"rounded-lg p-2 text-muted transition-colors hover:bg-card hover:text-foreground","aria-label":"Close",children:e.jsx(Es,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:$(ts),className:"min-h-0 flex-1 space-y-6 overflow-y-auto overscroll-contain px-5 pb-28 pt-5 sm:px-6 sm:pb-32 sm:pt-6",style:{WebkitOverflowScrolling:"touch"},children:[D?null:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Quick Presets"}),e.jsx("span",{className:"text-xs text-muted",children:"One-click inbound wizard"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:ae.map(r=>e.jsxs("button",{type:"button",onClick:()=>ze(r),className:"rounded-xl border border-line/80 bg-card/70 p-3 text-left transition hover:border-brand-400/55 hover:bg-card",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:r.name}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:r.values.protocol}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:r.values.network})]}),e.jsx("p",{className:"mt-1 text-xs leading-relaxed text-muted",children:r.description}),e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:r.highlights.slice(0,3).map(n=>e.jsx("span",{className:"rounded-md border border-brand-500/20 bg-brand-500/10 px-1.5 py-0.5 text-[10px] font-medium text-brand-700 dark:text-brand-300",children:n},`${r.id}-${n}`))})]},r.id))})]}),re.issues.length>0||re.tips.length>0?e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[re.issues.length>0?e.jsx(pt,{className:"h-4 w-4 text-amber-500"}):e.jsx(xt,{className:"h-4 w-4 text-brand-500"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Validation Guide"})]}),re.issues.map(r=>e.jsxs("p",{className:"mb-1 text-xs text-red-500",children:["• ",r]},`issue-${r}`)),re.tips.map(r=>e.jsxs("p",{className:"mb-1 text-xs text-muted",children:["• ",r]},`tip-${r}`))]}):null,e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Basic Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Protocol *"}),e.jsxs("select",{...m("protocol",{required:"Protocol is required"}),className:"w-full rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",children:[e.jsx("option",{value:"VLESS",children:"VLESS"}),e.jsx("option",{value:"VMESS",children:"VMess"}),e.jsx("option",{value:"TROJAN",children:"Trojan"}),e.jsx("option",{value:"SHADOWSOCKS",children:"Shadowsocks"}),e.jsx("option",{value:"SOCKS",children:"SOCKS5"}),e.jsx("option",{value:"HTTP",children:"HTTP Proxy"}),e.jsx("option",{value:"DOKODEMO_DOOR",children:"Dokodemo-door"}),e.jsx("option",{value:"WIREGUARD",children:"Wireguard"}),e.jsx("option",{value:"MTPROTO",children:"MTProto (Telegram)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{label:"Port *",type:"number",...m("port",{required:"Port is required",min:{value:1,message:"Port must be between 1-65535"},max:{value:65535,message:"Port must be between 1-65535"}}),error:(be=te.port)==null?void 0:be.message,placeholder:"443"}),e.jsxs(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>ne.mutate(),loading:ne.isPending,children:[e.jsx(us,{className:"mr-2 h-4 w-4"}),"Random Free Port"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Tag *",...m("tag",{required:"Tag is required"}),error:(Ce=te.tag)==null?void 0:Ce.message,placeholder:"vless-ws-tls"}),e.jsx(S,{label:"Remark",...m("remark"),placeholder:"My VLESS Inbound"})]}),e.jsx(S,{label:Q?"Target Address *":"Server Address *",...m("serverAddress",{required:"Server address is required"}),error:(Ve=te.serverAddress)==null?void 0:Ve.message,placeholder:Q?"127.0.0.1":"your.domain.com or IP"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Additional Domains"}),e.jsx(S,{placeholder:"cdn.domain.com, worker.domain.com (comma separated)",...m("domains")}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:"Optional: Comma-separated list of additional domains for this inbound."})]})]}),Q?e.jsxs("div",{className:"space-y-4 rounded-xl border border-line/70 bg-panel/50 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Dokodemo-door Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Target Port *",type:"number",...m("dokodemoTargetPort",{valueAsNumber:!0,min:{value:1,message:"Target port must be between 1-65535"},max:{value:65535,message:"Target port must be between 1-65535"}}),error:(Be=te.dokodemoTargetPort)==null?void 0:Be.message,placeholder:"80"}),e.jsx(S,{label:"Target Network",...m("dokodemoNetwork"),placeholder:"tcp,udp"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-foreground",children:[e.jsx("input",{type:"checkbox",...m("dokodemoFollowRedirect"),className:"h-4 w-4 rounded border-line bg-card"}),"Follow redirect"]})]}):null,P?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Network Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Network *"}),e.jsxs("select",{...m("network",{required:"Network is required"}),className:"w-full rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",children:[e.jsx("option",{value:"TCP",children:"TCP"}),e.jsx("option",{value:"WS",children:"WebSocket"}),e.jsx("option",{value:"HTTPUPGRADE",children:"HTTP Upgrade"}),e.jsx("option",{value:"XHTTP",children:"XHTTP"}),e.jsx("option",{value:"GRPC",children:"gRPC"}),e.jsx("option",{value:"HTTP",children:"HTTP/2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Security *"}),e.jsxs("select",{...m("security",{required:"Security is required"}),className:"w-full rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",children:[e.jsx("option",{value:"NONE",children:"None"}),B?e.jsx("option",{value:"TLS",children:"TLS"}):null,z?e.jsx("option",{value:"REALITY",children:"REALITY"}):null]})]})]})]}):e.jsx("div",{className:"rounded-xl border border-line/80 bg-panel/50 p-3 text-sm text-muted",children:"This protocol uses direct listener mode. Network and TLS settings are not required."}),F==="TLS"&&B&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"TLS Settings"}),e.jsx(S,{label:"Server Name (SNI)",...m("serverName"),placeholder:"your.domain.com"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"ALPN (JSON Array)"}),e.jsx("input",{...m("alpn"),className:"w-full rounded-xl border border-line/80 bg-card/75 px-3 py-2 font-mono text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:'["h2","http/1.1"]'}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:'Example: ["h2","http/1.1"] or ["h2"]'})]}),ge?e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Fallbacks"}),e.jsxs(p,{type:"button",size:"sm",variant:"secondary",onClick:Pe,children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"Add Fallback"]})]}),V.length===0?e.jsx("p",{className:"text-xs text-muted",children:"No fallbacks configured. Add fallback rows only when you need path/destination based routing."}):null,V.map(r=>e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-card/70 p-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Dest *"}),e.jsx("input",{value:r.dest,onChange:n=>ue(r.id,"dest",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"3001 or 127.0.0.1:3001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Path"}),e.jsx("input",{value:r.path,onChange:n=>ue(r.id,"path",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"/ws"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Name"}),e.jsx("input",{value:r.name,onChange:n=>ue(r.id,"name",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"fallback-api"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"ALPN"}),e.jsx("input",{value:r.alpn,onChange:n=>ue(r.id,"alpn",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"h2,http/1.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"Xver"}),e.jsx("input",{value:r.xver,onChange:n=>ue(r.id,"xver",n.target.value),className:"w-full rounded-lg border border-line/70 bg-card/80 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",placeholder:"1",inputMode:"numeric"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(p,{type:"button",size:"sm",variant:"ghost",onClick:()=>qe(r.id),children:[e.jsx(Ds,{className:"mr-2 h-4 w-4 text-red-500"}),"Remove"]})})]},r.id)),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium uppercase tracking-wide text-muted",children:"JSON Preview"}),e.jsx("pre",{className:"max-h-36 overflow-auto rounded-lg border border-line/70 bg-card/80 p-3 text-xs text-foreground",children:$e})]})]}):null]}),F==="REALITY"&&z&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"REALITY Settings"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>I.mutate(),loading:I.isPending,children:"Generate REALITY Keys"})]}),e.jsx(Jt,{register:m,watch:v,setValue:u,errors:te}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Server Name (SNI) *",...m("serverName",{required:F==="REALITY"?"SNI is required for REALITY":!1}),placeholder:"www.microsoft.com"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Fingerprint"}),e.jsxs("select",{...m("realityFingerprint"),className:"w-full rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",children:[e.jsx("option",{value:"chrome",children:"Chrome"}),e.jsx("option",{value:"firefox",children:"Firefox"}),e.jsx("option",{value:"safari",children:"Safari"}),e.jsx("option",{value:"ios",children:"iOS"}),e.jsx("option",{value:"android",children:"Android"}),e.jsx("option",{value:"edge",children:"Edge"}),e.jsx("option",{value:"random",children:"Random"})]})]})]}),e.jsx(S,{label:"Public Key *",...m("realityPublicKey",{required:F==="REALITY"?"Public key is required":!1}),placeholder:"Enter REALITY public key"}),e.jsx(S,{label:"Private Key *",...m("realityPrivateKey",{required:F==="REALITY"?"Private key is required":!1}),placeholder:"Enter REALITY private key"}),e.jsx(S,{label:"Short ID",...m("realityShortId"),placeholder:"e.g., 0123456789abcdef,abcdef0123456789"}),e.jsx(S,{label:"Reality Server Names",...m("realityServerName"),placeholder:"www.microsoft.com,www.cloudflare.com"}),Z?e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"REALITY Link Template"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>{Xe()},children:M?"Copied":"Copy Template"})]}),e.jsx("pre",{className:"max-h-44 overflow-auto rounded-lg border border-line/70 bg-card/80 p-3 text-xs text-foreground",children:Z}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"w-fit rounded-lg border border-line/70 bg-white p-2",children:e.jsx(ks,{value:Z,size:132})}),e.jsxs("p",{className:"text-xs text-muted",children:["Replace ","{UUID}"," with the user UUID for manual links, or use subscription URLs for automatic client import."]})]})]}):e.jsx("p",{className:"text-xs text-muted",children:"Enter server address, port, and REALITY keys to preview a share-link template."})]}),O==="WIREGUARD"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Wireguard Settings"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:he,children:"Auto Endpoint"}),e.jsx(p,{type:"button",size:"sm",variant:"secondary",onClick:()=>Ue.mutate(),loading:Ue.isPending,children:"Generate Key Pair"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Private Key *",...m("wgPrivateKey",{required:O==="WIREGUARD"?"Private key is required":!1}),placeholder:"Your Wireguard private key"}),e.jsx(S,{label:"Public Key",...m("wgPublicKey"),placeholder:"Your Wireguard public key"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Peer Public Key *",...m("wgPeerPublicKey",{required:O==="WIREGUARD"?"Peer public key is required":!1}),placeholder:"Server's Wireguard public key"}),e.jsx(S,{label:"Peer Endpoint",...m("wgPeerEndpoint"),placeholder:"server:51820"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Allowed IPs",...m("wgAllowedIPs"),placeholder:"0.0.0.0/0, ::/0"}),e.jsx(S,{label:"MTU",type:"number",...m("wgMtu",{valueAsNumber:!0}),placeholder:"1420"})]}),e.jsx(S,{label:"Client Address (optional)",...m("wgAddress"),placeholder:"10.66.2.2/32"}),Te?e.jsxs("div",{className:"space-y-3 rounded-xl border border-line/70 bg-panel/55 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"WireGuard Config Preview"}),e.jsx("pre",{className:"max-h-52 overflow-auto rounded-lg border border-line/70 bg-card/80 p-3 text-xs text-foreground",children:Te}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"w-fit rounded-lg border border-line/70 bg-white p-2",children:e.jsx(ks,{value:Te,size:132})}),e.jsx("p",{className:"text-xs text-muted",children:'Scan this QR in WireGuard mobile app using "Create from QR code".'})]})]}):e.jsx("p",{className:"text-xs text-muted",children:"Enter Private Key, Peer Public Key, and Peer Endpoint to preview WireGuard config and QR."})]}),(A==="WS"||A==="XHTTP"||A==="HTTPUPGRADE")&&P&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:A==="XHTTP"?"XHTTP Settings":A==="HTTPUPGRADE"?"HTTP Upgrade Settings":"WebSocket Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(S,{label:"Path",...m("wsPath"),placeholder:A==="XHTTP"?"/xhttp":"/vless"}),e.jsx(S,{label:A==="XHTTP"?"Host (comma-separated)":"Host",...m("wsHost"),placeholder:"your.domain.com"})]}),A==="XHTTP"?e.jsx(S,{label:"Mode",...m("xhttpMode"),placeholder:"auto or packet-up"}):null]}),A==="GRPC"&&P&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"gRPC Settings"}),e.jsx(S,{label:"Service Name",...m("grpcServiceName"),placeholder:"grpc-service"})]}),O==="SHADOWSOCKS"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Shadowsocks Settings"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-muted",children:"Cipher Method"}),e.jsxs("select",{...m("cipher"),className:"w-full rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",children:[e.jsx("option",{value:"chacha20-ietf-poly1305",children:"chacha20-ietf-poly1305"}),e.jsx("option",{value:"aes-256-gcm",children:"aes-256-gcm"}),e.jsx("option",{value:"aes-128-gcm",children:"aes-128-gcm"})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 z-10 -mx-5 flex flex-col gap-2 border-t border-line/70 bg-card/95 px-5 pb-2 pt-4 sm:-mx-6 sm:flex-row sm:px-6",children:[e.jsx(p,{type:"submit",className:"flex-1",loading:Ye.isPending,children:D?"Update Inbound":"Create Inbound"}),e.jsx(p,{type:"button",variant:"secondary",onClick:l,className:"flex-1",children:"Cancel"})]})]})]})})})},_t=[{protocol:"VLESS",title:"VLESS",useCase:"Best overall protocol for modern Xray deployments",networks:["TCP","WS","GRPC","HTTPUPGRADE","XHTTP"],security:["NONE","TLS","REALITY"],clients:["v2rayN","v2rayNG","Clash Meta","sing-box"],recommendation:"Use REALITY + XHTTP for anti-censorship or WS+TLS for CDN."},{protocol:"VMESS",title:"VMess",useCase:"Legacy compatibility with older V2Ray clients",networks:["TCP","WS","GRPC","HTTP"],security:["NONE","TLS"],clients:["v2rayN","v2rayNG","some Clash cores"],recommendation:"Prefer VLESS for new installs; keep VMess for migration."},{protocol:"TROJAN",title:"Trojan",useCase:"TLS-native protocol with strong censorship resistance",networks:["TCP","WS","GRPC"],security:["TLS"],clients:["Clash","sing-box","NekoBox"],recommendation:"Use gRPC+TLS for clean setup and stable performance."},{protocol:"SHADOWSOCKS",title:"Shadowsocks",useCase:"Lightweight encrypted proxy for low overhead scenarios",networks:["TCP"],security:["NONE"],clients:["Shadowrocket","Clash","Outline-compatible apps"],recommendation:"Great fallback profile; pair with strong cipher."},{protocol:"SOCKS",title:"SOCKS5",useCase:"Generic proxy for apps and browsers",networks:["TCP"],security:["NONE"],clients:["Browsers","OS proxy","Proxifier"],recommendation:"Use for local gateway use-cases with account auth."},{protocol:"HTTP",title:"HTTP Proxy",useCase:"Simple forward proxy for standard HTTP tooling",networks:["TCP"],security:["NONE"],clients:["Browsers","curl","system proxy"],recommendation:"Use where HTTP proxy support is explicitly required."},{protocol:"DOKODEMO_DOOR",title:"Dokodemo-door",useCase:"Traffic forwarding and transparent proxy integration",networks:["TCP"],security:["NONE"],clients:["Xray internal routing","DNS forwarders"],recommendation:"Ideal for DNS forward and transparent redirection flows."},{protocol:"WIREGUARD",title:"WireGuard",useCase:"Tunnel outbound transport through WireGuard peer",networks:["TCP"],security:["NONE"],clients:["WireGuard app (for preview config)","Xray upstream"],recommendation:"Set peer endpoint + keys first, then route traffic through it."},{protocol:"MTPROTO",title:"MTProto",useCase:"Telegram-specific proxy protocol",networks:["TCP"],security:["NONE"],clients:["Telegram MTProto proxy clients"],recommendation:"Use dedicated port and isolate from normal user traffic."}],Zt=({onQuickCreate:s})=>{const{t:d}=ss();return e.jsxs(se,{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(Ut,{className:"h-4 w-4 text-brand-500"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:d("compatibility.title",{defaultValue:"Protocol Compatibility Matrix"})})]}),e.jsx("div",{className:"space-y-3",children:_t.map(l=>e.jsx("div",{className:"rounded-xl border border-line/70 bg-card/65 p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:l.title}),e.jsx(Rs,{variant:"info",children:l.protocol})]}),e.jsx("p",{className:"text-sm text-muted",children:l.useCase}),e.jsx("p",{className:"text-xs text-muted",children:l.recommendation}),e.jsxs("div",{className:"pt-1",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted",children:d("compatibility.networks",{defaultValue:"Networks"})}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.networks.map(o=>e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-1 text-xs font-medium text-foreground",children:o},`${l.protocol}-${o}`))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted",children:d("compatibility.security",{defaultValue:"Security"})}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.security.map(o=>e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-1 text-xs font-medium text-foreground",children:o},`${l.protocol}-${o}`))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted",children:d("compatibility.clients",{defaultValue:"Supported Clients"})}),e.jsx("p",{className:"text-xs text-foreground/90",children:l.clients.join(" · ")})]})]}),e.jsx("div",{className:"md:pl-4",children:e.jsx(p,{type:"button",size:"sm",onClick:()=>s(l.protocol),className:"w-full md:w-auto",children:d("compatibility.quickCreate",{defaultValue:"Quick Create"})})})]})},l.protocol))})]})},ea=["recommended","cdn","transport","utility"],me={recommended:{title:"Recommended",hint:"Balanced defaults for most deployments."},cdn:{title:"CDN & Edge",hint:"Traffic profiles optimized for edge/CDN transport."},transport:{title:"Transport Profiles",hint:"Focused presets for specific transport behaviors."},utility:{title:"Utility & Gateway",hint:"DNS forwarders, gateways, and service adapters."}};function Is(s){return s==="inbounds"||s==="templates"||s==="compatibility"}function cs(s){if(typeof s=="number")return Number.isFinite(s)?s:0;if(typeof s=="string"&&s.trim()){const d=Number.parseFloat(s);return Number.isFinite(d)?d:0}return 0}const sa=new Set(["VLESS","VMESS","TROJAN","SHADOWSOCKS","SOCKS","HTTP","DOKODEMO_DOOR","WIREGUARD","MTPROTO"]),ta=new Set(["TCP","WS","GRPC","HTTP","HTTPUPGRADE","XHTTP"]),aa=new Set(["NONE","TLS","REALITY"]);function ra(s){const d=String(s||"VLESS").toUpperCase();return sa.has(d)?d:"VLESS"}function na(s,d){const l=String(s||"").toUpperCase();return ta.has(l)?l:d==="DOKODEMO_DOOR"||d==="SOCKS"||d==="HTTP"?"TCP":"WS"}function la(s,d){const l=String(s||"").toUpperCase();return d==="TROJAN"?"TLS":aa.has(l)?l==="REALITY"&&d!=="VLESS"?"NONE":l:"NONE"}function Ls(s,d,l){const o=String(s||d).trim().replace(/\s+/g,"-").toLowerCase();let N=o||d,h=1;for(;l.has(N);)N=`${o||d}-${h}`,h+=1;return l.add(N),N}function Os(s,d,l){let o=Number.parseInt(String(s??l),10);for((Number.isNaN(o)||o<1||o>65535)&&(o=l);d.has(o)||o<1||o>65535;)o+=1,o>65535&&(o=1024);return d.add(o),o}function oa(s,d,l,o){const N=ra(s.protocol),h=na(s.network,N),M=la(s.security,N),C=2e4+d,D=Os(s.port,o,C),R=Ls(s.tag,`${N.toLowerCase()}-${D}`,l),L={protocol:N,network:h,security:M,port:D,tag:R,remark:typeof s.remark=="string"?s.remark:void 0,serverAddress:typeof s.serverAddress=="string"&&s.serverAddress.trim()?s.serverAddress.trim():"127.0.0.1"},V=["serverName","wsPath","wsHost","xhttpMode","grpcServiceName","alpn","cipher","realityPublicKey","realityPrivateKey","realityShortId","realityFingerprint","wgPrivateKey","wgPublicKey","wgAddress","wgPeerPublicKey","wgPeerEndpoint","wgAllowedIPs","wgMtu","dokodemoTargetPort","dokodemoNetwork","dokodemoFollowRedirect","domains","fallbacks"];for(const x of V){const m=s[x];m!==void 0&&(L[x]=m)}return N==="DOKODEMO_DOOR"&&L.dokodemoTargetPort===void 0&&(L.dokodemoTargetPort=80),L}function Fs(s){const d={port:s.port,protocol:s.protocol,tag:s.tag,remark:s.remark,enabled:s.enabled,network:s.network,security:s.security,serverName:s.serverName,serverAddress:s.serverAddress,alpn:s.alpn,wsPath:s.wsPath,wsHost:s.wsHost,xhttpMode:s.xhttpMode,grpcServiceName:s.grpcServiceName,cipher:s.cipher,realityPublicKey:s.realityPublicKey,realityPrivateKey:s.realityPrivateKey,realityFingerprint:s.realityFingerprint,realityShortIds:s.realityShortIds,realityServerNames:s.realityServerNames,wgPrivateKey:s.wgPrivateKey,wgPublicKey:s.wgPublicKey,wgAddress:s.wgAddress,wgPeerPublicKey:s.wgPeerPublicKey,wgPeerEndpoint:s.wgPeerEndpoint,wgAllowedIPs:s.wgAllowedIPs,wgMtu:s.wgMtu,dokodemoTargetPort:s.dokodemoTargetPort,dokodemoNetwork:s.dokodemoNetwork,dokodemoFollowRedirect:s.dokodemoFollowRedirect,domains:s.domains,fallbacks:s.fallbacks};return Object.fromEntries(Object.entries(d).filter(([,l])=>l!=null))}function Qe(s){const d=String(s.values.protocol||"vless").toLowerCase(),l=Number(s.values.port||443);return{...s.values,tag:s.values.tag||`${d}-${l}`,serverAddress:s.values.serverAddress||"your.domain.com"}}function Ks(s,d){const l=Fs(s),o=new Set(d.map(C=>C.tag)),N=new Set(d.map(C=>C.port)),h=Ls(`${s.tag}-copy`,`${s.protocol.toLowerCase()}-copy`,o),M=Os(s.port+1,N,s.port+1);return{...l,tag:h,port:M,remark:`${s.remark||s.tag} (Clone)`}}function ia(s){var l;const d={...s};if(Array.isArray(s.domains)&&(d.domains=s.domains.map(o=>String(o)).join(", ")),Array.isArray(s.fallbacks)&&(d.fallbacks=JSON.stringify(s.fallbacks,null,2)),!d.realityShortId&&Array.isArray(s.realityShortIds)){const o=(l=s.realityShortIds)==null?void 0:l[0];o!=null&&(d.realityShortId=String(o))}return d}function da(s,d){return ia(Ks(s,d))}function ca(s){const d=s.toLowerCase().replace(/_/g,"-");return{protocol:s,port:443,tag:`${d}-new`,remark:`${s} inbound`,network:"TCP",security:"NONE",serverAddress:"your.domain.com"}}const ua=()=>{var js,ws;const{t:s}=ss(),d=gt(),l=ft(),o=ms(),N=f.useRef(null),[h,M]=ht(),C=bt(t=>t.admin),D=(C==null?void 0:C.role)==="SUPER_ADMIN",R=f.useMemo(()=>[{id:"inbounds",label:s("inbounds.tabs.inbounds",{defaultValue:"Inbounds"})},{id:"templates",label:s("inbounds.tabs.templates",{defaultValue:"Templates"})},{id:"compatibility",label:s("inbounds.tabs.compatibility",{defaultValue:"Compatibility"})}],[s]),L=f.useMemo(()=>({recommended:{title:s("inbounds.templateCategories.recommended.title",{defaultValue:me.recommended.title}),hint:s("inbounds.templateCategories.recommended.hint",{defaultValue:me.recommended.hint})},cdn:{title:s("inbounds.templateCategories.cdn.title",{defaultValue:me.cdn.title}),hint:s("inbounds.templateCategories.cdn.hint",{defaultValue:me.cdn.hint})},transport:{title:s("inbounds.templateCategories.transport.title",{defaultValue:me.transport.title}),hint:s("inbounds.templateCategories.transport.hint",{defaultValue:me.transport.hint})},utility:{title:s("inbounds.templateCategories.utility.title",{defaultValue:me.utility.title}),hint:s("inbounds.templateCategories.utility.hint",{defaultValue:me.utility.hint})}}),[s]),[V,x]=f.useState(!1),[m,$]=f.useState(null),[u,y]=f.useState(null),[v,te]=f.useState(null),[O,A]=f.useState(null),[F,de]=f.useState(null),[Re,De]=f.useState(null),[Ne,Me]=f.useState(null),[je,Le]=f.useState(null),[we,ke]=f.useState([]),[q,Y]=f.useState([]),[w,xe]=f.useState(null),[He,Q]=f.useState(!1),[P,B]=f.useState({serverAddress:"",serverName:"",cdnHost:"",fallbackPorts:"8443,9443",assignUserIds:[],assignGroupIds:[]}),[z,ge]=f.useState(null),[Oe,Fe]=f.useState(()=>Date.now()),fe=Et("one-ui/inbounds-filters",{defaultTab:"inbounds",viewMode:"auto"}),{views:ce,saveView:Se,deleteView:Ge}=Rt("one-ui/inbounds-saved-views"),[_,Ke]=f.useState(""),[K,$e]=f.useState(()=>{const t=h.get("tab");return Is(t)?t:fe.value.defaultTab}),ae=fe.value.viewMode,re=t=>{fe.setValue(a=>({...a,viewMode:t}))},ze=h.get("quick"),Pe=h.get("tab");f.useEffect(()=>{if(ze==="create"){$(null),y(null),x(!0),$e("inbounds");const t=new URLSearchParams(h);t.delete("quick"),t.set("tab","inbounds"),M(t,{replace:!0})}},[ze,h,M]),f.useEffect(()=>{Is(Pe)&&Pe!==K&&$e(Pe)},[Pe,K]),f.useEffect(()=>{fe.setValue(t=>t.defaultTab===K?t:{...t,defaultTab:K})},[K,fe]);const{data:qe,isLoading:ue,isFetching:Ye}=_e({queryKey:["inbounds"],queryFn:async()=>(await T.get("/inbounds")).data,placeholderData:yt,staleTime:3e4}),{data:ne=[]}=_e({queryKey:["inbounds-users-directory"],queryFn:async()=>{var j;let a=1,i=1;const c=[];for(;a<=i&&a<=50;){const k=await T.get("/users",{params:{page:a,limit:100}});Array.isArray(k.data)&&c.push(...k.data),i=Number(((j=k.meta)==null?void 0:j.totalPages)||1),a+=1}return c},staleTime:2e4}),{data:Ue=[]}=_e({queryKey:["inbounds-assignable-groups"],queryFn:async()=>(await It.list({page:1,limit:200,includeDisabled:!0})).data||[],staleTime:3e4}),I=f.useMemo(()=>qe||[],[qe]),ts=f.useMemo(()=>ne.map(t=>Number(t.id)).filter(t=>Number.isInteger(t)&&t>0),[ne]),he=Mt(ts,{includeOffline:!0,live:!0,streamInterval:2e3}),as=q.length,Te=I.length>0&&q.length===I.length,rs=G({mutationFn:async t=>{const a=new Set(I.map(k=>k.tag)),i=new Set(I.map(k=>k.port));let c=0;const j=[];for(const[k,X]of t.entries())try{const H=oa(X,k,a,i);await T.post("/inbounds",H),c+=1}catch(H){j.push(`Item ${k+1}: ${(H==null?void 0:H.message)||"Unknown error"}`)}return{success:c,failures:j}},onSuccess:async({success:t,failures:a})=>{await l.invalidateQueries({queryKey:["inbounds"]});const i=a.length;i>0?o.error(s("inbounds.import.completedWarningsTitle",{defaultValue:"Import completed with warnings"}),s("inbounds.import.completedWarningsBody",{defaultValue:"Imported {{success}} profile(s), {{failed}} failed. {{details}}",success:t,failed:i,details:a.slice(0,3).join(" | ")})):o.success(s("inbounds.import.completedTitle",{defaultValue:"Import completed"}),s("inbounds.import.completedBody",{defaultValue:"Successfully imported {{count}} profile(s).",count:t}))},onError:t=>{o.error(s("inbounds.import.failedTitle",{defaultValue:"Import failed"}),(t==null?void 0:t.message)||s("inbounds.import.failedBody",{defaultValue:"Failed to import inbound profiles"}))}}),Z=G({mutationFn:async t=>T.post("/inbounds/presets/myanmar",t),onSuccess:async t=>{var J,oe;const a=(t==null?void 0:t.data)||{},i=!!a.dryRun,c=a.warnings||[];if(i){ge(a);const ve=((J=a.planned)==null?void 0:J.length)||0;c.length>0?o.error(s("inbounds.myanmarPack.previewWarningsTitle",{defaultValue:"Myanmar pack preview generated with warnings"}),s("inbounds.myanmarPack.previewWarningsBody",{defaultValue:"{{count}} planned profile(s). {{details}}",count:ve,details:c.slice(0,3).join(" | ")})):o.success(s("inbounds.myanmarPack.previewTitle",{defaultValue:"Myanmar pack preview generated"}),s("inbounds.myanmarPack.previewBody",{defaultValue:"{{count}} planned profile(s).",count:ve}));return}await l.invalidateQueries({queryKey:["inbounds"]});const j=((oe=a.created)==null?void 0:oe.length)||0,k=a.assignment||{},X=Number(k.assignedUsers||0),H=Number(k.assignedGroups||0);let E="";(X>0||H>0)&&(E=`
${s("inbounds.myanmarPack.assignedSummary",{defaultValue:"Assigned to {{users}} user(s) and {{groups}} group(s).",users:X,groups:H})}`),await Promise.all([l.invalidateQueries({queryKey:["users"]}),l.invalidateQueries({queryKey:["groups"]}),l.invalidateQueries({queryKey:["inbounds-assignable-groups"]}),l.invalidateQueries({queryKey:["inbounds-users-directory"]})]),c.length>0?o.error(s("inbounds.myanmarPack.appliedWarningsTitle",{defaultValue:"Myanmar pack applied with warnings"}),s("inbounds.myanmarPack.appliedWarningsBody",{defaultValue:"{{count}} profile(s) created.{{assignment}} {{details}}",count:j,assignment:E,details:c.slice(0,3).join(" | ")})):o.success(s("inbounds.myanmarPack.appliedTitle",{defaultValue:"Myanmar pack applied"}),s("inbounds.myanmarPack.appliedBody",{defaultValue:"{{count}} profile(s) created.{{assignment}}",count:j,assignment:E})),Q(!1),ge(null)},onError:t=>{o.error(s("inbounds.myanmarPack.failedTitle",{defaultValue:"Myanmar pack failed"}),(t==null?void 0:t.message)||s("inbounds.myanmarPack.failedBody",{defaultValue:"Failed to apply Myanmar pack"}))}}),Xe=G({mutationFn:async t=>{await T.delete(`/inbounds/${t}`)},onSuccess:()=>{l.invalidateQueries({queryKey:["inbounds"]})}}),be=G({mutationFn:async t=>{await T.post("/inbounds/bulk/delete",{inboundIds:t})},onSuccess:async()=>{Y([]),await l.invalidateQueries({queryKey:["inbounds"]})}}),Ce=G({mutationFn:async t=>{await T.post("/inbounds/bulk/enable",{inboundIds:t})},onSuccess:async()=>{Y([]),await l.invalidateQueries({queryKey:["inbounds"]})}}),Ve=G({mutationFn:async t=>{await T.post("/inbounds/bulk/disable",{inboundIds:t})},onSuccess:async()=>{Y([]),await l.invalidateQueries({queryKey:["inbounds"]})}}),Be=G({mutationFn:async t=>{await T.post(`/inbounds/${t}/toggle`)},onSuccess:()=>{l.invalidateQueries({queryKey:["inbounds"]})}}),r=G({mutationFn:async t=>{await T.post(`/inbounds/${t}/random-port`)},onMutate:t=>{Le(t)},onSuccess:async()=>{await l.invalidateQueries({queryKey:["inbounds"]})},onError:t=>{o.error(s("inbounds.randomPortFailedTitle",{defaultValue:"Randomize port failed"}),(t==null?void 0:t.message)||s("inbounds.randomPortFailedBody",{defaultValue:"Failed to randomize inbound port"}))},onSettled:()=>{Le(null)}});f.useEffect(()=>{Y(t=>t.filter(a=>I.some(i=>i.id===a)))},[I]),f.useEffect(()=>{ke(t=>t.filter(a=>I.some(i=>i.id===a)))},[I]),f.useEffect(()=>{const t=window.setInterval(()=>{Fe(Date.now())},6e4);return()=>{window.clearInterval(t)}},[]);const n=f.useMemo(()=>{var a;const t=new Map;for(const i of((a=he.data)==null?void 0:a.sessions)||[])t.set(String(i.uuid||""),{online:!!i.online,currentIp:i.currentIp,lastSeenAt:i.lastSeenAt});return t},[(js=he.data)==null?void 0:js.sessions]),b=f.useMemo(()=>{var a;const t=(((a=he.data)==null?void 0:a.sessions)||[]).filter(i=>i.online).map(i=>String(i.uuid||"")).filter(Boolean);return new Set(t)},[(ws=he.data)==null?void 0:ws.sessions]),g=f.useMemo(()=>{var a;const t=new Map;for(const i of ne){const c=Array.isArray(i.inbounds)?i.inbounds:[];for(const j of c){const k=Number(j.inboundId??((a=j.inbound)==null?void 0:a.id));if(!Number.isInteger(k)||k<1)continue;const X=cs(i.uploadUsed),H=cs(i.downloadUsed),E=cs(i.dataLimit),J=X+H,oe={id:Number(i.id),email:String(i.email||""),uuid:String(i.uuid||""),status:String(i.status||""),enabled:!!j.enabled,priority:Number.isInteger(Number(j.priority))?Number(j.priority):100,expireDate:String(i.expireDate||""),uploadUsed:X,downloadUsed:H,dataLimit:E,totalUsed:J},ve=t.get(k)||[];ve.push(oe),t.set(k,ve)}}for(const[i,c]of t.entries())c.sort((j,k)=>j.priority!==k.priority?j.priority-k.priority:j.email.localeCompare(k.email)),t.set(i,c);return t},[ne]),U=t=>{Y(a=>a.includes(t)?a.filter(i=>i!==t):[...a,t])},W=t=>{ke(a=>a.includes(t)?a.filter(i=>i!==t):[...a,t])},Ae=()=>{if(Te){Y([]);return}Y(I.map(t=>t.id))},le=be.isPending||Ce.isPending||Ve.isPending,Ie=async(t={})=>{const a=[l.invalidateQueries({queryKey:["inbounds"]})];he.streamStatus!=="connected"&&a.push(l.invalidateQueries({queryKey:["user-sessions"]})),t.includeUsersDirectory&&a.push(l.invalidateQueries({queryKey:["inbounds-users-directory"]})),await Promise.all(a)},ee=Dt(()=>Ie(),{enabled:K==="inbounds",intervalMs:5e3}),Ee=async(t,a,i)=>{De(t);try{await a(),await Ie({includeUsersDirectory:!0})}catch(c){o.error(s("inbounds.clientActionFailedTitle",{defaultValue:"Client action failed"}),(c==null?void 0:c.message)||i)}finally{De(null)}},$s=async()=>{if(!D){o.error(s("inbounds.permissionDeniedTitle",{defaultValue:"Permission denied"}),s("inbounds.permissionDeniedDeleteBody",{defaultValue:"Only SUPER_ADMIN can delete inbounds."}));return}q.length!==0&&xe({type:"bulk-delete",ids:[...q]})},Us=async()=>{if(w)try{w.type==="bulk-delete"?(await be.mutateAsync(w.ids),o.success(s("inbounds.bulkDeleteSuccessTitle",{defaultValue:"Bulk delete completed"}),s("inbounds.bulkDeleteSuccessBody",{defaultValue:"Deleted {{count}} inbound(s).",count:w.ids.length}))):(await Xe.mutateAsync(w.id),o.success(s("inbounds.deleteSuccessTitle",{defaultValue:"Inbound deleted"}),s("inbounds.deleteSuccessBody",{defaultValue:'Deleted inbound "{{name}}".',name:w.label}))),xe(null)}catch(t){o.error(s("inbounds.deleteFailedTitle",{defaultValue:"Delete failed"}),(t==null?void 0:t.message)||s("inbounds.deleteFailedBody",{defaultValue:"Failed to delete inbound"}))}},Bs=async()=>{if(q.length!==0)try{await Ce.mutateAsync(q),o.success(s("inbounds.bulkEnableSuccessTitle",{defaultValue:"Bulk enable completed"}),s("inbounds.bulkEnableSuccessBody",{defaultValue:"Selected inbounds enabled."}))}catch(t){o.error(s("inbounds.bulkEnableFailedTitle",{defaultValue:"Bulk enable failed"}),(t==null?void 0:t.message)||s("inbounds.bulkEnableFailedBody",{defaultValue:"Failed to enable selected inbounds"}))}},Ws=async()=>{if(q.length!==0)try{await Ve.mutateAsync(q),o.success(s("inbounds.bulkDisableSuccessTitle",{defaultValue:"Bulk disable completed"}),s("inbounds.bulkDisableSuccessBody",{defaultValue:"Selected inbounds disabled."}))}catch(t){o.error(s("inbounds.bulkDisableFailedTitle",{defaultValue:"Bulk disable failed"}),(t==null?void 0:t.message)||s("inbounds.bulkDisableFailedBody",{defaultValue:"Failed to disable selected inbounds"}))}},ns=G({mutationFn:async t=>{const a=Ks(t,I);await T.post("/inbounds",a)},onMutate:t=>{Me(t.id)},onSuccess:async()=>{await l.invalidateQueries({queryKey:["inbounds"]}),o.success(s("inbounds.cloneSuccessTitle",{defaultValue:"Inbound cloned"}),s("inbounds.cloneSuccessBody",{defaultValue:"Inbound cloned successfully."}))},onError:t=>{o.error(s("inbounds.cloneFailedTitle",{defaultValue:"Clone failed"}),(t==null?void 0:t.message)||s("inbounds.cloneFailedBody",{defaultValue:"Failed to clone inbound"}))},onSettled:()=>{Me(null)}}),ps=f.useMemo(()=>({VLESS:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",VMESS:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",TROJAN:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",SHADOWSOCKS:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",SOCKS:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300",HTTP:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-300",DOKODEMO_DOOR:"bg-teal-100 text-teal-800 dark:bg-teal-900/30 dark:text-teal-300",WIREGUARD:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-300",MTPROTO:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300"}),[]),xs=(t,a={})=>{const i=!!a.mobile,c=[];if(c.push({key:"templates",label:s("inbounds.actionMenu.templates",{defaultValue:"Client templates"}),icon:Ot,onClick:()=>A(t)}),c.push({key:"details",label:s("inbounds.actionMenu.details",{defaultValue:"Inbound details"}),icon:ds,onClick:()=>de(t)}),a.includeRandomPort){const j=!!(r.isPending&&je===t.id);c.push({key:"random-port",label:j?s("inbounds.actionMenu.randomPortPending",{defaultValue:"Assigning random port..."}):s("inbounds.actionMenu.randomPort",{defaultValue:"Assign random free port"}),icon:us,disabled:j,onClick:()=>r.mutate(t.id)})}return c.push({key:"clone",label:Ne===t.id&&ns.isPending?s("inbounds.actionMenu.clonePending",{defaultValue:"Cloning..."}):s("inbounds.actionMenu.clone",{defaultValue:"Clone inbound"}),icon:Ft,disabled:!!(Ne===t.id&&ns.isPending),onClick:()=>ns.mutate(t)}),c.push({key:"clone-edit",label:s("inbounds.actionMenu.cloneEdit",{defaultValue:"Clone + edit"}),icon:Ze,onClick:()=>st(t)}),c.push({key:"edit",label:s("inbounds.actionMenu.edit",{defaultValue:"Edit inbound"}),icon:Kt,onClick:()=>{y(null),$(t)}}),D&&c.push({key:"delete",label:s("inbounds.actionMenu.delete",{defaultValue:"Delete inbound"}),icon:Ds,tone:"danger",onClick:()=>void at(t.id)}),c.length===0?null:e.jsx(Nt,{items:c,ariaLabel:s("common.moreActions",{defaultValue:"More actions"}),triggerClassName:`rounded-lg border border-line/60 bg-card/70 px-2 py-1 text-foreground transition hover:bg-panel/70 focus:outline-none focus:ring-2 focus:ring-brand-500/40 disabled:cursor-not-allowed disabled:opacity-50 ${i?"inline-flex h-10 w-10 items-center justify-center":"inline-flex h-8 w-8 items-center justify-center"}`,children:e.jsx(jt,{className:"h-4 w-4"})})},ls=f.useMemo(()=>[...ne].sort((t,a)=>String(t.email||"").localeCompare(String(a.email||""))).slice(0,500),[ne]),os=f.useMemo(()=>[...Ue].sort((t,a)=>String(t.name||"").localeCompare(String(a.name||""))),[Ue]),Hs=f.useMemo(()=>new Set(P.assignUserIds),[P.assignUserIds]),Gs=f.useMemo(()=>new Set(P.assignGroupIds),[P.assignGroupIds]),zs=f.useMemo(()=>{const t=new Map;for(const a of es)t.has(a.values.protocol)||t.set(a.values.protocol,a);return t},[]),qs=f.useMemo(()=>{const t={recommended:[],cdn:[],transport:[],utility:[]};for(const a of es)t[a.category].push(a);return t},[]),ye=t=>{$(null),y(t||null),x(!0)},Ys=()=>{B(t=>({...t,serverAddress:t.serverAddress||"",serverName:t.serverName||"",cdnHost:t.cdnHost||"",fallbackPorts:t.fallbackPorts||"8443,9443"})),ge(null),Q(!0)},Xs=(t,a)=>{B(i=>{const c=new Set(i.assignUserIds);return a?c.add(t):c.delete(t),{...i,assignUserIds:Array.from(c)}})},Js=(t,a)=>{B(i=>{const c=new Set(i.assignGroupIds);return a?c.add(t):c.delete(t),{...i,assignGroupIds:Array.from(c)}})},Qs=()=>{B(t=>({...t,assignUserIds:ls.map(a=>Number(a.id))}))},_s=()=>{B(t=>({...t,assignUserIds:[]}))},Zs=()=>{B(t=>({...t,assignGroupIds:os.map(a=>Number(a.id))}))},et=()=>{B(t=>({...t,assignGroupIds:[]}))},gs=async(t=!1)=>{if(!P.serverAddress.trim()){o.error(s("common.validationFailed",{defaultValue:"Validation failed"}),s("inbounds.myanmarPack.serverAddressRequired",{defaultValue:"Server address is required."}));return}const a={serverAddress:P.serverAddress.trim(),serverName:P.serverName.trim()||P.serverAddress.trim(),cdnHost:P.cdnHost.trim()||void 0,fallbackPorts:P.fallbackPorts.trim()||void 0,userIds:P.assignUserIds,groupIds:P.assignGroupIds,dryRun:t};await Z.mutateAsync(a)},st=t=>{ye(da(t,I))},tt=t=>{const a=zs.get(t);if(a){ye(Qe(a));return}ye(ca(t))},fs=()=>{x(!1),$(null),y(null)},hs=t=>{$e(t);const a=new URLSearchParams(h);a.set("tab",t),M(a,{replace:!0})},bs=()=>{const t=window.prompt(s("inbounds.savedViews.promptName",{defaultValue:"Name this inbounds view"}));if(t)try{const a=Se(t,{tab:K,viewMode:ae});Ke(a.id),o.success(s("inbounds.savedViews.savedTitle",{defaultValue:"View saved"}),s("inbounds.savedViews.savedBody",{defaultValue:'Saved view "{{name}}".',name:a.name}))}catch(a){o.error(s("inbounds.savedViews.saveFailedTitle",{defaultValue:"Save view failed"}),(a==null?void 0:a.message)||s("inbounds.savedViews.saveFailedBody",{defaultValue:"Failed to save view"}))}},ys=t=>{Ke(t);const a=ce.find(i=>i.id===t);a&&(re(a.filters.viewMode||"auto"),hs(a.filters.tab||"inbounds"))},vs=()=>{_&&(Ge(_),Ke(""))},at=async t=>{if(!D){o.error(s("inbounds.permissionDeniedTitle",{defaultValue:"Permission denied"}),s("inbounds.permissionDeniedDeleteBody",{defaultValue:"Only SUPER_ADMIN can delete inbounds."}));return}const a=I.find(i=>i.id===t);xe({type:"single-delete",id:t,label:(a==null?void 0:a.remark)||(a==null?void 0:a.tag)||`#${t}`})},rt=()=>{if(I.length===0){o.error(s("inbounds.export.unavailableTitle",{defaultValue:"Export unavailable"}),s("inbounds.export.unavailableBody",{defaultValue:"No inbounds to export."}));return}const t={app:"One-UI",version:"1.0.0",exportedAt:new Date().toISOString(),inbounds:I.map(Fs)},a=new Blob([JSON.stringify(t,null,2)],{type:"application/json;charset=utf-8"}),i=URL.createObjectURL(a),c=document.createElement("a");c.href=i,c.download=`one-ui-inbounds-${new Date().toISOString().replace(/[:.]/g,"-")}.json`,c.click(),URL.revokeObjectURL(i)},nt=t=>{if(Array.isArray(t))return t.filter(a=>a&&typeof a=="object");if(t&&typeof t=="object"){const a=t;return Array.isArray(a.inbounds)?a.inbounds.filter(i=>i&&typeof i=="object"):[a]}return[]},lt=async t=>{var i;const a=(i=t.target.files)==null?void 0:i[0];if(t.target.value="",!!a)try{const c=await a.text(),j=JSON.parse(c),k=nt(j);if(k.length===0){o.error(s("inbounds.import.failedTitle",{defaultValue:"Import failed"}),s("inbounds.import.noValidProfilesBody",{defaultValue:"No valid inbound profiles found in selected file."}));return}await rs.mutateAsync(k)}catch(c){o.error(s("inbounds.import.failedTitle",{defaultValue:"Import failed"}),(c==null?void 0:c.message)||s("inbounds.import.invalidJsonBody",{defaultValue:"Invalid JSON file"}))}},Je=t=>{if(!Number.isFinite(t)||t<=0)return"0 B";const a=["B","KB","MB","GB","TB","PB"],i=Math.min(Math.floor(Math.log(t)/Math.log(1024)),a.length-1),c=t/1024**i;return`${c.toFixed(c>=100?0:c>=10?1:2)} ${a[i]}`},ot=t=>{const a=new Date(t);if(Number.isNaN(a.getTime()))return null;const i=a.getTime()-Oe;return Math.ceil(i/(1e3*60*60*24))},it=(w==null?void 0:w.type)==="bulk-delete"?s("inbounds.bulkDeleteTitle",{defaultValue:"Delete Selected Inbounds"}):(w==null?void 0:w.type)==="single-delete"?s("inbounds.deleteTitle",{defaultValue:"Delete Inbound"}):"",dt=(w==null?void 0:w.type)==="bulk-delete"?s("inbounds.bulkDeleteBody",{defaultValue:"Delete {{count}} selected inbound(s)? This action cannot be undone.",count:w.ids.length}):(w==null?void 0:w.type)==="single-delete"?s("inbounds.deleteBody",{defaultValue:'Delete inbound "{{name}}"? Associated users may lose access.',name:w.label}):"",Ns=(w==null?void 0:w.type)==="bulk-delete"?be.isPending:(w==null?void 0:w.type)==="single-delete"?Xe.isPending:!1,ct=ae==="auto"?"hidden overflow-hidden p-0 lg:block":ae==="table"?"overflow-hidden p-0":"hidden",ut=ae==="auto"?"grid grid-cols-1 gap-4 lg:hidden":ae==="cards"?"grid grid-cols-1 gap-4":"hidden";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("input",{ref:N,type:"file",accept:"application/json,.json",className:"hidden",onChange:lt}),e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:s("inbounds.title",{defaultValue:"Inbounds"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:s("inbounds.subtitle",{defaultValue:"Manage your Xray inbound configurations and reusable profiles."})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[K==="inbounds"?e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"secondary",onClick:Ae,disabled:I.length===0,children:Te?s("inbounds.clearSelection",{defaultValue:"Clear Selection"}):s("common.selectAll",{defaultValue:"Select All"})}),e.jsxs(p,{variant:"secondary",onClick:rt,children:[e.jsx(Lt,{className:"mr-2 h-4 w-4"}),s("inbounds.exportJson",{defaultValue:"Export JSON"})]}),e.jsxs(p,{variant:"secondary",onClick:()=>{var t;return(t=N.current)==null?void 0:t.click()},loading:rs.isPending,children:[e.jsx(zt,{className:"mr-2 h-4 w-4"}),s("inbounds.importJson",{defaultValue:"Import JSON"})]}),e.jsxs(p,{variant:"secondary",onClick:Ys,loading:Z.isPending,children:[e.jsx(Ss,{className:"mr-2 h-4 w-4"}),s("inbounds.applyMyanmarPack",{defaultValue:"Apply Myanmar Pack"})]})]}):null,e.jsxs(p,{onClick:()=>ye(),children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),s("inbounds.addInbound",{defaultValue:"Add Inbound"})]})]})]}),e.jsx(se,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/40 p-3",children:[e.jsxs("details",{className:"group lg:hidden",children:[e.jsxs("summary",{className:"flex list-none items-center justify-between gap-3 rounded-xl px-2 py-2 text-left text-sm font-medium text-foreground transition hover:bg-panel/50 [&::-webkit-details-marker]:hidden",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate",children:s("common.advancedControls",{defaultValue:"Advanced controls"})}),e.jsx("p",{className:"mt-0.5 text-xs font-normal text-muted",children:s("autoRefresh.line",{defaultValue:"Auto refresh: {{status}} ({{seconds}}s)",status:s(`autoRefresh.status.${ee.status}`,{defaultValue:ee.statusLabel}),seconds:Math.ceil(ee.nextRunInMs/1e3)})})]}),e.jsx(Ps,{className:"h-5 w-5 shrink-0 text-muted transition-transform group-open:rotate-180"})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"min-w-[180px] flex-1 rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",value:_,onChange:t=>ys(t.target.value),children:[e.jsx("option",{value:"",children:s("common.savedViews",{defaultValue:"Saved views"})}),ce.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:bs,children:s("common.saveView",{defaultValue:"Save View"})}),e.jsx(p,{size:"sm",variant:"ghost",onClick:vs,disabled:!_,children:s("common.removeView",{defaultValue:"Remove View"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"inline-flex rounded-xl border border-line/70 bg-card/70 p-1",children:["auto","table","cards"].map(t=>e.jsx("button",{type:"button",onClick:()=>re(t),className:`rounded-lg px-3 py-1.5 text-xs font-medium transition-colors ${ae===t?"bg-gradient-to-r from-brand-500 to-brand-600 text-white":"text-muted hover:text-foreground"}`,children:s(`viewMode.${t}`,{defaultValue:t.toUpperCase()})},t))}),e.jsx(p,{size:"sm",variant:"ghost",onClick:ee.togglePaused,children:ee.paused?s("autoRefresh.resume",{defaultValue:"Resume Auto"}):s("autoRefresh.pause",{defaultValue:"Pause Auto"})})]})]})]}),e.jsxs("div",{className:"hidden items-center justify-between gap-3 lg:flex",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"min-w-[180px] rounded-xl border border-line/80 bg-card/75 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none focus:ring-2 focus:ring-brand-500/35",value:_,onChange:t=>ys(t.target.value),children:[e.jsx("option",{value:"",children:s("common.savedViews",{defaultValue:"Saved views"})}),ce.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:bs,children:s("common.saveView",{defaultValue:"Save View"})}),e.jsx(p,{size:"sm",variant:"ghost",onClick:vs,disabled:!_,children:s("common.removeView",{defaultValue:"Remove View"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"inline-flex rounded-xl border border-line/70 bg-card/70 p-1",children:["auto","table","cards"].map(t=>e.jsx("button",{type:"button",onClick:()=>re(t),className:`rounded-lg px-3 py-1.5 text-xs font-medium transition-colors ${ae===t?"bg-gradient-to-r from-brand-500 to-brand-600 text-white":"text-muted hover:text-foreground"}`,children:s(`viewMode.${t}`,{defaultValue:t.toUpperCase()})},t))}),e.jsx(p,{size:"sm",variant:"ghost",onClick:ee.togglePaused,children:ee.paused?s("autoRefresh.resume",{defaultValue:"Resume Auto"}):s("autoRefresh.pause",{defaultValue:"Pause Auto"})}),e.jsx("span",{className:"text-xs text-muted",children:s("autoRefresh.line",{defaultValue:"Auto refresh: {{status}} ({{seconds}}s)",status:s(`autoRefresh.status.${ee.status}`,{defaultValue:ee.statusLabel}),seconds:Math.ceil(ee.nextRunInMs/1e3)})})]})]})]})}),e.jsx(se,{className:"p-3 sm:p-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-flex min-w-full gap-1 rounded-xl border border-line/70 bg-panel/45 p-1",children:R.map(t=>{const a=K===t.id,i=t.id==="inbounds"?I.length:t.id==="templates"?es.length:void 0;return e.jsxs("button",{type:"button",onClick:()=>hs(t.id),className:`flex min-w-[130px] flex-1 items-center justify-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-colors sm:min-w-[150px] ${a?"bg-gradient-to-r from-brand-500 to-brand-600 text-white shadow-soft":"text-muted hover:bg-card/70 hover:text-foreground"}`,children:[e.jsx("span",{children:t.label}),typeof i=="number"?e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs ${a?"bg-white/20 text-white":"bg-card/80 text-foreground/80"}`,children:i}):null]},t.id)})})})}),K==="inbounds"&&as>0?e.jsx(se,{children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx("p",{className:"text-sm text-foreground",children:s("inbounds.selectedCount",{defaultValue:"{{count}} inbounds selected",count:as})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>{Y([])},disabled:le,children:s("common.clear",{defaultValue:"Clear"})}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>{Bs()},loading:Ce.isPending,disabled:le,children:s("inbounds.bulk.enableSelected",{defaultValue:"Enable Selected"})}),e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>{Ws()},loading:Ve.isPending,disabled:le,children:s("inbounds.bulk.disableSelected",{defaultValue:"Disable Selected"})}),D?e.jsx(p,{size:"sm",variant:"danger",onClick:()=>{$s()},loading:be.isPending,disabled:le,children:s("inbounds.bulk.deleteSelected",{defaultValue:"Delete Selected"})}):null]})]})}):null,K==="templates"?e.jsxs(se,{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4 text-brand-500"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:s("inbounds.templateLibrary.title",{defaultValue:"Template Library"})})]}),e.jsx("div",{className:"space-y-5",children:ea.map(t=>{const a=qs[t];if(a.length===0)return null;const i=L[t];return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:i.title}),e.jsx("p",{className:"text-xs text-muted",children:i.hint})]}),e.jsx("span",{className:"rounded-full border border-line/70 bg-panel/70 px-2.5 py-1 text-xs text-muted",children:s("inbounds.templateLibrary.count",{defaultValue:"{{count}} templates",count:a.length})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:a.map(c=>e.jsxs("div",{className:"rounded-xl border border-line/70 bg-card/65 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("p",{className:"mr-1 text-sm font-semibold text-foreground",children:c.name}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:c.values.protocol}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:c.values.network}),e.jsx("span",{className:"rounded-md border border-line/70 bg-panel/70 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-foreground/90",children:c.values.security})]}),e.jsx("p",{className:"mt-1 text-xs leading-relaxed text-muted",children:c.description}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1.5",children:c.highlights.map(j=>e.jsx("span",{className:"rounded-md border border-brand-500/25 bg-brand-500/10 px-2 py-0.5 text-[10px] font-medium text-brand-700 dark:text-brand-300",children:j},`${c.id}-${j}`))}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>te(c),children:[e.jsx(ds,{className:"mr-1 h-4 w-4"}),s("common.preview",{defaultValue:"Preview"})]}),e.jsx(p,{size:"sm",onClick:()=>{ye(Qe(c))},children:s("inbounds.templateLibrary.useTemplate",{defaultValue:"Use Template"})})]})]},c.id))})]},t)})})]}):null,K==="compatibility"?e.jsx(Zt,{onQuickCreate:tt}):null,K==="inbounds"&&ue?e.jsx(se,{children:e.jsx("div",{className:"space-y-4 p-2",children:Array.from({length:5}).map((t,a)=>e.jsxs("div",{className:"flex items-center gap-4 rounded-xl border border-line/40 p-4",children:[e.jsx(We,{className:"h-8 w-20 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(We,{className:"h-4 w-1/3"}),e.jsx(We,{className:"h-3 w-1/5"})]}),e.jsx(We,{className:"h-6 w-16 rounded-full"}),e.jsx(We,{className:"h-8 w-8 rounded-lg"})]},a))})}):K==="inbounds"&&I.length===0?e.jsx(se,{children:e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"mb-4 text-muted",children:s("inbounds.empty",{defaultValue:"No inbounds configured yet."})}),e.jsxs(p,{onClick:()=>ye(),children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),s("inbounds.addFirst",{defaultValue:"Add Your First Inbound"})]})]})}):K==="inbounds"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:s("inbounds.stats.total",{defaultValue:"Total Inbounds"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:I.length})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:s("inbounds.stats.onlineClients",{defaultValue:"Online Clients"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:b.size})]}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted",children:s("inbounds.stats.expanded",{defaultValue:"Expanded Rows"})}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-foreground",children:we.length})]})]})}),e.jsx(se,{className:ct,children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[1080px] w-full text-sm",children:[e.jsx("thead",{className:"bg-panel/70",children:e.jsxs("tr",{className:"border-b border-line/70 text-left text-xs uppercase tracking-wide text-muted",children:[e.jsx("th",{className:"px-3 py-3",children:s("common.select",{defaultValue:"Select"})}),e.jsx("th",{className:"px-3 py-3",children:s("common.details",{defaultValue:"Details"})}),e.jsx("th",{className:"px-3 py-3",children:s("common.enabled",{defaultValue:"Enabled"})}),e.jsx("th",{className:"px-3 py-3",children:s("inbounds.remark",{defaultValue:"Remark"})}),e.jsx("th",{className:"px-3 py-3",children:s("inbounds.port",{defaultValue:"Port"})}),e.jsx("th",{className:"px-3 py-3",children:s("inbounds.protocol",{defaultValue:"Protocol"})}),e.jsx("th",{className:"px-3 py-3",children:s("inbounds.clients",{defaultValue:"Clients"})}),e.jsx("th",{className:"px-3 py-3",children:s("inbounds.traffic",{defaultValue:"Traffic"})}),e.jsx("th",{className:"px-3 py-3",children:s("common.actions",{defaultValue:"Actions"})})]})}),e.jsx("tbody",{children:I.map(t=>{var H;const a=g.get(t.id)||[],i=a.filter(E=>b.has(E.uuid)).length,c=a.reduce((E,J)=>E+J.totalUsed,0),j=a.reduce((E,J)=>E+J.dataLimit,0),k=j>0?Math.min(c/j*100,100):0,X=we.includes(t.id);return e.jsxs(pe.Fragment,{children:[e.jsxs("tr",{className:"border-b border-line/70 hover:bg-panel/35",children:[e.jsx("td",{className:"px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:q.includes(t.id),onChange:()=>U(t.id),className:"h-4 w-4 rounded border-line/70 bg-card text-brand-500 focus:ring-brand-500/50"})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("button",{type:"button",onClick:()=>W(t.id),className:"inline-flex items-center gap-1 rounded-md border border-line/70 px-2 py-1 text-xs text-muted transition-colors hover:bg-card/80 hover:text-foreground",children:[X?e.jsx(Ps,{className:"h-4 w-4"}):e.jsx($t,{className:"h-4 w-4"}),X?s("common.hide",{defaultValue:"Hide"}):s("common.show",{defaultValue:"Show"})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("button",{type:"button",onClick:()=>Be.mutate(t.id),className:`inline-flex items-center gap-2 rounded-full border px-2.5 py-1 text-xs ${t.enabled?"border-green-400/50 bg-green-500/10 text-green-300":"border-amber-400/50 bg-amber-500/10 text-amber-300"}`,children:t.enabled?s("common.on",{defaultValue:"On"}):s("common.off",{defaultValue:"Off"})})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-foreground",children:t.remark||t.tag}),e.jsx("span",{className:"text-xs text-muted",children:t.tag})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-foreground",children:t.port}),e.jsxs("button",{type:"button",onClick:()=>r.mutate(t.id),disabled:r.isPending&&je===t.id,className:"inline-flex items-center gap-1 rounded-md border border-line/70 px-2 py-1 text-xs text-muted transition-colors hover:bg-card/80 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",title:s("inbounds.randomPortTitle",{defaultValue:"Assign random free port"}),children:[e.jsx(us,{className:"h-3.5 w-3.5"}),s("inbounds.randomPort",{defaultValue:"Random"})]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs font-medium ${ps[t.protocol]}`,children:t.protocol}),e.jsxs("span",{className:"text-xs text-muted",children:[t.network,"/",t.security]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-foreground",children:s("inbounds.onlineTotal",{defaultValue:"{{online}} online / {{total}} total",online:i,total:a.length})}),e.jsx("p",{className:"text-xs text-muted",children:s("inbounds.assignedCount",{defaultValue:"Assigned: {{count}}",count:((H=t._count)==null?void 0:H.userInbounds)||0})})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"w-40",children:[e.jsxs("p",{className:"text-xs text-muted",children:[Je(c)," / ",j>0?Je(j):"∞"]}),e.jsx("div",{className:"mt-1 h-2 rounded-full bg-panel/80",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-brand-500 to-brand-600",style:{width:`${k}%`}})})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"flex justify-end",children:xs(t)})})]}),X?e.jsx("tr",{className:"border-b border-line/70 bg-panel/30",children:e.jsx("td",{colSpan:9,className:"px-4 py-4",children:a.length===0?e.jsx("p",{className:"text-sm text-muted",children:s("inbounds.noClients",{defaultValue:"No clients assigned to this inbound yet."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[880px] w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs uppercase tracking-wide text-muted",children:[e.jsx("th",{className:"px-2 py-2",children:s("common.client",{defaultValue:"Client"})}),e.jsx("th",{className:"px-2 py-2",children:s("common.online",{defaultValue:"Online"})}),e.jsx("th",{className:"px-2 py-2",children:s("common.status",{defaultValue:"Status"})}),e.jsx("th",{className:"px-2 py-2",children:s("inbounds.traffic",{defaultValue:"Traffic"})}),e.jsx("th",{className:"px-2 py-2",children:s("common.expiry",{defaultValue:"Expiry"})}),e.jsx("th",{className:"px-2 py-2",children:s("common.action",{defaultValue:"Action"})})]})}),e.jsx("tbody",{children:a.map(E=>{const J=b.has(E.uuid),oe=E.dataLimit,ve=oe>0?Math.min(E.totalUsed/oe*100,100):0,is=ot(E.expireDate);return e.jsxs("tr",{className:"border-t border-line/70",children:[e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-foreground",children:E.email}),e.jsxs("span",{className:"text-xs text-muted",children:[E.uuid.slice(0,10),"..."]})]})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs ${J?"bg-green-500/15 text-green-300":"bg-zinc-500/15 text-zinc-300"}`,children:J?s("common.online",{defaultValue:"Online"}):s("common.offline",{defaultValue:"Offline"})})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs ${E.status==="ACTIVE"?"bg-emerald-500/15 text-emerald-300":"bg-amber-500/15 text-amber-300"}`,children:E.status})}),e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"w-48",children:[e.jsxs("p",{className:"text-xs text-muted",children:[Je(E.totalUsed)," / ",oe>0?Je(oe):"∞"]}),e.jsx("div",{className:"mt-1 h-2 rounded-full bg-panel/80",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-brand-500 to-brand-600",style:{width:`${ve}%`}})})]})}),e.jsx("td",{className:"px-2 py-2 text-xs text-muted",children:is===null?s("common.na",{defaultValue:"N/A"}):is>0?s("common.daysLeft",{defaultValue:"{{count}}d left",count:is}):s("common.expired",{defaultValue:"Expired"})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx(p,{size:"sm",variant:"secondary",onClick:()=>d(`/users/${E.id}`),children:s("common.view",{defaultValue:"View"})})})]},`${t.id}-${E.id}`)})})]})})})}):null]},t.id)})})]})})}),e.jsx("div",{className:ut,children:I.map(t=>{const a=g.get(t.id)||[],i=a.filter(c=>b.has(c.uuid)).length;return e.jsx(se,{className:"transition-shadow hover:shadow-lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:`inline-block rounded-full px-3 py-1 text-sm font-medium ${ps[t.protocol]}`,children:t.protocol}),e.jsx("h3",{className:"mt-2 text-base font-semibold text-foreground",children:t.remark||t.tag}),e.jsxs("p",{className:"text-xs text-muted",children:[s("inbounds.portLabel",{defaultValue:"Port"})," ",t.port," • ",t.network,"/",t.security]})]}),e.jsx(Rs,{variant:t.enabled?"success":"warning",children:t.enabled?s("common.active",{defaultValue:"Active"}):s("common.disabled",{defaultValue:"Disabled"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted",children:s("inbounds.clients",{defaultValue:"Clients"})}),e.jsxs("span",{className:"text-foreground",children:[i," online / ",a.length," total"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 border-t border-line/70 pt-3",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>Be.mutate(t.id),children:[t.enabled?e.jsx(kt,{className:"mr-1 h-4 w-4"}):e.jsx(St,{className:"mr-1 h-4 w-4"}),t.enabled?s("common.disable",{defaultValue:"Disable"}):s("common.enable",{defaultValue:"Enable"})]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>de(t),children:[e.jsx(ds,{className:"h-4 w-4"}),s("common.details",{defaultValue:"Details"})]}),e.jsx("div",{className:"ml-auto flex items-center",children:xs(t,{mobile:!0,includeRandomPort:!0})})]})]})},`mobile-${t.id}`)})})]}):null,He?e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-2 backdrop-blur-sm sm:items-center sm:p-4",children:e.jsxs("div",{className:"w-full max-w-xl rounded-2xl border border-line/80 bg-card/95 shadow-soft",children:[e.jsxs("div",{className:"border-b border-line/70 px-5 py-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s("inbounds.myanmarPack.title",{defaultValue:"Apply Myanmar Resilience Pack"})}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:s("inbounds.myanmarPack.subtitle",{defaultValue:"Creates three optimized profiles: VLESS REALITY XHTTP, VLESS WS TLS, and Trojan WS TLS."})})]}),e.jsxs("div",{className:"space-y-4 px-5 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:s("inbounds.myanmarPack.serverAddress",{defaultValue:"Server Address"})}),e.jsx("input",{value:P.serverAddress,onChange:t=>B(a=>({...a,serverAddress:t.target.value})),placeholder:"your.domain.com",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:s("inbounds.myanmarPack.serverName",{defaultValue:"Server Name (SNI)"})}),e.jsx("input",{value:P.serverName,onChange:t=>B(a=>({...a,serverName:t.target.value})),placeholder:"your.domain.com",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:s("inbounds.myanmarPack.cdnHost",{defaultValue:"CDN Host (optional)"})}),e.jsx("input",{value:P.cdnHost,onChange:t=>B(a=>({...a,cdnHost:t.target.value})),placeholder:"cdn.your.domain.com",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-foreground",children:s("inbounds.myanmarPack.fallbackPorts",{defaultValue:"Fallback Ports"})}),e.jsx("input",{value:P.fallbackPorts,onChange:t=>B(a=>({...a,fallbackPorts:t.target.value})),placeholder:"8443,9443",className:"w-full rounded-lg border border-line/70 bg-panel/60 px-3 py-2 text-sm text-foreground focus:border-brand-500/60 focus:outline-none"}),e.jsx("p",{className:"mt-1 text-xs text-muted",children:s("inbounds.myanmarPack.fallbackPortsHint",{defaultValue:"Comma-separated ports used for WS/TLS fallback profiles."})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-line/70 bg-panel/45 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s("inbounds.myanmarPack.assignUsers",{defaultValue:"Assign to Users"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:Qs,children:s("common.all",{defaultValue:"All"})}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:_s,children:s("common.clear",{defaultValue:"Clear"})})]})]}),e.jsx("p",{className:"mb-2 text-xs text-muted",children:s("inbounds.myanmarPack.assignUsersHint",{defaultValue:"Optional. Adds created profiles to selected users without removing existing keys."})}),e.jsx("div",{className:"max-h-40 space-y-1 overflow-auto pr-1",children:ls.length===0?e.jsx("p",{className:"text-xs text-muted",children:s("inbounds.myanmarPack.noUsers",{defaultValue:"No users found."})}):ls.map(t=>{const a=Number(t.id);return e.jsxs("label",{className:"flex items-center gap-2 rounded-md px-1 py-1 text-xs text-foreground hover:bg-panel/55",children:[e.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-line/70 bg-card/90",checked:Hs.has(a),onChange:i=>Xs(a,i.target.checked)}),e.jsx("span",{className:"truncate",children:t.email})]},`mm-pack-user-${a}`)})})]}),e.jsxs("div",{className:"rounded-lg border border-line/70 bg-panel/45 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s("inbounds.myanmarPack.assignGroups",{defaultValue:"Assign to Groups"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:Zs,children:s("common.all",{defaultValue:"All"})}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:et,children:s("common.clear",{defaultValue:"Clear"})})]})]}),e.jsx("p",{className:"mb-2 text-xs text-muted",children:s("inbounds.myanmarPack.assignGroupsHint",{defaultValue:"Optional. Merges created profiles into selected groups while keeping existing assignments."})}),e.jsx("div",{className:"max-h-40 space-y-1 overflow-auto pr-1",children:os.length===0?e.jsx("p",{className:"text-xs text-muted",children:s("inbounds.myanmarPack.noGroups",{defaultValue:"No groups found."})}):os.map(t=>{const a=Number(t.id);return e.jsxs("label",{className:"flex items-center gap-2 rounded-md px-1 py-1 text-xs text-foreground hover:bg-panel/55",children:[e.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-line/70 bg-card/90",checked:Gs.has(a),onChange:i=>Js(a,i.target.checked)}),e.jsx("span",{className:"truncate",children:t.name})]},`mm-pack-group-${a}`)})})]})]}),z!=null&&z.planned&&z.planned.length>0?e.jsxs("div",{className:"space-y-2 rounded-lg border border-line/70 bg-panel/50 p-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s("inbounds.myanmarPack.previewPlan",{defaultValue:"Preview Plan"})}),e.jsx("div",{className:"space-y-1 text-xs text-muted",children:z.planned.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-md bg-panel/60 px-2 py-1",children:[e.jsxs("span",{className:"text-foreground",children:[String(t.protocol||"INBOUND")," • ",String(t.network||"TCP")," • ",String(t.security||"NONE")]}),e.jsx("span",{children:String(t.port||"-")})]},`${t.tag||t.protocol||a}`))}),z.warnings&&z.warnings.length>0?e.jsx("div",{className:"space-y-1 rounded-md border border-amber-500/30 bg-amber-500/10 px-2 py-2 text-xs text-amber-300",children:z.warnings.map(t=>e.jsx("p",{children:t},t))}):null]}):null]}),e.jsxs("div",{className:"flex items-center gap-3 border-t border-line/70 px-5 py-4",children:[e.jsx(p,{variant:"secondary",onClick:()=>{gs(!0)},loading:Z.isPending,className:"flex-1",children:s("inbounds.myanmarPack.previewPlan",{defaultValue:"Preview Plan"})}),e.jsx(p,{onClick:()=>{gs(!1)},loading:Z.isPending,className:"flex-1",children:s("inbounds.myanmarPack.applyPack",{defaultValue:"Apply Pack"})}),e.jsx(p,{variant:"secondary",onClick:()=>Q(!1),className:"flex-1",children:s("common.cancel",{defaultValue:"Cancel"})})]})]})}):null,V||m?e.jsx(Qt,{inbound:m||void 0,initialValues:u||void 0,onClose:fs,onSuccess:async()=>{fs(),await l.invalidateQueries({queryKey:["inbounds"]})}}):null,O?e.jsx(Pt,{inbound:O,onClose:()=>A(null)}):null,F?e.jsx(Xt,{inbound:F,clients:g.get(F.id)||[],sessionsByUuid:n,actionLoadingKey:Re,onClose:()=>de(null),onViewUser:t=>d(`/users/${t}`),onToggleAccess:t=>{Ee(`u${t.id}-toggle`,async()=>{await T.post(`/users/${t.id}/inbounds/${F.id}/toggle`,{enabled:!t.enabled})},"Failed to toggle user key access")},onResetTraffic:t=>{Ee(`u${t.id}-reset`,async()=>{await T.post(`/users/${t.id}/reset-traffic`)},"Failed to reset user traffic")},onExtendExpiry:(t,a)=>{Ee(`u${t.id}-extend${a}`,async()=>{await T.post(`/users/${t.id}/extend-expiry`,{days:a})},"Failed to extend user expiry")},onDisableUser:t=>{Ee(`u${t.id}-disable`,async()=>{await T.put(`/users/${t.id}`,{status:"DISABLED"})},"Failed to disable user")},onDecreasePriority:t=>{Ee(`u${t.id}-priority-down`,async()=>{await T.patch(`/users/${t.id}/inbounds/${F.id}/priority`,{priority:Math.max(1,Number(t.priority||100)-1)})},"Failed to update key priority")},onIncreasePriority:t=>{Ee(`u${t.id}-priority-up`,async()=>{await T.patch(`/users/${t.id}/inbounds/${F.id}/priority`,{priority:Math.min(9999,Number(t.priority||100)+1)})},"Failed to update key priority")}}):null,v?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/55 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl border border-line/80 bg-card/95 p-5 shadow-soft",children:[e.jsx("div",{className:"mb-3 flex items-start justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:v.name}),e.jsx("p",{className:"mt-1 text-sm text-muted",children:v.description})]})}),e.jsxs("div",{className:"rounded-xl border border-line/70 bg-panel/60 p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-semibold uppercase tracking-wider text-muted",children:s("inbounds.templateLibrary.jsonPreview",{defaultValue:"Template JSON Preview"})}),e.jsx("pre",{className:"max-h-[48vh] overflow-auto rounded-lg bg-card/80 p-3 text-xs text-foreground",children:JSON.stringify(Qe(v),null,2)})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-end gap-2",children:[e.jsx(p,{variant:"secondary",onClick:()=>te(null),children:s("common.close",{defaultValue:"Close"})}),e.jsx(p,{onClick:()=>{ye(Qe(v)),te(null)},children:s("inbounds.templateLibrary.useTemplate",{defaultValue:"Use Template"})})]})]})}):null,e.jsx(wt,{open:!!w,title:it,description:dt,confirmLabel:s("common.delete",{defaultValue:"Delete"}),cancelLabel:s("common.cancel",{defaultValue:"Cancel"}),tone:"danger",loading:Ns,onCancel:()=>{Ns||xe(null)},onConfirm:()=>{Us()}}),Ye&&!ue?e.jsx("div",{className:"fixed bottom-24 right-4 z-40 rounded-full border border-line/80 bg-card/90 px-3 py-1 text-xs text-muted shadow-soft lg:bottom-6",children:s("inbounds.refreshing",{defaultValue:"Refreshing inbounds..."})}):null]})},Wa=ua;export{ua as Inbounds,Wa as InboundsPage};
