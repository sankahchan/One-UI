# Application
NODE_ENV=development
PORT=3000
API_VERSION=v1

# Database
DATABASE_URL=postgresql://postgres:changeme@db:5432/xray_panel

# JWT
JWT_SECRET=your_super_secret_jwt_key_change_this_in_production
JWT_EXPIRY=7d
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=30d

# Auth Security
AUTH_REQUIRE_2FA_SUPER_ADMIN=false
AUTH_STRICT_SESSION_BINDING=false
AUTH_REQUIRE_SESSION_CLAIM=false
AUTH_LOCKOUT_MAX_ATTEMPTS=5
AUTH_LOCKOUT_MINUTES=15
ADMIN_IP_ALLOWLIST=
ADMIN_REQUIRE_PRIVATE_IP=false
SECRETS_ENCRYPTION_KEY=
SECRETS_ENCRYPTION_REQUIRED=false

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=2000
AUTH_RATE_LIMIT_MAX=10
AUTH_REFRESH_RATE_LIMIT_MAX=120
AUTH_PROFILE_RATE_LIMIT_MAX=30

# Logging
LOG_LEVEL=info

# Xray Core Base Image (used by docker-compose xray build args)
XRAY_BASE_IMAGE=ghcr.io/xtls/xray-core:latest
XRAY_STABLE_IMAGE=ghcr.io/xtls/xray-core:latest
XRAY_UPDATE_SCRIPT=/opt/one-ui/scripts/update-xray-core.sh
COMPOSE_FILE=/opt/one-ui/docker-compose.yml
XRAY_UPDATE_REQUIRE_CANARY=true
XRAY_UPDATE_CANARY_WINDOW_MINUTES=360
XRAY_UPDATE_TIMEOUT_MS=1200000
XRAY_UPDATE_DEFAULT_CHANNEL=stable
XRAY_UPDATE_MODE=
XRAY_STARTUP_SELF_HEAL=true
XRAY_UPDATE_LOCK_NAME=one-ui-xray-update
XRAY_UPDATE_LOCK_TTL_SECONDS=1320
XRAY_UPDATE_PREFLIGHT_TIMEOUT_MS=8000
XRAY_UPDATE_CONTAINER_NAME=xray-core
XRAY_UPDATE_STUCK_LOCK_THRESHOLD_MS=1260000
XRAY_UPDATE_STUCK_LOCK_ALERT_INTERVAL_MS=1800000
ALERT_WEBHOOK_SECRET=change_this_alert_secret
XRAY_RELEASE_REPO=XTLS/Xray-core
XRAY_RELEASE_CACHE_TTL_MS=300000

# Mieru Sidecar (GPL-safe external runtime integration)
MIERU_ENABLED=false
MIERU_RUNTIME_MODE=docker
MIERU_CONTAINER_NAME=mieru-sidecar
MIERU_SERVICE_NAME=mieru
MIERU_COMPOSE_FILE=/opt/one-ui/docker-compose.yml
MIERU_HEALTH_URL=
MIERU_COMMAND_TIMEOUT_MS=7000
MIERU_AUTO_SYNC=true
MIERU_CONFIG_PATH=/opt/one-ui/mieru/server_config.json
MIERU_STATE_PATH=/opt/one-ui/mieru/oneui_sync_state.json
MIERU_USERS_JSON_PATH=users
MIERU_SYNC_RESTART=true
MIERU_SYNC_REQUIRE_RESTART=false
MIERU_SYNC_MAX_USERS=50000
MIERU_SYNC_DEBOUNCE_MS=1500
MIERU_SYNC_INCLUDE_NON_ACTIVE_USERS=false
MIERU_VERSION_COMMAND=mita version || mieru version
MIERU_RESTART_COMMAND=
MIERU_LOG_PATH=
MIERU_RESTART_ALERT_THRESHOLD=3
MIERU_RESTART_ALERT_WINDOW_SECONDS=600
MIERU_RESTART_ALERT_COOLDOWN_SECONDS=900

# Signed Webhook Event Bus
WEBHOOK_ENABLED=false
WEBHOOK_URL=
WEBHOOK_SECRET=
WEBHOOK_TIMEOUT_MS=10000
WEBHOOK_RETRY_ATTEMPTS=3
WEBHOOK_RETRY_DELAY_MS=1000
NOTIFICATION_MATRIX_JSON=
NOTIFICATION_DEFAULT_WEBHOOK=true
NOTIFICATION_DEFAULT_TELEGRAM=false
NOTIFICATION_DEFAULT_SYSTEM_LOG=true
ALERT_WEBHOOK_SECRET=change_this_alert_secret

# CORS
CORS_ORIGIN=*

# Public Subscription URL (optional)
SUBSCRIPTION_URL=http://localhost:3000

# Telegram Bot
TELEGRAM_ENABLED=true
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather
TELEGRAM_BOT_USERNAME=your_bot_username
TELEGRAM_OAUTH_ENABLED=false
TELEGRAM_OAUTH_MAX_AGE_SECONDS=86400
TELEGRAM_OAUTH_LINK_BY_USERNAME=true
TELEGRAM_ADMIN_IDS=123456789,987654321
TELEGRAM_POLLING=true
TELEGRAM_REPORT_CRON=0 9 * * *
TELEGRAM_NOTIFY_EXPIRY_DAYS=7
TELEGRAM_NOTIFY_DATA_THRESHOLD=10
TELEGRAM_ALERTS_ENABLED=true

# Scheduled Jobs
JOBS_ENABLED=true
TRAFFIC_MONITOR_CRON=*/10 * * * *
EXPIRY_CHECK_CRON=0 * * * *
SSL_RENEW_CRON=0 3 * * *
SMART_FALLBACK_ENABLED=true
SMART_FALLBACK_CRON=*/15 * * * *
SMART_FALLBACK_WINDOW_MINUTES=60
SMART_FALLBACK_MIN_KEYS=2

# SSL / ACME
SSL_ENABLED=true
SSL_DOMAIN=yourdomain.com
SSL_EMAIL=admin@yourdomain.com
SSL_CERT_PATH=/var/lib/xray-panel/certs
SSL_KEY_PATH=/var/lib/xray-panel/certs/key.pem
SSL_RENEW_DAYS=30
SSL_RELOAD_CMD=
ACME_HOME=/root/.acme.sh
ACME_SH_PATH=/root/.acme.sh/acme.sh

# Cloudflare DNS API
CLOUDFLARE_API_TOKEN=
CLOUDFLARE_ZONE_ID=
CLOUDFLARE_EMAIL=your@email.com
CLOUDFLARE_ACCOUNT_EMAIL=your@email.com
CLOUDFLARE_API_KEY=
CLOUDFLARE_DOMAIN=
CLOUDFLARE_TARGET_IP=

# Xray
XRAY_BINARY_PATH=xray
XRAY_CONFIG_PATH=/etc/xray/config.json
XRAY_DEPLOYMENT=docker
XRAY_LOG_LEVEL=warning
XRAY_PID_PATH=/tmp/xray-panel-xray.pid
XRAY_API_SERVICES=StatsService,HandlerService,LoggerService,RoutingService
XRAY_TRAFFIC_SYNC_ENABLED=true
XRAY_API_URL=http://127.0.0.1:10085
XRAY_API_SERVER=127.0.0.1:10085
XRAY_API_CLI_TIMEOUT_MS=7000
XRAY_API_LISTEN=127.0.0.1
XRAY_API_ADDRESS=127.0.0.1
XRAY_AUTO_RELOAD=false
XRAY_AUTO_RELOAD_STRICT=false
TRAFFIC_SYNC_INTERVAL=60
XRAY_OBSERVATORY_ENABLED=false
XRAY_OBSERVATORY_SELECTORS=proxy
XRAY_OBSERVATORY_PROBE_URL=https://www.gstatic.com/generate_204
XRAY_OBSERVATORY_PROBE_INTERVAL=1m
XRAY_BALANCER_ENABLED=false
XRAY_BALANCER_TAG=auto-balance
XRAY_BALANCER_SELECTORS=proxy
XRAY_BALANCER_STRATEGY=leastPing
XRAY_BALANCER_INBOUND_TAGS=
XRAY_HOT_RELOAD_ENABLED=true
XRAY_WRITE_CONFDIR=false
XRAY_CONF_DIR=/etc/xray/conf.d
XRAY_CONFIG_SNAPSHOT_DIR=/etc/xray/snapshots
XRAY_CONFIG_SNAPSHOT_RETENTION=20
XRAY_ROUTING_PROFILE_PATH=/var/lib/xray-panel/runtime/xray-routing-profile.json
XRAY_GEODATA_UPDATE_COMMAND=
XRAY_GEODATA_UPDATE_TIMEOUT_MS=300000
XRAY_GEO_PATH=/usr/local/share/xray
XRAY_GEOSITE_PATH=/usr/local/share/xray/geosite.dat
XRAY_GEOIP_PATH=/usr/local/share/xray/geoip.dat
XRAY_GEOSITE_URL=https://github.com/v2fly/domain-list-community/releases/latest/download/dlc.dat
XRAY_GEOIP_URL=https://github.com/v2fly/geoip/releases/latest/download/geoip.dat
XRAY_GEOSITE_CHECKSUM_URL=https://github.com/v2fly/domain-list-community/releases/latest/download/dlc.dat.sha256sum
XRAY_GEOIP_CHECKSUM_URL=https://github.com/v2fly/geoip/releases/latest/download/geoip.dat.sha256sum

# Startup Gates (fail-fast safety checks)
STARTUP_MIGRATION_GATE=true
STARTUP_MIGRATION_CMD=npx prisma migrate deploy
STARTUP_HEALTH_GATE=true
STARTUP_HEALTH_GATE_STRICT=false
STARTUP_HEALTH_GATE_TIMEOUT_MS=7000
STARTUP_HEALTH_REQUIRE_XRAY=false

# Realtime online heartbeat
USER_ONLINE_TTL_SECONDS=60
USER_ONLINE_IDLE_TTL_SECONDS=75
USER_ONLINE_DEVICE_TTL_SECONDS=60
USER_ONLINE_REFRESH_INTERVAL_SECONDS=5
DEVICE_TRACKING_TTL_SECONDS=1800
SECURITY_RULES_ENABLED=true
MYANMAR_DEFAULTS_ENABLED=true

# Worker runtime (inline: API runs jobs, separate: use npm run worker, worker: worker-only process)
WORKER_MODE=inline
WORKER_LOCK_NAME=one-ui-jobs
WORKER_LOCK_TTL_SECONDS=45
WORKER_HEARTBEAT_INTERVAL_SECONDS=15
WORKER_RETRY_MS=10000

# Subscription branding
SUBSCRIPTION_BRANDING_ENABLED=true

# Analytics snapshots
ANALYTICS_SNAPSHOTS_ENABLED=true
ANALYTICS_SNAPSHOT_INTERVAL_SECONDS=300
ANALYTICS_SPIKE_FACTOR=2.5
ANALYTICS_MIN_SPIKE_BYTES=10485760

# System Monitoring
SYSTEM_MONITOR_ENABLED=true
SYSTEM_MONITOR_INTERVAL=300
SYSTEM_MONITOR_ALERT_COOLDOWN=1800
CPU_THRESHOLD=80
MEMORY_THRESHOLD=80
DISK_THRESHOLD=80

# Backup
BACKUP_ENABLED=false
BACKUP_DIR=/var/backups/xray-panel
BACKUP_RETENTION_DAYS=7
BACKUP_SCHEDULE=0 2 * * *
BACKUP_USE_DOCKER=true
BACKUP_DB_DOCKER_CONTAINER=xray-panel-db
S3_ENABLED=false
S3_BUCKET=
